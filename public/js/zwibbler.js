(function(){var aa="function"==typeof Object.defineProperties?Object.defineProperty:function(c,a,b){c!=Array.prototype&&c!=Object.prototype&&(c[a]=b.value)},ba="undefined"!=typeof window&&window===this?this:"undefined"!=typeof global&&null!=global?global:this;function ca(c,a){if(a){for(var b=ba,d=c.split("."),e=0;e<d.length-1;e++){var f=d[e];f in b||(b[f]={});b=b[f]}d=d[d.length-1];e=b[d];f=a(e);f!=e&&null!=f&&aa(b,d,{configurable:!0,writable:!0,value:f})}}var da;
if("function"==typeof Object.setPrototypeOf)da=Object.setPrototypeOf;else{var ea;a:{var fa={Fp:!0},ha={};try{ha.__proto__=fa;ea=ha.Fp;break a}catch(c){}ea=!1}da=ea?function(c,a){c.__proto__=a;if(c.__proto__!==a)throw new TypeError(c+" is not extensible");return c}:null}var ia=da;ca("Object.setPrototypeOf",function(c){return c||ia});function ja(){ja=function(){};ba.Symbol||(ba.Symbol=ka)}var ka=function(){var c=0;return function(a){return"jscomp_symbol_"+(a||"")+c++}}();
function la(){ja();var c=ba.Symbol.iterator;c||(c=ba.Symbol.iterator=ba.Symbol("iterator"));"function"!=typeof Array.prototype[c]&&aa(Array.prototype,c,{configurable:!0,writable:!0,value:function(){return ma(this)}});la=function(){}}function ma(c){var a=0;return na(function(){return a<c.length?{done:!1,value:c[a++]}:{done:!0}})}function na(c){la();c={next:c};c[ba.Symbol.iterator]=function(){return this};return c}
function oa(c,a){la();c instanceof String&&(c+="");var b=0,d={next:function(){if(b<c.length){var e=b++;return{value:a(e,c[e]),done:!1}}d.next=function(){return{done:!0,value:void 0}};return d.next()}};d[Symbol.iterator]=function(){return d};return d}ca("Array.prototype.keys",function(c){return c?c:function(){return oa(this,function(a){return a})}});ca("Array.prototype.values",function(c){return c?c:function(){return oa(this,function(a,b){return b})}});
ca("Array.prototype.fill",function(c){return c?c:function(a,b,d){var e=this.length||0;0>b&&(b=Math.max(0,e+b));if(null==d||d>e)d=e;d=Number(d);0>d&&(d=Math.max(0,e+d));for(b=Number(b||0);b<d;b++)this[b]=a;return this}});ca("Array.prototype.find",function(c){return c?c:function(a,b){a:{var d=this;d instanceof String&&(d=String(d));for(var e=d.length,f=0;f<e;f++){var c=d[f];if(a.call(b,c,f,d)){d=c;break a}}d=void 0}return d}});
var p=function(){var c=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var d in b)b.hasOwnProperty(d)&&(a[d]=b[d])};return function(a,b){function d(){this.constructor=a}c(a,b);a.prototype=null===b?Object.create(b):(d.prototype=b.prototype,new d)}}();function pa(c){return"object"===typeof c&&"[object Array]"===Object.prototype.toString.apply(c)}function qa(c){return"string"===typeof c}function r(c){return"number"===typeof c}function ra(c){return"object"===typeof c};var t=function(){function c(){this.keys={}}c.prototype.contains=function(a){return a in this.keys};c.prototype.add=function(a){if(a instanceof Array)for(var b=0;b<a.length;b++)this.keys[a[b]]=!0;else this.keys[a]=!0};c.prototype.remove=function(a){delete this.keys[a]};c.prototype.Of=function(a){var b,d;void 0===d&&(d="");if(!(a instanceof c))throw d||"Assertion failed";d=new c;for(b in this.keys)a.contains(b)||d.add(b);return d};c.prototype.ec=function(){var a;var b=[];for(a in this.keys)this.keys.hasOwnProperty(a)&&
b.push(a);return b};c.prototype.td=function(){var a;var b=[];for(a in this.keys)this.keys.hasOwnProperty(a)&&b.push(parseFloat(a));return b};c.prototype.clear=function(){this.keys={}};c.prototype.yb=function(a){for(var b in this.keys)if(this.keys.hasOwnProperty(b)&&a(b))break};c.prototype.empty=function(){for(var a in this.keys)if(this.keys.hasOwnProperty(a))return!1;return!0};return c}();var w=new (function(){function c(){this.dn={};this.Um={}}c.prototype.add=function(a,b){w.dn[a]=b};c.prototype.Dj=function(a,b){w.Um[a]=b};c.prototype.encode=function(a,b){for(var d=a.split(","),e=b,f=0;f<d.length;f++)e=w.dn[d[f]](e);return e};c.prototype.decode=function(a,b){for(var d=a.split(","),e=b,f=0;f<d.length;f++)e=w.Um[d[f]](e);return e};return c}());
w.add("base64",function(c){for(var a="",b,d,e,f,g,h,k=0;k<c.length;)b=c.charCodeAt(k++),d=c.charCodeAt(k++),e=c.charCodeAt(k++),f=b>>2,b=(b&3)<<4|d>>4,g=(d&15)<<2|e>>6,h=e&63,isNaN(d)?g=h=64:isNaN(e)&&(h=64),a=a+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(f)+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(b)+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(g)+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(h);
return a});
w.Dj("base64",function(c){var a="",b=0,d={A:0,B:1,C:2,D:3,E:4,F:5,G:6,H:7,I:8,J:9,K:10,L:11,M:12,N:13,O:14,P:15,Q:16,R:17,S:18,T:19,U:20,V:21,W:22,X:23,Y:24,Z:25,a:26,b:27,c:28,d:29,e:30,f:31,g:32,h:33,i:34,j:35,k:36,l:37,m:38,n:39,o:40,p:41,q:42,r:43,s:44,t:45,u:46,v:47,w:48,x:49,y:50,z:51,0:52,1:53,2:54,3:55,4:56,5:57,6:58,7:59,8:60,9:61,"+":62,"/":63,"=":64};for(c=c.replace(/[^A-Za-z0-9\-_=\+\/]/g,"");b<c.length;){var e=d[c.charAt(b++)];var f=d[c.charAt(b++)];var g=d[c.charAt(b++)];var h=d[c.charAt(b++)];
e=e<<2|f>>4;f=(f&15)<<4|g>>2;var k=(g&3)<<6|h;a+=String.fromCharCode(e);64!==g&&(a+=String.fromCharCode(f));64!==h&&(a+=String.fromCharCode(k))}return a});
w.add("ascii85",function(c){for(var a="",b,d,e,f,g,h,k,l,n=0;n<c.length;)b=c.charCodeAt(n++),d=c.charCodeAt(n++),e=c.charCodeAt(n++),f=c.charCodeAt(n++),g=(b<<24|d<<16|e<<8|f)>>>0,b=(g/52200625|0)%85+33,h=(g/614125|0)%85+33,k=(g/7225|0)%85+33,l=(g/85|0)%85+33,g=g%85+33,a+=String.fromCharCode(b)+String.fromCharCode(h),isNaN(d)||(a+=String.fromCharCode(k),isNaN(e)||(a+=String.fromCharCode(l),isNaN(f)||(a+=String.fromCharCode(g))));return a+"~>"});
w.add("utf8",function(c){for(var a="",b=0;b<c.length;b++){var d=c.charCodeAt(b);128>d?a+=String.fromCharCode(d):(127<d&&2048>d?a+=String.fromCharCode(d>>6|192):(a+=String.fromCharCode(d>>12|224),a+=String.fromCharCode(d>>6&63|128)),a+=String.fromCharCode(d&63|128))}return a});
w.Dj("utf8",function(c){for(var a="",b=0;b<c.length;b++){var d=c.charCodeAt(b);127>=d?a+=String.fromCharCode(d):2047>=d?(a+=String.fromCharCode(192|d>>6),a+=String.fromCharCode(128|d&63)):65535>=d?(a+=String.fromCharCode(224|d>>12),a+=String.fromCharCode(128|d>>6&63),a+=String.fromCharCode(128|d&63)):1114111>=d?(a+=String.fromCharCode(240|d>>18),a+=String.fromCharCode(128|d>>12&63),a+=String.fromCharCode(128|d>>6&63),a+=String.fromCharCode(128|d&63)):a+=String.fromCharCode(63)}return a});
w.Dj("utf8",function(c){for(var a="",b=0;b<c.length;b++){var d=c.charCodeAt(b);128>d?a+=String.fromCharCode(d):(127<d&&2048>d?a+=String.fromCharCode(d>>6|192):(a+=String.fromCharCode(d>>12|224),a+=String.fromCharCode(d>>6&63|128)),a+=String.fromCharCode(d&63|128))}return a});w.add("hex",function(c){for(var a=[],b=0;b<c.length;b++){var d=c.charCodeAt(b);16>d&&a.push("0");a.push(d.toString(16))}return a.join("")});
w.add("sha1",function(c){var a=[1518500249,1859775393,2400959708,3395469782];c+=String.fromCharCode(128);for(var b=Math.ceil((c.length/4+2)/16),d=Array(b),e=0;e<b;e++){d[e]=Array(16);for(var f=0;16>f;f++)d[e][f]=c.charCodeAt(64*e+4*f)<<24|c.charCodeAt(64*e+4*f+1)<<16|c.charCodeAt(64*e+4*f+2)<<8|c.charCodeAt(64*e+4*f+3)}d[b-1][14]=8*(c.length-1)/Math.pow(2,32);d[b-1][14]=Math.floor(d[b-1][14]);d[b-1][15]=8*(c.length-1)&4294967295;c=1732584193;f=4023233417;var g=2562383102,h=271733878,k=3285377520,
l=Array(80);for(e=0;e<b;e++){for(var n=0;16>n;n++)l[n]=d[e][n];for(n=16;80>n;n++){var m=l[n-3]^l[n-8]^l[n-14]^l[n-16];l[n]=m<<1|m>>>31}m=c;var q=f;var u=g;var v=h;var A=k;for(n=0;80>n;n++){var x=Math.floor(n/20);a:switch(x){case 0:var y=q&u^~q&v;break a;case 1:y=q^u^v;break a;case 2:y=q&u^q&v^u&v;break a;default:y=q^u^v}x=(m<<5|m>>>27)+y+A+a[x]+l[n]&4294967295;A=v;v=u;u=q<<30|q>>>2;q=m;m=x}c=c+m&4294967295;f=f+q&4294967295;g=g+u&4294967295;h=h+v&4294967295;k=k+A&4294967295}return String.fromCharCode(c>>
24&255)+String.fromCharCode(c>>16&255)+String.fromCharCode(c>>8&255)+String.fromCharCode(c>>0&255)+String.fromCharCode(f>>24&255)+String.fromCharCode(f>>16&255)+String.fromCharCode(f>>8&255)+String.fromCharCode(f>>0&255)+String.fromCharCode(g>>24&255)+String.fromCharCode(g>>16&255)+String.fromCharCode(g>>8&255)+String.fromCharCode(g>>0&255)+String.fromCharCode(h>>24&255)+String.fromCharCode(h>>16&255)+String.fromCharCode(h>>8&255)+String.fromCharCode(h>>0&255)+String.fromCharCode(k>>24&255)+String.fromCharCode(k>>
16&255)+String.fromCharCode(k>>8&255)+String.fromCharCode(k>>0&255)});var sa=function(){function c(a,b,d){void 0===d&&(d="");this.name=a;this.attributes=b;this.text=d;this.children=[]}c.prototype.toString=function(){var a=[];this.Bm(a,"");return w.encode("utf8",a.join(""))};c.prototype.Bm=function(a,b){var d;if(this.hasAttributes()||0!==this.children.length){a.push(b);a.push("<");a.push(this.name);for(d in this.attributes)this.attributes.hasOwnProperty(d)&&(a.push(" "),a.push(d),void 0!==this.attributes[d]&&null!==this.attributes[d]&&(a.push('="'),a.push(this.qm(""+
this.attributes[d])),a.push('"')));if(this.children.length||void 0!==this.text){a.push(">\n");for(d=0;d<this.children.length;d++)this.children[d].Bm(a,b+"  ");void 0!==this.text&&a.push(b+"  "+this.qm(this.text));a.push(b+"</"+this.name+">")}else a.push("/>");a.push("\n")}};c.prototype.hasAttributes=function(){for(var a in this.attributes)if(this.attributes.hasOwnProperty(a))return!0;return!1};c.prototype.Ho=function(a){for(var b in a)a.hasOwnProperty(b)&&(this.attributes[b]=a[b])};c.prototype.Je=
function(a){this.children.push(a)};c.prototype.qm=function(a){return(""+a).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;")};return c}();var z=function(){function c(a,b){this.type=a;this.values=b}c.ik=function(a){a.toLowerCase()in c.Xl&&(a=c.Xl[a.toLowerCase()]);var b=/#([0-9a-f])([0-9a-f])([0-9a-f])/i,d=/rgb\( *([0-9]+) *, *([0-9]+) *, *([0-9]+) *\)/,e=/rgba\( *([0-9]+) *, *([0-9]+) *, *([0-9]+) *, *([0-9\.]+) *\)/;var f=/#([0-9a-f][0-9a-f])([0-9a-f][0-9a-f])([0-9a-f][0-9a-f])/i.exec(a);if(null!==f)a=parseInt(f[1],16)/255,b=parseInt(f[2],16)/255,d=parseInt(f[3],16)/255,f=1;else if(f=e.exec(a),null!==f)a=parseFloat(f[1])/255,b=parseFloat(f[2])/
255,d=parseFloat(f[3])/255,f=parseFloat(f[4]);else if(f=d.exec(a),null!==f)a=parseFloat(f[1])/255,b=parseFloat(f[2])/255,d=parseFloat(f[3])/255,f=1;else if(f=b.exec(a),null!==f)a=parseInt(f[1],16),a=(16*a+a)/255,b=parseInt(f[2],16),b=(16*b+b)/255,d=parseInt(f[2],16),d=(16*d+d)/255,f=1;else return null;return new c(c.RGBA,[a,b,d,f])};c.Xb=function(a){return c.ik(a)||new c(c.RGBA,[1,0,1,1])};c.Qs=function(a){var b=/#[0-9a-f]+|rgba?\([^\)]+\)|[a-z]+/gi,d=[],e;do(e=b.exec(a))&&d.push(e[0]);while(e);return d};
c.prototype.toString=function(){function a(b){b=Math.round(255*b);return 16>b?"0"+b.toString(16):b.toString(16)}var b=this.zd(c.RGBA);return 1===b.values[3]?"#"+a(b.values[0])+a(b.values[1])+a(b.values[2]):"rgba("+Math.round(255*b.values[0])+","+Math.round(255*b.values[1])+","+Math.round(255*b.values[2])+","+b.values[3]+")"};c.prototype.zd=function(a){return c.qq[this.type][a](this)};c.prototype.Oa=function(a){a.type!==this.type&&(a=a.zd(this.type));if(this.type===c.yc){var b=this.values[0],d=a.values[0];
b=b>d?Math.min(b-d,d-b+360):Math.min(d-b,b-d+360);b/=360;return Math.pow(b*b+(this.values[1]-a.values[1])*(this.values[1]-a.values[1])+(this.values[2]-a.values[2])*(this.values[2]-a.values[2]),.5)}return Math.pow((this.values[0]-a.values[0])*(this.values[0]-a.values[0])+(this.values[1]-a.values[1])*(this.values[1]-a.values[1])+(this.values[2]-a.values[2])*(this.values[2]-a.values[2]),.5)};c.RGBA=0;c.jm=1;c.yc=2;c.pp=3;c.Mu=3;c.qq=[[ua,va,wa,xa],[ya,ua,za,Ba],[Ca,Da,ua,Ea],[Fa,Ga,Ha,ua]];c.Xl={aliceblue:"#f0f8ff",
antiquewhite:"#faebd7",aqua:"#00ffff",aquamarine:"#7fffd4",azure:"#f0ffff",beige:"#f5f5dc",bisque:"#ffe4c4",black:"#000000",blanchedalmond:"#ffebcd",blue:"#0000ff",blueviolet:"#8a2be2",brown:"#a52a2a",burlywood:"#deb887",cadetblue:"#5f9ea0",chartreuse:"#7fff00",chocolate:"#d2691e",coral:"#ff7f50",cornflowerblue:"#6495ed",cornsilk:"#fff8dc",crimson:"#dc143c",cyan:"#00ffff",darkblue:"#00008b",darkcyan:"#008b8b",darkgoldenrod:"#b8860b",darkgray:"#a9a9a9",darkgreen:"#006400",darkkhaki:"#bdb76b",darkmagenta:"#8b008b",
darkolivegreen:"#556b2f",darkorange:"#ff8c00",darkorchid:"#9932cc",darkred:"#8b0000",darksalmon:"#e9967a",darkseagreen:"#8fbc8f",darkslateblue:"#483d8b",darkslategray:"#2f4f4f",darkturquoise:"#00ced1",darkviolet:"#9400d3",deeppink:"#ff1493",deepskyblue:"#00bfff",dimgray:"#696969",dodgerblue:"#1e90ff",firebrick:"#b22222",floralwhite:"#fffaf0",forestgreen:"#228b22",fuchsia:"#ff00ff",gainsboro:"#dcdcdc",ghostwhite:"#f8f8ff",gold:"#ffd700",goldenrod:"#daa520",gray:"#808080",green:"#008000",greenyellow:"#adff2f",
honeydew:"#f0fff0",hotpink:"#ff69b4",indianred:"#cd5c5c",indigo:"#4b0082",ivory:"#fffff0",khaki:"#f0e68c",lavender:"#e6e6fa",lavenderblush:"#fff0f5",lawngreen:"#7cfc00",lemonchiffon:"#fffacd",lightblue:"#add8e6",lightcoral:"#f08080",lightcyan:"#e0ffff",lightgoldenrodyellow:"#fafad2",lightgreen:"#90ee90",lightgrey:"#d3d3d3",lightpink:"#ffb6c1",lightsalmon:"#ffa07a",lightseagreen:"#20b2aa",lightskyblue:"#87cefa",lightslategray:"#778899",lightsteelblue:"#b0c4de",lightyellow:"#ffffe0",lime:"#00ff00",
limegreen:"#32cd32",linen:"#faf0e6",magenta:"#ff00ff",maroon:"#800000",mediumaquamarine:"#66cdaa",mediumblue:"#0000cd",mediumorchid:"#ba55d3",mediumpurple:"#9370d8",mediumseagreen:"#3cb371",mediumslateblue:"#7b68ee",mediumspringgreen:"#00fa9a",mediumturquoise:"#48d1cc",mediumvioletred:"#c71585",midnightblue:"#191970",mintcream:"#f5fffa",mistyrose:"#ffe4e1",moccasin:"#ffe4b5",navajowhite:"#ffdead",navy:"#000080",oldlace:"#fdf5e6",olive:"#808000",olivedrab:"#6b8e23",orange:"#ffa500",orangered:"#ff4500",
orchid:"#da70d6",palegoldenrod:"#eee8aa",palegreen:"#98fb98",paleturquoise:"#afeeee",palevioletred:"#d87093",papayawhip:"#ffefd5",peachpuff:"#ffdab9",peru:"#cd853f",pink:"#ffc0cb",plum:"#dda0dd",powderblue:"#b0e0e6",purple:"#800080",red:"#ff0000",rosybrown:"#bc8f8f",royalblue:"#4169e1",saddlebrown:"#8b4513",salmon:"#fa8072",sandybrown:"#f4a460",seagreen:"#2e8b57",seashell:"#fff5ee",sienna:"#a0522d",silver:"#c0c0c0",skyblue:"#87ceeb",slateblue:"#6a5acd",slategray:"#708090",snow:"#fffafa",springgreen:"#00ff7f",
steelblue:"#4682b4",tan:"#d2b48c",teal:"#008080",thistle:"#d8bfd8",tomato:"#ff6347",transparent:"rgba(0,0,0,0.0)",turquoise:"#40e0d0",violet:"#ee82ee",wheat:"#f5deb3",white:"#ffffff",whitesmoke:"#f5f5f5",yellow:"#ffff00",yellowgreen:"#9acd32"};return c}(),Ia=.9505,Ja=1,Ka=1.089;
function Ca(c){var a=c.values[0],b=c.values[1],d=c.values[2];0>a&&(a+=360);var e=a/60-Math.floor(a/60),f=d*(1-b),g=d*(1-e*b);b=d*(1-(1-e)*b);var h=e=0,k=0;switch(Math.floor(a/60)%6){case 0:e=d;h=b;k=f;break;case 1:e=g;h=d;k=f;break;case 2:e=f;h=d;k=b;break;case 3:e=f;h=g;k=d;break;case 4:e=b;h=f;k=d;break;case 5:e=d,h=f,k=g}return new z(z.RGBA,[e,h,k,c.values[3]])}
function wa(c){var a=c.values[0],b=c.values[1],d=c.values[2],e=Math.max(a,b,d),f=Math.min(a,b,d);return new z(z.yc,[e===f?0:e===a?(60*(b-d)/(e-f)+360)%360:e===b?60*(d-a)/(e-f)+120:60*(a-b)/(e-f)+240,0===e?0:1-f/e,e,c.values[3]])}function Ba(c){function a(b){return b>6/29*(6/29)*(6/29)?Math.pow(b,1/3):1/3*(29/6)*(29/6)*b+4/29}var b=a(c.values[1]/Ja);return new z(z.pp,[116*b-16,500*(a(c.values[0]/Ia)-b),200*(b-a(c.values[2]/Ka)),c.values[3]])}
function Ga(c){var a=(c.values[0]+16)/116,b=a+c.values[1]/500,d=a-c.values[2]/200,e=6/29;return new z(z.jm,[b>e?Ia*b*b*b:3*(b-16/116)*e*e*Ia,a>e?Ja*a*a*a:3*(a-16/116)*e*e*Ja,d>e?Ka*d*d*d:3*(d-16/116)*e*e*Ka,c.values[3]])}function va(c){for(var a=[],b=0;3>b;b++)a[b]=.04045>=c.values[b]?c.values[b]/12.92:Math.pow((c.values[b]+.055)/1.055,2.4);return new z(z.jm,[.4124*a[0]+.3576*a[1]+.1805*a[2],.2126*a[0]+.7152*a[1]+.0722*a[2],.0193*a[0]+.1192*a[1]+.9505*a[2],c.values[3]])}
function ya(c){var a=[],b=[0,0,0,0];a[0]=3.241*c.values[0]-1.5374*c.values[1]-.4986*c.values[2];a[1]=-.9692*c.values[0]+1.876*c.values[1]+.0416*c.values[2];a[2]=.0556*c.values[0]-.204*c.values[1]+1.057*c.values[2];for(var d=0;3>d;d++)b[d]=.0031308>=a[d]?12.92*a[d]:1.055*Math.pow(a[d],1/2.4)-.055;b[3]=c.values[3];return new z(z.RGBA,b)}function ua(c){return new z(c.type,c.values.concat())}function xa(c){return Ba(va(c))}function Fa(c){return ya(Ga(c))}function za(c){return wa(ya(c))}
function Da(c){return va(Ca(c))}function Ea(c){return xa(Ca(c))}function Ha(c){return za(Ga(c))};var B=new (function(){function c(){this.disabled={};this.eh=[];this.mq=!1}c.prototype.enable=function(a,b){void 0===b&&(b=!0);this.disabled[a]=!b};c.prototype.create=function(a,b){void 0===b&&(b=!0);!1===b&&(this.disabled[a]=!0);var d=this;return function(){for(var b=0;b<arguments.length;b++);d.ps(a,arguments)}};c.prototype.addListener=function(a){this.eh.push(a);return a};c.prototype.removeListener=function(a){for(var b=0;b<this.eh.length;b++)if(this.eh[b]===a){this.eh.splice(b,1);break}};c.prototype.Iq=
function(){this.mq||this.addListener(function(a,b){console.log(a+": "+b)})};c.prototype.ps=function(a,b){var d=[],e;if(!this.disabled[a]){var f=b[0].split("%s");d.push(f[0]);for(e=1;e<f.length;e++)e-1>=b.length-1?d.push("<too few args>"):"string"===typeof b[e]||"number"===typeof b[e]?d.push(b[e]):void 0===b[e]?d.push("(undefined)"):null===b[e]?d.push("(null)"):b[e]instanceof Object&&b[e].toString instanceof Function?d.push(b[e].toString()):d.push(JSON.stringify(b[e])),d.push(f[e]);d=d.join("");e=
0;for(f=this.eh;e<f.length;e++)(0,f[e])(a,d)}};return c}());(function(){function c(a){this.log=B.create("Layout");this.ge=a.itemSize||100;this.algorithm=a.algorithm||"wrap";this.En=a.gravity||"down";this.Hm=!1!==a.resize;"down"===this.En?(this.offsetWidth="offsetWidth",this.offsetHeight="offsetHeight",this.width="width",this.height="height",this.top="top",this.left="left",this.clientWidth="clientWidth",this.clientHeight="clientHeight"):"up"===this.En?(this.offsetWidth="offsetWidth",this.offsetHeight="offsetHeight",this.width="width",this.height="height",this.top=
"bottom",this.left="left",this.clientWidth="clientWidth",this.clientHeight="clientHeight"):(this.offsetWidth="offsetHeight",this.offsetHeight="offsetWidth",this.width="height",this.height="width",this.top="left",this.left="top",this.clientWidth="clientHeight",this.clientHeight="clientWidth")}c.prototype.Zf=function(a){return a[this.offsetWidth]};c.prototype.bh=function(a){return a[this.offsetHeight]};c.prototype.jl=function(a,b){if(this.Hm){var d=this.Zf(a),e=this.bh(a);a.style[this.width]=""+b+"px";
a.style[this.height]=""+b/d*e+"px"}};c.prototype.Oo=function(a,b){if(this.Hm){var d=this.Zf(a),e=this.bh(a);a.style[this.height]=""+b+"px";a.style[this.width]=""+b/e*d+"px"}};c.prototype.gf=function(a,b,d){a.style[this.top]=d+"px";a.style[this.left]=b+"px"};c.prototype.fs=function(a){"absolute"!==window.getComputedStyle(a).getPropertyValue("position")&&(a.style.position="relative");for(var b=0;b<a.children.length;b++)a.children[b].style.position="absolute";"wrap"===this.algorithm?this.js(a):"mason"===
this.algorithm?this.gs(a):"perfect"===this.algorithm&&this.hs(a)};c.prototype.js=function(a){for(var b=a[this.clientWidth],d=0,e=0,f=0,c=0;c<a.children.length;c++){var h=a.children[c];this.jl(h,this.ge);var k=this.Zf(h),l=this.bh(h);d+k>b?0===d?(this.gf(h,d,e),e+=l):(e+=f,d=0,this.gf(h,d,e),f=l):(this.gf(h,d,e),d+=k,f=Math.max(f,l))}};c.prototype.gs=function(a){var b=a[this.clientWidth],d;if(0>=b)this.log("Skipping layout; width is <= 0");else{this.log("Laying out to width %s",b);var e=Math.round(b/
this.ge);this.ge=b/e;b=[];for(var f=0;f<e;f++)b.push(0);for(f=0;f<a.children.length;f++){var c=a.children[f];this.jl(c,this.ge);var h=this.bh(c),k=0;for(d=1;d<e;d++)b[d]<b[k]&&(k=d);d=k*this.ge;var l=b[k];this.gf(c,d,l);b[k]+=h}}};c.prototype.hs=function(a){var b=a[this.clientWidth],d=0,e=[];var f=0;for(var c,h=0;h<a.children.length;h++){var k=a.children[h];this.Oo(k,this.ge);var l=this.Zf(k);if(f+l>b)if(0===e.length){this.gf(k,0,d);this.jl(k,b);d+=this.bh(k);continue}else{for(var n=b/f,m=f=0;m<e.length;m++)c=
e[m],this.Oo(c,this.ge*n),this.gf(c,f,d),f+=this.Zf(c);d+=this.ge*n;f=0;e.length=0}e.push(k);f+=l}for(h=f=0;h<e.length;h++)c=e[h],this.gf(c,f,d),f+=this.Zf(c)};return c})();function Ma(){this.length=0}var Na=B.create("JQUERY"),Oa,Pa=/\s+/,Qa=/^[\s\xA0]+/,Ra=/[\s\xA0]+$/,Sa=/[\n\t]/g,Ta,Ua={B:1,BIG:1,I:1,SMALL:1,TT:1,ABBR:1,ACRONYM:1,CITE:1,CODE:1,DFN:1,EM:1,KBD:1,STRONG:1,SAMP:1,VAR:1,A:1,BDO:1,BR:1,IMG:1,MAP:1,OBJECT:1,Q:1,SCRIPT:1,SPAN:1,SUB:1,SUP:1,BUTTON:1,INPUT:1,LABEL:1,SELECT:1,TEXTAREA:1},Va=[],Wa=!1;function Xa(){!Wa&&window.attachEvent&&(window.attachEvent("onresize",function(c){for(var a=0;a<Va.length;a++)Va[a](c)}),Wa=!0)}
function Ya(c,a,b,d){this.name=c;this.Hq=a;this.ui=b;this.Cu=d}
function Za(c,a){var b=/#(.*)$/,d=/\.(.*)$/,e=/^<\s*([a-zA-Z0-9]+).*>$/,f=/^([A-Za-z]+)$/;a=a||document;var g=new Ma,h;try{var k=("object"===typeof HTMLElement?c instanceof HTMLElement:"object"===typeof c&&1===c.nodeType&&"string"===typeof c.nodeName||3===c.nodeType)||c===window||c===document||c===document.body||c instanceof Element}catch(q){k=!1}if(k)return g[g.length++]=c,g;if(c instanceof Ma)return c;k=c.split(",");for(var l=0;l<k.length;l++){var n=k[l];if(null!==(h=b.exec(n)))h=document.getElementById(h[1]),
null!==h&&(g[g.length++]=h);else if(null!==(h=e.exec(n)))h=h[1],g[g.length++]=document.createElement(h);else if(null!==(h=d.exec(n))){n=g;h=Ta(a,h[1]);for(var m=0;m<h.length;m++)n[n.length++]=h[m]}else if(null!==(h=f.exec(n)))for(n=g,h=a.getElementsByTagName(h[1]),m=0;m<h.length;m++)n[n.length++]=h[m];else throw console.log(n),"Error: can't parse selector: "+n+" ("+n.nodeType;}return g}
Ma.prototype={first:function(){var c=new Ma;this.length&&(c[c.length++]=this[0]);return c},children:function(){for(var c=new Ma,a=0;a<this.length;a++)for(var b=this[a].firstChild;b;)c[c.length++]=b,b=b.nextSibling;return c},Xa:function(){for(var c=0;c<this.length;c++){var a=C(this[c]).ea("display");"none"!==a&&(this[c].ho=a);this[c].style.display="none"}return this},show:function(){for(var c=0;c<this.length;c++)this[c].ho?this[c].style.display=this[c].ho:"none"===C(this[c]).ea("display")&&(this[c].style.display=
this[c].tagName in Ua?"inline":"block");return this},toggle:function(c){void 0===c&&this.length&&(c="none"===this.ea("display"));c?this.show():this.Xa()},append:function(c){c=Za(c);if(0<this.length)for(var a=0;a<c.length;a++)this[0].appendChild(c[a]);return this},Gj:function(c){c=Za(c);if(0<c.length)for(var a=0;a<this.length;a++)c[0].appendChild(this[a]);return this},remove:function(){for(var c=0;c<this.length;c++)this[c].parentNode&&this[c].parentNode.removeChild(this[c]);return this},empty:function(){for(var c=
0;c<this.length;c++)for(;null!==this[c].firstChild;)this[c].removeChild(this[c].firstChild);return this},text:function(c){if(0===arguments.length){var a="";$a(this,function(b){3===b.nodeType&&(a+=b.nodeValue)});return a}for(var b=0;b<this.length;b++){for(;null!==this[b].firstChild;)this[b].removeChild(this[b].firstChild);this[b].appendChild(document.createTextNode(c))}return this},vg:function(c){this.yb(function(a,b){Na("Trigger "+c);if(document.createEventObject){var d=document.createEventObject();
if("resize"===c){Na("Calling stored window resize functions");for(var e=0;e<Va.length;e++)Va[e](d)}else b.fireEvent("on"+c,d)}else d=document.createEvent("HTMLEvents"),d.initEvent(c,!0,!0),b.dispatchEvent(d)})},width:function(c){if(0<this.length){if(1===arguments.length){for(var a=Math.max(0,arguments[0]),b=0;b<this.length;b++)this[b].style.width=""+a+"px";return this}return this[0]===window?this[0].innerWidth||document.documentElement.clientWidth:this[0].clientWidth}return 0},height:function(){if(0<
this.length){if(1===arguments.length){for(var c=0;c<this.length;c++)this[c].style.height=""+arguments[0]+"px";return this}return this[0]===window?this[0].innerHeight||document.documentElement.clientHeight:this[0].clientHeight}return 0},outerWidth:function(){return 0<this.length?this[0].offsetWidth:0},outerHeight:function(){return 0<this.length?this[0].offsetHeight:0},offset:function(c){if(c){if(0<this.length){var a=this.offsetParent().offset();this[0].style.left=c.left-a.left+"px";this[0].style.top=
c.top-a.top+"px"}return this}if(0<this.length){c=this[0].getBoundingClientRect();if("pageYOffset"in window){a=window.pageXOffset;var b=window.pageYOffset}else a=document.body.scrollLeft,b=document.body.scrollTop;return{top:c.top+b,left:c.left+a}}return{left:0,top:0}},offsetParent:function(){if(0===this.length)return null;if("fixed"===this.ea("position"))return C(document.body);for(var c=this[0].parentNode;c&&"static"===C(c).ea("position")&&"BODY"!==c.tagName;)c=c.parentNode;return C(c)},clone:function(){return this.length?
Za(this[0].cloneNode(!0)):new Ma},find:function(c){return this.length?Za(c,this[0]):new Ma},Jb:function(c,a){if(2===arguments.length){for(var b=0;b<this.length;b++)this[b].setAttribute(c,a);return this}return 0<this.length?this[0].getAttribute(c):""},replaceWith:function(c){this.length&&this[0].parentNode.replaceChild(c[0],this[0]);return this},yb:function(c){for(var a=0;a<this.length;a++)c(a,this[a])},focus:function(){0<this.length&&this[0].focus();return this},blur:function(){0<this.length&&this[0].blur();
return this},submit:function(){for(var c=0;c<this.length;c++)this[c].submit();return this},select:function(){for(var c=0;c<this.length;c++)this[c].select();return this},ea:function(c,a){var b=c.split("-");c=b[0];for(var d=1;d<b.length;d++)c="ms"!==b[d]?c+(b[d].substr(0,1).toUpperCase()+b[d].substr(1)):c+b[d];if(2===arguments.length){for(d=0;d<this.length;d++)this[d].style[c]=""+a;return this}return this[0].currentStyle?this[0].currentStyle[c]:window.getComputedStyle?window.getComputedStyle(this[0],
null)[c]:this[0].style[c]},xa:function(c,a){function b(b){d[0]===window&&"resize"===b&&window.attachEvent?(Va.push(a),Xa()):window.addEventListener?d.yb(function(d,e){function f(b){b.po=b;"which"in b||(b.which=b.button);return a.call(e,b)}e.__JqlListeners||(e.__JqlListeners=[]);f.vp=c;a.vp=c;e.addEventListener(b,f,!1);e.__JqlListeners.push(new Ya(b,e,a,f))}):d.yb(function(d,e){e.attachEvent("on"+b,function(b){b.po=b;b.which=b.button;b.pageX=b.clientX;b.pageY=b.clientY;b.preventDefault=function(){b.returnValue=
!1};b.stopPropagation=function(){b.cancelBubble=!0};b.target=b.target||b.srcElement;return a.call(e,b)})})}var d=this;c=c.split(" ");for(var e=0;e<c.length;e++)b(c[e]);return this},bind:function(c,a){return this.xa(c,a)},wg:function(c,a){window.addEventListener&&this.yb(function(b,d){if(d.__JqlListeners)for(var e=d.__JqlListeners,f=0;f<e.length;f++){var g=e[f];if(c===g.name&&d===g.Hq&&a===g.ui){d.removeEventListener(c,g.Cu,!1);e.splice(f,1);break}}});return this},click:function(c){return c?this.xa("click",
c):this.vg("click")},load:function(c){return this.xa("load",c)},fd:function(c){return this.xa("change",c)},resize:function(c){c?this.xa("resize",c):this.vg("resize");return this},scrollLeft:function(c){if(1===arguments.length){for(var a=0;a<this.length;a++)this[a].scrollLeft=c;return this}return this[0].scrollLeft},scrollTop:function(c){if(1===arguments.length){for(var a=0;a<this.length;a++)this[a].scrollTop=c;return this}return this[0].scrollTop}};
function ab(c){for(var a=0;a<c.length;a++)c[a].style.display="block"}function eb(c,a){c.xa("mouseout",a)}function fb(c,a){c.xa("mouseover",a)}function gb(c,a){c.xa("dblclick",a)}function hb(c,a){c.xa("mousemove",a)}function ib(c,a){c.xa("mousedown",a)}function jb(c,a){c.xa("keydown",a)}function kb(){var c=C("<input>").Jb("type","button");c[0].value="OK";return c}
function lb(c,a){if(a&&"string"===typeof a)for(var b=(a||"").split(Pa),d=0,e=c.length;d<e;d++){var f=c[d];if(1===f.nodeType)if(f.className){for(var g=" "+f.className+" ",h=f.className,k=0,l=b.length;k<l;k++)0>g.indexOf(" "+b[k]+" ")&&(h+=" "+b[k]);f.className=Oa.trim(h)}else f.className=a}return c}function mb(c,a){for(var b=0;b<c.length;b++)c[b].innerHTML=a}function nb(c,a){a=Za(a);0<c.length&&0<a.length&&a[0].parentNode.insertBefore(c[0],a[0])}
function ob(c,a){a=Za(a);0<c.length&&0<a.length&&a[0].parentNode.insertBefore(c[0],a[0].nextSibling)}function $a(c,a){for(var b=[],d=c.length-1;0<=d;d--)b.push(c[d]);for(;b.length;)for(d=b.pop(),a(d),d=d.lastChild;d;)b.push(d),d=d.previousSibling}Oa=function(c){return Za(c)};Oa.trim=function(c){return null===c?"":c.toString().replace(Qa,"").replace(Ra,"")};
Oa.Np=function(c){var a=c.url||"",b=c.type||"GET",d=c.Zt||function(){},e=c.error||function(){},f=c.data||"";c=c.Vp||function(){};var g="";try{var h=new XMLHttpRequest}catch(l){try{h=new ActiveXObject("Msxml2.XMLHTTP")}catch(n){try{h=new ActiveXObject("Microsoft.XMLHTTP")}catch(m){e(null,"",null)}}}if("object"===typeof f)for(var k in f)Object.hasOwnProperty.call(f,k)&&(g.length&&(g+="&"),g+=encodeURIComponent(k),g+="=",g+=encodeURIComponent(f[k]));"GET"===b&&(a+="?"+g,g="");c(h,h);h.open(b,a,!0);h.onreadystatechange=
function(){if(4===h.readyState)if(200===h.status){var b=h.responseText,a=h.getResponseHeader("content-type");if(a&&0===a.indexOf("application/json"))try{b=Oa.Ts(b)}catch(m){}d(b,"",h)}else e(h,"",null)};"POST"===b&&h.setRequestHeader("Content-Type","application/x-www-form-urlencoded");h.send(g)};
Ta=function(c,a){var b=[],d;var e=a.split(/\s+/);for(d=0;d<e.length;d++){var f=e[d].replace(/([\/\\\^$*+?.()|\[\]{}])/g,"\\$1");b.push(new RegExp("(^|\\s)"+f+"(\\s|$)"))}var g=c.getElementsByTagName("*"),h=[];d=0;for(f=g.length;d<f;d++){var k=g[d],l=!0;for(e=0;e<b.length;e++)if(!b[e].test(k.className)){l=!1;break}l&&h.push(k)}return h};Oa.Ts=function(c){return window.JSON.parse(c)};
Oa.extend=function(c){for(var a=arguments[0],b=1;b<arguments.length;b++){var d=arguments[b],e;for(e in d)d.hasOwnProperty(e)&&(a[e]=d[e])}return a};Oa.fn=Ma.prototype;var C=Oa;var pb=function(){function c(a,b){this.Os=a;this.name=b;this.ia=C("<div>").ea("border-top","1px solid #888").ea("padding","5px").ea("cursor","default");this.Os.append(this.ia);this.update(0)}c.prototype.update=function(a){this.ia.text(this.name+"... "+Math.round(100*a)+"%")};c.prototype.error=function(a){var b=this,d=kb();d.click(function(){b.done()});mb(this.ia,this.name+"... "+a+" ");this.ia.append(d)};c.prototype.done=function(){this.ia.remove()};c.all=[];return c}();var qb=function(){function c(a,b,d,e,f){void 0===a&&(a="transparent");void 0===b&&(b=0);void 0===d&&(d=0);void 0===e&&(e=0);void 0===f&&(f=0);this.Ke=a;this.left=b;this.top=d;this.right=e;this.bottom=f;this.zIndex=1;this.insertBefore=null;this.ia=C("<div>")}c.prototype.Xa=function(){this.ia&&this.ia.remove()};c.prototype.show=function(a){this.ia.ea("position","fixed");this.ia.ea("background",this.Ke);this.ia.ea("opacity","0.25");this.ia.ea("left",""+this.left+"px");this.ia.ea("top",""+this.top+"px");
this.ia.ea("right",""+this.right+"px");this.ia.ea("bottom",""+this.bottom+"px");this.ia.ea("display","none");this.ia.click(function(b){a(b)});this.insertBefore?(this.ia.ea("z-index",""+this.zIndex),nb(C(this.ia),this.insertBefore)):(this.ia.ea("z-index",""+this.zIndex),C("body").append(this.ia));ab(this.ia)};return c}();var rb=function(){function c(a){void 0===a&&(a=C("<div>"));this.Rc=this.Qd=0;this.ia=a;this.ia.ea("position","absolute");this.ia.ea("margin","0px");this.ia.ea("padding","0px");C("body").append(this.ia)}c.prototype.width=function(a){function b(b){b=parseInt(d.ia.ea(b),10);return isNaN(b)?0:b}var d=this;if(void 0===a)return this.ia.outerWidth();a-=b("border-left-width");a-=b("border-right-width");a-=b("padding-right");a-=b("padding-left");a-=b("margin-left");a-=b("margin-right");this.Qd=a=Math.max(0,
a);this.ia.ea("width",""+a+"px");return a};c.prototype.height=function(a){function b(b){b=parseInt(d.ia.ea(b),10);return isNaN(b)?0:b}var d=this;if(void 0===a)return this.ia.outerHeight();a-=b("border-top-width");a-=b("border-bottom-width");a-=b("padding-top");a-=b("padding-bottom");a-=b("margin-top");a-=b("margin-bottom");this.Rc=a=Math.max(0,a);this.ia.ea("height",""+this.Rc+"px");return a};c.prototype.moveTo=function(a,b){null!==a&&this.ia.ea("left",""+a+"px");null!==b&&this.ia.ea("top",""+b+"px")};
c.prototype.show=function(){this.ia.show()};c.prototype.Xa=function(){this.ia.Xa()};c.prototype.Nf=function(){this.ia.remove()};return c}();var sb=function(){function c(){this.Mg=[];this.log=B.create("DESTRUCTOR")}c.prototype.add=function(a){this.Mg.push(a)};c.prototype.bind=function(a,b,d){a.bind(b,d);this.add(function(){a.wg(b,d)})};c.prototype.Nf=function(){this.log("Running %s destructors",this.Mg.length);for(var a=this.Mg.length-1;0<=a;a--)this.Mg[a]();this.Mg.length=0};return c}();var tb=function(c){function a(b,a){var d=c.call(this,b)||this;d.Ik=0;d.Bk={};d.vb=!1;d.timeout=null;d.lines=[];d.Lb="#ffffff #008800 #008888 #880000 #880088 #884400 #888888 #444444 #0000ff #00ff00 #00ffff #ff0000 #ff00ff #ffff00".split(" ");d.ia.ea("background","black");d.ia.ea("font-family",'"Lucida Console","Dejavu Sans Mono",Monospace,"Courier New"');d.ia.ea("font-size","10px");d.ia.ea("line-height","12px");d.ia.ea("overflow","scroll");d.ia.ea("cursor","default");d.ls=B.addListener(function(b,
a){return d.Em(b,a)});a.add(function(){B.removeListener(d.ls)});d.Em("DEBUG","Debug window starting");d.Wu=d.Lb[0];return d}p(a,c);a.prototype.show=function(){rb.prototype.show.call(this);this.vb=!0;this.km();this.ia[0].scrollTop=this.ia[0].scrollHeight};a.prototype.Xa=function(){this.vb=!1;rb.prototype.Xa.call(this)};a.prototype.hr=function(b){b in this.Bk||(this.Bk[b]=this.Lb[this.Ik],this.Ik=(this.Ik+1)%this.Lb.length);return this.Bk[b]};a.prototype.Em=function(b,a){var d,f=this;var c=a.split("\n");
var h=0;for(d=c.length;h<d;h++){var k=c[h];this.lines.push({key:b,line:k})}this.vb&&null===this.timeout&&(this.timeout=setTimeout(function(){return f.km()},100))};a.prototype.km=function(){var b;var a=this.ia[0].scrollTop>this.ia[0].scrollHeight-this.ia[0].clientHeight-100;var e=this.lines;var f=0;for(b=e.length;f<b;f++){var c=e[f];var h=c.key;c=c.line;var k=this.hr(h);k=C("<div>").ea("color",k);k.ea("border-bottom","1px solid #222");k.text(""+h+": "+c);this.ia.append(k)}a&&(this.ia[0].scrollTop=
this.ia[0].scrollHeight);this.timeout=null;this.lines.length=0};return a}(rb);function ub(c,a){function b(b){for(var a=b.changedTouches,d=0;d<a.length;d++){var e;a:{var f=a[d],c=-1;if("identifier"in f)for(e=0;e<k.length;e++){if(f.identifier===k[e].identifier)break a}else{var l=0;for(e=0;e<k.length;e++){var m=k[e].Pf(f);if(-1===c||m<l)c=e,l=m}}e=c}-1===e?"touchend"!==b.type&&(k.push(new h(a[d])),g("New touch %s",a[d].identifier)):"touchend"!==b.type?(k[e].pageX=a[d].pageX,k[e].pageY=a[d].pageY):(g("Remove touch %s",a[d].identifier),k.splice(e,1))}}function d(){for(var b=0,a=
0,d=0;d<k.length;d++)g("Active touch: %s,%s",k[d].pageX,k[d].pageY),b+=k[d].pageX,a+=k[d].pageY;return{x:b/k.length,y:a/k.length}}function e(b,a){for(var d=0,e=0;e<k.length;e++){var f=k[e];d+=Math.sqrt((f.pageX-b)*(f.pageX-b)+(f.pageY-a)*(f.pageY-a))}return d/k.length}function f(b,a){b.preventDefault=function(){a.preventDefault()};b.stopPropagation=function(){a.stopPropagation()};return b}var g=B.create("GESTURES");if(c.dv)c.addEventListener("gesture",a,!1),g("No emulation needed");else{var h=function(){function b(b){this.yh=
b.pageX;this.zh=b.pageY;this.pageX=b.pageX;this.pageY=b.pageY;this.identifier=b.identifier}b.prototype.Pf=function(b){return Math.sqrt((this.pageX-b.pageX)*(this.pageX-b.pageX)+(this.pageY-b.pageY)*(this.pageY-b.pageY))};return b}(),k=[],l=!1,n=1,m=0,q,u;c.addEventListener("touchstart",function(c){b(c);g("touchend; inGesture=%s active.length=%s",l,k.length);2<=k.length&&!l&&(l=!0,u=d(),q=e(u.x,u.y),n=1,m=0,a(f({type:"gesturestart",pageX:u.x,pageY:u.y,scale:n,rotation:m},c)))});c.addEventListener("touchmove",
function(c){b(c);if(2<=k.length){u=d();n=e(u.x,u.y)/q;for(var g=u.x,h=u.y,l=0,v=0;v<k.length;v++)l+=Math.atan2(k[v].pageY-h,k[v].pageX-g)-Math.atan2(k[v].zh-h,k[v].yh-g);m=l/k.length/Math.PI*180;a(f({type:"gesturechange",pageX:u.x,pageY:u.y,scale:n,rotation:m},c))}});c.addEventListener("touchend",function(d){b(d);g("touchend; inGesture=%s active.length=%s",l,k.length);l&&2>k.length&&(l=!1,a(f({type:"gestureend",pageX:u.x,pageY:u.y,scale:n,rotation:m},d)))})}};var vb=function(){function c(a,b){this.ia=a;this.size=b;this.canvas=document.createElement("canvas");this.lb=0;this.Uh=!1;this.bg="";this.strokeStyle="#000000";this.Hd={x:0,y:0};this.Xe={x:0,y:0};this.fg={x:0,y:0};this.mid={x:0,y:0};this.log=B.create("ColourWheel");this.height=this.width=b;this.canvas.width=this.width;this.canvas.height=this.height;this.canvas.style.cursor="crosshair";this.ia.appendChild(this.canvas);"G_vmlCanvasManager"in window&&window.G_vmlCanvasManager.initElement(this.canvas);
this.ka=this.canvas.getContext("2d");var d=document.createElement("input");d.setAttribute("type","range");this.ug=document.createElement("input");this.ug.setAttribute("type","checkbox");"range"===d.type?(this.ia.appendChild(document.createElement("br")),this.ia.appendChild(d),d.min="0",d.max="255",d.value="255",this.xd=d):(this.xd=null,d="colourcheckbox"+this.lb,this.ug.setAttribute("id",d),this.ia.appendChild(document.createElement("br")),this.ia.appendChild(this.ug),this.lb+=1,d=C("<label>").Jb("for",
d).text("Transparent"),this.ia.appendChild(d[0]));this.cb=this.height;this.fe=.8*this.height;if(c.Cache[b])this.data=c.Cache[b];else{d=this.ka.getImageData(0,0,this.cb,this.cb);for(var e=this.cb/2,f=this.fe/2,g,h=0;h<this.cb;h++){var k=Math.sqrt(e*e-(h-e)*(h-e)),l=Math.floor(-k+e),n=Math.floor(k+e),m=f*f-(h-e)*(h-e);if(0<=m){k=Math.sqrt(m);m=Math.floor(-k+e);var q=Math.floor(k+e);for(k=h*this.cb*4+4*l;l<=m;l++)g=Math.atan2(h-e,l-e),g=new z(z.yc,[g/Math.PI*180,1,1,1]),g=g.zd(z.RGBA),d.data[k++]=255*
g.values[0],d.data[k++]=255*g.values[1],d.data[k++]=255*g.values[2],d.data[k++]=255;k=h*this.cb*4+4*q;l=q}else k=h*this.cb*4+4*l;for(;l<=n;l++)g=Math.atan2(h-e,l-e),g=new z(z.yc,[g/Math.PI*180,1,1,1]),g=g.zd(z.RGBA),d.data[k++]=255*g.values[0],d.data[k++]=255*g.values[1],d.data[k++]=255*g.values[2],d.data[k++]=255}this.data=d;c.Cache[b]=d}this.kb=new z(z.yc,[20,1,1,1]);this.update();this.ja();var u=this;u.Uh=!1;u.bg="";ib(C(this.canvas),function(b){if("mousedown"===b.type){var a=C(u.canvas).offset(),
d=b.pageX-a.left;a=b.pageY-a.top;u.Uh=!0;u.Pm(d,a);b.stopPropagation();b.preventDefault()}});hb(C(this.canvas),function(b){if(u.Uh&&"mousemove"===b.type){var a=C(u.canvas).offset();u.Pm(b.pageX-a.left,b.pageY-a.top)}b.stopPropagation();b.preventDefault()});C(window).xa("mouseup",function(){u.Uh=!1;u.bg=""});null!==this.xd&&C(this.xd).fd(function(){u.xd&&(u.kb.values[3]=parseFloat(u.xd.value)/255,u.update(),u.ja())});C(this.ug).fd(function(){u.kb.values[3]=u.ug.checked?0:1;u.update();u.ja()})}c.prototype.Mo=
function(a){this.kb=z.Xb(a).zd(z.yc);null!==this.xd&&(this.xd.value=""+Math.round(255*this.kb.values[3]));this.ug.checked=0===this.kb.values[3]?!0:!1;this.ja();this.update()};c.prototype.update=function(){this.Sk&&this.Sk(this.kb.toString())};c.prototype.ja=function(){this.ka.save();this.ka.lineWidth=1;this.ka.fillStyle="rgb(128, 128, 128)";this.ka.fillRect(0,0,this.width,this.height);this.ka.putImageData(this.data,0,0);var a=this.kb.values[0]/180*Math.PI;this.ka.beginPath();var b={x:Math.cos(a)*
this.fe/2+this.cb/2,y:Math.sin(a)*this.fe/2+this.cb/2},d={x:Math.cos(a+2*Math.PI/3)*this.fe/2+this.cb/2,y:Math.sin(a+2*Math.PI/3)*this.fe/2+this.cb/2},e={x:Math.cos(a+4*Math.PI/3)*this.fe/2+this.cb/2,y:Math.sin(a+4*Math.PI/3)*this.fe/2+this.cb/2},f=Math.cos(a)*this.cb/2+this.cb/2,c=Math.sin(a)*this.cb/2+this.cb/2;a={x:d.x+(e.x-d.x)/2,y:d.y+(e.y-d.y)/2};this.ka.moveTo(b.x,b.y);this.ka.lineTo(d.x,d.y);this.ka.lineTo(e.x,e.y);this.ka.lineTo(b.x,b.y);var h=this.ka.createLinearGradient(d.x,d.y,e.x,e.y);
h.addColorStop(0,"#ffffff");h.addColorStop(1,"#000000");this.ka.fillStyle=h;this.ka.fill();h=this.ka.createLinearGradient(b.x,b.y,a.x,a.y);var k=this.kb.zd(z.yc);k.values[1]=1;k.values[2]=1;k=k.zd(z.RGBA);k.values[3]=1;h.addColorStop(0,k.toString());k.values[3]=0;h.addColorStop(1,k.toString());this.ka.fillStyle=h;this.ka.fill();this.strokeStyle="#000000";this.ka.beginPath();this.ka.moveTo(b.x,b.y);this.ka.lineTo(f,c);this.ka.stroke();c=1-this.kb.values[2];f=this.kb.values[1]*b.x+c*e.x+(1-this.kb.values[1]-
c)*d.x;c=this.kb.values[1]*b.y+c*e.y+(1-this.kb.values[1]-c)*d.y;this.ka.beginPath();this.ka.arc(f,c,4,0,2*Math.PI,!1);this.ka.stroke();this.ka.restore();this.Hd=b;this.Xe=d;this.fg=e;this.mid=a};c.prototype.Pm=function(a,b){var d=Math.sqrt((a-this.cb/2)*(a-this.cb/2)+(b-this.cb/2)*(b-this.cb/2));if("ring"===this.bg||"triangle"!==this.bg&&d>=this.fe/2&&d<=this.cb/2)this.kb.values[0]=Math.atan2(this.cb/2-b,this.cb/2-a)/Math.PI*180+180,0===this.kb.values[1]&&(this.kb.values[1]=1,this.kb.values[2]=1),
this.bg="ring";else{var e=this.Hd;d=this.Xe;var f=this.fg;var c=(e.x-f.x)*(d.y-f.y)-(d.x-f.x)*(e.y-f.y);d=((d.y-f.y)*(a-f.x)-(d.x-f.x)*(b-f.y))/c;c=1-Math.max(0,d)-Math.max(0,(-(e.y-f.y)*(a-f.x)+(e.x-f.x)*(b-f.y))/c);this.kb.values[1]=Math.min(Math.max(d,0),1);this.kb.values[2]=1-Math.min(Math.max(c,0),1);this.bg="triangle"}0===this.kb.values[3]&&(this.kb.values[3]=1,null!==this.xd&&(this.xd.value="255"));this.ja();this.update()};c.isSupported=function(){var a=document.createElement("canvas");"G_vmlCanvasManager"in
window&&window.G_vmlCanvasManager.initElement(a);return a.getContext&&a.getContext("2d").getImageData};c.Cache=[];return c}();var wb=function(){function c(a){this.code="en";this.data={};this.log=B.create("LANGUAGE");this.data=this.ro(a,{})}c.prototype.Po=function(a){a=a.split(",");this.log("Choice of languages: %s",a);for(var b=0;b<a.length;b++){var d=a[b].split("-")[0];if(d in this.data){this.log("Using language code %s",d);this.code=d;break}else this.log("No language for code %s",d)}};c.prototype.Fj=function(a){this.ro(a,this.data)};c.prototype.ro=function(a,b){for(var d=a.split("\n"),e=/^([ \t]*)([^:]+):([^:]+):(.*)/,
c=0;c<d.length;c++){var g=e.exec(d[c]);if(g){var h=g[2],k=g[3];g=g[4];h in b||(b[h]={});k in b[h]&&this.log("Warning: Replacing %s:%s",h,k);b[h][k]=g}}return b};c.prototype.fn=function(){var a=this;return function(b){for(var d=[],e=1;e<arguments.length;e++)d[e-1]=arguments[e];return a.sm(b,d)}};c.prototype.get=function(a){for(var b=[],d=1;d<arguments.length;d++)b[d-1]=arguments[d];return this.sm(a,b)};c.prototype.sm=function(a,b){var d="<not translated:"+a+">";this.code in this.data&&a in this.data[this.code]&&
(d=this.data[this.code][a]);for(var e=0;e<b.length;e++)d=d.replace("^"+e,b[e]);return d};return c}();var xb=B.create("SharedTree");
(function(){function c(){this.ra={};this.log=B.create("DebugTree");this.root={tb:"0",parent:null,children:[],aa:{name:"root"}};this.ra["0"]=this.root}c.prototype.createNode=function(a,b,d,e){this.log("create node "+a+" child of "+b);b=this.ra[b];e={tb:a,parent:b,children:[],aa:e};b.children.splice(d,0,e);this.ra[a]=e};c.prototype.rc=function(a){this.log("delete node "+a);if(a in this.ra){var b=this.ra[a].parent;if(b)for(var d=0;d<b.children.length;d++)if(b.children[d].tb===a){b.children.splice(d,
1);break}delete this.ra[a]}};c.prototype.je=function(a,b,d){this.log("move "+a+" to "+b+":"+d);if(a in this.ra){var e=this.ra[a];this.rc(a);this.createNode(a,b,d,e.aa)}};c.prototype.Cb=function(a,b){if(a in this.ra)for(var d in b)b.hasOwnProperty(d)&&(this.ra[a].aa[d]=b[d])};c.prototype.tc=function(a){return a in this.ra?this.ra[a].aa:{}};c.prototype.ta=function(){};c.prototype.toString=function(){return this.encode(this.root)};c.prototype.encode=function(a){for(var b="("+a.aa.name,d=0;d<a.children.length;d++)b+=
" "+this.encode(a.children[d]);return b+")"};return c})();function yb(c){c=c.split("-");return c[0]+"-"+(parseInt(c[1])+1)}
var zb=function(){function c(a,b){this.Ic=a;this.index=b}c.prototype.encode=function(){return this.Ic+";"+this.index};return c}(),Ab=function(){function c(a,b,d){this.qc=a;this.hg=b;this.type=d}c.prototype.encode=function(){return""};return c}(),Bb=function(c){function a(b,a,e,f,g,h){b=c.call(this,b,a,"c")||this;b.tb=e;b.Vu=f;b.aa=h;b.type="c";b.bb=new zb(f,g);return b}p(a,c);a.prototype.encode=function(){var b=JSON.stringify(this.aa);return"C"+this.tb+";"+this.bb.encode()+";"+b.length+";"+b+";"};
a.Ae=function(b,d,e,c){var f=/C([^;]+);([^;]+);(\d+);(\d+);/g;f.lastIndex=d;var h=f.exec(b);return h&&h.index===d?(d=parseInt(h[4],10),b=JSON.parse(b.substr(f.lastIndex,d)),{fd:new a(e,c,h[1],h[2],parseInt(h[3],10),b),position:f.lastIndex+d+1}):null};return a}(Ab),Cb=function(c){function a(b,a,e,f,g){b=c.call(this,b,a,"d")||this;b.tb=e;b.Ic=f;b.index=g;b.aa={};b.type="d";b.bb=new zb(f,g);return b}p(a,c);a.prototype.encode=function(){return"D"+this.tb+";"+this.bb.encode()+";"};a.Ae=function(b,d,e,
c){var f=/D([^;]+);([^;]+);(\d+);/g;f.lastIndex=d;return(b=f.exec(b))&&b.index===d?{fd:new a(e,c,b[1],b[2],parseInt(b[3],10)),position:f.lastIndex}:null};return a}(Ab),Db=function(c){function a(b,a,e,f){b=c.call(this,b,a,"s")||this;b.tb=e;b.aa=f;b.Ok={};b.type="s";return b}p(a,c);a.prototype.encode=function(){var b=JSON.stringify(this.aa);return"S"+this.tb+";"+b.length+";"+b+";"};a.Ae=function(b,d,e,c){var f=/S([^;]+);(\d+);/g;f.lastIndex=d;var h=f.exec(b);return h&&h.index===d?(d=parseInt(h[2],10),
b=JSON.parse(b.substr(f.lastIndex,d)),{fd:new a(e,c,h[1],b),position:f.lastIndex+d+1}):null};return a}(Ab),Eb=function(c){function a(b,a,e,f,g,h,k){b=c.call(this,b,a,"m")||this;b.tb=e;b.type="m";b.src=new zb(f,g);b.bb=new zb(h,k);return b}p(a,c);a.prototype.encode=function(){return"M"+this.tb+";"+this.src.encode()+";"+this.bb.encode()+";"};a.Ae=function(b,d,e,c){var f=/M([^;]+);([^;]+);(\d+);([^;]+);(\d+);/g;f.lastIndex=d;return(b=f.exec(b))&&b.index===d?{fd:new a(e,c,b[1],b[2],parseInt(b[3],10),
b[4],parseInt(b[5],10)),position:f.lastIndex}:null};return a}(Ab);(function(){function c(a){this.ha=a}c.prototype.toString=function(){return""};return c})();
function Fb(c){for(var a=[],b=0,d="0-0",e="0-0",f=/B([^;]+);([^;]+);([^;]+);\d+;/g;b<c.length;){switch(c[b]){case "B":f.lastIndex=b;if((d=f.exec(c))&&d.index===b)e=d[2],d=d[3],b=f.lastIndex;else return null;continue;case "C":e=Bb.Ae(c,b,d,e);break;case "D":e=Cb.Ae(c,b,d,e);break;case "S":e=Db.Ae(c,b,d,e);break;case "M":e=Eb.Ae(c,b,d,e);break;default:return null}if(null===e)return null;b=e.position;a.push(e.fd);e=d;d=yb(d)}return a}
var Gb=function(){function c(a){this.Nc=a;this.local=[];this.Oc={};this.qd=[];this.clientId=Math.floor(1E7*Math.random()).toString(36);this.ys=1;this.mc=this.Rp=!1;this.log=B.create("SharedTree")}c.prototype.Ph=function(){return 0===this.qd.length?"0-0":this.qd[this.qd.length-1].qc};c.prototype.Nh=function(){return this.clientId+"-"+this.ys++};c.prototype.ss=function(a){return"N"+this.clientId+"-"+a};c.prototype.createNode=function(a,b,d,e){this.mc||(b=new Bb(this.Nh(),this.Ph(),a,b,d,e),this.Jh(b));
return a};c.prototype.rc=function(a,b,d){this.mc||(b=new Cb(this.Nh(),this.Ph(),a,b,d),b.aa=this.Nc.tc(a),this.Jh(b))};c.prototype.je=function(a,b,d,e,c){this.mc||(a=new Eb(this.Nh(),this.Ph(),a,e,c,b,d),this.Jh(a))};c.prototype.Cb=function(a,b){if(!this.mc){var d=new Db(this.Nh(),this.Ph(),a,b);this.Jh(d)}};c.prototype.Jh=function(a){this.Oc[a.qc]=a;this.qd.push(a);this.local.push(a);xb("Add change "+a.qc+" parent "+a.hg);this.Rp&&this.vj(a,!1)};c.prototype.gr=function(){var a;void 0===a&&(a=!0);
for(var b=this.local,d="",e=[[]],c=e[0],g=0;g<b.length;g++)0<g&&yb(b[g-1].qc)===b[g].qc&&(c=[],e.push(c)),c.push(b[g]);for(b=0;b<e.length;b++)for(c=e[b],g=0;g<c.length;g++){var h=c[g];0===g&&(d+="B"+Math.round((new Date).getTime()/1E3).toString(36)+";"+h.hg+";"+h.qc+";"+c.length+";");d+=h.encode()}a&&(this.local.length=0);return d};c.prototype.Hp=function(a){function b(a,d,e){for(var c="",f=0;f<e;f++)c+="..";xb(c+("["+d+"]"));c=0;for(d=a[d];c<d.length;c++)b(a,d[c],e+1)}var d=Fb(a);if(null!==d){for(a=
0;a<d.length;a++){var e=d[a];e.qc in this.Oc||(this.Oc[e.qc]=e)}d={"0-0":[]};for(var c in this.Oc)this.Oc.hasOwnProperty(c)&&(d[c]=[]);for(c in this.Oc)this.Oc.hasOwnProperty(c)&&(e=this.Oc[c],a=e.hg,a in d&&d[a].push(c));for(c in d)d.hasOwnProperty(c)&&d[c].sort();b(d,"0-0",0);e=d["0-0"];c="0-0";for(a=0;a<this.qd.length&&1===e.length&&e[0]===this.qd[a].qc;a++)c=e[0],e=d[e[0]];for(e=this.qd.length-1;e>=a;e--)this.vj(this.qd[e],!0);this.qd.length=a;e=[];this.rk(d,c,e);for(a=1;a<e.length;a++)this.qd.push(this.Oc[e[a]]),
this.vj(this.Oc[e[a]],!1);this.mc=!0;2<=e.length&&this.Nc.ta();this.mc=!1}};c.prototype.rk=function(a,b,d){d.push(b);for(b=a[b];1===b.length;)d.push(b[0]),b=a[b[0]];if(0!==b.length){var e=d.length;this.rk(a,b[0],d);for(var c=1;c<b.length;c++){var g=d.length;this.rk(a,b[c],d);for(var h=g;h<d.length;h++)for(var k=this.Oc[d[h]],l=e;l<g;l++)this.fu(this.Oc[d[l]],k)}}};c.prototype.fu=function(a,b){function d(b,d,c){b="c"===a.type?1:-1;switch(c.type){case "c":e(d,c.bb,b,"c");break;case "d":e(d,c.bb,b,"d");
break;case "m":e(d,c.src,b,"d"),e(d,c.bb,b,"c")}}function e(a,d,e,c){a.Ic===d.Ic&&0<=d.index&&(a.index<d.index||a.index==d.index&&0<e?(d.index+=e,xb("Shift "+b.type+" by "+e)):a.index===d.index&&0>e&&"d"===c&&(d.index=-1,xb("NULLIFY")))}xb("xform "+a.qc+":"+a.type+"/"+b.qc+":"+b.type);a.hg===b.hg&&(b.hg=a.qc);"c"===a.type?d(a.type,a.bb,b):"d"===a.type?d(a.type,a.bb,b):"m"===a.type&&(d("d",a.src,b),d("c",a.bb,b))};c.prototype.vj=function(a,b){xb((b?"Undo":"Execute")+" "+a.qc+": "+a.type);this.mc=!0;
if("c"===a.type){var d=a;b?this.Nc.rc(d.tb,d.bb.Ic,d.bb.index):this.Nc.createNode(d.tb,d.bb.Ic,d.bb.index,d.aa)}else if("d"===a.type){d=a;if(-1===d.bb.index){xb("Change was nullified.");this.mc=!1;return}b?this.Nc.createNode(d.tb,d.bb.Ic,d.bb.index,d.aa):(d.aa=this.Nc.tc(d.tb),this.Nc.rc(d.tb,d.bb.Ic,d.bb.index))}else if("s"===a.type)if(d=a,b)this.Nc.Cb(d.tb,d.Ok);else{d.Ok={};var e=this.Nc.tc(d.tb),c;for(c in d.aa)d.Ok[c]=e[c];this.Nc.Cb(d.tb,d.aa)}else if("m"===a.type){d=a;if(-1===d.src.index){this.mc=
!1;return}b?this.Nc.je(d.tb,d.src.Ic,d.src.index,d.bb.Ic,d.bb.index):this.Nc.je(d.tb,d.bb.Ic,d.bb.index,d.src.Ic,d.src.index)}this.mc=!1};return c}();var Hb=function(){function c(){this.Ei=!1;this.Ra={};this.log=B.create("EventEmitter")}c.prototype.ua=function(a){for(var b=this,d=1;d<arguments.length;d++);var e=Array.prototype.slice.apply(arguments);setTimeout(function(){b.Oe.apply(b,e)},0)};c.prototype.Oe=function(a){for(var b=1;b<arguments.length;b++);this.Ra||(this.Ra={});b=Array.prototype.slice.call(arguments,1);var d,e=!1;if(a in this.Ra){var c=this.Ra[a];var g=0;for(d=c.length;g<d;g++){var h=c[g];this.Ei||e||(this.log("Emit %s",a),e=!0);
h.apply(null,b)}}};c.prototype.xa=function(a,b){this.Ra||(this.Ra={});this.bind(a,b)};c.prototype.once=function(a,b){function d(){e.wg(a,d);b.apply(null,arguments)}var e=this;e.bind(a,d)};c.prototype.bind=function(a,b){a in this.Ra?this.Ra[a].push(b):this.Ra[a]=[b];return b};c.prototype.wg=function(a,b){var d,e;if(a in this.Ra){var c=this.Ra[a];var g=d=0;for(e=c.length-1;d<=e;g=d+=1)if(c[g]===b){c.splice(g,1);break}}};return c}();var Ib=function(c){function a(b){var a=c.call(this)||this;a.Rd=b;a.Yu=(new Date).getTime();a.cj=1;a.Ve={};a.buttons=[];a.ae=0;a.log=B.create("TOOLBAR");a.ia=document.createElement("div");a.ia.style.width=b+"px";a.ia.style.height="320px";a.ia.style.border="none";a.ia.style.backgroundColor="#ffffff";a.ia.style.MozUserSelect="none";a.ia.style.WebkitUserSelect="none";a.ia.style.Ou="none";a.ia.style.yu="none";a.ae=0;return a}p(a,c);a.prototype.width=function(){return parseInt(this.ia.style.width,10)};
a.prototype.focus=function(b){0<this.buttons.length&&(0<arguments.length&&(this.Cg(!1),this.ae=b||0),this.Cg(!0))};a.prototype.blur=function(){0<this.buttons.length&&this.Cg(!1)};a.prototype.Cg=function(b){this.buttons[this.ae].ia.style.outline=b?"1px dotted gray":"none"};a.prototype.Zb=function(b,a){if(0!==this.buttons.length){var d="next"===b||"previous"===b;d&&this.Cg(!1);switch(b){case "next":this.ae=Math.min(this.ae+1,this.buttons.length-1);break;case "previous":this.ae=Math.max(this.ae-1,0);
break;case "enter":this.buttons[this.ae].hq(a)}d&&(this.Cg(!0),a.stopPropagation(),a.preventDefault())}};a.prototype.moveTo=function(b,a){C(this.ia).ea("left",""+b+"px");C(this.ia).ea("top",""+a+"px")};a.prototype.show=function(b){void 0===b&&(b=!1);this.ia.style.display=b?"block":"none"};a.prototype.De=function(b,a,e,c){this.Ve[b]=this.hc(e,a,c)};a.prototype.cq=function(){for(var b in this.Ve)this.Ve.hasOwnProperty(b)&&(this.Ve[b].ia.style.background="#ffffff",this.Ve[b].qa.style.background="#ffffff")};
a.prototype.Io=function(b){this.cq();b in this.Ve&&(b=this.Ve[b],b.ia.style.background="#9fb3e7",b.qa.style.background="#9fb3e7")};a.prototype.hc=function(b,a,e){function d(){var b=h.style.background;h.style.background="#e7d69f";k.style.background="#e7d69f";var a=h.style.background;setTimeout(function(){h.style.background===a&&(h.style.background=b,k.style.background=b)},200)}var c=this,h=document.createElement("div"),k=document.createElement("img"),l=this;h.style.display="inline";h.style.cssFloat=
"left";h.style.overflow="hidden";h.style.width=this.Rd+"px";h.style.height=this.Rd+"px";h.style.margin="1px";h.style.yu="none";k.src=b;k.style.cursor="pointer";k.setAttribute("title",a);k.style.maxWidth=this.Rd+"px";k.style.maxHeight=this.Rd+"px";k.draggable=!1;k.style.iv="none";k.cv=function(b){b.preventDefault()};h.appendChild(k);C(k).bind("load",function(){var b=(c.Rd-k.height)/2;k.style.marginLeft=(c.Rd-k.width)/2+"px";k.style.marginTop=b+"px"});this.ia.appendChild(h);var n=this.buttons.length;
e&&(C(h).bind("touchstart",function(b){b.preventDefault();d();e(b);l.ua("click",b)}),C(h).click(function(b){d();e(b);l.focus(n);l.ua("click",b)}));this.cj+=this.Rd+1;b={ia:h,qa:k,hq:e};this.buttons.push(b);return b};a.prototype.Yq=function(b){if(!(0>=b)){var a=(this.Rd+2)*Math.ceil(this.cj/b)+1;this.ia.style.width=""+a+"px";this.ia.style.height=""+b+"px";this.log("Toolbar width/height = %s,%s totalHeight=%s",a,b,this.cj)}};return a}(Hb);var Jb=function(c){function a(b){var d=c.call(this)||this;d.ia=b;d.Cj=!1;d.duration=200;d.right=!0;d.Sh=a.up();d.prefix=a.gm;d.Yg=null;d.left=!1;d.eg=null;d.log=B.create("SlidingPanel",!1);b.ea("display","none");d.Sh&&(b=d.ia.outerWidth(),d.ea("TransitionProperty","transform"),d.ea("Transform","translate("+b+"px,0)"));d.body=C(".body");return d}p(a,c);a.up=function(){var b=(document.body||document.documentElement).style,d="transition",e=["Moz","Webkit","Khtml","O","ms"];d=d.charAt(0).toUpperCase()+
d.substr(1);for(var c=0;c<e.length;c++)if("string"===typeof b[e[c]+d])return a.gm=e[c],!0;return!1};a.prototype.show=function(b,a){void 0===a&&(a=!1);var d=this;this.Yg&&(clearTimeout(this.Yg),this.Yg=null);!1!==a&&(a=!0);this.Cj=!0;this.ia.show();var c=this.ia.outerWidth();this.ia.Xa();"right"===b?(this.left=!1,this.ia.ea("left",""+(C(window).width()-c)+"px")):this.left=!0;a&&(d.eg=new qb,d.eg.zIndex=parseFloat(d.ia.ea("z-index"))||0,d.eg.insertBefore=d.ia,d.eg.show(function(){d.Ks()}));d.Sh?(this.log("Performing transition"),
d.ia.ea("display","block"),d.left?d.ea("Transform","translate(-"+c+"px,0)"):d.ea("Transform","translate("+c+"px,0)"),d.ea("TransitionDuration",""+d.duration+"ms"),d.ea("TransitionDuration",""+d.duration+"ms",d.body),window.setTimeout(function(){d.ea("Transform","translate(0,0)");d.ea("Transform","translate("+(d.left?c:-c)+"px,0)",d.body);window.setTimeout(function(){d.oo()},d.duration)},1)):(this.log("No transitions allowed"),d.ia.ea("display","block"),d.oo())};a.prototype.Ks=function(){this.Xa()};
a.prototype.ea=function(b,a,e){void 0===e&&(e=this.ia);0!==e.length&&(b=""!==this.prefix?this.prefix+b:b.charAt(0).toLowerCase()+b.substr(1),e[0].style[b]=a,this.log("%s=%s",b,a))};a.prototype.vb=function(){return this.Cj};a.prototype.Xa=function(){var b=this;if(!this.Yg){this.Cj=!1;b.eg&&b.eg.Xa();var a=this.ia.outerWidth();b.Sh?this.left?b.ea("Transform","translate(-"+a+"px,0)"):b.ea("Transform","translate("+a+"px,0)"):b.ia.ea("display","none");b.ea("Transform","translate(0,0)",this.body);b.Sh?
this.Yg=window.setTimeout(function(){b.ia.ea("display","none");b.ua("hide")},b.duration):b.ua("hide")}};a.prototype.oo=function(){this.ia.find(".focus").focus();this.ua("show")};a.gm="";return a}(Hb);var Kb=function(c){function a(){var b=c.call(this)||this;b.keys={};b.Ei=!0;b.Ut=new RegExp("alt backspace cmd command control ctrl del delete down end enter esc escape f4 home ins insert left meta pagedown pageup right shift up \u2318".split(" ").sort(function(b,a){return a.length-b.length}).join("|"),"g");b.log=B.create("KEYMAP");b.ui=function(a){b.Sr(a)};return b}p(a,c);a.prototype.map=function(b,a){var d=b.toLowerCase().split(","),c;if("string"===typeof a){var g=a.split(",");for(c=0;c<d.length;c++)for(var h=
0;h<g.length;h++)this.lm(d[c],g[h])}else for(c=0;c<d.length;c++)this.lm(d[c],a)};a.prototype.lm=function(b,a){if(0!==b.length){var d=b.match(this.Ut)||[],c=!1,g=!1,h=!1,k=!1,l=[],n;for(n=0;n<d.length;n++)switch(d[n]){case "alt":h=!0;break;case "control":case "ctrl":g=!0;break;case "shift":c=!0;break;case "home":l.push(36);break;case "end":l.push(35);break;case "pageup":l.push(33);break;case "pagedown":l.push(34);break;case "delete":case "del":l.push(46);break;case "backspace":l.push(8);break;case "up":l.push(38);
break;case "right":l.push(39);break;case "down":l.push(40);break;case "left":l.push(37);break;case "escape":case "esc":l.push(27);break;case "enter":l.push(13);break;case "ins":case "insert":l.push(45);break;case "f4":l.push(115);break;case "meta":case "command":case "cmd":case "\u2318":k=!0;break;default:alert("key entry not found: "+d[n])}var m=this;d=function(b){c&&-1===b.indexOf("-shift")&&(b+="-shift");g&&-1===b.indexOf("-control")&&(b+="-control");h&&-1===b.indexOf("-alt")&&(b+="-alt");k&&-1===
b.indexOf("-meta")&&(b+="-meta");"string"===typeof a?m.log("Keyboard mapping: %s->%s",b,a):m.log("Keyboard mapping: %s->%s",b,"function()");if(b in m.keys){var d,e=m.keys[b];for(d=0;d<e.length&&e[d]!==a;d++);d===e.length&&m.keys[b].push(a)}else m.keys[b]=[a]};if(0===l.length)switch(n=b.toUpperCase().charAt(b.length-1),n){case "=":d("107-shift");d("187");d("61");break;case "+":d("107");d("61-shift");break;case "-":d("109");d("189");d("173");break;default:l.push(n.charCodeAt(0))}for(n=0;n<l.length;n++)d(""+
l[n])}};a.prototype.xr=function(b){var a="";b.keyCode&&(a+=b.keyCode);b.shiftKey&&(a+="-shift");b.ctrlKey&&(a+="-control");b.altKey&&(a+="-alt");b.metaKey&&(a+="-meta");return a};a.prototype.translate=function(b){var a=[];b=this.xr(b);b in this.keys&&(a=this.keys[b]);this.log("%s",b);return a};a.prototype.Sr=function(b){for(var a=0,e=this.translate(b);a<e.length;a++){var c=e[a];"string"===typeof c?(this.log("action: %s",c),this.Oe("*",c,b)):c(b)}};a.prototype.Qp=function(b){C(b).bind("keydown",this.ui)};
a.prototype.detach=function(b){C(b).wg("keydown",this.ui)};return a}(Hb);function Lb(c){var a=document.createElement("input");C(a).Jb("type","range");if("range"===a.type)return a.Ft=function(b,d){a.min=""+b;a.max=""+d},a.Cn=function(){return parseFloat(a.value)},a.ql=function(b){a.value=""+b},a;var b=C("<div>");b.ea("display","inline-block");b.ea("vertical-align","top");b.ea("height","1em");b.ea("width","10em");b.ea("padding","0.25em");b.ea("position","relative");var d=C("<div>");d.ea("top","50%");d.ea("height","0");d.ea("border-top","1px solid black");d.ea("border-bottom",
"1px solid #888888");d.ea("position","absolute");d.ea("left","0");d.ea("right","0");var e=C("<div>");e.ea("height","1em");e.ea("left","0px");e.ea("background","#888888");e.ea("border-top","1px solid #cccccc");e.ea("border-left","1px solid #cccccc");e.ea("border-bottom","1px solid #000000");e.ea("border-right","1px solid #000000");e.ea("width","0.5em");e.ea("position","absolute");e.ea("cursor","pointer");b.append(d);b.append(e);var f=b[0];f.type="range";f.min="0";f.max="100";f.value="0";f.onchange=
function(){};f.Ft=function(b,a){f.min=""+b;f.max=""+a};f.ql=function(a){f.value=""+a;var d=b.width()-e.width();a=a/parseFloat(f.max)*d;a=Math.round(a);a=Math.max(a,0);a=Math.min(a,b.width());e.ea("left",""+a+"px")};f.Cn=function(){return parseFloat(f.value)};var g,h,k,l=B.create("RANGE");ib(C(e),function(b){"mousedown"===b.type&&(k=!0,g=b.pageX,h=parseInt(e.ea("left"),10),l("Mousedown at %s, ox=%s",g,h),b.stopPropagation(),b.preventDefault())});ib(C(b),function(a){if("mousedown"===a.type){var d=b.width()-
e.width(),c=a.pageX-C(b).offset().left;c=Math.max(c,0);c=Math.min(c,d);e.ea("left",""+c+"px");g=a.pageX;h=c;c=c/d*(parseFloat(f.max)-parseFloat(f.min))+parseFloat(f.min);c=Math.round(c);f.value=""+c;f.onchange&&f.onchange.call(f,a);k=!0}});hb(C(b),function(a){if(k&&"mousemove"===a.type){var d=b.width()-e.width(),c=a.pageX-g+h;c=Math.max(c,0);c=Math.min(c,d);e.ea("left",""+c+"px");c=c/d*(parseFloat(f.max)-parseFloat(f.min))+parseFloat(f.min);c=Math.round(c);f.value=""+c;f.onchange&&f.onchange.call(f,
a)}});c.bind(C(document.body),"mouseup",function(){k=!1});return f};function Mb(c,a,b){this.qa=c;this.Xi=a;this.fn=b;this.bj=0}
var Nb=new (function(){function c(){this.Ab=[];this.Cl=!1;this.log=B.create("ImageLoader")}c.prototype.timeout=function(){var a=[];this.log("Timeout running... %s images remaining",this.Ab.length);for(var b=0;b<this.Ab.length;b++)this.Ab[b].qa.complete?this.Ab[b].fn(this.Ab[b].qa,this.Ab[b].Xi):5E3>this.Ab[b].bj?(this.Ab[b].bj+=250,a.push(this.Ab[b])):this.Ab[b].fn(this.Ab[b].qa,this.Ab[b].Xi);this.Ab=a;this.Ab.length?setTimeout(this.timeout,250):(this.log("Timeout Stopped"),this.Cl=!1)};c.prototype.load=
function(a,b){var d=this,e=document.createElement("img"),c=new Mb(e,a,b);this.Ab.push(c);var g=0<=a.indexOf("://"),h="://"+window.location.host;0!==a.indexOf("data:")&&g&&-1===a.indexOf(h)&&(this.log("Using cross origin request for img"),e.crossOrigin="");e.addEventListener("load",function(){d.log("LoadFn called. complete=%s",e.complete);if(e.complete)for(var a=0;a<d.Ab.length;a++){var f=d.Ab[a];if(f.qa===e){d.Ab.splice(a,1);b(e,f.Xi);break}}else d.Cl||(d.Cl=!0,setTimeout(d.timeout,250),c.bj=250)},
!1);e.addEventListener("error",function(){d.log("Error loading %s",a);b(null,c.Xi)},!1);e.src=a;return e};return c}());var Ob=function(c){function a(b){var a=c.call(this)||this;a.parent=b;a.Ra={};a.maxWidth=128;a.maxHeight=0;a.Tt=2;a.fs="grid";a.Jk=0;a.ni=1;a.cells=[];a.Dl=null;a.log=B.create("ListView");b.append(a.ia);a.ia.ea("overflow-x","auto");a.ia.ea("overflow-y","auto");return a}p(a,c);a.prototype.xa=function(a,d){this.Ra[a]=d};a.prototype.Si=function(a,d){this.maxWidth=a;this.maxHeight=d};a.prototype.Rh=function(a,d,e){var b=this,c=this.ni;var h={qa:null,index:this.Jk,Pn:!1};this.Jk+=1;Nb.load(a,function(a){if(c===
b.ni&&null!==a){var f=a.width;var g=a.height;b.maxWidth&&f>b.maxWidth&&(a.width=b.maxWidth,a.height=g/f*b.maxWidth);b.maxHeight&&g>b.maxHeight&&(a.width=b.maxHeight/(g/f),a.height=b.maxHeight);var k=C(a);k.ea("margin",""+b.Tt+"px");k.ea("border-width","3");k.ea("border-color","white");k.ea("border-style","solid");k.ea("image-rendering","optimizeQuality");fb(k,function(){b.log("Mouseenter");return k.ea("border-color","#888888")});eb(k,function(){return k.ea("border-color","white")});k.click(function(){if("click"in
b.Ra)return b.Ra.click(d)});e&&k.Jb("title",e);h.qa=k;b.cells.push(h);b.cells.sort(function(a,b){return a.index-b.index});b.Dl||(b.Dl=setTimeout(function(){b.Dl=null;b.format()},500))}})};a.prototype.format=function(){var a;var d=null;var e=this.cells;var c=0;for(a=e.length;c<a;c++){var g=e[c];if(!g.Pn&&g.qa){if(null===d){d=this.ia;var h=g.qa;h=Za(h);0<d.length?d[0].insertBefore(h[0],d[0].firstChild):d[0].appendChild(h[0])}else d.qa&&ob(d.qa,g.qa);g.Pn=!0}d=g}};a.prototype.clear=function(){this.ia.empty();
this.cells.length=0;this.ni+=1};return a}(rb);Ob.prototype=C.extend({},rb.prototype,Ob.prototype);var Qb=function(){function c(){this.items=[];this.next=0;this.Vd=!1;this.log=B.create("UNDOSTACK")}c.prototype.ta=function(a,b,d){void 0===b&&(b=!1);a=a instanceof Pb?[a]:a;this.next<this.items.length&&(this.items.length=this.next);if(!b)for(b=0;b<a.length;b++)a[b].Ob(d);for(d=this.top();d;)if(d[d.length-1].co(a[0])){if(a.shift(),0===a.length)break}else break;a.length&&this.items.push(a);this.Vd=!0;this.next=this.items.length};c.prototype.jb=function(a){this.log("Undo index %s of %s",this.next,this.items.length);
if(this.Ie()){for(var b=this.items[--this.next],d=b.length-1;0<=d;d--)b[d].jb(a);this.Vd=!0}};c.prototype.Jd=function(a){this.log("Redo index %s of %s",this.next,this.items.length);if(this.He()){for(var b=this.items[this.next++],d=0;d<b.length;d++)b[d].Ob(a);this.Vd=!0}};c.prototype.Ie=function(){return 0<this.next};c.prototype.He=function(){return this.next<this.items.length};c.prototype.clear=function(){this.next=this.items.length=0;this.Vd=!1};c.prototype.top=function(){return this.items.length?
this.items[this.items.length-1]:null};return c}(),Pb=function(){function c(){}c.prototype.Ob=function(){};c.prototype.jb=function(){};c.prototype.co=function(){return!1};return c}();var Rb=function(){function c(a){this.next=a}c.prototype.Ql=function(a){for(var b=0;b<a.length;b++)this.Qa(a.charCodeAt(b))};c.prototype.Qa=function(a){this.next.Qa(a)};c.prototype.flush=function(){this.next.flush()};c.prototype.Sf=function(){return this.next.Sf()};return c}(),Sb=function(){function c(){this.data="";this.log=B.create("BYTESTREAM")}c.prototype.Ql=function(a){for(var b=0;b<a.length;b++)this.Qa(a.charCodeAt(b))};c.prototype.Sf=function(){return this};c.prototype.Qa=function(a){if(255<
a||0>a)throw"Bad data written to byte buffer";this.data+=String.fromCharCode(a)};c.prototype.flush=function(){};c.prototype.toString=function(){return this.data};c.prototype.ec=function(){for(var a=[],b=0;b<this.data.length;b++)a.push(this.data.charCodeAt(b));return a};c.rj=function(a,b){c.cm[a]=b};c.yg=function(a){var b=new c;a=a.split(",");a.reverse();for(var d=0;d<a.length;d++){var e=a[d];e.length&&(b=c.cm[e](b))}return b};c.cm={};return c}();var Tb=function(c){function a(a){a=c.call(this,a)||this;a.Eg=0;a.total=0;a.size=0;a.keys="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";return a}p(a,c);a.prototype.Qa=function(a){this.Eg=this.Eg<<8|a;this.size+=8;for(this.total+=1;6<=this.size;)this.next.Qa(this.keys.charCodeAt(this.Eg>>this.size-6&63)),this.size-=6};a.prototype.flush=function(){var a=(3-this.total%3)%3;this.size&&(this.next.Qa(this.keys.charCodeAt(this.Eg>>this.size-6&63)),this.Eg=this.size=0);for(;a--;)this.next.Qa(61);
this.next.flush()};return a}(Rb);Sb.rj("Base64Encoder",function(c){return new Tb(c)});var Ub=function(c){function a(a){a=c.call(this,a)||this;a.items=[];return a}p(a,c);a.prototype.Qa=function(a){4===this.items.length&&this.pm();this.items.push(a)};a.prototype.pm=function(){var a=this.items[0];var d=this.items[1];var e=this.items[2];var c=this.items[3];a=(a<<24|d<<16|e<<8|c)>>>0;var g=(a/614125|0)%85+33;var h=(a/7225|0)%85+33;var k=(a/85|0)%85+33;var l=a%85+33;this.next.Qa((a/52200625|0)%85+33);this.next.Qa(g);isNaN(d)||(this.next.Qa(h),isNaN(e)||(this.next.Qa(k),isNaN(c)||this.next.Qa(l)));
this.items.length=0};a.prototype.flush=function(){0<this.items.length&&this.pm();this.next.Ql("~>");this.next.flush()};return a}(Rb);Sb.rj("Ascii85Encoder",function(c){return new Ub(c)});var Vb=function(){function c(a){this.next=a;this.od=this.Ye=0;this.ao=[0,1,3,7,15,31,63,127,255,511,1023,2047,4095,8193];this.log=B.create("BITWRITER")}c.prototype.Qa=function(a){this.hp(a,8)};c.prototype.hp=function(a,b){this.Ye=this.Ye<<b|a&this.ao[b];for(this.od+=b;8<=this.od;)this.next.Qa(this.Ye>>>this.od-8&255),this.od-=8,this.Ye&=this.ao[this.od]};c.prototype.flush=function(){this.od&&(this.next.Qa(this.Ye<<8-this.od),this.Ye=this.od=0);this.next.flush()};return c}();var Wb=function(c){function a(a){var b=c.call(this,a)||this;b.cg=258;b.Uu=0;b.sf=0;b.first=!0;b.Hg=[];b.Wk=[];b.Hj=[];b.av=0;b.Mj=9;b.log=B.create("LZWEncoder");b.Xp=new Vb(a);b.nm();return b}p(a,c);a.prototype.Qa=function(a){if(this.first)this.sf=a,this.first=!1;else{var b=this.yp(this.sf,a);void 0!==this.Hg[b]?this.sf=this.Hg[b]:(this.Oh(this.sf),this.Hg[b]=this.cg,this.Wk[b]=this.sf,this.sf=this.Hj[b]=a,4095>this.cg?(this.cg+=1,this.Mj=Math.ceil(Math.log(this.cg)/Math.log(2))):this.nm())}};a.prototype.yp=
function(a,d){var b;var c=d<<4^a;for(b=0===c?1:18041-c;;){if(void 0===this.Hg[c]||this.Wk[c]===a&&this.Hj[c]===d)return c;c-=b;0>c&&(c+=18041)}};a.prototype.nm=function(){this.Oh(a.jp);this.cg=258;this.Mj=9;this.Hg.length=0;this.Wk.length=0;this.Hj.length=0};a.prototype.flush=function(){this.first||(this.Oh(this.sf),this.Oh(a.op))};a.prototype.Oh=function(a){this.Xp.hp(a,this.Mj)};a.jp=256;a.op=257;return a}(Rb);Sb.rj("LZWEncoder",function(c){return new Wb(c)});var Xb=B.create("MISC");function Yb(c){"jQuery"in window&&c instanceof window.jQuery&&(c=c[0]);return C(c)}function Zb(c){var a=document.createElement("canvas");c&&c.appendChild(a);"G_vmlCanvasManager"in window&&(Xb("Emulating canvas in IE"),window.Ku.Xu(a),C(a).bind("selectstart",function(a){Xb("Cancelled selectstart on canvas");a.stopPropagation();a.preventDefault()}));a.style.background="transparent";return a}function $b(){return(new Date).getTime()}
var ac=/MSIE ([0-9]{1,}[\.0-9]{0,})/,bc=0,cc=!1;function dc(){if(cc)var c=bc;else{c=-1;if("Microsoft Internet Explorer"===navigator.appName){var a=ac.exec(navigator.userAgent);null!==a&&(c=parseFloat(a[1]))}bc=c;cc=!0;Xb("IE version is %s",c)}return 0<=c&&9>c}function ec(){for(var c=document.getElementsByTagName("*"),a=0,b=0;b<c.length;b++){var d=parseInt(C(c[b]).ea("z-index"),10)||0;d>a&&(a=d)}return a}
function fc(){if(null===gc){var c=document.createElement("div");c.style.visibility="hidden";c.style.width="100px";document.body.appendChild(c);var a=c.offsetWidth;c.style.overflow="scroll";var b=document.createElement("div");b.style.width="100%";c.appendChild(b);b=b.offsetWidth;c.parentNode.removeChild(c);gc=a-b;Xb("ScrollbarWidth calculated as %spx",gc)}return gc}var gc=0;function hc(c,a){var b=z.Xb(c);b.values[3]=a;return b.toString()}
function ic(c){var a=atob(c.split(",")[1]);c=c.split(",")[0].split(":")[1].split(";")[0];for(var b=new ArrayBuffer(a.length),d=new Uint8Array(b),e=0;e<a.length;e++)d[e]=a.charCodeAt(e);return new Blob([b],{type:c})}function jc(c,a){var b="function"!==typeof a?function(b){return b===a}:a;for(var d=0,e=0;e<c.length;e++)b(c[e])?d+=1:d&&(c[e-d]=c[e]);c.length-=d}
function kc(){var c=document.documentElement,a=c.scrollHeight>C(c).height();c=c.scrollWidth>C(c).width();a=a?fc():0;c=c?fc():0;var b=document.documentElement.scrollTop||document.body.scrollTop,d=document.documentElement.scrollLeft||document.body.scrollLeft;return{width:C(window).width()-a,height:C(window).height()-c,x:d,y:b}}function lc(c){var a=kc(),b=c.offset();b.left=Math.min(b.left,a.x+a.width-c.outerWidth());b.top=Math.min(b.top,a.y+a.height-c.outerHeight());c.offset(b)}
function mc(c,a){function b(a,b){return{stopPropagation:function(){a.stopPropagation()},preventDefault:function(){a.preventDefault()},po:a,type:b.type,target:b.target,pageX:b.pageX,pageY:b.pageY,scale:b.scale,rotation:b.rotation}}var d=1,e=0;c.addEventListener("mousedown",function(c){3===(c.buttons&3)&&(d=1,e=0,a(b(c,{type:"gesturestart",target:c.target,pageX:c.pageX,pageY:c.pageY,scale:d,rotation:e})))},!1);c.addEventListener("contextmenu",function(a){a.preventDefault()},!1);c.addEventListener("mousemove",
function(c){3===(c.buttons&3)&&a(b(c,{type:"gesturechange",target:c.target,pageX:c.pageX,pageY:c.pageY,scale:d,rotation:e}))},!1);c.addEventListener("mouseup",function(e){5!==(e.buttons&3)&&a(b(e,{type:"gestureend",target:e.target,pageX:e.pageX,pageY:e.pageY,scale:d,rotation:0}))},!1);c.addEventListener("wheel",function(c){3===(c.buttons&3)&&(d=0<c.deltaY?1.1*d:d/1.1,0<c.deltaX?e+=10:0>c.deltaY&&(e-=10),a(b(c,{type:"gesturechange",target:c.target,pageX:c.pageX,pageY:c.pageY,scale:d,rotation:e})))})}
function nc(c,a){"erase"===a?c.Cf?(c.strokeStyle="#000000",c.globalCompositeOperation="destination-out",--c.lineWidth,c.stroke(),c.globalCompositeOperation="source-over",c.strokeStyle=c.Cf,c.lineWidth+=2,c.stroke(),--c.lineWidth):(c.strokeStyle="#000000",c.globalCompositeOperation="destination-out",c.stroke(),c.globalCompositeOperation="source-over"):(c.strokeStyle=a,c.stroke())};var oc=function(c){function a(a,d,e,f,g){var b=c.call(this)||this;b.size=d;b.vd=e;b.Ru=f;b.Lb=[];b.width=0;b.Rc=0;b.Ig=0;b.gp=!1;b.log=B.create("COLOURPANEL");b.canvas=C(Zb(a[0]));b.ia=b.canvas;b.canvas.ea("position","absolute");b.canvas.ea("border","none");b.canvas.ea("border-top","1px solid black");b.canvas.ea("display","block");b.ka=b.canvas[0].getContext("2d");b.Lb="string"===typeof g?b.Tm():g;b.rl(100);b.canvas.bind("touchstart",function(a){if("touchstart"===a.type){var d=b.canvas.offset();b.nc(a.touches[0].pageX-
d.left,a.touches[0].pageY-d.top,!0);a.preventDefault();a.stopPropagation()}});ib(b.canvas,function(a){if("mousedown"===a.type){var d=b.canvas.offset();b.nc(a.pageX-d.left,a.pageY-d.top,0===a.button)||(a.preventDefault(),a.stopPropagation())}});b.canvas.bind("contextmenu",function(a){a.preventDefault();a.stopPropagation();return!1});return b}p(a,c);a.prototype.te=function(a,d){this.size=a;this.vd=d;this.format();this.ja()};a.prototype.Tm=function(){function a(a){for(var b=30;100>b;b+=20)a.values[2]=
b/100,d.push(a.toString())}var d="rgba(0,0,0,0.0) rgba(0,0,0,0.5) #000000 #ffffff #000088 #008800 #008888 #880000 #880088 #884400 #888888 #444444 #0000ff #00ff00 #00ffff #ff0000 #ff00ff #ffff00".split(" ");a(new z(z.yc,[0,0,0,1]));for(var e=0;720>e;e+=35){var c=new z(z.yc,[e,.5,0,1]);a(c)}return d};a.prototype.rt=function(a){this.Lb="string"===typeof a?this.Tm():a.slice(0);this.log("Set colours to %s len=%s",this.Lb,this.Lb.length);this.format();this.ja()};a.prototype.rl=function(a){this.width=a;
this.canvas.Jb("width",""+this.width);this.format();this.ja()};a.prototype.No=function(a){this.Rc=a;this.canvas.Jb("height",""+(this.Rc-1))};a.prototype.height=function(){return this.Rc};a.prototype.moveTo=function(a,d){this.canvas.ea("left",""+a+"px");this.canvas.ea("top",""+d+"px")};a.prototype.format=function(){this.Ig=Math.floor(this.width/this.size);var a=Math.ceil(this.Lb.length/this.Ig);this.log("Format to width=%s; height=%s wrap=%s, cpr=%s",this.width,a*this.size,this.gp,this.Ig);this.gp?
this.No(a*this.size):this.No(this.size)};a.bm=function(a,d,e,c){a.fillStyle="#ffffff";a.fillRect(d,e,c,c);a.beginPath();a.strokeStyle="#000000";a.moveTo(d,e);a.lineTo(d+c,e+c);a.moveTo(d+c,e);a.lineTo(d,e+c);a.stroke()};a.am=function(a,d,e,c){for(var b,f=0;f<c;f+=5){b=0===f/5%2;for(var k=0;k<c;k+=5)a.fillStyle=b?"#000000":"#ffffff",b=!b,a.fillRect(d+k,e+f,5,5)}b=a.createLinearGradient(d+c,e+c,d,e);b.addColorStop(0,"rgba(255, 255, 255, 1.0)");b.addColorStop(1,"rgba(255, 255, 255, 0.0)");a.fillStyle=
b;a.fillRect(d,e,c,c)};a.prototype.ja=function(){for(var b=0,d=0,e=0;e<this.Lb.length;e++){var c=z.Xb(this.Lb[e]);this.ka.fillStyle=this.Lb[e];this.ka.fillRect(b,d,this.size,this.size);0===c.values[3]?a.bm(this.ka,b,d,this.size):.5===c.values[3]&&a.am(this.ka,b,d,this.size);b+=this.size;b>=this.width&&(d+=this.size,b=0)}};a.prototype.Xa=function(){this.canvas.Xa()};a.prototype.show=function(){this.canvas.show()};a.prototype.nc=function(a,d,e){a=Math.floor(a/this.size);d=Math.floor(d/this.size);var b=
d*this.Ig+a;this.log("row=%s col=%s index=%s coloursPerRow=%s",d,a,b,this.Ig);return b<this.Lb.length?("rgba(0,0,0,0.0)"===this.Lb[b]?this.ua("opacity",0,e):"rgba(0,0,0,0.5)"===this.Lb[b]?this.ua("opacity",.5,e):this.ua("colour",this.Lb[b],e),!0):!1};return a}(Hb);var pc=function(c){function a(a,d,e,f){var b=c.call(this)||this;b.wa=a;b.uo=e;b.log=B.create("PageSelector");b.current=0;b.ed=[];b.enabled=!1;b.page=0;b.ia=C(d);lb(b.ia,"zwibbler-page-selector");b.uo||(b.ia.ea("overflow-y","scroll"),b.ia.ea("text-align","center"));e||f||(a=C("<input>").Jb("type","button").Jb("value","Add Page"),b.ia.append(a),a.click(function(){b.wa.nf(b.wa.ah(b.wa.be()+1))}),a=C("<input>").Jb("type","button").Jb("value","Delete Page"),b.ia.append(a),a.click(function(){b.wa.Wm(b.wa.be())}),
b.enabled=!1);return b}p(a,c);a.prototype.Ri=function(a){this.enabled=a;var b=this;this.enabled&&this.wa&&setTimeout(function(){b.Zk()},10)};a.prototype.hl=function(a){function b(){null===c&&e.enabled&&(c=setTimeout(function(){e.Zk();e.Bb(e.wa.be());c=null},100))}var e=this,c=null;this.wa=a;a.xa("document-changed",function(){b()});a.xa("resource-loaded",function(){b()});a.xa("set-page",function(a){e.Bb(a)})};a.prototype.Zk=function(){this.log("Regenerate page views.");var a=this.ia.width()-6-10-fc(),
d=this.ia.height()-6,e=this.wa.Cc(),c=this.wa.Tg();d>a?d=a/c.width*c.height:a=d/c.height*c.width;for(var g=0;g<e;g++){var h=g===this.ed.length?this.qs(g):this.ed[g];h.width=a;h.height=d;if(h=h.getContext("2d"))h.save(),h.fillStyle="#ffffff",h.fillRect(0,0,a,d),h.scale(a/c.width,a/c.width),h.translate(-c.x,-c.y),this.wa.ja(h,{page:g}),h.restore()}for(;g<this.ed.length;g++)C(this.ed[g]).remove();this.ed.length=e};a.prototype.qs=function(a){var b=Zb(this.ia[0]);this.uo||(C(b).ea("margin-left","10px"),
C(b).ea("margin-right","10px"),C(b).ea("margin-top","5px"),C(b).ea("margin-bottom","5px"));C(b).ea("border-width","3px");this.log("Make canvas for page %s, currentPage is %s",a,this.page);a===this.page?C(b).ea("border-color","#9fb3e7"):C(b).ea("border-color","transparent");C(b).ea("border-style","solid");this.ed.push(b);b.page=a;var e=this;C(b).click(function(){e.wa.nf(a);e.wa.ua("page-preview-clicked",a)});return b};a.prototype.Bb=function(a){a!==this.page&&this.log("Set page %s",a);this.page<this.ed.length&&
C(this.ed[this.page]).ea("border-color","transparent");this.page=a;this.page<this.ed.length&&C(this.ed[this.page]).ea("border-color","#9fb3e7")};return a}(Hb);function D(c){var a;void 0===a&&(a="Assertion failed.");if(!c)throw Error(a);}
var qc=function(){function c(a){var b=this;this.Kc=0;this.log=B.create("BinaryReader");if("string"===typeof a)this.length=a.length,this.getUint8=function(){D(b.Kc<a.length);return a.charCodeAt(b.Kc++)&255};else{var d=new Uint8Array(a);this.length=d.length;this.getUint8=function(){D(b.Kc<d.length);return d[b.Kc++]}}}c.prototype.seek=function(a){D(0<=a&&a<=this.length);var b=this.Kc;this.Kc=a;return b};c.prototype.getUint16=function(){return(this.getUint8()<<8|this.getUint8())>>>0};c.prototype.getUint32=
function(){return this.getInt32()>>>0};c.prototype.getInt16=function(){var a=this.getUint16();a&32768&&(a-=65536);return a};c.prototype.getInt32=function(){return this.getUint8()<<24|this.getUint8()<<16|this.getUint8()<<8|this.getUint8()};c.prototype.Fb=function(){return this.getInt16()};c.prototype.Nr=function(){this.getUint16()};c.prototype.Re=function(){return this.getInt16()/16384};c.prototype.pk=function(){return this.getInt32()/65536};c.prototype.Bn=function(a){for(var b="",d=0;d<a;d++)b+=String.fromCharCode(this.getUint8());
return b};c.prototype.Or=function(a){for(var b="",d=0;d<a;d+=2)b+=String.fromCharCode(this.getUint16());return b};c.prototype.getDate=function(){var a=1E3*(4294967296*this.getUint32()+this.getUint32())+Date.UTC(1904,1,1);return new Date(a)};return c}(),rc=function(){function c(a){this.format=0;this.Im=[];this.log=B.create("CMAP0");for(var b=0;256>b;b++){var d=a.getUint8();this.log("   Glyph[%s] = %s",b,d);this.Im.push(d)}}c.prototype.map=function(a){return 0<=a&&255>=a?this.Im[a]:0};return c}(),tc=
function(){function c(a){this.file=a;this.format=4;this.cache={};this.log=B.create("CMAP4");var b,d=[],e=a.getUint16()/2;a.getUint16();a.getUint16();a.getUint16();for(b=0;b<e;b++)d.push({yi:0,Yi:0,en:a.getUint16(),Mn:0});a.getUint16();for(b=0;b<e;b++)d[b].Yi=a.getUint16();for(b=0;b<e;b++)d[b].Mn=a.getUint16();for(b=0;b<e;b++){var c=a.getUint16();d[b].yi=c?a.Kc-2+c:0}this.va=d}c.prototype.map=function(a){if(!(a in this.cache)){for(var b=0;b<this.va.length;b++){var d=this.va[b];if(d.Yi<=a&&d.en>=a){if(d.yi){var e=
d.yi+2*(a-d.Yi);this.file.seek(e);var c=this.file.getUint16()}else c=d.Mn+a&65535;this.log("Charcode %s is between %s and %s; maps to %s (%s) roffset=%s",a,d.Yi,d.en,e,c,d.yi);this.cache[a]=c;break}}b===this.va.length&&(this.cache[a]=0)}return this.cache[a]};return c}(),uc=function(){function c(a,b,d){this.file=a;this.map={};this.We=-1;this.log=B.create("KERN0");this.$t=b&&!d||!b&&d;this.file=a;this.offset=a.Kc;this.ws=a.getUint16();a.getUint16();a.getUint16();a.getUint16();for(b=0;b<this.ws;b++){d=
a.getUint16();var e=a.getUint16(),c=a.Fb();this.map[d<<16|e]=c}this.reset()}c.prototype.reset=function(){this.We=-1};c.prototype.get=function(a){var b=0;if(0<=this.We){var d=this.We<<16|a;d in this.map&&(b=this.map[d])}this.We=a;return this.$t?{x:0,y:b}:{x:b,y:0}};return c}(),vc=function(){function c(a){this.Lj=[];this.dh=[];this.Il=this.flags=this.Zn=this.version=0;this.Ud=new Date;this.On=this.Tl=this.Rl=this.Ul=this.Sl=0;this.fontFamily=this.Rf="";this.hh=0;this.log=B.create("TrueType");this.file=
new qc(a);this.hb=this.ct(this.file);this.Zs(this.file);this.bt(this.file);this.Xs(this.file);this.$s(this.file);this.at(this.file);this.length=this.Qr()}c.prototype.ct=function(a){var b={};a.getUint32();var d=a.getUint16();a.getUint16();a.getUint16();a.getUint16();for(var e=0;e<d;e++){var c=a.Bn(4);b[c]={bq:a.getUint32(),offset:a.getUint32(),length:a.getUint32()};"head"!==c&&this.log("Table %s has checksum 0x%s",c,b[c].bq.toString(16))}return b};c.prototype.Zs=function(a){D("head"in this.hb);a.seek(this.hb.head.offset);
this.version=a.pk();a.pk();a.getUint32();this.Zn=a.getUint32();D(1594834165===this.Zn);this.flags=a.getUint16();this.Il=a.getUint16();this.Ud=a.getDate();a.getDate();this.Sl=a.Fb();this.Ul=a.Fb();this.Rl=a.Fb();this.Tl=a.Fb();a.getUint16();a.getUint16();a.getInt16();this.On=a.getInt16();a.getInt16()};c.prototype.Xs=function(a){D("cmap"in this.hb);var b=this.hb.cmap.offset;a.seek(b);a.getUint16();for(var d=a.getUint16(),e=0;e<d;e++){var c=a.getUint16(),g=a.getUint16(),h=a.getUint32();this.log("CMap platformid=%s specificid=%s offset=%s",
c,g,h);3===c&&1>=g&&this.Ws(a,b+h)}};c.prototype.Ws=function(a,b){var d=a.seek(b),e=a.getUint16(),c=a.getUint16();a.getUint16();var g;this.log("    Cmap format %s length %s",e,c);0===e?g=new rc(a,c):4===e&&(g=new tc(a,c));g&&this.Lj.push(g);a.seek(d)};c.prototype.at=function(a){if("kern"in this.hb){a.seek(this.hb.kern.offset);var b=a.getUint16(),d=a.getUint16();this.log("Kern Table version: %s",b);this.log("Kern nTables: %s",d);for(var e=0;e<d;e++){b=a.getUint16();var c=a.getUint16(),g=a.getUint16(),
h=g>>8,k=g&4,l=0===(g&1);this.log("Kerning subtable version %s format %s length %s coverage: %s",b,h,c,g);b=null;0===h?b=new uc(a,l,0!=k):(this.log("Unknown format -- skip"),a.seek(a.Kc+c));b&&this.dh.push(b)}}};c.prototype.bt=function(a){D("name"in this.hb);var b=this.hb.name.offset;a.seek(b);a.getUint16();for(var d=a.getUint16(),e=a.getUint16(),c=0;c<d;c++){var g=a.getUint16(),h=a.getUint16(),k=a.getUint16(),l=a.getUint16(),n=a.getUint16(),m=a.getUint16();m=a.seek(b+e+m);n=0===g||3===g?a.Or(n):
a.Bn(n);this.log("Name %s/%s id %s language %s: %s",g,h,l,k,n);a.seek(m);switch(l){case 1:this.fontFamily=n;break;case 4:this.Rf=n}}};c.prototype.$s=function(a){D("hhea"in this.hb);a.seek(this.hb.hhea.offset);a.pk();a.Fb();a.Fb();a.Fb();a.Nr();a.Fb();a.Fb();a.Fb();a.getInt16();a.getInt16();a.Fb();a.getInt16();a.getInt16();a.getInt16();a.getInt16();a.getInt16();this.hh=a.getUint16()};c.prototype.ur=function(a){D("hmtx"in this.hb);var b=this.file;b.seek(this.hb.hmtx.offset+4);var d=this.hb.hmtx.offset;
if(a<this.hh){var e=this.file.seek(d+4*a);var c=b.getUint16();a=b.getInt16()}else e=b.seek(d+4*(this.hh-1)),c=b.getUint16(),b.seek(d+4*this.hh+2*(a-this.hh)),a=b.Fb();this.file.seek(e);return{Gm:c,ks:a}};c.prototype.Qr=function(){D("maxp"in this.hb);var a=this.file.seek(this.hb.maxp.offset+4),b=this.file.getUint16();this.file.seek(a);return b};c.prototype.sr=function(a){D("loca"in this.hb);var b=this.hb.loca,d=this.file;if(1===this.On){b=d.seek(b.offset+4*a);a=d.getUint32();var e=d.getUint32()}else b=
d.seek(b.offset+2*a),a=2*d.getUint16(),e=2*d.getUint16();d.seek(b);return a===e?0:a+this.hb.glyf.offset};c.prototype.yo=function(a){var b=this.sr(a);a=this.file;if(0===b||b>=this.hb.glyf.offset+this.hb.glyf.length)return null;D(b>=this.hb.glyf.offset);D(b<this.hb.glyf.offset+this.hb.glyf.length);a.seek(b);b={yd:[],jh:a.getInt16(),ma:[],Sl:a.Fb(),Ul:a.Fb(),Rl:a.Fb(),Tl:a.Fb()};D(-1<=b.jh);-1===b.jh?this.Ys(a,b):this.dt(a,b);return b};c.prototype.dt=function(a,b){function d(b,d,c){for(var f=0,k=0;k<
g;k++){var l=h[k];l&d?f=l&c?f+a.getUint8():f-a.getUint8():~l&c&&(f+=a.getInt16());e[k][b]=f}}b.yd=[];for(var e=b.ma=[],c=0;c<b.jh;c++)b.yd.push(a.getUint16());a.seek(a.getUint16()+a.Kc);if(0!==b.jh){var g=Math.max.apply(null,b.yd)+1,h=[];for(c=0;c<g;c++){var k=a.getUint8();h.push(k);e.push({x:0,y:0,dg:0<(k&1)});if(k&8){var l=a.getUint8();D(0<l);for(c+=l;l--;)h.push(k),e.push({x:0,y:0,dg:0<(k&1)})}}d("x",2,16,b.Sl,b.Rl);d("y",4,32,b.Ul,b.Tl)}};c.prototype.Ys=function(a,b){var d,e,c=32;b.yd=[];for(b.ma=
[];c&32;){c=a.getUint16();var g=a.getUint16();var h=1;var k=d=0;var l=1;var n=e=0;if(c&1){var m=a.getInt16();var q=a.getInt16()}else m=a.getUint8(),q=a.getUint8();c&2&&(e=m,n=q);c&8?l=h=a.Re():c&64?(h=a.Re(),l=a.Re()):c&128&&(h=a.Re(),d=a.Re(),k=a.Re(),l=a.Re());this.log("Read component glyph index %s",g);this.log("Transform: [%s %s %s %s %s %s]",h,d,k,l,e,n);m=a.Kc;if(g=this.yo(g)){var u=b.ma.length;for(q=0;q<g.yd.length;q++)b.yd.push(g.yd[q]+u);for(q=0;q<g.ma.length;q++){u=g.ma[q].x;var v=g.ma[q].y;
u=h*u+d*v+e;v=k*u+l*v+n;b.ma.push({x:u,y:v,dg:g.ma[q].dg})}}a.seek(m)}b.jh=b.yd.length;c&256&&a.seek(a.getUint16()+a.Kc)};c.prototype.zq=function(a,b,d,e){b=this.yo(b);if(null!==b)for(var c=0,g=0,h=0,k=0,l;g<b.ma.length;g++){var n=b.ma[g];0===c?(a.moveTo(n.x+d,n.y+e),c=1):1===c?n.dg?a.lineTo(n.x+d,n.y+e):c=2:(l=b.ma[g-1],n.dg?(a.quadraticCurveTo(l.x+d,l.y+e,n.x+d,n.y+e),c=1):a.quadraticCurveTo(l.x+d,l.y+e,(l.x+n.x)/2+d,(l.y+n.y)/2+e));g===b.yd[h]&&(2===c&&(l=n,n=b.ma[k],n.dg?a.quadraticCurveTo(l.x+
d,l.y+e,n.x+d,n.y+e):a.quadraticCurveTo(l.x+d,l.y+e,(l.x+n.x)/2+d,(l.y+n.y)/2+e)),k=g+1,h+=1,c=0)}};c.prototype.transform=function(a,b){a.scale(b/this.Il,-b/this.Il)};c.prototype.Fq=function(a,b,d,e,c){a.save();a.translate(d,e);this.transform(a,c);e=d=0;this.jt();for(c=0;c<b.length;c++){var f=this.ts(b.charCodeAt(c)),h=this.ur(f),k=this.zs(f);this.log("Metrics for %s code %s index %s: %s %s kern: %s,%s",b.charAt(c),b.charCodeAt(c),f,h.Gm,h.ks,k.x,k.y);this.zq(a,f,d+k.x,e+k.y);d+=h.Gm}a.restore()};
c.prototype.ts=function(a){for(var b=0,d=0;d<this.Lj.length&&!(b=this.Lj[d].map(a));d++);return b};c.prototype.jt=function(){for(var a=0;a<this.dh.length;a++)this.dh[a].reset()};c.prototype.zs=function(a){for(var b,d=0,e=0,c=0;c<this.dh.length;c++)b=this.dh[c].get(a),d+=b.x,e+=b.y;return{x:d,y:e}};return c}(),wc=function(c){function a(){var a=c.call(this)||this;a.fonts={};a.ih=0;a.Zj=[];a.log=B.create("FontCollection");return a}p(a,c);a.prototype.add=function(a,d){this.ih+=1;var b=this;C.Np({url:a,
Zt:function(e){b.Bp(a,d,e)},error:function(){b.Ia(a)},Vp:function(a,b){b.overrideMimeType("text/plain; charset=x-user-defined")}})};a.prototype.Ia=function(a){this.log("Error fetching "+a);--this.ih;this.mm()};a.prototype.Bp=function(a,d,e){this.log("Got font %s; result is %s bytes",a,e.length);for(var b="",c=0;c<e.length;c++)b+=String.fromCharCode(e.charCodeAt(c)&255);e=new vc(b);this.log("Loaded '%s'",e.Rf);for(c=0;c<e.Rf.length;c++)this.log("   %s, %s",e.Rf.charAt(c),e.Rf.charCodeAt(c));d=d||e.fontFamily;
this.fonts[d]={name:e.Rf,url:a,data:b,font:e};--this.ih;this.mm()};a.prototype.mm=function(){if(0===this.ih){this.ua("done");for(var a=0;a<this.Zj.length;a++)this.Zj[a]();this.Zj.length=0}};a.prototype.get=function(a){this.log("Lookup font %s",a);for(var b=0;b<a.length;b++)this.log("   %s, %s",a.charAt(b),a.charCodeAt(b));if(a in this.fonts)return this.fonts[a].font;this.log("Lookup font %s; not found",a);for(var e in this.fonts)this.log("Searched: '%s'",e)};return a}(Hb);B.create("Graphics",!0);
var E=function(){function c(a,b){this.x=a;this.y=b}c.prototype.Oa=function(a){return Math.sqrt((a.x-this.x)*(a.x-this.x)+(a.y-this.y)*(a.y-this.y))};c.prototype.toString=function(){return"("+this.x+", "+this.y+")"};c.prototype.$d=function(a){return this.x===a.x&&this.y===a.y};c.prototype.clone=function(){return new c(this.x,this.y)};c.prototype.ei=function(a,b){var d=a.x,e=a.y,c=this.x,g=this.y,h=b.x-d,k=b.y-e,l=h*h+k*k;if(0===l)return this.Oa(a);l=((c-d)*h+(g-e)*k)/l;1<l?l=1:0>l&&(l=0);d=d+l*h-c;
e=e+l*k-g;return Math.sqrt(d*d+e*e)};return c}();function xc(c,a){this.width=c;this.height=a}function G(c,a,b,d){return Math.sqrt((c-b)*(c-b)+(a-d)*(a-d))}function J(c,a,b,d){var e=G(c,a,b,d);return 0===e?{x:1,y:0}:{x:(b-c)/e,y:(d-a)/e}}function yc(c){c.x*=-1;c.y*=-1;return c}
var K=function(){function c(a,b,d,e){this.x=a;this.y=b;this.width=d;this.height=e;this.zo()}c.load=function(a){return new c(a.x,a.y,a.width,a.height)};c.ze=function(a){if(0===a.length)return new c(0,0,0,0);for(var b=a[0].x,d=a[0].x,e=a[0].y,f=a[0].y,g=1;g<a.length;g++)a[g].x<b&&(b=a[g].x),a[g].x>d&&(d=a[g].x),a[g].y<e&&(e=a[g].y),a[g].y>f&&(f=a[g].y);return new c(b,e,d-b,f-e)};c.prototype.save=function(){return{x:this.x,y:this.y,width:this.width,height:this.height}};c.prototype.clone=function(){return new c(this.x,
this.y,this.width,this.height)};c.prototype.$d=function(a){return this.x===a.x&&this.y===a.y&&this.width===a.width&&this.height===a.height};c.prototype.Eh=function(a){a.x<this.x&&(this.width+=this.x-a.x,this.x=a.x);a.y<this.y&&(this.height+=this.y-a.y,this.y=a.y);a.x+a.width>this.x+this.width&&(this.width+=a.x+a.width-this.x-this.width);a.y+a.height>this.y+this.height&&(this.height+=a.y+a.height-this.y-this.height)};c.prototype.Hl=function(a,b){a<this.x?(this.width+=this.x-a,this.x=a):a>this.x+this.width&&
(this.width=a-this.x);b<this.y?(this.height+=this.y-b,this.y=b):b>this.y+this.height&&(this.height=b-this.y)};c.prototype.contains=function(a){return this.x<=a.x&&this.x+this.width>a.x+a.width&&this.y<=a.y&&this.y+this.height>a.y+a.height};c.prototype.Ls=function(a){return this.x>a.x+a.width||a.x>this.x+this.width||this.y>a.y+a.height||a.y>this.y+this.height?!1:!0};c.prototype.Uc=function(a,b,d){void 0===d&&(d=0);return this.x-d<=a&&this.x+this.width+d>a&&this.y-d<=b&&this.y+this.height+d>b};c.prototype.zo=
function(){0>this.width&&(this.x+=this.width,this.width=-this.width);0>this.height&&(this.y+=this.height,this.height=-this.height)};c.prototype.Gc=function(a,b){void 0===b&&(b=a);this.x-=a/2;this.y-=b/2;this.width+=a;this.height+=b};c.prototype.transform=function(a){var b=a.apply(this.x,this.y);var d=a.apply(this.x+this.width,this.y);var e=a.apply(this.x+this.width,this.y+this.height);a=a.apply(this.x,this.y+this.height);this.x=Math.min(b.x,d.x,e.x,a.x);this.y=Math.min(b.y,d.y,e.y,a.y);this.width=
Math.max(b.x,d.x,e.x,a.x)-this.x;this.height=Math.max(b.y,d.y,e.y,a.y)-this.y};c.prototype.right=function(){return this.x+this.width};c.prototype.bottom=function(){return this.y+this.height};c.prototype.Kf=function(){return new E(this.x+this.width/2,this.y+this.height/2)};c.prototype.toString=function(){return"Rectangle("+this.x+", "+this.y+", "+this.width+", "+this.height+")"};return c}(),M=function(){function c(){this.log=B.create("MATRIX");this.Tb="Matrix";if(0===arguments.length)this.m11=1,this.m21=
this.m12=0,this.m22=1,this.Da=this.Ca=0;else if(1===arguments.length){if(6!==arguments[0].length)throw"Bad array initializer for Matrix.";this.m11=arguments[0][0];this.m12=arguments[0][1];this.m21=arguments[0][2];this.m22=arguments[0][3];this.Ca=arguments[0][4];this.Da=arguments[0][5]}else this.m11=arguments[0],this.m12=arguments[1],this.m21=arguments[2],this.m22=arguments[3],this.Ca=arguments[4],this.Da=arguments[5]}c.prototype.toString=function(){return"[ "+this.m11+" "+this.m12+" "+this.Ca+"    "+
this.m21+" "+this.m22+" "+this.Da+"    0 0 1 ]"};c.prototype.ec=function(){return[this.m11,this.m12,this.m21,this.m22,this.Ca,this.Da]};c.prototype.Wr=function(){return 1===this.m11&&0===this.m12&&0===this.m21&&1===this.m22&&0===this.Ca&&0===this.Da};c.prototype.$d=function(a){return this.m11===a.m11&&this.m12===a.m12&&this.m21===a.m21&&this.m22===a.m22&&this.Ca===a.Ca&&this.Da===a.Da};c.prototype.multiply=function(a){var b=new c;b.m11=this.m11*a.m11+this.m12*a.m21;b.m21=this.m21*a.m11+this.m22*a.m21;
b.m12=this.m11*a.m12+this.m12*a.m22;b.m22=this.m21*a.m12+this.m22*a.m22;b.Ca=this.m11*a.Ca+this.m12*a.Da+this.Ca;b.Da=this.m21*a.Ca+this.m22*a.Da+this.Da;return b};c.prototype.apply=function(a,b){return new E(this.m11*a+this.m12*b+this.Ca,this.m21*a+this.m22*b+this.Da)};c.prototype.dj=function(a){var b;void 0===b&&(b=!1);b?a.setTransform(this.m11,this.m21,this.m12,this.m22,this.Ca,this.Da):a.transform(this.m11,this.m21,this.m12,this.m22,this.Ca,this.Da)};c.prototype.clone=function(){return new c(this.m11,
this.m12,this.m21,this.m22,this.Ca,this.Da)};c.prototype.inverse=function(){var a=this.m11*this.m22-this.m12*this.m21;return new c(this.m22/a,-this.m12/a,-this.m21/a,this.m11/a,(this.m12*this.Da-this.Ca*this.m22)/a,(this.Ca*this.m21-this.m11*this.Da)/a)};c.prototype.cp=function(){var a=this.m11,b=this.m21,d=this.m12,e=this.m22,f=Math.sqrt(a*a+b*b),g=Math.sqrt(d*d+e*e);return new c(a/f,d/g,b/f,e/g,this.Ca,this.Da)};c.prototype.Vg=function(){return new E(Math.sqrt(this.m11*this.m11+this.m21*this.m21),
Math.sqrt(this.m12*this.m12+this.m22*this.m22))};c.prototype.Tn=function(){return 1===this.m11&&1===this.m22&&0===this.m12&&0===this.m21};c.prototype.translate=function(a,b){return this.multiply(new L(a,b))};c.prototype.rotate=function(a,b,d){return this.multiply(new zc(a,b,d))};return c}(),zc=function(c){function a(a,d,e){var b=Math.cos(a);a=Math.sin(a);return c.call(this,b,a,-a,b,-d*b-e*a+d,d*a-e*b+e)||this}p(a,c);return a}(M),L=function(c){function a(a,d){return c.call(this,1,0,0,1,a,d)||this}
p(a,c);return a}(M),O=function(c){function a(a,d,e,f){return void 0===e||void 0===f?c.call(this,a,0,0,d,0,0)||this:c.call(this,a,0,0,d,e-a*e,f-d*f)||this}p(a,c);return a}(M),Ac=function(c){function a(a,d,e){var b=Math.cos(2*a);a=Math.sin(2*a);return c.call(this,b,a,a,-b,-d*b-e*a+d,-d*a+e*b+e)||this}p(a,c);return a}(M);
function Bc(c,a,b,d,e,f,g,h,k,l){if(!(8<++Bc.depth)){var n=(a+d)/2,m=(b+e)/2,q=(d+f)/2,u=(e+g)/2,v=(f+h)/2,A=(g+k)/2,x=(n+q)/2,y=(m+u)/2;q=(q+v)/2;u=(u+A)/2;var F=(x+q)/2,I=(y+u)/2,H=h-a,T=k-b;d=Math.abs((d-h)*T-(e-k)*H);f=Math.abs((f-h)*T-(g-k)*H);(d+f)*(d+f)<l*(H*H+T*T)?c.push(new E(F,I)):(Bc(c,a,b,n,m,x,y,F,I,l),Bc(c,F,I,q,u,v,A,h,k,l))}--Bc.depth}(Bc||(Bc={})).depth=0;
function Cc(c,a,b,d,e,f,g,h){if(!(8<++Bc.depth)){var k=(a+d)/2,l=(b+e)/2,n=(d+f)/2,m=(e+g)/2,q=(k+n)/2,u=(l+m)/2,v=f-a,A=g-b;d=Math.abs((d-f)*A-(e-g)*v);d*d<=h*(v*v+A*A)?c.push(new E(q,u)):(Cc(c,a,b,k,l,q,u,h),Cc(c,q,u,n,m,f,g,h))}--Bc.depth}
function Dc(c,a,b){var d,e=!1,f=c.length;1<f&&c[f-1].x===c[0].x&&c[f-1].y===c[0].y&&--f;if(3>f)return!1;var g=c[f-1].x;var h=c[f-1].y;for(d=0;d<f;d++){var k=c[d].x;var l=c[d].y;if(k>g){var n=g;var m=k;var q=h;h=l}else n=k,m=g,q=l;k<a===a<=g&&(b-q)*(m-n)<(h-q)*(a-n)&&(e=!e);g=k;h=l}return e}function Ec(c,a,b,d,e,f,g,h){b-=c;d-=a;g-=e;var k=h-f;var l=-g*d+b*k;if(0===l)return null;h=(-d*(c-e)+b*(a-f))/l;e=(g*(a-f)-k*(c-e))/l;return 0<=h&&1>=h&&0<=e&&1>=e?new E(c+e*b,a+e*d):null}
function Fc(c,a,b,d,e){for(var f=[],g=new E(c,a),h=1;h<=e.length;h++){var k=e[h-1],l=e[h%e.length];(k=Ec(c,a,b,d,k.x,k.y,l.x,l.y))&&f.push(k)}f.sort(function(a,b){return a.Oa(g)-b.Oa(g)});return f}function Gc(c,a,b,d){d*=d;for(var e=1;e<c.length;e++){var f=c[e-1].x,g=c[e-1].y,h=c[e].x-f,k=c[e].y-g,l=((a-f)*h+(b-g)*k)/(h*h+k*k);1<l?l=1:0>l&&(l=0);f=f+l*h-a;g=g+l*k-b;if(f*f+g*g<=d)return!0}return!1}
(function(){function c(a){this.Qb=a}c.prototype.clear=function(){for(var a=0;a<this.Qb.width*this.Qb.height*4;a++)this.Qb.data[a]=0};c.prototype.getImageData=function(){return this.Qb};c.prototype.width=function(){return this.Qb.width};c.prototype.height=function(){return this.Qb.height};c.prototype.get=function(a,b){var d=this.Qb.width*b*4+4*a;return this.Qb.data[d]|this.Qb.data[d+1]<<8|this.Qb.data[d+2]<<16|this.Qb.data[d+3]<<24};c.prototype.set=function(a,b,d){a=this.Qb.width*b*4+4*a;this.Qb.data[a]=
d&255;this.Qb.data[a+1]=d>>8&255;this.Qb.data[a+2]=d>>16&255;this.Qb.data[a+3]=d>>24&255};return c})();
(function(){function c(a,b){this.data=[];this.Qd=a;this.Rc=b;this.data=[]}c.prototype.width=function(){return this.Qd};c.prototype.height=function(){return this.Rc};c.prototype.getImageData=function(){var a=document.createElement("canvas");a.width=this.Qd;a.height=this.Rc;a=a.getContext("2d").getImageData(0,0,this.Qd,this.Rc);for(var b=this.Qd*this.Rc,d=0;d<b;d++){var e=!0===this.data[d]?255:0;a.data[4*d]=e;a.data[4*d+1]=e;a.data[4*d+2]=e;a.data[4*d+3]=255}return a};c.prototype.get=function(a,b){return!0===
this.data[this.Qd*b+a]};c.prototype.set=function(a,b,d){this.data[this.Qd*b+a]=d};return c})();
var P=function(){function c(a){this.closed=!1;this.ba=[];a instanceof K&&(this.moveTo(a.x,a.y),this.lineTo(a.x+a.width,a.y),this.lineTo(a.x+a.width,a.y+a.height),this.lineTo(a.x,a.y+a.height),this.lineTo(a.x,a.y),this.closePath())}c.prototype.clear=function(){this.closed=!1;this.ba=[]};c.prototype.beginPath=function(){};c.prototype.rect=function(){};c.prototype.moveTo=function(a,b){this.ba.push(c.pc,a,b)};c.prototype.lineTo=function(a,b){this.ba.push(c.oc,a,b)};c.prototype.bezierCurveTo=function(a,
b,d,e,f,g){this.ba.push(c.xf,a,b,d,e,f,g)};c.prototype.quadraticCurveTo=function(a,b,d,e){this.ba.push(c.zf,a,b,d,e)};c.prototype.arc=function(){};c.prototype.arcTo=function(){};c.prototype.closePath=function(){this.ba.push(c.xc)};c.prototype.ja=function(a){for(var b=0;b<this.ba.length;){switch(this.ba[b]){case c.pc:a.moveTo&&a.moveTo(this.ba[b+1],this.ba[b+2]);break;case c.oc:a.lineTo&&a.lineTo(this.ba[b+1],this.ba[b+2]);break;case c.xf:a.bezierCurveTo&&a.bezierCurveTo(this.ba[b+1],this.ba[b+2],
this.ba[b+3],this.ba[b+4],this.ba[b+5],this.ba[b+6]);break;case c.zf:a.quadraticCurveTo&&a.quadraticCurveTo(this.ba[b+1],this.ba[b+2],this.ba[b+3],this.ba[b+4]);break;case c.xc:a.closePath&&a.closePath();break;default:alert("Error!")}b+=c.gc[this.ba[b]]}};c.prototype.Md=function(){for(var a=0,b,d=[];a<this.ba.length;){var e=c.fm[this.ba[a]];for(b=0;b<e;b++)d.push(new E(this.ba[a+1+2*b],this.ba[a+1+2*b+1]));a+=c.gc[this.ba[a]]}return d};c.prototype.transform=function(a){for(var b=0,d,e;b<this.ba.length;){e=
c.fm[this.ba[b]];for(d=0;d<e;d++){var f=a.apply(this.ba[b+1+2*d],this.ba[b+1+2*d+1]);this.ba[b+1+2*d]=f.x;this.ba[b+1+2*d+1]=f.y}b+=c.gc[this.ba[b]]}};c.prototype.clone=function(){var a=new c;a.ba=this.ba.concat();return a};c.prototype.Om=function(a){for(var b=0,d,e=d=0,f=new K(this.ba[1],this.ba[2],0,0),g;b<this.ba.length;){switch(this.ba[b]){case c.pc:case c.oc:d=this.ba[b+1];e=this.ba[b+2];f.Hl(d,e);break;case c.xf:var h=g=[],k=this.ba[b+5],l=this.ba[b+6];Bc(h,d,e,this.ba[b+1],this.ba[b+2],this.ba[b+
3],this.ba[b+4],k,l,a*a);h.push(new E(k,l));for(d=0;d<g.length;d++)f.Hl(g[d].x,g[d].y);d=this.ba[b+5];e=this.ba[b+6];break;case c.zf:h=g=[];k=this.ba[b+3];l=this.ba[b+4];Cc(h,d,e,this.ba[b+1],this.ba[b+2],k,l,a*a);h.push(new E(k,l));for(d=0;d<g.length;d++)f.Hl(g[d].x,g[d].y);d=this.ba[b+3];e=this.ba[b+4]}b+=c.gc[this.ba[b]]}return f};c.prototype.append=function(a){this.ba=this.ba.concat(a.ba)};c.prototype.El=function(a){for(var b=0,d=0,e=0,f=new c,g;b<this.ba.length;){switch(this.ba[b]){case c.pc:d=
this.ba[b+1];e=this.ba[b+2];f.moveTo(d,e);break;case c.oc:d=this.ba[b+1];e=this.ba[b+2];f.lineTo(d,e);break;case c.xf:var h=g=[],k=this.ba[b+5],l=this.ba[b+6];Bc(h,d,e,this.ba[b+1],this.ba[b+2],this.ba[b+3],this.ba[b+4],k,l,a*a);h.push(new E(k,l));2===g.length&&1E-4>d*(g[0].y-g[1].y)+g[0].x*(g[1].y-e)+g[1].x*(e-g[0].y)&&(g[0]=g[1],g.length=1);for(d=0;d<g.length;d++)f.lineTo(g[d].x,g[d].y);d=this.ba[b+5];e=this.ba[b+6];break;case c.zf:h=g=[];k=this.ba[b+3];l=this.ba[b+4];Cc(h,d,e,this.ba[b+1],this.ba[b+
2],k,l,a*a);h.push(new E(k,l));for(d=0;d<g.length;d++)f.lineTo(g[d].x,g[d].y);d=this.ba[b+3];e=this.ba[b+4];break;case c.xc:f.closePath()}b+=c.gc[this.ba[b]]}return f};c.prototype.vo=function(a,b,d){void 0===d&&(d=0);return Dc(this.Md(),a,b)||0<d&&this.Vk(a,b,d)};c.prototype.Vk=function(a,b,d){var e=0,f=0,g=0;for(d*=d;g<this.ba.length;){switch(this.ba[g]){case c.pc:e=this.ba[g+1];f=this.ba[g+2];break;case c.oc:var h=this.ba[g+1];var k=this.ba[g+2];var l=h-e;var n=k-f;var m=l*l+n*n;m=((a-e)*l+(b-f)*
n)/m;1<m?m=1:0>m&&(m=0);e+=m*l;n=f+m*n;f=e-a;n-=b;f=f*f+n*n;if(f<=d)return!0;e=h;f=k}g+=c.gc[this.ba[g]]}return!1};c.prototype.iq=function(a){a=a.Md();for(var b=0,d=new E(0,0),e=new E(0,0),f=new c,g=!1,h;b<this.ba.length;){switch(this.ba[b]){case c.pc:d.x=this.ba[b+1];d.y=this.ba[b+2];(g=Dc(a,d.x,d.y))||f.moveTo(d.x,d.y);break;case c.oc:e.x=this.ba[b+1];e.y=this.ba[b+2];h=Fc(d.x,d.y,e.x,e.y,a);for(var k=0;k<h.length;k++)g?f.moveTo(h[k].x,h[k].y):f.lineTo(h[k].x,h[k].y),g=!g;g||f.lineTo(e.x,e.y);d.x=
e.x;d.y=e.y}b+=c.gc[this.ba[b]]}return f};c.prototype.hi=function(a,b){for(var d=0,e=0,f=b[0],g,h=new E(0,0),k;d<this.ba.length;){switch(this.ba[d]){case c.pc:k=this.ba[d+1];g=this.ba[d+2];a.moveTo(k,g);h=new E(k,g);break;case c.oc:k=this.ba[d+1];var l=g=this.ba[d+2],n=new E(k,l);g=h.Oa(n);if(!(0>=g)){for(;g>f;)h.x+=(n.x-h.x)*f/g,h.y+=(n.y-h.y)*f/g,e&1?a.moveTo(h.x,h.y):a.lineTo(h.x,h.y),g-=f,e=(e+1)%b.length,f=b[e];g<=f&&(h=new E(k,l),e&1?a.moveTo(h.x,h.y):a.lineTo(h.x,h.y),f-=g)}}d+=c.gc[this.ba[d]]}};
c.prototype.Op=function(){function a(a,b){f-=(a-d)*(b+e);d=a;e=b}for(var b=0,d,e,f=0;b<this.ba.length;){switch(this.ba[b]){case c.pc:d=this.ba[b+1];e=this.ba[b+2];break;case c.oc:a(this.ba[b+1],this.ba[b+2]);break;case c.xf:a(this.ba[b+5],this.ba[b+6]);break;case c.zf:a(this.ba[b+3],this.ba[b+4])}b+=c.gc[this.ba[b]]}return f/2};c.prototype.cn=function(a){for(var b=0,d=0,e=0,f=!1;b<this.ba.length;){switch(this.ba[b]){case c.pc:d=this.ba[b+1];e=this.ba[b+2];f=!0;break;case c.oc:a(d,e,this.ba[b+1],this.ba[b+
2],f),d=this.ba[b+1],e=this.ba[b+2],f=!1}b+=c.gc[this.ba[b]]}};c.prototype.Yp=function(){var a=0;this.cn(function(b,d,e,c){a+=G(b,d,e,c)});return a};c.prototype.Zp=function(a){var b=new c,d=0;this.cn(function(e,c,g,h,k){if(d<=a){k&&b.moveTo(e,c);k=G(e,c,g,h);if(d+k>=a){var f=a-d;g=e+(g-e)*f/k;h=c+(h-c)*f/k}d+=k;b.lineTo(g,h)}});return b};c.pc=0;c.oc=1;c.xf=2;c.zf=3;c.xc=4;c.gc=[3,3,7,5,1];c.fm=[1,1,3,2,0];return c}();
function Hc(c,a,b,d,e){var f;if(2>=d-b)e.push(c[b]);else{var g=c[b],h=c[d-1],k=0,l=0;for(f=b+1;f<d;f++){var n=c[f].ei(g,h);n>k&&(k=n,l=f)}0<l&&k>a?(Hc(c,a,b,l,e),Hc(c,a,l,d,e)):e.push(g)}}function Ic(c,a){var b=[];Hc(c,a,0,c.length,b);0<c.length&&0<b.length&&!c[c.length-1].$d(b[b.length-1])&&b.push(c[c.length-1]);return b}
var Q=function(){function c(){this.ma=[];if(1===arguments.length){var a=arguments[0];if(a instanceof K)this.ma.push(new E(a.x,a.y)),this.ma.push(new E(a.right(),a.y)),this.ma.push(new E(a.right(),a.bottom())),this.ma.push(new E(a.x,a.bottom()));else if(a instanceof Array)this.ma=a;else throw alert("Bad parameter passed to Polygon() constructor."),"Error";}}c.prototype.transform=function(a){for(var b=0;b<this.ma.length;b++)this.ma[b]=a.apply(this.ma[b].x,this.ma[b].y)};c.prototype.add=function(a,b){this.ma.push(new E(a,
b))};c.prototype.Uc=function(a,b,d){void 0===d&&(d=0);return Dc(this.ma,a,b)||d&&Gc(this.ma,a,b,d)};c.prototype.Nm=function(){return K.ze(this.ma)};c.prototype.clone=function(){return new c(this.ma.slice(0))};c.prototype.$d=function(a){if(this.ma.length!==a.ma.length)return!1;for(var b=0;b<this.ma.length;b++){var d=this.ma[b],e=a.ma[b];if(d.x!==e.x||d.y!==e.y)return!1}return!0};c.prototype.Gc=function(a){for(var b=[],d=0;d<this.ma.length;d++){var e=this.ma[0===d?this.ma.length-1:d-1],c=this.ma[d],
g=this.ma[d===this.ma.length-1?0:d+1],h=G(e.x,e.y,c.x,c.y),k=G(g.x,g.y,c.x,c.y);b.push({x:c.x+((c.x-e.x)/h+(c.x-g.x)/k)/Math.sqrt(2)*a,y:c.y+((c.y-e.y)/h+(c.y-g.y)/k)/Math.sqrt(2)*a})}this.ma=b};c.prototype.ja=function(a){if(!(1>this.ma.length)){a.moveTo(this.ma[0].x,this.ma[0].y);for(var b=1;b<this.ma.length;b++)a.lineTo(this.ma[b].x,this.ma[b].y);a.closePath()}};c.prototype.Md=function(){return this.ma};c.Ju=function(a,b){for(var d=0,e=0,c=!1,g=[],h=[],k=0;k<b.length;k++)h.push(0);for(;;){var l=
0,n=-1;for(k=0;k<b.length;k++)if(h[k]<b[k].length){var m=b[k][h[k]];if(0===k||m<l){l=m;n=k;var q=1-h[k]%2}}if(-1===n)return g;h[n]+=1;"intersection"===a?q?(e+=1,e===b.length&&(d=l)):(e===b.length&&(g.push(d),g.push(l)),--e):q?(e+=1,0===n?(c=!0,1===e)&&(d=l):c&&2===e&&(g.push(d),g.push(l))):(c&&1===e&&(g.push(d),g.push(l)),--e,0===n&&(c=!1),c&&1===e&&(d=l))}};return c}();
function Jc(c,a,b,d,e,f,g,h){b-=c;d-=a;g-=e;h-=f;var k=-g*d+b*h;if(0===k)return null;e=(g*(a-f)-h*(c-e))/k;return new E(c+e*b,a+e*d)}
function Kc(c,a){function b(a){var b,e;var c=[];var k=b=0;for(e=a.length;k<e;k++){var l=a[k];a[b+1]&&(c[b]=d(l,a[b+1]));b+=1}return c}function d(a,b){return new E(a.x+(b.x-a.x)/2,a.y+(b.y-a.y)/2)}return a?Kc(b(b(function(a){var b,e;a=[a[0]].concat(a).concat(a[a.length-1]);var c=[];var k=b=0;for(e=a.length;k<e;k++){var l=a[k];c[2*b]=l;a[b+1]&&(c[2*b+1]=d(l,a[b+1]));b+=1}return c}(c))),a-1):c}
function Lc(c,a){var b;void 0===b&&(b=null);var d=a.match(/[A-Z]+|-?[0-9\.E]+/gi),e=0,f=0,g,h=[];if(d)for(g=0;g<d.length;g++){var k=d[g++];var l=d;for(h.length=0;g<l.length;g++){var n=parseFloat(l[g]);if(isNaN(n)){g--;break}else h.push(n)}if("M"===k){c.moveTo(h[0],h[1]);for(k=2;k<h.length;k+=2)c.lineTo(h[k],h[k+1]);e=h[h.length-2];f=h[h.length-1]}else if("m"===k)for(c.moveTo(h[0]+e,h[1]+f),e=h[0]+e,f=h[1]+f,k=2;k<h.length;k+=2)c.lineTo(h[k]+e,h[k+1]+f),e=h[k]+e,f=h[k+1]+f;else if("L"===k){for(k=0;k<
h.length;k+=2)c.lineTo(h[k],h[k+1]);e=h[h.length-2];f=h[h.length-1]}else if("l"===k)for(k=0;k<h.length;k+=2)c.lineTo(h[k]+e,h[k+1]+f),e=h[k]+e,f=h[k+1]+f;else if("C"===k)for(k=0;k<h.length;k+=6)c.bezierCurveTo(h[k],h[k+1],h[k+2],h[k+3],h[k+4],h[k+5]),e=h[k+4],f=h[k+5];else if("c"===k)for(k=0;k<h.length;k+=6)c.bezierCurveTo(h[k]+e,h[k+1]+f,h[k+2]+e,h[k+3]+f,h[k+4]+e,h[k+5]+f),e=h[k+4]+e,f=h[k+5]+f;else"z"===k||"Z"===k?c.closePath():b&&b(k,h)}}
var Mc=function(){function c(){this.items=[];this.sa=new M}c.prototype.toString=function(){return this.items.join(" ")};c.prototype.arc=function(){throw Error("SvgPathContext.arc is not implemented.");};c.prototype.arcTo=function(){throw Error("SvgPathContext.arcTo is not implemented.");};c.prototype.moveTo=function(a,b){var d=this.sa.apply(a,b);this.items.push("M",d.x,d.y)};c.prototype.lineTo=function(a,b){var d=this.sa.apply(a,b);this.items.push("L",d.x,d.y)};c.prototype.transform=function(a,b,
d,e,c,g){a=new M(a,d,b,e,c,g);this.sa=this.sa.multiply(a)};c.prototype.rect=function(){};c.prototype.bezierCurveTo=function(a,b,d,e,c,g){a=this.sa.apply(a,b);d=this.sa.apply(d,e);c=this.sa.apply(c,g);this.items.push("C",a.x,a.y,d.x,d.y,c.x,c.y)};c.prototype.quadraticCurveTo=function(){throw Error("SvgPathContext.quadraticCurveTo is not implemented.");};c.prototype.beginPath=function(){};c.prototype.closePath=function(){this.items.push("Z")};return c}();
function Nc(c,a,b,d,e,f){if(!(2>a.length)){void 0===e&&(e=!0);void 0===f&&(f=!0);var g=a[0].x===a[a.length-1].x&&a[0].y===a[a.length-1].y,h=[],k=[],l=new E(0,0),n=l,m=l,q=l,u=l,v=[],A=b/2,x;for(x=1;x<a.length;x++){m=a[x-1];u=a[x];q=J(m.x,m.y,u.x,u.y);l=new E(q.y,-q.x);"middle"===d?(n=new E(m.x-q.x*A-l.x*A,m.y-q.y*A-l.y*A),m=new E(m.x-q.x*A+l.x*A,m.y-q.y*A+l.y*A)):"outside"===d?n=new E(m.x-l.x*b,m.y-l.y*b):(n=m,m=new E(m.x+l.x*b,m.y+l.y*b));if(k.length){var y=k[k.length-1];var F=v[v.length-1];n=Jc(y.x,
y.y,y.x+F.x,y.y+F.y,n.x,n.y,n.x+q.x,n.y+q.y)||n;y=h[h.length-1];m=Jc(y.x,y.y,y.x+F.x,y.y+F.y,m.x,m.y,m.x+q.x,m.y+q.y)||m}k.push(n);h.push(m);v.push(q)}g?(y=k[0],F=v[0],n=Jc(y.x,y.y,y.x+F.x,y.y+F.y,n.x,n.y,n.x+q.x,n.y+q.y)||n,y=h[0],m=Jc(y.x,y.y,y.x+F.x,y.y+F.y,m.x,m.y,m.x+q.x,m.y+q.y)||m,k[0].x=n.x,k[0].y=n.y,h[0].x=m.x,h[0].y=m.y,k.push(n),h.push(m)):"middle"===d?(k.push(new E(u.x+q.x*A-l.x*A,u.y+q.y*A-l.y*A)),h.push(new E(u.x+q.x*A+l.x*A,u.y+q.y*A+l.y*A))):"outside"===d?(k.push(new E(u.x-l.x*b,
u.y-l.y*b)),h.push(u)):(k.push(u),h.push(new E(u.x+l.x*b,u.y+l.y*b)));if(f){c.moveTo(k[0].x,k[0].y);for(x=1;x<k.length;x++)c.lineTo(k[x].x,k[x].y);g&&(c.closePath(),c.moveTo(h[h.length-1].x,h[h.length-1].y))}else e&&c.moveTo(h[h.length-1].x,h[h.length-1].y);if(e){for(x=h.length-1;0<=x;x--)c.lineTo(h[x].x,h[x].y);!g&&f&&c.lineTo(k[0].x,k[0].y)}}};var Oc=function(){function c(a,b,d,e){this.view=a;this.hf=b;this.Da=this.Ca=0;this.Ma=!1;this.log=B.create("SELECT");this.mo(d,e)}c.prototype.ub=function(a){if("touchmove"===a.type){var b=this.view.wc(a.changedTouches[0]);this.Ta(b.x,b.y,a)}else"touchend"===a.type&&(b=this.view.wc(a.changedTouches[0]),this.Za(b.x,b.y,a));return!0};c.prototype.Ya=function(a){this.log("Gesture detected; aborting select box.");this.view.Pa(this.hf);return this.hf.Ya?this.hf.Ya(a):!1};c.prototype.Sa=function(a,b){return this.mo(a,
b)};c.prototype.mo=function(a,b){this.Ca=a;this.Da=b;return this.Ma=!0};c.prototype.Ta=function(a,b){if(this.Ma){var d=this;this.view.ja(function(e){e.save();e.strokeStyle="#0050B7";e.lineWidth=2/d.view.scale;e.fillStyle="rgba(0, 80, 183, 0.2)";var c=new K(d.Ca+.5,d.Da+.5,a-d.Ca,b-d.Da);e.fillRect(c.x,c.y,c.width,c.height);e.strokeRect(c.x,c.y,c.width,c.height);e.restore()});return!0}return!1};c.prototype.Za=function(a,b){this.Ma=!1;this.view.nb();this.view.mt(new K(this.Ca,this.Da,a-this.Ca,b-this.Da));
this.view.Nb();this.view.ja();this.view.Pa(this.hf);return!0};return c}();var Pc=B.create("FitCurve");
function Qc(c){function a(a,b){F.bezierCurveTo(b[1].x,b[1].y,b[2].x,b[2].y,b[3].x,b[3].y);Pc("Bezier: (%s,%s), (%s,%s), (%s,%s), (%s,%s)",b[0].x,b[0].y,b[1].x,b[1].y,b[2].x,b[2].y,b[3].x,b[3].y)}function b(a,b){return a.x*b.x+a.y*b.y}function d(a){var b=1-a;return 3*a*b*b}function e(a){return 3*a*a*(1-a)}function f(a,b){var d=a.x-b.x,e=a.y-b.y;return Math.sqrt(d*d+e*e)}function g(a){return a.x*a.x+a.y*a.y}function h(a,b){var d=Math.sqrt(g(a));0!==d&&(a.x*=b/d,a.y*=b/d);return a}function k(a,b,d){void 0===
d&&Pc("Undef!");d.x=a.x+b.x;d.y=a.y+b.y;return d}function l(a,b){return{x:a.x+b.x,y:a.y+b.y}}function n(a,b){return{x:a.x*b,y:a.y*b}}function m(a,b){return{x:a.x-b.x,y:a.y-b.y}}function q(a,c,g,q,A,u){var v,x=[],y=[[],[]],H=[];var I=[{x:0,y:0},{x:0,y:0},{x:0,y:0},{x:0,y:0}];var F=g-c+1;for(v=0;v<F;v++){var T={x:A.x,y:A.y};var W={x:u.x,y:u.y};h(T,d(q[v]));h(W,e(q[v]));x[v]=[T,W]}y[0][0]=0;y[0][1]=0;y[1][0]=0;y[1][1]=0;H[0]=0;for(v=H[1]=0;v<F;v++)y[0][0]+=b(x[v][0],x[v][0]),y[0][1]+=b(x[v][0],x[v][1]),
y[1][0]=y[0][1],y[1][1]+=b(x[v][1],x[v][1]),T=1-q[v],W=q[v],T=m(a[c+v],l(n(a[c],T*T*T),l(n(a[c],d(q[v])),l(n(a[g],e(q[v])),n(a[g],W*W*W))))),H[0]+=b(x[v][0],T),H[1]+=b(x[v][1],T);q=y[0][0]*y[1][1]-y[1][0]*y[0][1];v=y[0][0]*H[1]-y[0][1]*H[0];H=H[0]*y[1][1]-H[1]*y[0][1];0===q&&(q=y[0][0]*y[1][1]*1E-11);y=H/q;H=v/q;if(0>y||0>H)return y=f(a[g],a[c])/3,I[0]=a[c],I[3]=a[g],k(I[0],h(A,y),I[1]),k(I[3],h(u,y),I[2]),I;I[0]=a[c];I[3]=a[g];k(I[0],h(A,y),I[1]);k(I[3],h(u,H),I[2]);return I}function u(a,b,d){var e;
var c=[];for(e=0;e<=a;e++)c[e]={x:b[e].x,y:b[e].y};for(e=1;e<=a;e++)for(b=0;b<=a-e;b++)c[b].x=(1-d)*c[b].x+d*c[b+1].x,c[b].y=(1-d)*c[b].y+d*c[b+1].y;return c[0]}function v(a){var b=Math.sqrt(Math.sqrt(g(a)));0!==b&&(a.x/=b,a.y/=b);return a}function A(a,b,d,e,c){var f,h=(d-b+1)/2;var k=0;for(f=b+1;f<d;f++){var l=u(3,e,c[f-b]);l=m(l,a[f]);l=g(l);l>=k&&(k=l,h=f)}return{bo:k,Wo:h}}function x(b,d,e,c,g,l){var n;var F=[{x:0,y:0},{x:0,y:0},{x:0,y:0},{x:0,y:0}];var I=l*l;if(2===e-d+1)l=f(b[e],b[d])/3,F[0]=
b[d],F[3]=b[e],k(F[0],h(c,l),F[1]),k(F[3],h(g,l),F[2]),a(3,F);else{var H=[0];for(n=d+1;n<=e;n++)H[n-d]=H[n-d-1]+f(b[n],b[n-1]);for(n=d+1;n<=e;n++)H[n-d]/=H[e-d];var T=H;F=q(b,d,e,T,c,g);n=A(b,d,e,F,T);H=n.bo;n=n.Wo;if(H<l)a(3,F);else{if(H<I||y)for(I=0;4>I;I++){n=b;H=d;var W=e;var Xd=F;var sc=[];for(F=H;F<=W;F++){var Yd=sc,Zd=F-H,N,La=Xd,bb=n[F],cb=T[F-H],ta=[];var Aa=[];var db=u(3,La,cb);for(N=0;2>=N;N++)ta[N]={x:0,y:0},ta[N].x=3*(La[N+1].x-La[N].x),ta[N].y=3*(La[N+1].y-La[N].y);for(N=0;1>=N;N++)Aa[N]=
{x:0,y:0},Aa[N].x=2*(ta[N+1].x-ta[N].x),Aa[N].y=2*(ta[N+1].y-ta[N].y);N=u(2,ta,cb);Aa=u(1,Aa,cb);Yd[Zd]=cb-((db.x-bb.x)*N.x+(db.y-bb.y)*N.y)/(N.x*N.x+N.y*N.y+(db.x-bb.x)*Aa.x+(db.y-bb.y)*Aa.y)}W=sc;F=q(b,d,e,W,c,g);n=A(b,d,e,F,W);H=n.bo;n=n.Wo;if(H<l||y){a(3,F);return}T=W}W={x:0,y:0};I=m(b[n-1],b[n]);H=m(b[n],b[n+1]);W.x=(I.x+H.x)/2;W.y=(I.y+H.y)/2;I=W=v(W);x(b,d,n,c,I,l);I.x=-I.x;I.y=-I.y;x(b,n,e,I,g,l)}}}var y=!0;void 0===y&&(y=!1);var F=new P;F.moveTo(c[0].x,c[0].y);(function(a,b,d){var e=m(a[1],
a[0]);e=v(e);var c=b-1;c=m(a[c-1],a[c]);c=v(c);x(a,0,b-1,e,c,d)})(c,c.length,25);return F};var Rc=function(){function c(a){this.view=a;this.start=new E(0,0);this.xl=new E(0,0);this.active=!1;this.rect=null;this.log=B.create("PanZoomMixin")}c.prototype.Ya=function(a){this.log("onGesture(%s)",a.type);if(!this.view.da.get("allowZoom"))return!1;if("gesturestart"===a.type)this.start=new E(a.pageX,a.pageY),this.xl=this.view.eb(a.pageX,a.pageY),this.rect=this.view.Vf(),this.active=!0;else if("gesturechange"===a.type&&this.rect){var b=a.pageX-this.start.x,d=a.pageY-this.start.y;a=this.view.da.cl(1/
a.scale);a=new O(a,a,this.xl.x,this.xl.y);a=(new L(-b/this.view.scale,-d/this.view.scale)).multiply(a);b=this.rect.clone();b.transform(a);this.view.uh(b)}else"gestureend"===a.type&&(this.active=!1);return!0};return c}();var Sc=function(){function c(a){this.view=a;this.state="none";this.start=new E(0,0);this.Yo=this.Xo=0;this.log=B.create("PanTool");this.ac=new Rc(a)}c.prototype.sc=function(){this.log("Entering PanToolBehaviour");this.view.canvas.style.cursor="all-scroll"};c.prototype.Hc=function(){this.log("Leaving PanToolBehaviour")};c.prototype.Ya=function(a){return this.ac.Ya(a)};c.prototype.ub=function(a){if("touchstart"===a.type){var b=a.changedTouches[0];b=this.view.eb(b.pageX,b.pageY);return this.Sa(b.x,b.y,
a)}return"touchmove"===a.type?(b=a.changedTouches[0],b=this.view.eb(b.pageX,b.pageY),this.Ta(b.x,b.y,a)):"touchend"===a.type?(b=a.changedTouches[0],b=this.view.eb(b.pageX,b.pageY),this.Za(b.x,b.y,a)):!0};c.prototype.zn=function(a){switch(a.type){case "touchend":case "touchstart":case "touchmove":return new E(a.changedTouches[0].pageX,a.changedTouches[0].pageY);case "mousedown":case "mouseup":case "mousemove":case "pointerdown":case "pointermove":case "pointerup":return new E(a.pageX,a.pageY);default:return this.log("Can't handle event: %s",
a.type),new E(0,0)}};c.prototype.Sa=function(a,b,d){this.log("onMouseDown type %s",d.type);this.state="dragging";this.start=this.zn(d);this.Xo=this.view.wb;this.Yo=this.view.ib;return!0};c.prototype.Ta=function(a,b,d){if("dragging"!==this.state)return!1;a=this.zn(d);b=this.Yo+a.y-this.start.y;this.view.wb=this.Xo+a.x-this.start.x;this.view.ib=b;this.view.ic();this.view.ja();return!0};c.prototype.Za=function(){this.state="none";return!0};c.prototype.Qk=function(a,b,d,e){if(!this.view.da.get("allowZoom"))return this.log("Zooming is disabled."),
!1;this.log("onMouseWheel(%s, %s, %s)",a,b,d);d=0<d?1/1.1:1.1;a=new O(d,d,a,b);b=this.view.Vf();b.transform(a);this.view.uh(b);e.stopPropagation();e.preventDefault();return!0};c.prototype.Zb=function(a){"cancel"===a&&this.view.Va()};return c}();var Tc=function(c){function a(a,d,e){var b=c.call(this)||this;b.id=a;b.Cd=d;b.Ei=!0;b.width=32;b.height=500;b.hv=0;b.Eb=new K(0,0,0,0);b.Ma=!1;b.Tp="#c0c0c0";b.Mm="#808080";b.borderWidth=1;b.Xd=0;b.Wd=100;b.Pl=10;b.position=5;b.offset=0;b.log=B.create("SCROLLBAR",!0);b.Ei=!0;b.canvas=Zb(document.body);b.canvas.style.position="absolute";b.canvas.style.border="none";b.ka=b.canvas.getContext("2d");C(b.canvas).bind("click",function(a){b.nc(a)});C(b.canvas).bind("mousedown",function(a){b.Sa(a)});e.bind(C(document.body),
"mousemove",function(a){b.Ta(a)});e.bind(C(document.body),"mouseup",function(a){b.Za(a)});C(b.canvas).bind("touchstart",function(a){b.ub(a)});e.bind(C(document.body),"touchmove",function(a){b.ub(a)});e.bind(C(document.body),"touchend",function(a){b.ub(a)});b.format();return b}p(a,c);a.prototype.Gj=function(a){a.appendChild(this.canvas)};a.prototype.moveTo=function(a,d){this.canvas.style.left=""+a+"px";this.canvas.style.top=""+d+"px"};a.prototype.te=function(a,d){this.width=a;this.height=d;this.canvas.width=
this.width;this.canvas.height=d;this.format();this.ja()};a.prototype.Xa=function(){this.canvas.style.display="none"};a.prototype.show=function(){this.canvas.style.display="block"};a.prototype.cs=function(){return"block"===this.canvas.style.display};a.prototype.Ro=function(a,d,e,c){this.Xd=a;this.Wd=d-a;this.Pl=e;this.position=c;this.format();this.ja()};a.prototype.format=function(){var a=this.Cd?this.width:this.height;var d=this.Pl/this.Wd*a;a*=(this.position-this.Xd)/this.Wd;this.Eb=this.Cd?new K(a,
0,d-1,this.height-1):new K(0,a,this.width-1,d-1);this.Eb.x=Math.round(this.Eb.x)+.5;this.Eb.y=Math.round(this.Eb.y)+.5;this.Eb.width=Math.round(this.Eb.width);this.Eb.height=Math.round(this.Eb.height)};a.prototype.ja=function(){this.ka.beginPath();this.ka.fillStyle=this.Tp;this.ka.strokeStyle=this.Mm;this.ka.lineWidth=this.borderWidth;this.ka.rect(this.borderWidth/2,this.borderWidth/2,this.width-this.borderWidth,this.height-this.borderWidth);this.ka.fill();this.ka.stroke();this.ka.beginPath();this.ka.fillStyle=
this.Mm;this.ka.strokeStyle="#000000";this.ka.rect(this.Eb.x,this.Eb.y,this.Eb.width,this.Eb.height);this.ka.fill();this.ka.stroke()};a.prototype.jn=function(a){var b=C(this.canvas).offset(),e=0,c=0;if("touchstart"===a.type||"touchend"===a.type||"touchmove"===a.type)e=a.changedTouches[0].pageX,c=a.changedTouches[0].pageY;else if("mousedown"===a.type||"mouseup"===a.type||"mousemove"===a.type)e=a.pageX,c=a.pageY;return new E(e-b.left,c-b.top)};a.prototype.ub=function(a){switch(a.type){case "touchstart":this.Sa(a);
break;case "touchend":this.Za(a);break;case "touchmove":this.Ta(a)}};a.prototype.nc=function(){};a.prototype.wo=function(a){a=this.Cd?a.x/this.width*this.Wd+this.Xd:a.y/this.height*this.Wd+this.Xd;a=Math.min(a,this.Wd-this.Pl+this.Xd);return a=Math.max(a,this.Xd)};a.prototype.Sa=function(a){a.preventDefault();a=this.jn(a);this.Eb.Uc(a.x,a.y)?this.Cd?(this.offset=a.x-this.Eb.x,a.x-=this.offset):(this.offset=a.y-this.Eb.y,a.y-=this.offset):(this.position=this.wo(a),this.offset=0,this.Cd?this.Eb.x=(this.position-
this.Xd)/this.Wd*this.width:this.Eb.y=(this.position-this.Xd)/this.Wd*this.height,this.ua("scroll",this.position),this.ja());this.Ma=!0};a.prototype.Ta=function(a){this.Ma&&(this.Ma&&"mousemove"===a.type&&0===a.buttons?this.Ma=!1:(a.preventDefault(),a=this.jn(a),this.Cd?a.x-=this.offset:a.y-=this.offset,this.position=this.wo(a),this.ua("scroll",this.position),this.format(),this.ja()))};a.prototype.Za=function(){this.Ma&&(this.Ma=!1)};a.prototype.si=function(){return this.Cd?this.height:this.width};
a.Qu=0;a.Nu=1;a.Iu=2;a.Pu=3;return a}(Hb);var Uc=function(){function c(a,b){void 0===b&&(b=30);this.bc=a;this.vc=b;this.Hf=[];this.log=B.create("AngleAddon")}c.prototype.format=function(){var a=this.bc.Jc,b=0,d=[],e=[];this.Hf.length=0;for(var c=0>a.Op();b<a.ba.length;){switch(a.ba[b]){case P.pc:d=[new E(a.ba[b+1],a.ba[b+2])];e=d.concat();break;case P.oc:3===d.length&&d.shift();d.push(new E(a.ba[b+1],a.ba[b+2]));e.push(d[d.length-1]);3===d.length&&this.Dm(d[0],d[1],d[2],c);break;case P.xc:3<=e.length&&this.Dm(e[e.length-2],e[0],e[1],c)}b+=
P.gc[a.ba[b]]}};c.prototype.Dm=function(a,b,d,e){var c=J(b.x,b.y,a.x,a.y);var g=J(b.x,b.y,d.x,d.y);a=J(a.x,a.y,d.x,d.y);new E(c.x+a.x/2,c.y+a.y/2);c=Math.atan2(c.y,c.x);g=Math.atan2(g.y,g.x);e&&(e=c,c=g,g=e);this.Hf.push({x:b.x,y:b.y,lg:g,ji:c})};c.prototype.ja=function(a){a.beginPath();var b;for(b=0;b<this.Hf.length;b++){var d=this.Hf[b];a.moveTo(d.x+this.vc*Math.cos(d.lg),d.y+this.vc*Math.sin(d.lg));a.arc(d.x,d.y,this.vc,d.lg,d.ji,!1)}a.lineWidth=3;a.strokeStyle="red";a.stroke();a.fillStyle="red";
a.font="20px Arial";for(b=0;b<this.Hf.length;b++){d=this.Hf[b];var e=(d.lg+d.ji)/2+Math.PI;0<d.lg&&0>d.ji&&(e-=Math.PI);var c=d.ji-d.lg;0>c&&(c+=2*Math.PI);a.fillText(""+Math.round(c/Math.PI*180)+"\u00b0",d.x+this.vc*Math.cos(e),d.y+this.vc*Math.sin(e))}};return c}();var Vc=function(){function c(a){this.bc=a;this.Vh=[];this.al=!0;this.log=B.create("cloudAddon");this.vc=a.la("cloudRadius")}c.prototype.format=function(){var a=this.bc.Jc.Md();this.log("Format cloud; %s points",a.length);this.Vh=this.jq(a,this.vc)};c.prototype.jq=function(a,b){var d=[],e=5/6*b*2,c,g=a[a.length-1];for(c=0;c<a.length;c++){var h=a[c];var k=h.x-g.x,l=h.y-g.y,n=Math.sqrt(k*k+l*l);k/=n;l/=n;var m=n/e+.5|0;1>m&&(m=1);m=n/m;for(var q=0;q+.1*m<n;q+=m)d.push({x:g.x+q*k,y:g.y+q*l,Km:0,end:0});
g=h}h=d[d.length-1];for(c=0;c<d.length;c++)e=d[c],k=e.x-h.x,l=e.y-h.y,g=.5*Math.sqrt(k*k+l*l)/b,-1>g&&(g=-1),1<g&&(g=1),k=Math.atan2(l,k),g=Math.acos(g),g=[k-g,Math.PI+k+g],h.end=g[0],e.Km=g[1],h=e;return d};c.prototype.ja=function(a){this.log("Drawing cloud with %s circles",this.Vh.length);var b=15*Math.PI/180,d=this.vc;a.beginPath();for(var e=0;e<this.Vh.length;e++){var c=this.Vh[e];a.arc(c.x,c.y,d,c.Km,c.end+b)}a.stroke()};return c}();var R=function(){function c(a,b){this.id=a;this.ha=b;this.parent=null;this.aa={};this.rect=new K(0,0,1,1);this.Lh=!1;this.fb=new K(0,0,1,1);this.order=0;this.page=null;this.cc=0;this.log=B.create("BaseNode");this.aa.matrix=new M;this.aa.layer="default";this.Ij(c.ya)}c.Sc=function(a,b){c.types[a]=b};c.create=function(a,b,d){return a in c.types?new c.types[a](b,d):null};c.prototype.Ij=function(a){for(var b in a)a.hasOwnProperty(b)&&(this.aa[b]=a[b])};c.prototype.clip=function(){};c.prototype.toString=
function(){return this.type()+":"+this.id};c.prototype.Xf=function(){return!1};c.prototype.ld=function(){return null};c.prototype.ii=function(){};c.prototype.Qn=function(){return!1};c.prototype.wi=function(){return"text"in this.aa};c.prototype.ln=function(a,b){var d=typeof this.aa[a],e=typeof b;d!==e&&"string"===e&&"number"===d&&(this.log("Convert property %s to a number.",a),b=parseFloat(b));return b};c.prototype.clone=function(a){a=c.create(this.type(),a(),this.ha);a.Cb(this.tc());return a};c.prototype.tc=
function(){var a={},b;for(b in this.aa)this.aa.hasOwnProperty(b)&&(a[b]=this.la(b));return a};c.prototype.Cb=function(a){for(var b in a)a.hasOwnProperty(b)&&this.setProperty(b,a[b])};c.prototype.Ad=function(){var a=this.la("layer");return a?""+a:"default"};c.prototype.Sn=function(){return void 0!==this.children};c.prototype.yk=function(){return null!==this.parent&&null!==this.parent.parent&&"PageNode"!==this.parent.type()};c.prototype.type=function(){return"BaseNode"};c.prototype.Ga=function(){return this.aa.matrix};
c.prototype.Te=function(){return this.aa.matrix.inverse()};c.prototype.og=function(a){this.aa.matrix=a};c.prototype.setProperty=function(a,b){b=this.ln(a,b);if(a in this.aa||"customData"===a||"tag"===a||"locked"===a||"lockSize"===a||"lockRotation"===a||"lockPosition"===a||"lockEditMode"===a||"rotationHandles"===a||"lockAspectRatio"===a||"zIndex"===a||"wallAffinity"===a||"snap"===a||"opacity"===a)pa(b)&&(b=b.slice(0)),"opacity"===a&&(b=parseFloat(b)),this.aa[a]=b};c.prototype.la=function(a){return this.aa[a]};
c.prototype.vk=function(){return[]};c.prototype.jk=function(){var a=new Q(this.fb);a.transform(this.Ga());return a};c.prototype.Wf=function(){return this.la("zIndex")||0};c.prototype.transform=function(a){this.og(a.multiply(this.Ga()))};c.prototype.format=function(){};c.prototype.gb=function(a,b){var d=this.Te().apply(a,b);return this.hidden()||this.la("locked")||!this.fb.Uc(d.x,d.y)?null:this};c.prototype.qe=function(a){this.Lh=a};c.prototype.hidden=function(){return this.Lh};c.prototype.pg=function(){};
c.prototype.Pk=function(){};c.prototype.Rk=function(){};c.prototype.ig=function(a){if(a.ig){var b={"zwibbler:id":""+this.id};if("tag"in this.aa){var d=this.aa.tag;"string"!==typeof d&&(d=JSON.stringify(d));b["zwibbler:tag"]=d}a.ig(b)}};c.prototype.gg=function(a){a.gg&&a.gg()};c.prototype.ja=function(a){a.save();this.ig(a);var b=this.aa.matrix;a.transform(b.m11,b.m21,b.m12,b.m22,b.Ca,b.Da);"erase"===this.aa.strokeStyle?a.Cf?a.strokeStyle=a.Cf:(a.strokeStyle="#000000",a.globalCompositeOperation="destination-out"):
a.strokeStyle=this.aa.strokeStyle;a.fillStyle=this.aa.fillStyle;a.lineWidth=this.aa.lineWidth;this.aa.shadow&&(a.shadowOffsetX=3,a.shadowOffsetY=3,a.shadowBlur=5,a.shadowColor="rgba(0,0,0,0.5)");"opacity"in this.aa&&(a.globalAlpha=this.aa.opacity);this.Ce(a);this.gg(a);a.restore();c.Zl&&(a.save(),a.beginPath(),a.lineWidth=1,a.strokeStyle="#ff8000",a.rect(this.rect.x,this.rect.y,this.rect.width,this.rect.height),a.stroke(),a.restore())};c.prototype.Ce=function(){};c.prototype.resolve=function(){return!1};
c.prototype.Xq=function(a,b,d){this.Og||(this.Og={});var e=this.Og.insideFill;if(!e||e.fp!==d){e&&d===e.fp||(e={fp:d,value:d},this.Og.insideFill=e);d=/url\(([^\)]+)\)/.exec(d);var c;d&&(c=d[1]);var g=this;c&&(e.value="rgba(0, 0, 0, 0.2)",b.add(this.id,"image",c,null,function(d){g.log("Got image response.");e.value=a.createPattern(d,"repeat");b.ua("reformat",g)}))}};c.prototype.rr=function(){if(this.Og){var a=this.Og.insideFill;if(a)return a.value}return"magenta"};c.prototype.Tf=function(){return""};
c.prototype.ie=function(){};c.prototype.Ug=function(){return null};c.prototype.de=function(){return null};c.prototype.Se=function(){return this.parent?this.parent.gk(this):-1};c.ya={fillStyle:"#cccccc",strokeStyle:"#000000",lineWidth:2,shadow:!1};c.Zl=!1;c.types={};return c}();var Wc=function(){function c(){this.text="";this.font="10px Arial";this.nn="Arial";this.fontSize=10;this.lines=[];this.Ol="left";this.Xg="top";this.Un=this.bold=!1;this.textDecoration="";this.log=B.create("TextBox");this.rect=new K(0,0,0,this.fontSize)}c.prototype.yt=function(a,b,d,e,c){this.nn=a;this.fontSize=b;this.bold=d;this.Un=e;this.textDecoration=c};c.prototype.So=function(a){this.text=a};c.prototype.Go=function(a,b){switch(a){case "left":case "centre":case "right":this.Xg=a;break;case null:break;
default:this.log("Unknnown alignment: %s",a)}switch(b){case "top":case "middle":case "bottom":this.Ol=b;break;case null:break;default:this.log("Unknnown alignment: %s",b)}};c.prototype.format=function(a,b,d){this.font=""+this.fontSize+'px "'+this.nn+'"';this.bold&&(this.font="bold "+this.font);this.Un&&(this.font="italic "+this.font);this.lines.length=0;var e;a.font=this.font;var c=0;this.rect.width=0;if(0===b){var g=this.text.split("\n");for(e=0;e<g.length;e++){var h=g[e];var k=a.measureText(h).width;
c+=this.fontSize;this.lines.push({x:0,y:c,width:k,text:h});this.rect.width=Math.max(this.rect.width,k)}}else{h=g=0;var l=!1;for(e=0;e<this.text.length;e++){var n=this.text.charAt(e);k=a.measureText(this.text.substr(g,e-g+1)).width;"\n"===n?l=!0:k>b?h?(e=h,l=!0):e>g&&(--e,l=!0):" "===n&&(h=e);l&&(k=" "===this.text.charAt(e)?a.measureText(this.text.substr(g,e-g)).width:a.measureText(this.text.substr(g,e-g+1)).width,c+=this.fontSize,this.lines.push({x:0,y:c,width:k,text:this.text.substr(g,e-g+1)}),g=
e+1,h=0,l=!1,this.rect.width=Math.max(this.rect.width,k))}k&&(c+=this.fontSize,this.lines.push({x:0,y:c,width:k,text:this.text.substr(g,e-g)}),this.rect.width=Math.max(this.rect.width,k))}this.rect.x=0;this.rect.y=0;this.rect.height=c;if("centre"===this.Xg)for(e=0;e<this.lines.length;e++)a=this.lines[e],a.x=this.rect.width/2-a.width/2;else if("right"===this.Xg)for(e=0;e<this.lines.length;e++)a=this.lines[e],a.x=this.rect.width-a.width;b&&"centre"===this.Xg?this.rect.x=b/2-this.rect.width/2:b&&"right"===
this.Xg&&(this.rect.x=b-this.rect.width);d&&"middle"===this.Ol?this.rect.y=d/2-this.rect.height/2:d&&"bottom"===this.Ol&&(this.rect.y=d-this.rect.height)};c.prototype.ja=function(a,b,d){this.fillText(a,b,d);this.an(a,b,d)};c.prototype.an=function(a,b,d){var e;if(0<=this.textDecoration.indexOf("underline")){a.save();a.beginPath();var c=1;for(e=0;e<this.lines.length;e++){var g=this.lines[e];a.moveTo(g.x+b,g.y+d+c);a.lineTo(g.x+b+g.width,g.y+d+c)}a.strokeStyle=a.fillStyle;a.lineWidth=1;a.stroke();a.beginPath();
a.restore()}if(0<=this.textDecoration.indexOf("line-through")){a.save();a.beginPath();c=.25*-this.fontSize;for(e=0;e<this.lines.length;e++)g=this.lines[e],a.moveTo(g.x+b,g.y+d+c),a.lineTo(g.x+b+g.width,g.y+d+c);a.strokeStyle=a.fillStyle;a.lineWidth=1;a.stroke();a.restore()}};c.prototype.fillText=function(a,b,d){a.textBaseline="alphabetic";a.font=this.font;for(var e=0;e<this.lines.length;e++){var c=this.lines[e];a.fillText(c.text,this.rect.x+c.x+b,this.rect.y+c.y+d)}};c.prototype.strokeText=function(a,
b,d){a.textBaseline="alphabetic";a.font=this.font;for(var e=0;e<this.lines.length;e++){var c=this.lines[e];a.strokeText(c.text,this.rect.x+c.x+b,this.rect.y+c.y+d)}};return c}();var Xc=function(c){function a(b,d){var e=c.call(this,b,d)||this;e.pb=new Wc;e.Jn=0;e.border={lineWidth:0,Ke:"#000000"};e.log=B.create("TEXT",!0);e.Ij(a.wp);e.aa.text="lorum ipsum dolor";return e}p(a,c);a.prototype.type=function(){return"TextNode"};a.prototype.setProperty=function(a,d){this.aa[a]=this.ln(a,d);"textFillStyle"===a?this.aa.fillStyle=d:"fillStyle"===a&&(this.aa.textFillStyle=d)};a.prototype.format=function(a){this.pb.yt(this.aa.fontName,this.aa.fontSize,this.aa.bold,this.aa.italic,this.aa.textDecoration);
var b=this.aa.text;b.length&&10===b.charCodeAt(b.length-1)&&(b=b.substr(0,b.length-1));this.pb.So(b);var e=this.aa.matrix;b=e.apply(0,0);e=e.apply(1,0);b=b.Oa(e);e=this.la("wrap");var c=!1!==this.la("scaleFont");this.pb.Go(this.aa.textAlign,"top");e?(e=this.aa.baseWidth,void 0===e&&(this.pb.format(a,0,0),e=Math.max(this.pb.rect.width,10),500<e&&(e=500),this.aa.baseWidth=e,this.log("Formatting text for first time; baseWidth=%s",e)),b=Math.ceil(b*e),this.pb.format(a,b,0),a=this.pb.rect.height,this.fb=
new K(0,0,e,a)):c?(this.pb.format(a,0,0),b=this.pb.rect.width,a=this.pb.rect.height,this.fb=new K(0,-(0+this.la("fontSize")),b,a)):(this.pb.format(a,0,0),b=this.pb.rect.width,a=this.pb.rect.height,this.fb=new K(0,0,b,a));a=new Q(this.fb);a.transform(this.Ga());this.rect=a.Nm();this.Jn=this.rect.height;this.rect.height+=1.3*this.aa.fontSize;a=this.la("lineWidth")+0;this.rect.Gc(a,a);this.border=this.aa.border?this.Rs(this.aa.border):{lineWidth:0,Ke:"#000000"}};a.prototype.Rs=function(a){var b={lineWidth:0,
Ke:"#000000"};a=a.split(" ");for(var e=0;e<a.length;e++){var c=parseFloat(a[e]);if(isNaN(c)){if(c=z.ik(a[e]))b.Ke=c.toString()}else b.lineWidth=c}return b};a.prototype.Ga=function(){return!1===this.la("scaleFont")?c.prototype.Ga.call(this).cp():c.prototype.Ga.call(this)};a.prototype.ja=function(a){if(0!==this.aa.text.length){a.save();this.ig(a);this.la("wrap")?this.Ga().cp().dj(a):this.Ga().dj(a);"opacity"in this.aa&&(a.globalAlpha=this.aa.opacity);var b=this.aa.background;if(b||this.border.lineWidth)a.save(),
b&&(a.fillStyle=b,a.fillRect(this.fb.x,this.fb.y,this.fb.width,this.fb.height)),this.border.lineWidth&&(a.beginPath(),a.strokeStyle=this.border.Ke,a.lineWidth=this.border.lineWidth,a.rect(this.fb.x,this.fb.y,this.fb.width,this.fb.height),a.stroke()),a.restore();a.strokeStyle=this.aa.strokeStyle;a.fillStyle=this.aa.fillStyle;a.lineWidth=this.aa.lineWidth;b=0;this.aa.wrap||!1===this.la("scaleFont")||(b=-(0+this.la("fontSize")));this.aa.shadow&&(a.shadowOffsetX=3,a.shadowOffsetY=3,a.shadowBlur=5,a.shadowColor=
"rgba(0,0,0,0.5)");0<this.aa.lineWidth&&this.pb.strokeText(a,0,b);this.pb.fillText(a,0,b);this.pb.an(a,0,b);this.gg(a);a.restore();R.Zl&&(a.save(),a.beginPath(),a.lineWidth=1,a.strokeStyle="#ff8000",a.rect(this.rect.x,this.rect.y,this.rect.width,this.rect.height),a.stroke(),a.restore())}};a.wp={textFillStyle:"#000000",fontName:"Arial",fontSize:20,lineWidth:0,fillStyle:"#000000",wrap:!1,textAlign:"left",bold:!1,italic:!1,background:"rgba(0,0,0,0.0)",textDecoration:""};return a}(R);
R.Sc("TextNode",Xc);var Yc=function(){function c(a,b){this.pa=a;this.fa=b;this.Rt=!0;this.log=B.create("MoveSegment")}c.prototype.ja=function(a){a.moveTo(this.fa.x,this.fa.y)};c.prototype.xe=function(){return this.Bc()};c.prototype.Bc=function(){return{x:1,y:0}};return c}(),Zc=function(){function c(a,b,d,e,c){this.pa=a;this.fa=b;this.ul=e;this.Kd=c;this.log=B.create("LineSegment");this.lf=0;this.Aa=new E(0,0);this.Ja=new E(0,0);this.length=0;this.from=new E(0,0);this.fa=b;this.pa=a;this.Kd=c;this.ul=e;d.next();this.Ki=
d.next();this.Li=d.next();this.moveTo=this.mf=null;this.format()}c.prototype.format=function(){var a=G(this.pa.fa.x,this.pa.fa.y,this.fa.x,this.fa.y);this.lf=this.length=a;var b=this.pa.fa.clone();this.pa instanceof c&&this.Kd&&(this.Kd=Math.min(this.Kd,a/2,this.pa.length/2),a=J(this.pa.fa.x,this.pa.fa.y,this.fa.x,this.fa.y),b.x+=a.x*this.Kd,b.y+=a.y*this.Kd,this.pa.Jt(this.Kd),this.lf-=this.Kd);this.from=b;null===this.mf&&(this.mf=this.fa);a=this.lf/10*this.ul;10<a&&(a=10);var d=b.x,e=b.y,f=this.fa.x,
g=this.fa.y;d+=a;e+=a;this.Aa=new E(d+this.Ki*(f+a-d),e+this.Ki*(g+a-e));d=b.x-a;f=this.fa.x-a;e=b.y-a;g=this.fa.y-a;this.Ja=new E(d+this.Li*(f-d),e+this.Li*(g-e))};c.prototype.Jt=function(a){var b=J(this.from.x,this.from.y,this.fa.x,this.fa.y),d=this.fa.clone();d.x-=b.x*a;d.y-=b.y*a;this.mf=d;this.lf-=a;a=this.lf/10*this.ul;10<a&&(a=10);b=this.from.x;var e=this.from.y,c=d.x,g=d.y;b+=a;e+=a;this.Aa=new E(b+this.Ki*(c+a-b),e+this.Ki*(g+a-e));this.log("RECALC ctrl1=%s",this.Aa);b=this.from.x-a;c=d.x-
a;e=this.from.y-a;g=d.y-a;this.Ja=new E(b+this.Li*(c-b),e+this.Li*(g-e))};c.prototype.th=function(a){this.pa=a;this.format();this.pa instanceof c&&(this.moveTo=this.pa.mf)};c.prototype.ja=function(a){null!==this.mf&&(this.Kd&&(this.moveTo&&a.moveTo(this.moveTo.x,this.moveTo.y),a.quadraticCurveTo(this.pa.fa.x,this.pa.fa.y,this.from.x,this.from.y)),a.bezierCurveTo(this.Aa.x,this.Aa.y,this.Ja.x,this.Ja.y,this.mf.x,this.mf.y))};c.prototype.xe=function(){return this.pa?J(this.pa.fa.x,this.pa.fa.y,this.Aa.x,
this.Aa.y):this.Bc()};c.prototype.Bc=function(){return J(this.Ja.x,this.Ja.y,this.fa.x,this.fa.y)};return c}(),$c=function(){function c(a,b,d){this.vl=d;this.fa=b;this.pa=a;this.vl=d;var e=G(a.fa.x,a.fa.y,b.x,b.y);e||(e=1);var c=(b.x-a.fa.x)/e,g=(b.y-a.fa.y)/e;this.Ja=new E(b.x-e*d*c,b.y-e*d*g);if((b=a.Ja)&&a.pa){var h=J(a.pa.fa.x,a.pa.fa.y,a.fa.x,a.fa.y),k=G(a.pa.fa.x,a.pa.fa.y,a.fa.x,a.fa.y);c=.5*(c+h.x);g=.5*(g+h.y);b.x=a.fa.x-k*d*c;b.y=a.fa.y-k*d*g}this.Aa=new E(a.fa.x+e*d*c,a.fa.y+e*d*g);this.length=
e}c.prototype.th=function(a){this.pa=a;var b=a.Ja,d=(this.fa.x-a.fa.x)/this.length,e=(this.fa.y-a.fa.y)/this.length,c=this.vl;if(b&&a.pa){var g=J(a.pa.fa.x,a.pa.fa.y,a.fa.x,a.fa.y),h=G(a.pa.fa.x,a.pa.fa.y,a.fa.x,a.fa.y);d=.5*(d+g.x);e=.5*(e+g.y);b.x=a.fa.x-h*c*d;b.y=a.fa.y-h*c*e}this.Aa=new E(a.fa.x+this.length*c*d,a.fa.y+this.length*c*e)};c.prototype.ja=function(a){a.bezierCurveTo(this.Aa.x,this.Aa.y,this.Ja.x,this.Ja.y,this.fa.x,this.fa.y)};c.prototype.xe=function(){return this.pa?J(this.pa.fa.x,
this.pa.fa.y,this.Aa.x,this.Aa.y):{x:1,y:0}};c.prototype.Bc=function(){return 0<this.vl?J(this.Ja.x,this.Ja.y,this.fa.x,this.fa.y):J(this.pa.fa.x,this.pa.fa.y,this.fa.x,this.fa.y)};return c}(),ad=function(){function c(a,b,d){this.pa=a;this.control=b;this.fa=d}c.prototype.ja=function(a){a.quadraticCurveTo(this.control.x,this.control.y,this.fa.x,this.fa.y)};c.prototype.xe=function(){return this.pa?J(this.pa.fa.x,this.pa.fa.y,this.control.x,this.control.y):{x:1,y:0}};c.prototype.Bc=function(){return J(this.control.x,
this.control.y,this.fa.x,this.fa.y)};return c}(),bd=function(){function c(a,b,d,e){this.pa=a;this.control=b;this.fa=d;this.vc=e}c.prototype.ja=function(a){a.arcTo(this.control.x,this.control.y,this.fa.x,this.fa.y,this.vc)};c.prototype.xe=function(){return{x:1,y:0}};c.prototype.Bc=function(){return J(0,0,1,0)};return c}(),cd=function(){function c(a,b,d,e){this.Aa=b;this.Ja=d;this.Aa=b;this.Ja=d;this.fa=e;this.pa=a}c.prototype.ja=function(a){a.bezierCurveTo(this.Aa.x,this.Aa.y,this.Ja.x,this.Ja.y,this.fa.x,
this.fa.y)};c.prototype.xe=function(){return this.pa?J(this.pa.fa.x,this.pa.fa.y,this.Aa.x,this.Aa.y):{x:1,y:0}};c.prototype.Bc=function(){return J(this.Ja.x,this.Ja.y,this.fa.x,this.fa.y)};return c}(),dd=function(){function c(a,b,d,e){this.pa=a;this.Aa=b;this.Ja=d;this.fa=e}c.prototype.ja=function(a){if(this.pa){var b=[];this.pa.Ja&&b.push(this.pa.Ja);this.Aa&&b.push(this.Aa);2===b.length?a.bezierCurveTo(b[0].x,b[0].y,b[1].x,b[1].y,this.fa.x,this.fa.y):1===b.length&&a.quadraticCurveTo(b[0].x,b[0].y,
this.fa.x,this.fa.y)}};c.prototype.th=function(a){this.pa=a};c.prototype.xe=function(){return this.pa&&this.pa.Ja?J(this.pa.fa.x,this.pa.fa.y,this.Aa.x,this.Aa.y):{x:1,y:0}};c.prototype.Bc=function(){return this.Aa?J(this.Aa.x,this.Aa.y,this.fa.x,this.fa.y):{x:1,y:0}};return c}(),ed=function(){function c(a,b,d,e,c){this.pa=a;this.Jg=b;this.fa=d;this.log=B.create("SEGMENT");this.pa=a;this.Jg=b;c*=2;var f=2*e.next()-1;e.next();e=this.pa.Bc();if(!this.pa.Rt&&e){var h=G(a.fa.x,a.fa.y,b.x,b.y);this.Aa=
new E(a.fa.x+.5522847498*e.x*h,a.fa.y+.5522847498*e.y*h)}else this.Aa=new E(a.fa.x+.5522847498*(b.x-a.fa.x),a.fa.y+.5522847498*(b.y-a.fa.y));this.Ja=new E(d.x-.5522847498*(d.x-b.x)*(1-f*c),d.y-.5522847498*(d.y-b.y)*(1-f*c));this.fa=d}c.prototype.th=function(a){this.pa=a;var b=this.pa.Bc();if(b){var d=G(a.fa.x,a.fa.y,this.Jg.x,this.Jg.y);this.Aa=new E(a.fa.x+.5522847498*b.x*d,a.fa.y+.5522847498*b.y*d)}else this.Aa=new E(a.fa.x+.5522847498*(this.Jg.x-this.pa.fa.x),a.fa.y+.5522847498*(this.Jg.y-this.pa.fa.y))};
c.prototype.ja=function(a){a.bezierCurveTo(this.Aa.x,this.Aa.y,this.Ja.x,this.Ja.y,this.fa.x,this.fa.y)};c.prototype.xe=function(){return this.pa?J(this.pa.fa.x,this.pa.fa.y,this.Aa.x,this.Aa.y):{x:1,y:0}};c.prototype.Bc=function(){return J(this.Ja.x,this.Ja.y,this.fa.x,this.fa.y)};return c}();var fd=function(){function c(a){this.gh=this.fh=0;if("string"===typeof a){for(;8>a.length;)a+=a;for(var b=16777619,d=0;d<a.length;d++)b=(16777619*b^a.charCodeAt(d))&4294967295;a=b}this.Fo=a;this.reset()}c.prototype.reset=function(){this.gh=this.fh=this.Fo};c.prototype.next=function(){this.gh=36969*(this.gh&65535)+(this.gh>>16);this.fh=18E3*(this.fh&65535)+(this.fh>>16);return((this.gh<<16)+this.fh)/4294967295/2+.5};return c}();var gd=function(){function c(a){this.ma=a;this.n=0;this.kd=new E(0,0)}c.prototype.next=function(a){if(0===this.ma.length)return null;if(0===this.n)return this.kd=this.ma[0].clone(),this.n+=1,this.kd.clone();for(;this.n<this.ma.length;){var b=this.kd.Oa(this.ma[this.n]);if(0===b)this.n+=1;else if(b<=a)a-=b,this.n+=1;else return this.kd.x+=(this.ma[this.n].x-this.kd.x)*a/b,this.kd.y+=(this.ma[this.n].y-this.kd.y)*a/b,this.kd.clone()}return null};return c}(),hd=function(){function c(a){this.bc=a;this.al=
!0;this.ma=[];this.log=B.create("WaveAddon");this.vc=a.la("waveRadius")}c.prototype.format=function(){var a=this.bc.Jj(!1).El(S.mj).Md();this.log("Format cloud; %s points",a.length);this.ma=this.zu(a,this.vc)};c.prototype.zu=function(a,b){var d=new gd(a),e=1,c=[];if(2>a.length)return c;var g=0;for(var h=1;h<a.length;h++)g+=G(a[h-1].x,a[h-1].y,a[h].x,a[h].y);b=g/Math.round(g/(2*b)+.5)/2;for(g=[];;){h=d.next(2*b);if(!h)break;g.push(h)}g.push(a[a.length-1]);var k=g[0];c.push(k);for(d=1;d<g.length;d++){h=
g[d];var l=J(k.x,k.y,h.x,h.y);var n=b,m=new E(l.y*e,-1*l.x*e);k=new E(k.x+(l.x+m.x)*n,k.y+(l.y+m.y)*n);c.push(k);c.push(h);e*=-1;k=h}for(d=2;d<c.length-1;d+=2)e=c[d-1],g=c[d+1],c[d].x=e.x+(g.x-e.x)/2,c[d].y=e.y+(g.y-e.y)/2;return c};c.prototype.ja=function(a){a.beginPath();a.moveTo(this.ma[0].x,this.ma[0].y);for(var b=1;b<this.ma.length-1;b+=2)a.quadraticCurveTo(this.ma[b].x,this.ma[b].y,this.ma[b+1].x,this.ma[b+1].y)};return c}();var S=function(c){function a(b,d){var e=c.call(this,b,d)||this;e.va=[];e.If=0;e.Tc=[];e.Vi=[];e.$o=!1;e.inverse=new M;e.origin=new E(0,0);e.lc=[];e.Jc=new P;e.Gn=!1;e.log=B.create("PATHNODE");e.log("New PathNode Created");e.dc=new Xc(0,d);e.dc.setProperty("text",e.aa.text);e.Ij(a.ya);e.aa.closed=!1;e.aa.commands=[];e.aa.seed=0;return e}p(a,c);a.prototype.moveTo=function(b,d){var e=this.aa.commands;e.push(a.yf);e.push(b);e.push(d)};a.prototype.Wp=function(b,d,e,c,g,h){var f=this.aa.commands;f.push(a.xg);
f.push(g);f.push(h);f.push(b);f.push(d);f.push(e);f.push(c)};a.prototype.type=function(){return"PathNode"};a.prototype.wi=function(){return!0};a.prototype.setProperty=function(a,d){c.prototype.setProperty.call(this,a,d);if("fontName"===a||"fontSize"===a||"text"===a||"wrap"===a)this.dc.setProperty(a,d);else if("textFillStyle"===a)this.dc.setProperty("fillStyle",d);else if("textBackground"===a)this.dc.setProperty("background",d);else if("spotHighlight"===a)this.aa.spotHighlight=d;else if("cloudRadius"===
a||"waveRadius"===a||"doubleLine"===a||"doubleLineDashSide"===a)this.aa[a]=d};a.prototype.Ug=function(b){for(var d=0,e=this.aa.commands,c=b/3|0,g=0;g<c;g++)d+=a.ab[e[d]]+1;g=b%3*2+1;c=e[d+g];d=e[d+g+1];this.log("getEditHandle(%s) = (%s, %s)",b,c,d);return this.Ga().apply(c,d)};a.prototype.ie=function(b,d,e){for(var c=0,g=this.aa.commands,h=b/3|0,k=0;k<h;k++)c+=a.ab[g[c]]+1;h=this.inverse.apply(d,e);k=b%3*2+1;g[c+k]=h.x;g[c+k+1]=h.y;if(0===b&&this.aa.closed){for(b=null;c<g.length;)h=a.ab[g[c]],2<=
h&&(b=c),c+=h+1;b&&(c=b,h=this.inverse.apply(d,e),g[c+1]=h.x,g[c+2]=h.y)}};a.prototype.Tf=function(){return"commands"};a.prototype.it=function(b){for(var d=this.aa.commands,e=0,c=0;c<b/3;c++)e+=a.ab[d[e]]+1;d.splice(e,a.ab[d[e]]+1)};a.prototype.dr=function(){return this.la("arrowXOffset")||this.la("arrowSize")};a.prototype.format=function(b,d){var e=null;this.va.length=0;this.inverse=this.aa.matrix.inverse();new E(0,0);for(var c=this.aa.commands,g=null,h,k,l=this.aa.matrix,n=new fd(this.aa.seed),
m=this.Vi.length=0;m<c.length;){switch(c[m++]){case a.yf:var q=l.apply(c[m++],c[m++]);this.va.push(new Yc(g,q));null===e&&(e=q);this.Vi.push(q);break;case a.Pd:g&&(q=l.apply(c[m++],c[m++]),this.va.push(new Zc(g,q,n,this.aa.sloppiness,this.aa.roundRadius)),this.Vi.push(q));break;case a.Af:g&&(q=l.apply(c[m++],c[m++]),h=l.apply(c[m++],c[m++]),this.va.push(new ad(g,h,q)));break;case a.lj:g&&(q=l.apply(c[m++],c[m++]),h=l.apply(c[m++],c[m++]),k=c[m++],this.va.push(new bd(g,h,q,k)));break;case a.xg:g&&
(q=l.apply(c[m++],c[m++]),h=l.apply(c[m++],c[m++]),k=l.apply(c[m++],c[m++]),this.va.push(new cd(g,h,k,q)));break;case a.im:g&&(q=l.apply(c[m++],c[m++]),h=l.apply(c[m++],c[m++]),k=l.apply(c[m++],c[m++]),this.va.push(new dd(g,h,k,q)));break;case a.Hh:g&&(q=l.apply(c[m++],c[m++]),this.va.push(new $c(g,q,this.aa.smoothness)));break;case a.nj:g&&(q=l.apply(c[m++],c[m++]),h=l.apply(c[m++],c[m++]),this.va.push(new ed(g,h,q,n,this.aa.sloppiness)));break;case a.xc:this.aa.closed=!0;break;default:m++}g=this.va[this.va.length-
1]}this.origin=e||new E(0,0);m=this.va[1];this.aa.closed&&3<=this.va.length&&m.th&&g&&(m.th(g),g.fa=this.origin);this.If=this.va.length;this.Vq(n);this.rect.x=this.origin.x;this.rect.y=this.origin.y;this.rect.width=0;this.rect.height=0;g=this.aa.dashes.split(",");this.lc=[];for(m=0;m<g.length;m++)n=parseFloat(g[m]),isNaN(n)||this.lc.push(n);g=this.lc.length?a.mj:a.ip;this.Jc=this.Jj(!0).El(g);m=0+this.la("shapeWidth");0<m&&(this.Jc=this.pq(this.Jc,m));this.rect=this.Jc.Om(g);m=this.rect.width-2*(this.aa.lineWidth/
2+1);n=this.aa.lineWidth;e=this.Jc.clone();e.transform(this.Te());this.fb=e.Om(g);g=this.Ga().Vg();this.fb.Gc(Math.ceil(n/g.x),Math.ceil(n/g.y));this.rect.Gc(n+1,n+1);8>this.rect.width&&(this.rect.x+=this.rect.width/2-4,this.rect.width=8);8>this.rect.height&&(this.rect.y+=this.rect.height/2-4,this.rect.height=8);""!==this.aa.text&&(g=this.rect.Kf(),this.dc.setProperty("textAlign","centre"),this.dc.setProperty("baseWidth",m),this.dc.format(b,d),this.dc.transform(new L(g.x-this.dc.rect.x-this.dc.rect.width/
2,g.y-this.dc.rect.y-this.dc.Jn/2)),this.dc.format(b,d));this.$o=0===z.Xb(this.aa.fillStyle).values[3];this.Tc.length=0;0<this.aa.angleArcs?this.Tc.push(new Uc(this,this.aa.angleArcs)):0<this.aa.cloudRadius?this.Tc.push(new Vc(this)):0<this.aa.waveRadius?this.Tc.push(new hd(this)):this.aa.doubleLine&&this.Tc.push(new id(this));for(m=0;m<this.Tc.length;m++)this.Tc[m].format(b)};a.prototype.vk=function(){return this.Vi};a.prototype.ri=function(){return this.Jc};a.prototype.Vq=function(a){function b(b,
d){b=b.clone();k&&(b.x+=d.x*g*.5,b.y+=d.y*g*.5);var f=b.x-d.x*g;var l=b.y-d.y*g;var n=f+d.y*c/2;var m=l-d.x*c/2;f+=-d.y*c/2;l+=d.x*c/2;e.va.push(new Yc(e.va[e.va.length-1],new E(f,l)));e.va.push(new $c(e.va[e.va.length-1],b,h));e.va.push(new $c(e.va[e.va.length-1],new E(n,m),h));"solid"===e.aa.arrowStyle&&e.va.push(new Zc(e.va[e.va.length-1],new E(f,l),a,e.aa.smoothness,0))}if(this.Gn=0<this.aa.arrowSize&&!this.aa.closed&&0<this.va.length){var e=this,c=this.aa.arrowSize,g=this.aa.arrowXOffset,h=this.aa.smoothness,
k=this.aa.doubleLine;null===g&&(g=c);var l=this.va[this.va.length-1];b(l.fa,l.Bc());this.aa.doubleArrow&&b(this.va[0].fa,yc(this.va[1].xe()))}};a.prototype.close=function(){this.aa.commands.push(a.xc)};a.prototype.Sp=function(){var a=this.va[this.va.length-1];8>=G(a.fa.x,a.fa.y,this.origin.x,this.origin.y)&&this.close()};a.prototype.pq=function(a,d){this.log("ConvertToRects: width=%s",d);for(var b=0,c=a.ba,g=0,h=0,k,l,n=new P;b<c.length;){this.log("cmd %s %s %s",c[b],c[b+1],c[b+2]);switch(c[b]){case P.pc:g=
c[b+1];h=c[b+2];break;case P.oc:k=c[b+1];l=c[b+2];this.log("(%s,%s-%s,%s)",g,h,k,l);if(0<G(g,h,k,l)){var m=J(g,h,k,l),q=m.y*d/2;m=-m.x*d/2;n.moveTo(g+q,h+m);n.lineTo(k+q,l+m);n.lineTo(k-q,l-m);n.lineTo(g-q,h-m);n.closePath()}g=k;h=l}b+=P.gc[c[b]]}return n};a.prototype.clip=function(a){if(this.aa.closed){this.log("Clipping to a path");for(var b=0;b<this.va.length;b++)this.va[b].ja(a);a.closePath()}};a.prototype.Ce=function(a){if(this.aa.spotHighlight)this.log("Not drawing node %s due to spothighlight",
this.id);else{var b=this.inverse;a.save();a.lineJoin="round";a.transform(b.m11,b.m21,b.m12,b.m22,b.Ca,b.Da);a.beginPath();a.lineCap="round";b=!0;var e;for(e=0;e<this.Tc.length;e++)this.Tc[e].al&&(b=!1);if(b)for(e=0;e<this.va.length;e++)this.va[e].ja(a);for(e=0;e<this.Tc.length;e++)this.Tc[e].ja(a);if(!b&&0<this.aa.arrowSize)for(e=this.If;e<this.va.length;e++)this.va[e].ja(a);this.aa.closed&&(a.closePath(),a.fill(),a.shadowColor="rgba(0,0,0,0.0)");b&&(this.lc.length&&0<this.aa.lineWidth?(a.beginPath(),
this.Jc.hi(a,this.lc),a.lineCap="butt"):0<0+this.la("shapeWidth")&&(a.beginPath(),this.Jc.ja(a)));0<this.aa.lineWidth&&a.stroke();if(this.aa.arrowSize&&"solid"===this.aa.arrowStyle){a.beginPath();for(e=this.If;e<this.va.length;e++)this.va[e].ja(a);a.fillStyle=this.aa.strokeStyle;a.fill()}""!==this.aa.text&&this.dc.ja(a);a.restore()}};a.prototype.gb=function(a,d){if(this.hidden()||this.la("locked"))return null;var b=12+this.aa.shapeWidth/2+this.aa.lineWidth/2;if(a>=this.rect.x-b&&a<this.rect.x+b+this.rect.width&&
d>=this.rect.y-b&&d<this.rect.y+b+this.rect.height)if(this.aa.closed&&!this.$o){if(this.Jc.vo(a,d))return this}else if(this.Jc.Vk(a,d,b)||""!==this.aa.text&&this.dc.gb(a,d))return this;return null};a.prototype.Jj=function(a){var b=new P;if(0<this.aa.arrowSize&&!a)for(a=0;a<this.If;a++)this.va[a].ja(b);else for(a=0;a<this.va.length;a++)this.va[a].ja(b);this.aa.closed&&b.closePath();return b};a.prototype.lineTo=function(b,d){var e=this.aa.commands;e.push(a.Pd);e.push(b);e.push(d)};a.prototype.Lg=function(b,
d){var e=this.aa.commands;e.push(a.Hh);e.push(b);e.push(d)};a.prototype.Xf=function(){return!1!==this.aa.editable&&!0!==this.aa.lockEditMode};a.prototype.ld=function(a,d,e){e*=8;if(a>=this.origin.x-e&&a<this.origin.x+e&&d>=this.origin.y-e&&d<this.origin.y+e)return 0;for(var b=0;b<this.If;b++){var c=this.va[b];if(a>=this.va[b].fa.x-e&&a<this.va[b].fa.x+e&&d>=this.va[b].fa.y-e&&d<this.va[b].fa.y+e)return 3*b;if(c.control){if(a>=c.control.x-e&&a<c.control.x+e&&d>=c.control.y-e&&d<c.control.y+e)return 3*
b+1}else if(c.Aa){if(a>=c.Aa.x-e&&a<c.Aa.x+e&&d>=c.Aa.y-e&&d<c.Aa.y+e)return 3*b+1;if(c.Ja&&a>=c.Ja.x-e&&a<c.Ja.x+e&&d>=c.Ja.y-e&&d<c.Ja.y+e)return 3*b+2}}return null};a.prototype.de=function(b){var d=this.aa.commands;b/=3;var e=0,c=!1,g=0,h;for(h=0;h<d.length;){var k=d[h];if(k===a.xc){c=!0;break}g+=1;h+=a.ab[d[h]]+1}0===b&&c&&(b=g-1);for(h=0;h<d.length;e++){c=null;switch(d[h]){case a.yf:c="move_to";break;case a.Pd:c="line_to";break;case a.Af:c="quadratic_to"}if(b===e)return c;h+=a.ab[d[h]]+1}return null};
a.sp=function(b,d,e){d/=3;var c=0,g=[],h=new E(0,0),k=!1,l=0,n;for(n=0;n<b.length;){var m=b[n];if(m===a.xc){k=!0;break}l+=1;n+=a.ab[b[n]]+1}0===d&&k&&(d=l-1);for(n=0;n<b.length;c++){m=b[n];k=!1;d===c&&(m===a.Af&&"line_to"===e?(g.push(a.Pd,b[n+1],b[n+2]),k=!0):m===a.Pd&&"quadratic_to"===e&&(g.push(a.Af,b[n+1],b[n+2],(h.x+b[n+1])/2,(h.y+b[n+2])/2),k=!0));h=new E(b[n+1],b[n+2]);if(!k)for(m=0;m<1+a.ab[b[n]];m++)g.push(b[n+m]);n+=a.ab[b[n]]+1}return g};a.prototype.Qn=function(){return!0};a.prototype.ii=
function(a,d,e){a.save();a.lineWidth=1*d;a.strokeStyle="#0050B7";a.fillStyle="#0050B7";d*=8;0===e?a.fillRect(this.origin.x-d,this.origin.y-d,2*d,2*d):a.strokeRect(this.origin.x-d,this.origin.y-d,2*d,2*d);for(var b=1;b<this.If;b++){var c=this.va[b];a.beginPath();if(c.control)a.arc(c.control.x,c.control.y,d,0,2*Math.PI),a.arc(c.control.x,c.control.y,2*d,0,2*Math.PI),e===3*b+1?a.fill():a.stroke();else if(c instanceof cd||c instanceof dd){var h=c.Aa;var k=c.Ja;var l=c.pa.fa;h&&(a.moveTo(l.x,l.y),a.lineTo(h.x,
h.y),a.moveTo(h.x+d,h.y),a.arc(h.x,h.y,d,0,2*Math.PI),e===3*b+1?a.fill():a.stroke());a.beginPath();a.moveTo(c.fa.x,c.fa.y);a.lineTo(k.x,k.y);a.moveTo(k.x+d,k.y);a.arc(k.x,k.y,d,0,2*Math.PI);e===3*b+2?a.fill():a.stroke()}e===3*b?a.fillRect(this.va[b].fa.x-d,this.va[b].fa.y-d,2*d,2*d):a.strokeRect(this.va[b].fa.x-d,this.va[b].fa.y-d,2*d,2*d)}a.restore()};a.mp=function(a){var b=new U,e=0;for(a=a.ba;e<a.length;){switch(a[e]){case P.pc:b.moveTo(a[e+1],a[e+2]);break;case P.oc:b.lineTo(a[e+1],a[e+2]);break;
case P.xf:b.bezierCurveTo(a[e+1],a[e+2],a[e+3],a[e+4],a[e+5],a[e+6]);break;case P.zf:b.quadraticCurveTo(a[e+1],a[e+2],a[e+3],a[e+4]);break;case P.xc:b.close()}e+=P.gc[a[e]]}return b.ec()};a.ya={strokeStyle:"#000000",fillStyle:"#ffffff",textFillStyle:"#000000",fontName:"Arial",fontSize:20,lineWidth:2,dashes:"",shapeWidth:0,smoothness:.3,sloppiness:0,shadow:!1,closed:!1,arrowSize:0,arrowXOffset:null,arrowStyle:"simple",doubleArrow:!1,text:"",roundRadius:0,wrap:!1,angleArcs:0};a.ip=8;a.mj=2;a.yf=0;a.Pd=
1;a.Af=2;a.lj=3;a.xg=4;a.Hh=5;a.nj=6;a.xc=7;a.im=8;a.Lu=.5522847498;a.ab=[];return a}(R);S.ab[S.yf]=2;S.ab[S.Pd]=2;S.ab[S.Af]=4;S.ab[S.lj]=5;S.ab[S.xg]=6;S.ab[S.Hh]=2;S.ab[S.nj]=4;S.ab[S.xc]=0;S.ab[S.im]=6;
var U=function(){function c(a){void 0===a&&(a=[]);this.ba=a}c.prototype.beginPath=function(){};c.prototype.fd=function(a,b,d){for(var e=0,c=0;c<a;c++)e+=S.ab[this.ba[e]]+1;this.ba[e+1]=b;this.ba[e+2]=d};c.prototype.moveTo=function(a,b){this.ba.push(S.yf);this.ba.push(a);this.ba.push(b)};c.prototype.lineTo=function(a,b){this.ba.push(S.Pd);this.ba.push(a);this.ba.push(b)};c.prototype.Lg=function(a,b){this.ba.push(S.Hh);this.ba.push(a);this.ba.push(b)};c.prototype.quadraticCurveTo=function(a,b,d,e){this.ba.push(S.Af);
this.ba.push(d);this.ba.push(e);this.ba.push(a);this.ba.push(b)};c.prototype.Me=function(a,b,d,e){this.ba.push(S.nj);this.ba.push(d);this.ba.push(e);this.ba.push(a);this.ba.push(b)};c.prototype.bezierCurveTo=function(a,b,d,e,c,g){this.ba.push(S.xg);this.ba.push(c);this.ba.push(g);this.ba.push(a);this.ba.push(b);this.ba.push(d);this.ba.push(e)};c.prototype.arcTo=function(a,b,d,e,c){this.ba.push(S.lj);this.ba.push(d);this.ba.push(e);this.ba.push(a);this.ba.push(b);this.ba.push(c)};c.prototype.sn=function(){for(var a=
[],b=0;b<this.ba.length;){for(var d=this.ba[b],e=0;e<S.ab[d];e+=2)a.push(new E(this.ba[b+1+e],this.ba[b+1+e+1]));b+=S.ab[d]+1}a=K.ze(a);return{x:a.x,y:a.y,width:a.width,height:a.height}};c.prototype.translate=function(a,b){for(var d=0;d<this.ba.length;){for(var e=this.ba[d],c=0;c<S.ab[e];c+=2)this.ba[d+1+c]+=a,this.ba[d+2+c]+=b;d+=S.ab[e]+1}};c.prototype.closePath=function(){this.ba.push(S.xc)};c.prototype.close=function(){this.closePath()};c.prototype.ec=function(){return this.ba};return c}();
U.prototype.change=U.prototype.fd;U.prototype.moveTo=U.prototype.moveTo;U.prototype.lineTo=U.prototype.lineTo;U.prototype.curveTo=U.prototype.Lg;U.prototype.quadraticCurveTo=U.prototype.quadraticCurveTo;U.prototype.cornerTo=U.prototype.Me;U.prototype.bezierCurveTo=U.prototype.bezierCurveTo;U.prototype.arcTo=U.prototype.arcTo;U.prototype.getBoundingBox=U.prototype.sn;U.prototype.translate=U.prototype.translate;U.prototype.closePath=U.prototype.closePath;U.prototype.close=U.prototype.close;
U.prototype.toArray=U.prototype.ec;function jd(){var c=new E(0,0),a=new U;a.moveTo(c.x,c.y-50);a.Me(c.x+50,c.y-50,c.x+50,c.y);a.Me(c.x+50,c.y+50,c.x,c.y+50);a.Me(c.x-50,c.y+50,c.x-50,c.y);a.Me(c.x-50,c.y-50,c.x,c.y-50);a.closePath();return a.ec()}R.Sc("PathNode",S);U.prototype.beginPath=U.prototype.beginPath;U.prototype.change=U.prototype.fd;U.prototype.moveTo=U.prototype.moveTo;U.prototype.lineTo=U.prototype.lineTo;U.prototype.curveTo=U.prototype.Lg;U.prototype.quadraticTo=U.prototype.gv;
U.prototype.cornerTo=U.prototype.Me;U.prototype.bezierTo=U.prototype.Wp;U.prototype.arcTo=U.prototype.arcTo;U.prototype.getBoundingBox=U.prototype.sn;U.prototype.translate=U.prototype.translate;U.prototype.closePath=U.prototype.closePath;U.prototype.close=U.prototype.close;U.prototype.toArray=U.prototype.ec;var id=function(){function c(a){this.bc=a;this.vc=0;this.al=!0;this.vi=!1;this.path=new P;this.Ji=new P;this.log=B.create("DoubleLineAddon")}c.prototype.format=function(){this.log("Formatting doubleline; thickness=%s",this.bc.la("doubleLine"));var a=this.bc.Jj(!1).El(S.mj),b=this.bc.dr();if(0<b){var d=a.Yp();d>b&&(a=a.Zp(d-b))}a=a.Md();b=this.bc.la("doubleLine");this.path=new P;this.Ji=new P;d=this.bc.la("doubleLineDashSide");this.vi=!1;"outer"===d?(Nc(this.path,a,b,"middle",!0,!1),Nc(this.Ji,a,b,
"middle",!1,!0),this.vi=!0):"inner"===d?(Nc(this.path,a,b,"middle",!1,!0),Nc(this.Ji,a,b,"middle",!0,!1),this.vi=!0):Nc(this.path,a,b,"middle",!0,!0)};c.prototype.ja=function(a){a.beginPath();this.bc.lc.length&&this.vi?(this.Ji.hi(a,this.bc.lc),this.path.ja(a)):this.bc.lc.length?this.path.hi(a,this.bc.lc):this.path.ja(a)};return c}();var kd=function(c){function a(){var a=c.call(this)||this;a.jg=[];a.Ge=!1;a.canvas=null;a.log=B.create("FORMAT",!0);return a}p(a,c);a.prototype.add=function(a,d,e,c,g){var b;var f=this.jg;var l=0;for(b=f.length;l<b;l++){var n=f[l];n.type===d&&n.Kk===a&&(n.Ui=!0)}this.log("Request URL %s",e);this.jg.push({Kk:a,type:d,url:e,ev:c||{},Qm:g,Ui:!1});this.check()};a.prototype.check=function(){for(var a=0;!this.Ge&&a<this.jg.length;)this.jg[a].Ui?this.jg.shift():(this.Cp(this.jg[0]),a+=1);this.Ge||this.ua("done")};
a.prototype.Cp=function(a){var b=this;b.Ge=!0;b.log("Processing request for item %s url=%s",a.Kk,a.url);if(0===a.type.indexOf("image")){var e=0<=a.url.indexOf("svg+xml");Nb.load(a.url,function(d,c){if(null!==d){b.log("Image request completed for item %s url %s",a.Kk,c);if(e){b.log("Doing double-copy to eliminate SVG");var f=document.createElement("canvas");f.width=d.naturalWidth;f.height=d.naturalHeight;f.getContext("2d").drawImage(d,0,0);Nb.load(f.toDataURL(),function(d,e){null!==d?(b.log("SVG elimination succeeded; url=%s",
e.substr(0,20)),a.Qm(d,e)):b.log("Image conversion from SVG failed.");b.Ge=!1;a.Ui=!0;b.check()});return}a.Qm(d,c)}else b.log("Image request failed for url %s",c);b.Ge=!1;a.Ui=!0;b.check()})}};a.prototype.nq=function(a,d){this.ua("convert-dom-request",a,d)};a.prototype.bl=function(a){this.ua("reformat",a)};a.prototype.lk=function(){return C(this.canvas)};return a}(Hb);var ld=function(c){function a(a,d){var b=c.call(this,a,d)||this;b.children=[];return b}p(a,c);a.prototype.type=function(){return"GroupNode"};a.prototype.clone=function(b){for(var d=new a(b(),this.ha),e=0;e<this.children.length;e++){var c=this.children[e].clone(b);c.parent=d;d.children.push(c)}return d};a.prototype.format=function(a,d){for(var b=0;b<this.children.length;b++)this.children[b].format(a,d),0===b?this.rect=this.children[b].rect.clone():this.rect.Eh(this.children[b].rect)};a.prototype.ja=
function(a){for(var b=0;b<this.children.length;b++)this.children[b].ja(a)};a.prototype.gb=function(a,d){for(var b=this.children.length-1;0<=b;b--){var c=this.children[b].gb(a,d);if(c)return c}return null};a.prototype.gk=function(a){for(var b=0;b<this.children.length;b++)if(a===this.children[b])return b;return-1};return a}(R);R.Sc("GroupNode",ld);var md=function(c){function a(a,d){var b=c.call(this,a,d)||this;b.ma=[];b.lc=[];b.log=B.create("BRUSH",!0);b.log("New BrushNode created.");b.aa.points=[];b.aa.strokeStyle="#ff00ff";b.aa.lineWidth=10;return b}p(a,c);a.prototype.type=function(){return"BrushNode"};a.prototype.setProperty=function(a,d){"fillStyle"===a&&(a="strokeStyle");a in this.aa||"dashes"===a||"lineCap"===a?this.aa[a]=d:c.prototype.setProperty.call(this,a,d)};a.prototype.la=function(a){"fillStyle"===a&&(a="strokeStyle");return c.prototype.la.call(this,
a)};a.prototype.format=function(){var a,d;this.ma.length=0;var e=this.aa.points;var c=a=0;for(d=e.length-1;a<=d;c=a+=2)this.ma.push(new E(e[c],e[c+1]));c=K.ze(this.ma);e=this.Ga().Vg();a=this.aa.lineWidth;c.Gc(a/e.x,a/e.y);this.fb=c.clone();c=new Q(c);c.transform(this.aa.matrix);this.rect=K.ze(c.ma);this.lc=[];if("dashes"in this.aa)for(e=this.aa.dashes.split(","),c=0;c<e.length;c++)a=parseFloat(e[c]),isNaN(a)||this.lc.push(a);this.log("Format brushnode")};a.prototype.gb=function(a,d){if(this.rect.Uc(a,
d)){var b=this.Te().apply(a,d);if(Gc(this.ma,b.x,b.y,12+this.aa.lineWidth/2))return this}return null};a.prototype.Ce=function(b){var d=this.aa.points;if(0!==d.length){b.save();b.beginPath();var e=this.la("lineCap")||"round";b.lineCap=e;b.lineJoin="round"===e?"round":"bevel";if(1<this.lc.length){e=this.ma;var c=this.lc;if(0!==e.length){b.moveTo(e[0].x,e[0].y);var g=0;for(var h=1,k=c[0],l=e[0].clone(),n;h<e.length;)n=l.Oa(e[h]),0===n?h+=1:n<=k?(l=e[h].clone(),g&1?b.moveTo(l.x,l.y):b.lineTo(l.x,l.y),
k-=n,h+=1):(l.x+=(e[h].x-l.x)*k/n,l.y+=(e[h].y-l.y)*k/n,g&1?b.moveTo(l.x,l.y):b.lineTo(l.x,l.y),g=(g+1)%c.length,k=c[g])}}else for(b.moveTo(d[0],d[1]),e=c=2,g=d.length-1;c<=g;e=c+=2)b.lineTo(d[e],d[e+1]);this.Te().dj(b);nc(b,this.aa.strokeStyle);if(a.rp){this.Ga().dj(b);b.beginPath();e=c=0;for(g=d.length-1;c<=g;e=c+=2)b.rect(d[e]-2,d[e+1]-2,4,4);b.fillStyle="#ff0000";b.fill()}b.restore()}};a.rp=!1;return a}(R);R.Sc("BrushNode",md);function nd(c){c=c.replace(/\+/g," ");return decodeURIComponent(c)}function od(){if(void 0===c)var c=window.location.hash;0===c.indexOf("#/")&&(c="#"+c.substr(2));var a=c,b;c={};var d=a.indexOf("#");0<=d&&(a=a.substr(d+1));d=a.indexOf("#");0<=d&&(a=a.substr(0,d));a=a.split("&");d=0;for(b=a.length;d<b;d++){var e=a[d];var f=e.split("=");e=nd(f[0]);f=1<f.length?nd(f[1]):"";e.length&&(c[e]=f)}return c};var pd=function(){if(!document.getElementsByTagName)return"";var c=document.getElementsByTagName("script");if(0===c.length)return"";c=c[c.length-1];return void 0!==c.getAttribute.length?c.src:c.getAttribute("src")||""}(),qd=function(c){function a(a){var b=c.call(this)||this;b.options={angleArcs:0,allowSelectBox:"auto",allowResize:!0,allowTextInShape:!0,allowPointerEvents:!0,allowZoom:!0,autoPickTool:!0,autoPickToolText:!0,autoSnap:0,background:"clear",backgroundImage:null,clickToDrawShapes:!1,colourPicker:"wheel",
colourPalette:"auto",debug:!1,defaultArrowStyle:"simple",defaultArrowSize:15,defaultArrowXOffset:null,defaultItalic:!1,defaultBold:!1,defaultBrushColour:"#000000",defaultBrushWidth:10,defaultFillStyle:"#e0e0e0",defaultFont:"Arial",defaultFontSize:20,defaultLineWidth:2,defaultPaperSize:"none",defaultRoundRectRadius:10,defaultSmoothness:"smooth",defaultStrokeStyle:"#000000",defaultText:"Lorum ipsum dolor",defaultTextBackground:"rgba(0,0,0,0.0)",defaultTextFillStyle:"#000000",defaultTextStrokeStyle:"#000000",
defaultTextLineWidth:0,defaultZoom:1,drawCircleStyle:"box",drawShapeStyle:"box",fonts:["Arial","Times New Roman"],gridBlocks:10,gridSpacing:20,gridColour:"#cccccc",imageFolder:"$SCRIPT",iPadNoScrollText:!1,keyBringToFront:"Home",keyCancel:"ESC",keyCopy:"Ctrl+C,\u2318+C",keyCurveTool:"C",keyCut:"Ctrl+X,\u2318+X,Shift+Delete",keyDelete:"Delete,Backspace",keyDown:"Down,Ctrl+Down",keyDuplicate:"Ctrl+D",keyEnter:"Enter",keyGroup:"Ctrl+G",keyLeft:"Left,Ctrl+Left",keyLineTool:"L",keyMoveDown:"PageDown",
keyMoveUp:"PageUp",keyNext:"Down,Right",keyNextPage:"Shift+PageDown",keyPaste:"Ctrl+V,\u2318+V,Shift+Insert",keyPrevious:"Left,Up",keyPreviousPage:"Shift+Pageup",keyRedo:"Ctrl+Shift+Z",keyRight:"Right,Ctrl+Right",keySelectNone:"ESC",keySelectAll:"Ctrl+A",keySendToBack:"End",keyUndo:"Ctrl+Z",keyUngroup:"Ctrl+Shift+G",keyUp:"Up,Ctrl+Up",keyZoomIn:"+,Shift+=",keyZoomNormal:"=",keyZoomOut:"-",keyZoomToPage:"F4",keyZoomToWidth:"Shift+F4",language:"en",leaveTextToolOnBlur:!1,maximumZoom:0,minimumZoom:0,
multilineText:!1,nudge:10,outsidePageColour:"#808080",pagePlacement:"centre",pageSelectorDiv:"",pageBorderColour:"rbga(0,0,0,0.0)",pageInflation:20,pageShadow:!0,pageView:!1,pasteOffset:10,pasteOffsetX:0,pasteOffsetY:0,persistent:!1,preciseNudge:1,readOnly:!1,scrollbars:!0,setFocus:!0,showArrowTool:!0,showBackgroundSelector:!1,showBrushTool:!0,showCircleTool:!0,showColourPanel:!0,showCopyPaste:!0,showCurveTool:!0,showDebug:!1,showFontNameProperty:!0,showFontSizeProperty:!0,showHints:!0,showImageSelector:!1,
showImageTool:!1,showKeyboardHelp:!0,showLineTool:!0,showMathTool:!1,showMoveToFrontBack:!1,showPageSelector:!1,showPageSelectorControls:!0,showPickTool:!0,showPropertyPanel:!1,showRoundRectTool:!1,showShapeBrushTool:!1,showSloppinessProperty:!0,showSmoothnessProperty:!0,showSquareTool:!0,showTextTool:!0,showToolbar:!0,showUndoRedo:!0,simulateGestures:!1,singleStrokeBrush:!1,sloppy:!1,snap:0,spotHighlightColour:"rgba(0,0,0,0.2)",spotHighlightZIndex:0,symmetry:0,textMode:"interactive",toolbarButtonSize:50,
useTouch:"auto",enableArrowKeysNudge:!1,showMenu:!1};b.log=B.create("CONFIG");for(var e in a)e in b.options||alert("Zwibbler: Unknown option '"+e+"'"),b.set(e,a[e],!0);C(window).xa("hashchange",function(){b.log("Reload parameters from url hash");b.Xn()});b.Xn();""===b.An()?(b.Dd=b.options.imageFolder.replace("$SCRIPT/",""),b.Dd=b.Dd.replace("$SCRIPT","")):b.Dd=b.options.imageFolder.replace("$SCRIPT",b.An());""!==b.Dd&&"/"!==b.Dd[b.Dd.length-1]&&(b.Dd+="/");"auto"===b.options.useTouch&&b.log("Detected touch support: %s",
"ontouchstart"in window||"onmsgesturechange"in window);for(var f in b.options)b.log("%s=%s",f,b.options[f]);return b}p(a,c);a.prototype.Xn=function(){var a=od(),d;for(d in a)this.set(d,a[d])};a.prototype.set=function(a,d,e){void 0===e&&(e=!1);if(!(a in this.options))return this.log("Error: %s is not a configuration option.",a),!1;if("defaultZoom"===a){if("page"!==d&&"width"!==d&&!r(d)&&(d=parseFloat(d),isNaN(d)))return this.log("Error: Config option %s must be a number or 'page' or 'width'",a),!1}else if("allowSelectBox"!==
a)if("colourPalette"===a)"auto"!==d&&"string"===typeof d&&(d=z.Qs(d));else if("string"===typeof d)if("number"===typeof this.options[a]){if(d=parseFloat(d),isNaN(d))return this.log("Error: Config option %s expects a number",a),!1}else"boolean"===typeof this.options[a]&&(d="1"===d||"true"===d||""===d);this.log("Set config %s=%s",a,d);this.options[a]=d;e||(this.Oe("update",a,d),this.Oe(a,d,!1));return!0};a.prototype.xa=function(a,d){d(a,this.options[a],!0);return c.prototype.xa.call(this,a,d)};a.prototype.An=
function(){var a=pd;var d=a.lastIndexOf("/");return a=0<=d?a.substr(0,d+1):""};a.prototype.Kt=function(){return this.options.showBrushTool};a.prototype.Uo=function(){return this.options.showPropertyPanel};a.prototype.Lt=function(){return this.options.showColourPanel};a.prototype.qg=function(){return this.options.showDebug};a.prototype.Ot=function(){return this.options.showToolbar};a.prototype.Ha=function(a){return this.options[a]};a.prototype.get=function(a){return this.Ha(a)};a.prototype.vd=function(){return"auto"===
this.options.useTouch?"ontouchstart"in window||"onmsgesturechange"in window:this.options.useTouch};a.prototype.br=function(){if("auto"===this.options.allowSelectBox){var a=this.vd(),d=document.documentElement.offsetHeight,e=window.innerHeight,c=!a||a&&0<e-d+50;this.log("Allowing select box: %s (useTouch=%s, documentHeight=%s, windowHeight=%s)",c,a,d,e);return c}return this.options.allowSelectBox};a.prototype.lr=function(){var a=(""+this.options.defaultSmoothness).toLowerCase();return"sharpest"===
a?0:"sharper"===a?.1:"sharp"===a?.2:"smoothest"===a?.5:.3};a.prototype.sb=function(a){return 0===a.indexOf("http:")||0===a.indexOf("https:")||0===a.indexOf("/")?a:this.Dd+a};a.prototype.nk=function(a){a=this.get(a);return void 0!==a.className?a:""!==a&&C(a).length?C(a)[0]:null};a.prototype.Pp=function(a){for(var b in this.options)if(this.options.hasOwnProperty(b)&&0===b.indexOf("key")){for(var e="",c=0;c<b.length;c++){var g=b.charAt(c);e=g===g.toUpperCase()?e+("-"+g.toLowerCase()):e+g}a.map(this.options[b],
e.substr(4))}};a.prototype.wn=function(){return"radial"===this.get("drawCircleStyle")||"radial"===this.get("drawShapeStyle")?"circle":"rectangle"};a.prototype.cl=function(a){var b=a;0<this.options.maximumZoom&&(a=Math.min(a,this.options.maximumZoom));0<this.options.minimumZoom&&(a=Math.max(a,this.options.minimumZoom));a!==b&&this.log("Zoom restricted to %s",a);return a};return a}(Hb);var rd=function(c){function a(a,d,e){var b=c.call(this)||this;b.da=a;b.language=d;b.xb=e;b.Mi=[];b.Ni={};b.view=null;b.ra=[];b.onclick=null;b.log=B.create("PROP");lb(b.ia,"PropertyPanel");b.Sm=vb.isSupported()&&"wheel"===a.get("colourPicker");b.Sm||b.log("ColourWheel not supported in this canvas.");b.ia.ea("background","#ffffff");b.ia.ea("border","none");b.ia.ea("font-family","tahoma,arial,helvetica,sans");b.ia.ea("color","#4fa0d3");b.ia.ea("font-weight","bold");b.ia.ea("font-size","10pt");b.ia.ea("overflow-y",
"scroll");b.ia.click(function(){b.log("PropertyPanel clicked.");b.ua("click")});return b}p(a,c);a.prototype.xa=function(a,d){if("click"===a)this.onclick=d;else throw Error("This object only handles the click event");};a.prototype.ua=function(){if(this.onclick)this.onclick()};a.prototype.ns=function(a){this.Mi.length=0;this.Ni={};this.ra=a.concat();for(var b=!1,e=0;e<a.length;e++){var c=a[e];c.yk()&&(b=!0);var g=c.tc(),h;for(h in g)g.hasOwnProperty(h)&&this.ms(h,c)}this.rq();this.da.get("showKeyboardHelp")&&
this.Nt(a,b)};a.prototype.Nt=function(a,d){var b=lb(C("<div>"),"keydiv");b.ea("font-size","8pt");b.ea("color","#909090");b.ea("font-weight","normal");C(this.ia).append(b);var c=this.language.fn();b.append("<h1>"+c("keyboard")+"</h1>");var g=[{key:this.da.get("keyCurveTool"),description:c("draw-curves")},{key:this.da.get("keyLineTool"),description:c("draw-lines")}];0<a.length&&g.push({key:this.da.get("keyDelete"),description:c("delete-selection")},{key:this.da.get("keyDuplicate"),description:c("duplicate-selection")},
{key:this.da.get("keyMoveUp"),description:c("move-selection-closer")},{key:this.da.get("keyMoveDown"),description:c("move-selection-away")});1<a.length&&g.push({key:this.da.get("keyGroup"),description:c("group-selection")});d&&g.push({key:this.da.get("keyUngroup"),description:c("break-apart-group")});g.push({key:this.da.get("keyZoomIn"),description:c("zoom-in")});g.push({key:this.da.get("keyZoomOut"),description:c("zoom-out")});g.push({key:c("arrow-keys"),description:c("move-while-zoomed")});for(c=
0;c<g.length;c++){var h=lb(C("<a>").text(g[c].key),"key");h.ea("background","#d0d0d0");h.ea("border-left","1px solid #808080");h.ea("border-right","1px solid #e0e0e0");h.ea("border-top","1px solid #808080");h.ea("border-bottom","1px solid #e0e0e0");h.ea("padding-left","0.5em");h.ea("padding-right","0.5em");h.ea("margin-right","1em");h.ea("color","#4fa0d3");h.ea("font-weight","bold");h=C("<p>").append(h);h[0].appendChild(document.createTextNode(g[c].description));b.append(h)}};a.prototype.uq=function(a,
d){var b=this.language.fn();if("strokeStyle"===d)return{name:d,type:"colour",display:b("outline-colour")};if("fillStyle"===d)return{name:d,type:"colour",display:b("fill-colour")};if("lineWidth"===d){var c=[{name:b("thickness-pencil"),value:1},{name:b("thickness-pen"),value:2},{name:b("thickness-marker"),value:4},{name:b("thickness-brush"),value:10}];!0!==a.la("closed")&&"TextNode"!==a.type()||c.unshift({name:b("none"),value:0});return{name:d,display:b("outline-thickness"),type:"select",values:c}}if("sloppiness"===
d)return{name:"sloppiness",display:b("sloppiness"),type:"select",values:[{name:b("sloppiness-draftsman"),value:0},{name:b("sloppiness-artist"),value:.25},{name:b("sloppiness-cartoonist"),value:.5},{name:b("sloppiness-child"),value:1},{name:b("sloppiness-drunk"),value:2}]};if("smoothness"===d)return{name:"smoothness",display:b("smoothness"),type:"select",values:[{name:b("smoothness-sharpest"),value:0},{name:b("smoothness-sharper"),value:.1},{name:b("smoothness-sharp"),value:.2},{name:b("smoothness-smooth"),
value:.3},{name:b("smoothness-smoothest"),value:.5}]};if("shadow"===d)return{name:"shadow",display:b("shadow"),type:"select",values:[{name:b("yes"),value:!0},{name:b("no"),value:!1}]};if("dashes"===d)return{name:"dashes",display:b("line-style"),type:"select",values:[{name:b("line-style-solid"),value:""},{name:b("line-style-short-dashes"),value:"5,5"},{name:b("line-style-long-dashes"),value:"10,5"}]};if("matrix"===d||"inverse"===d||"closed"===d||"commands"===d||"seed"===d)return{name:d,type:"none"};
if("text"===d)return{name:"text",display:b("text"),type:"textarea"};if("textFillStyle"===d)return{name:"textFillStyle",display:b("text-colour"),type:"colour"};if("fontSize"===d)return{name:"fontSize",display:b("font-size"),type:"select",values:[{name:"10",value:10},{name:"12",value:12},{name:"15",value:15},{name:"20",value:20},{name:"30",value:30},{name:"40",value:40},{name:"50",value:50},{name:"60",value:60},{name:"100",value:100}]};if("fontName"===d){var g=[],h=this.da.Ha("fonts");for(c=0;c<h.length;c++)g.push({name:h[c],
value:h[c]});return{name:"fontName",display:b("font"),type:"select",values:g}}return"arrowSize"===d?{name:"arrowSize",display:b("arrowhead-size"),type:"select",values:[{name:b("arrowhead-size-none"),value:0},{name:b("arrowhead-size-tiny"),value:10},{name:b("arrowhead-size-small"),value:15},{name:b("arrowhead-size-medium"),value:20},{name:b("arrowhead-size-large"),value:30}]}:"arrowStyle"===d?{name:"arrowStyle",display:b("arrowhead-style"),type:"select",values:[{name:b("arrowhead-style-simple"),value:"simple"},
{name:b("arrowhead-style-solid"),value:"solid"}]}:"doubleArrow"===d?{name:"doubleArrow",display:b("double-arrows"),type:"select",values:[{name:b("no"),value:!1},{name:b("yes"),value:!0}]}:"url"===d?{name:"url",display:b("image-url"),type:"text"}:"rows"===d?{name:d,display:"Rows",type:"text"}:"columns"===d?{name:d,display:"Columns",type:"text"}:{name:d,display:"Display-"+d,type:"text"}};a.prototype.ms=function(a,d){var b=this.da;a in this.Ni?(b=this.Ni[a],b.value!==d.la(a)&&(b.value=null)):"locked"===
a||"points"===a||!0===d.la("closed")&&("arrowSize"===a||"arrowStyle"===a||"doubleArrow"===a)||!1===d.la("closed")&&("fontName"===a||"fontSize"===a||"textFillStyle"===a||"text"===a||"fillStyle"===a)||"ImageNode"===d.type()&&("fillStyle"===a||"strokeStyle"===a||"lineWidth"===a||"shadow"===a)||"BrushNode"===d.type()&&"fillStyle"===a||"TextNode"===d.type()&&"fillStyle"===a||"lockSize"===a||"lockRotate"===a||"rotateAround"===a||"layer"===a||0===a.indexOf("cell-")||"fontName"===a&&!b.get("showFontNameProperty")||
"fontSize"===a&&!b.get("showFontSizeProperty")||"smoothness"===a&&!b.get("showSmoothnessProperty")||"sloppiness"===a&&!b.get("showSloppinessProperty")||(b={Yk:this.uq(d,a),value:d.la(a)},b.Yk.display&&0===b.Yk.display.indexOf("Display-")||(this.Mi.push(b),this.Ni[a]=b))};a.prototype.rq=function(){function a(){h.Bu(this)}function d(){var a=this;"timer"in a&&clearTimeout(a.timer);a.timer=setTimeout(function(){h.apply(a.uc.name,a.value)},250)}function c(a){13===a.keyCode&&h.apply(this.uc.name,this.value)}
function f(){var a=parseInt(this.value,10);this.uc&&this.uc.values&&h.apply(this.uc.name,this.uc.values[a].value)}C(this.ia).empty();var g,h=this;for(g=0;g<this.Mi.length;g++){var k=this.Mi[g],l=k.Yk;if("none"!==l.type){var n=document.createElement("div");var m=document.createElement("span");m.appendChild(document.createTextNode(l.display||l.name));n.appendChild(m);n.appendChild(document.createElement("br"));if("select"===l.type){var q=document.createElement("select");for(m=0;m<l.values.length;m++){var u=
l.values[m],v=document.createElement("option");v.appendChild(document.createTextNode(u.name));v.setAttribute("value",m.toString());u.value===k.value&&v.setAttribute("selected","");q.appendChild(v)}q.uc=l;q.onchange=f;n.appendChild(q)}else if("colour"===l.type)m=document.createElement("input"),m.setAttribute("type","text"),m.value=k.value,m.uc=l,jb(C(m),c),n.appendChild(m),k=document.createElement("img"),k.src=this.da.sb("wd-wheel.png"),k.style.verticalAlign="middle",k.input=m,n.appendChild(k),C(k).click(a);
else if("text"===l.type)m=document.createElement("input"),m.setAttribute("type","text"),m.value=k.value,m.uc=l,jb(C(m),c),n.appendChild(m);else if("textarea"===l.type)m=document.createElement("textarea"),m.setAttribute("rows","3"),m.setAttribute("cols","20"),m.value=k.value,m.uc=l,jb(C(m),d),n.appendChild(m);else if("button"===l.type)m=document.createElement("input"),m.setAttribute("type","button"),m.value="Edit",m.uc=l,n.appendChild(m);else throw"Error: No such property";this.ia.append(C(n))}}};
a.prototype.apply=function(a,d){this.view.setProperty(a,d)};a.prototype.Bu=function(a){if(!a.Hn){var b="#000000 #ffffff #000088 #008800 #008888 #880000 #880088 #884400 #888888 #444444 #0000ff #00ff00 #00ffff #ff0000 #ff00ff #ffff00".split(" "),c=this;if(this.Sm){b=document.createElement("div");var f=new vb(b,120);f.Mo(a.input.value);f.Sk=function(b){c.Nj(b,a.input,a.input.uc)};a.Au=f;a.Hn=!0;a.parentNode.appendChild(b)}else{f=this.da.get("colourPalette");"auto"===f&&(f=b);b=new oc(C(a.parentNode),
20,!1,!0,f);b.ia.ea("position","static");a.Au=b;a.Hn=!0;a.parentNode.appendChild(b.ia[0]);var g=Lb(c.xb);b.xa("colour",function(b){c.Nj(b,a.input,a.input.uc);b=z.Xb(b).values[3];g.ql(Math.round(100*b))});g.min="0";g.max="100";var h=z.Xb(a.input.value);g.ql(Math.round(100*h.values[3]));g.onchange=function(){h=z.Xb(a.input.value);h.values[3]=g.Cn()/100;c.Nj(h.toString(),a.input,a.input.uc)};a.parentNode.appendChild(document.createElement("br"));a.parentNode.appendChild(g)}}};a.prototype.Nj=function(a,
d,c){this.view.setProperty(c.name,a);d.value=a};return a}(rb);var sd=function(){function c(a,b){void 0===b&&(b="repeat");this.qa=a;this.repeat=b}c.prototype.loaded=function(){return this.qa instanceof HTMLImageElement?this.qa.complete:!0};c.prototype.setTransform=function(){};return c}(),td=function(){function c(a,b,d,c){this.Yt=[];this.from=new E(a,b);this.fa=new E(d,c)}c.prototype.addColorStop=function(a,b){this.Yt.push({offset:a,Ke:b})};return c}(),ud=function(){function c(){this.stack=[];this.sa=new M;this.lineCap="butt";this.lineJoin="miter";this.lineWidth=
1;this.strokeStyle=this.fillStyle="#000000";this.textBaseline="top";this.font="10px arial";this.globalCompositeOperation="source-over";this.globalAlpha=1;this.shadowBlur=this.shadowOffsetY=this.shadowOffsetX=0;this.shadowColor="rgba(0,0,0,0)"}c.prototype.save=function(){this.stack.push({sa:this.sa.clone(),fillStyle:this.fillStyle,font:this.font,lineJoin:this.lineJoin,lineCap:this.lineCap,lineWidth:this.lineWidth,strokeStyle:this.strokeStyle,textBaseline:this.textBaseline,globalCompositeOperation:this.globalCompositeOperation,
globalAlpha:this.globalAlpha,shadowOffsetX:this.shadowOffsetX,shadowOffsetY:this.shadowOffsetY,shadowBlur:this.shadowBlur,shadowColor:this.shadowColor})};c.prototype.restore=function(){var a=this.stack.pop();a&&(this.sa=a.sa,this.fillStyle=a.fillStyle,this.font=a.font,this.lineJoin=a.lineJoin,this.lineCap=a.lineCap,this.lineWidth=a.lineWidth,this.sa=a.sa,this.strokeStyle=a.strokeStyle,this.textBaseline=a.textBaseline,this.globalCompositeOperation=a.globalCompositeOperation,this.globalAlpha=a.globalAlpha,
this.shadowOffsetX=a.shadowOffsetX,this.shadowOffsetY=a.shadowOffsetY,this.shadowBlur=a.shadowBlur,this.shadowColor=a.shadowColor)};c.prototype.drawImage=function(a,b,d,c,f,g,h,k,l){var e=a.width,m=a.height,q=0,u=e,v=m;void 0!==c&&void 0!==f&&void 0!==g&&void 0!==h&&void 0!==k&&void 0!==l?(q=b,0-d,u=c,v=f,b=g,d=h,e=k,m=l):void 0!==c&&void 0!==f&&(e=c,m=f);this.om(a,q,0,u,v,b,d,e,m)};c.prototype.beginPath=function(){};c.prototype.closePath=function(){};c.prototype.arc=function(a,b,d,c,f,g){g&&(g=c,
c=f,f=g);for(;0>c;)c+=2*Math.PI;for(;0>f;)f+=2*Math.PI;c>f&&(c-=2*Math.PI);var e=2*Math.PI;var k=c%e;var l=f%e;l===k&&(l+=2*Math.PI);f=[];c=Math.PI/2;g=k<l?1:-1;var n=k;for(e=Math.min(e,Math.abs(l-k));1E-5<e;){k=n+g*Math.min(e,c);var m=(k-n)/2,q=d*Math.cos(m),u=d*Math.sin(m),v=.5522847498*Math.tan(m);l=q+v*u;q=-u+v*q;u=-q;v=m+n;m=Math.cos(v);v=Math.sin(v);f.push({Pc:d*Math.cos(n),Qc:d*Math.sin(n),Nd:l*m-q*v,Od:l*v+q*m,Du:l*m-u*v,Fu:l*v+u*m,Eu:d*Math.cos(k),Gu:d*Math.sin(k)});e-=Math.abs(k-n);n=k}for(d=
0;d<f.length;d++)c=f[d],0===d&&this.moveTo(c.Pc+a,c.Qc+b),this.bezierCurveTo(c.Nd+a,c.Od+b,c.Du+a,c.Fu+b,c.Eu+a,c.Gu+b)};c.prototype.arcTo=function(){};c.prototype.strokeRect=function(a,b,d,c){this.beginPath();this.rect(a,b,d,c);this.stroke()};c.prototype.setTransform=function(a,b,d,c,f,g){this.sa=new M(a,d,b,c,f,g)};c.prototype.transform=function(a,b,d,c,f,g){a=new M(a,d,b,c,f,g);this.sa=this.sa.multiply(a)};c.prototype.translate=function(a,b){this.transform(1,0,0,1,a,b)};c.prototype.scale=function(a,
b){this.transform(a,0,0,b,0,0)};c.prototype.rotate=function(a){var b=Math.cos(a);a=Math.sin(a);this.transform(b,a,-a,b,0,0)};c.prototype.rect=function(a,b,d,c){this.beginPath();this.moveTo(a,b);this.lineTo(a+d,b);this.lineTo(a+d,b+c);this.lineTo(a,b+c);this.lineTo(a,b);this.closePath()};c.prototype.fillRect=function(a,b,d,c){this.rect(a,b,d,c);this.fill()};c.prototype.Ef=function(a){var b=null,d="10",c="normal",f="normal",g="normal",h="normal",k=!1;a=a.split(/\s+/);a:for(;;){var l=a.shift();if(!l)break;
switch(l){case "normal":break;case "italic":case "oblique":c=l;break;case "small-caps":g=l;break;case "bold":case "bolder":case "lighter":case "100":case "200":case "300":case "400":case "500":case "600":case "700":case "800":case "900":f=l;break;default:if(k){b=l;a.length&&(b+=" "+a.join(" "));2<b.length&&('"'===b.charAt(0)||"'"===b.charAt(0))&&(b=b.substr(1,b.length-2));break a}else l=l.split("/"),d=l[0],k=!0,1<l.length&&(h=l[1])}}return{fontStyle:c,fontVariant:g,fontWeight:f,fontSize:d,lineHeight:h,
fontFamily:b}};c.prototype.createPattern=function(a,b){return new sd(a,b)};c.prototype.createLinearGradient=function(a,b,d,c){return new td(a,b,d,c)};c.prototype.clip=function(){};return c}();var vd=function(){function c(a,b,d,c){this.x=a;this.y=b;this.width=d;this.height=c;this.Yb=[];this.fonts={};this.images=[];this.fj={};this.lb=1;this.lq=!0;this.page={};this.log=B.create("PdfWriter");this.$a=this.object("Pages",{Kids:[],Count:0});this.$p=this.object("Catalog",{Pages:this.$a._id+" 0 R"});this.rg()}c.prototype.Xr=function(){if(null!==c.yj)return c.yj;var a=document.createElement("canvas"),b=!1;a.width=10;a.height=10;"toDataURL"in a&&(b=0<a.toDataURL("image/jpeg").indexOf("jpeg"));c.yj=
b;this.log("JPEG supported: %s",b);return b};c.prototype.rg=function(a,b,d,c){void 0===a&&(a=this.x);void 0===b&&(b=this.x);void 0===d&&(d=this.width);void 0===c&&(c=this.height);this.log("StartPage MediaBox=[%s %s %s %s]",a,b,d,c);this.page=this.object("Page",{MediaBox:[a,b,a+d,b+c],Parent:this.$a._id+" 0 R"});this.$a.Kids.push(this.page._id+" 0 R");this.$a.Count+=1;this.fj={}};c.prototype.object=function(a,b){var d=this.Yb.length+1;a&&(b.Type=a);b._id=d;this.Yb.push(b);return b};c.prototype.Mp=
function(a){this.page.Contents=a._id+" 0 R"};c.prototype.stream=function(a){if(this.lq){var b=Sb.yg("LZWEncoder");b.Ql(a);b.flush();a=b.Sf().toString();a=this.object(null,{_stream:a,Filter:"[/LZWDecode]",DecodeParms:"[ << /EarlyChange 0 >> ]"})}else a=this.object(null,{_stream:a});return a};c.prototype.lu=function(a){if(!(a in this.fonts)){var b="F"+this.lb;this.lb+=1;var d="/"+a.replace(/ /g,"");b=this.object("Font",{_name:b,BaseFont:d,Encoding:"/StandardEncoding",Subtype:"/Type1"});this.fonts[a]=
b}this.Kh("Font",this.fonts[a]);return"/"+this.fonts[a]._name};c.prototype.ep=function(a,b){var d=""+a+"-"+b;if(!(d in this.fj)){var c="gs"+this.lb;this.lb+=1;var f=this.object("ExtGState",{_name:c});b?f.ca=this.Lc(a):f.CA=this.Lc(a);this.fj[d]=c;this.Kh("ExtGState",f)}return this.fj[d]};c.prototype.Kh=function(a,b){"Resources"in this.page||(this.page.Resources={});a in this.page.Resources||(this.page.Resources[a]={});this.page.Resources[a][b._name]=b._id+" 0 R"};c.prototype.wj=function(a,b){void 0===
b&&(b="");for(var d=0;d<this.images.length;d++)if(this.images[d].Zg===a&&b===this.images[d].Ln)return this.images[d].kh;return null};c.prototype.gj=function(a,b){var d,c=this.wj(a);if(!c){var f="I"+this.lb;this.lb+=1;b instanceof HTMLCanvasElement?c=b:(c=document.createElement("canvas"),c.width=b.width,c.height=b.height,c.getContext("2d").drawImage(b,0,0));var g=c.getContext("2d").getImageData(0,0,c.width,c.height),h=!1;if(this.Xr()){this.log("Using JPEG encoding");var k="[/DCTDecode]";var l=Sb.yg("");
for(d=0;d<g.data.length;d+=4)h=h||255>g.data[d+3];d=c.toDataURL("image/jpeg");var n=atob(d.split(",")[1]);for(d=0;d<n.length;d++)l.Qa(n.charCodeAt(d))}else{this.log("Using LZW encoding");k="[/LZWDecode]";l=Sb.yg("LZWEncoder");for(d=0;d<g.data.length;d+=4)l.Qa(g.data[d]),l.Qa(g.data[d+1]),l.Qa(g.data[d+2]),h=h||255>g.data[d+3];var m="[ <</EarlyChange 0 >> ]"}l.flush();l=l.Sf().toString();f=this.object("XObject",{Subtype:"/Image",Width:c.width,Height:c.height,ColorSpace:"/DeviceRGB",BitsPerComponent:8,
Length:l.length,Interpolate:"true",Filter:k,_name:f,_stream:l});m&&(f.DecodeParms=m);if(h){l=Sb.yg("LZWEncoder");for(d=0;d<g.data.length;d+=4)l.Qa(g.data[d+3]);l.flush();l=l.Sf().toString();m=this.object("XObject",{Subtype:"/Image",Width:c.width,Height:c.height,ColorSpace:"/DeviceGray",BitsPerComponent:8,Length:l.length,Filter:"[/LZWDecode]",DecodeParms:"[ << /EarlyChange 0 >> ]",_stream:l});f.SMask=m._id+" 0 R"}this.images.push({Zg:a,Ln:"",kh:f});c=f}this.Kh("XObject",c);return"/"+c._name};c.prototype.hj=
function(a,b){var d=this.wj(a.qa,b.toString());if(!d){d="P"+this.lb;this.lb+=1;this.gj(a.qa,a.qa);var c=this.wj(a.qa),f=new M(a.qa.width,0,0,-a.qa.height,0,a.qa.height);f=b.multiply(f);var g="1",h="1",k=b.Vg();k=Math.max(k.x,k.y);if("no-repeat"===a.repeat||"repeat-y"===a.repeat)g=""+Math.ceil(this.width/a.qa.width/k);if("no-repeat"===a.repeat||"repeat-x"===a.repeat)h=""+Math.ceil(this.height/a.qa.height/k);d=this.object("Pattern",{_name:d,PatternType:"1",PaintType:"1",TilingType:"2",BBox:"[0 0 1 1]",
XStep:g,YStep:h,Matrix:"[ "+this.Lc(f.m11,f.m21,f.m12,f.m22,f.Ca,f.Da)+"]",Resources:"<< /XObject << /"+c._name+" "+c._id+" 0 R >> >>"});d._stream="/"+c._name+" Do";this.images.push({Zg:a.qa,Ln:b.toString(),kh:d})}this.Kh("Pattern",d);return"/"+d._name};c.prototype.kf=function(){var a=[],b=[],d;a.push("%PDF-1.4\n%\u0080\u0081\u0082\u0083\n");for(d=0;d<this.Yb.length;d++)this.Cm(a,b,this.Yb[d],!1);var c=a.join("").length;a.push("xref\n0 "+(this.Yb.length+1)+"\n");a.push("0000000000 65535 f\n");for(d=
0;d<this.Yb.length;d++){for(var f=""+b[d];10>f.length;)f="0"+f;a.push(f+" 00000 n \n")}a.push("trailer\n");a.push("<< /Size "+(this.Yb.length+1)+"\n");a.push("   /Root "+this.$p._id+" 0 R\n");a.push(">>\n");a.push("startxref\n");a.push(c+"\n");a.push("%%EOF\n");return a.join("")};c.prototype.toBlob=function(){for(var a=this.kf(),b=new Uint8Array(a.length),d=0;d<a.length;d++)b[d]=a.charCodeAt(d);return new Blob([b],{type:"application/pdf"})};c.prototype.Cm=function(a,b,d,c){c?a.push("<<\n"):(b.push(a.join("").length),
a.push(d._id+" 0 obj\n"),"Type"in d?a.push("<< /Type /"+d.Type+"\n"):a.push("<<\n"));"_stream"in d&&(d.Length=d._stream.toString().length);for(var e in d)if(d.hasOwnProperty(e)&&"Type"!==e&&"_"!==e.charAt(0)){c&&a.push("    ");a.push("   /"+e+" ");var g=d[e];"object"===typeof g&&"[object Array]"===Object.prototype.toString.apply(g)?a.push("[ "+g.join(" ")+" ]"):"object"===typeof g?this.Cm(a,b,g,!0):a.push(g);a.push("\n")}c&&a.push("    ");a.push(">>\n");"_stream"in d&&(a.push("stream\n"),a.push(d._stream+
"\n"),a.push("endstream\n"));c||a.push("endobj\n")};c.prototype.Lq=function(a){return"("+a.replace(/\\/g,"\\\\").replace(/\(/g,"\\(").replace(/\)/g,"\\)")+")"};c.prototype.Lc=function(){for(var a=[],b=0;b<arguments.length;b++)a[b]=arguments[b];b=[];for(var d=0;d<a.length;d++){var c=""+a[d];0<c.indexOf("e")&&(c=a[d].toFixed(20));b.push(c)}return b.join(" ")};c.yj=null;return c}(),wd=function(c){function a(a,d){var b=c.call(this)||this;b.Uq=d;b.path=[];b.x=0;b.y=0;b.so=[];b.$e="";b.ff="";b.ef=-1;b.df=
"";b.cf="";b.bf="";b.af="";b.Ze=-1;b.log=B.create("PDFContext");b.Id=a.clone();b.Id.transform(new O(.75,.75,0,0));b.mb=new vd(72*a.x/96,72*a.y/96,72*a.width/96,72*a.height/96);b.stream=[];b.x=0;b.y=0;b.fillStyle="#000000";b.strokeStyle="#000000";b.zm=b.Dp;b.ym();return b}p(a,c);a.prototype.save=function(){c.prototype.save.call(this);this.stream.push("q");this.so.push({$e:this.$e,ff:this.ff,ef:this.ef,df:this.df,cf:this.cf,bf:this.bf,af:this.af,Ze:this.Ze})};a.prototype.restore=function(){c.prototype.restore.call(this);
var a=this.so.pop();a&&(this.stream.push("Q"),this.$e=a.$e,this.ff=a.ff,this.ef=a.ef,this.df=a.df,this.cf=a.cf,this.bf=a.bf,this.af=a.af,this.Ze=a.Ze)};a.prototype.rg=function(a){var b=new O(.75,.75,0,0);a&&(this.Id=a.clone(),this.Id.transform(b));this.dk();this.mb.rg(this.Id.x,this.Id.y,this.Id.width,this.Id.height);this.ym();this.beginPath()};a.prototype.beginPath=function(){this.path.length=0};a.prototype.ym=function(){this.log("Start page: %s",this.Id);this.setTransform(1,0,0,1,0,0);this.ff=this.$e=
"";this.ef=-1;this.af=this.bf=this.cf=this.df="";this.Ze=-1};a.prototype.dk=function(){this.stream.length&&this.mb.Mp(this.mb.stream(this.stream.join("\n")));this.stream.length=0};a.prototype.toString=function(){this.dk();return this.mb.kf()};a.prototype.toBlob=function(){this.dk();return this.mb.toBlob()};a.prototype.setTransform=function(a,d,c,f,g,h){var b=this.Id.Kf();this.sa=(new M(a,c,d,f,g,h)).multiply(new Ac(0,b.x,b.y)).multiply(new O(.75,.75,0,0))};a.prototype.closePath=function(){this.path.push("h")};
a.prototype.fill=function(){this.zj();for(var a=0;a<this.path.length;a++)this.stream.push(this.path[a]);this.stream.push("f")};a.prototype.stroke=function(){this.Aj();for(var a=0;a<this.path.length;a++)this.stream.push(this.path[a]);this.stream.push("S")};a.prototype.moveTo=function(a,d){var b=this.sa.apply(a,d);this.path.push(this.mb.Lc(b.x,b.y)+" m");this.x=a;this.y=d};a.prototype.lineTo=function(a,d){var b=this.sa.apply(a,d);this.path.push(this.mb.Lc(b.x,b.y)+" l");this.x=a;this.y=d};a.prototype.bezierCurveTo=
function(a,d,c,f,g,h){a=this.sa.apply(a,d);c=this.sa.apply(c,f);f=this.sa.apply(g,h);this.path.push(this.mb.Lc(a.x,a.y,c.x,c.y,f.x,f.y)+" c");this.x=g;this.y=h};a.prototype.quadraticCurveTo=function(a,d,c,f){this.bezierCurveTo(2/3*a+1/3*this.x,2/3*d+1/3*this.y,2/3*a+1/3*c,2/3*d+1/3*f,c,f)};a.prototype.fillText=function(a,d,c){this.zm(a,d,c,0)};a.prototype.strokeText=function(a,d,c){this.zm(a,d,c,1)};a.prototype.zj=function(){if(this.$e!==this.fillStyle){if(this.fillStyle instanceof sd){var a=this.mb.hj(this.fillStyle,
this.sa);this.stream.push("/Pattern cs");this.stream.push(a+" scn")}else"string"===typeof this.fillStyle&&(a=z.Xb(this.fillStyle).zd(z.RGBA),this.stream.push(this.mb.Lc(a.values[0],a.values[1],a.values[2])+" rg"),a=this.mb.ep(a.values[3],!0),this.stream.push("/"+a+" gs"));this.$e=this.fillStyle}};a.prototype.Aj=function(){function a(a){return"bevel"===a?2:"round"===a?1:0}function d(a){return"butt"===a?0:"round"===a?1:2}if(this.ff!==this.strokeStyle){if(this.strokeStyle instanceof sd){var c=this.mb.hj(this.strokeStyle,
this.sa);this.stream.push("/Pattern CS");this.stream.push(c+" SCN")}else"string"===typeof this.strokeStyle&&(c=z.Xb(this.strokeStyle).zd(z.RGBA),this.stream.push(this.mb.Lc(c.values[0],c.values[1],c.values[2])+" RG"),c=this.mb.ep(c.values[3],!1),this.stream.push("/"+c+" gs"));this.ff=this.strokeStyle}this.ef!==this.lineWidth&&(this.ef=this.lineWidth,this.stream.push(this.mb.Lc(72*this.lineWidth/96)+" w"));this.df!==this.lineJoin&&(this.df=this.lineJoin,this.stream.push(a(this.lineJoin)+" j"));this.cf!==
this.lineCap&&(this.cf=this.lineCap,this.stream.push(d(this.lineCap)+" J"))};a.prototype.Ep=function(a,d,c,f){var b=this.Ef(this.font);if(this.bf!==b.fontSize||this.af!==b.fontFamily){var e=this.mb.lu(b.fontFamily);this.stream.push(e+" "+this.mb.Lc(parseFloat(b.fontSize))+" Tf");this.bf=b.fontSize;this.af=b.fontFamily}this.Ze!==f&&(this.stream.push(f+" Tr"),this.Ze=f);0===f?this.zj():this.Aj();this.stream.push("BT");d=this.sa.multiply(new M(1,0,0,-1,d,c));this.stream.push(this.mb.Lc(d.m11,d.m21,d.m12,
d.m22,d.Ca,d.Da)+" Tm");this.stream.push(this.mb.Lq(a)+" Tj");this.stream.push("ET")};a.prototype.Dp=function(a,d,c,f){var b=this.Ef(this.font),e=this.Uq.get(b.fontFamily);e?(0===f?this.zj():this.Aj(),this.beginPath(),e.Fq(this,a,d,c,parseFloat(b.fontSize)),0===f?this.fill():this.stroke()):this.Ep(a,d,c,f)};a.prototype.measureText=function(){return{width:1}};a.prototype.Ef=function(a){var b="",c="",f="normal",g="normal",h="normal",k="normal";a=a.split(/\s+/);a:for(;;){var l=a.shift();if(!l)break;
switch(l){case "normal":break;case "italic":case "oblique":f=l;break;case "small-caps":h=l;break;case "bold":case "bolder":case "lighter":case "100":case "200":case "300":case "400":case "500":case "600":case "700":case "800":case "900":g=l;break;default:if(""===c)l=l.split("/"),c=l[0],1<l.length&&(k=l[1]);else{b=l;a.length&&(b+=" "+a.join(" "));break a}}}b&&(b=b.replace(/"/g,""));return{fontStyle:f,fontVariant:h,fontWeight:g,fontSize:c,lineHeight:k,fontFamily:b}};a.prototype.om=function(a,d,c,f,
g,h,k,l,n){this.log("DrawImage(%s, %s, %s, %s, %s, %s, %s %s)",d,c,f,g,h,k,l,n);k+=n;var b=document.createElement("canvas"),e=b.getContext("2d");b.width=f;b.height=g;e.drawImage(a,-d,-c);a=this.mb.gj(a instanceof HTMLImageElement?[a.src,d,c,f,g].join():a,b);this.stream.push("q");h=this.sa.multiply(new M(l,0,0,-n,h,k));this.stream.push(this.mb.Lc(h.m11,h.m21,h.m12,h.m22,h.Ca,h.Da)+" cm");this.stream.push(a+" Do");this.stream.push("Q")};a.prototype.kf=function(){return this.mb.kf()};return a}(ud);var xd=function(){function c(){this.ba=[]}c.prototype.lineTo=function(a,b,d){a.apply(b,d);this.ba.push({Gg:"L",Hd:a.apply(b,d)})};c.prototype.moveTo=function(a,b,d){a.apply(b,d);this.ba.push({Gg:"M",Hd:a.apply(b,d)})};c.prototype.quadraticCurveTo=function(a,b,d,c,f){this.ba.push({Gg:"Q",Hd:a.apply(b,d),Xe:a.apply(c,f)})};c.prototype.bezierCurveTo=function(a,b,d,c,f,g,h){this.ba.push({Gg:"C",Hd:a.apply(b,d),Xe:a.apply(c,f),fg:a.apply(g,h)})};c.prototype.closePath=function(){this.ba.push({Gg:"Z"})};
c.prototype.Zo=function(a){a=a.inverse();for(var b="",d=0;d<this.ba.length;d++){var c=this.ba[d];0<d&&(b+=" ");b+=c.Gg;if(c.Hd){var f=a.apply(c.Hd.x,c.Hd.y);b+=f.x+","+f.y;c.Xe&&(f=a.apply(c.Xe.x,c.Xe.y),b+=","+f.x+","+f.y,c.fg&&(c=a.apply(c.fg.x,c.fg.y),b+=","+c.x+","+c.y))}}return b};return c}(),yd=function(c){function a(a){var b=c.call(this)||this;b.sa=new M;b.ba=[];b.path=new xd;b.Yb=[];b.log=B.create("SvgContext");b.zg=1;b.Bf=2;b.oj=4;b.log("SVG context rect: %s",a);b.root=new sa("svg",{xmlns:"http://www.w3.org/2000/svg",
"xmlns:xlink":"http://www.w3.org/1999/xlink",version:1.2,baseProfile:"tiny",width:a.width,height:a.height,viewBox:a.x+" "+a.y+" "+a.width+" "+a.height});b.Wj=new sa("defs",{});b.root.Je(b.Wj);b.Bd=[b.root];return b}p(a,c);a.prototype.ig=function(a){a=new sa("g",a||{});this.Qj().Je(a);this.Bd.push(a)};a.prototype.gg=function(){var a=this.Bd.pop();if(a&&1===a.children.length){var d=a.children[0];d.Ho(a.attributes);a.name=d.name;a.attributes=d.attributes;a.children=d.children;a.text=d.text}};a.prototype.Qj=
function(){return this.Bd[this.Bd.length-1]};a.prototype.node=function(a,d,c,f){function b(a,b){if(b instanceof sd)c[a]="url(#"+e.hj(b)+")";else if("string"===typeof b){var d=z.Xb(b),f=d.values[3];1>f&&(d.values[3]=1,c[a+"-opacity"]=""+f);c[a]=d.toString()}}void 0===c&&(c={});var e=this;this.sa.Wr()||(c.transform="matrix("+this.sa.m11+" "+this.sa.m21+" "+this.sa.m12+" "+this.sa.m22+" "+this.sa.Ca+" "+this.sa.Da+")");d&this.zg?b("fill",this.fillStyle):c.fill="none";d&this.Bf&&(b("stroke",this.strokeStyle),
c["stroke-width"]=this.lineWidth,"miter"!==this.lineJoin&&(c["stroke-linejoin"]=this.lineJoin),"butt"!==this.lineCap&&(c["stroke-linecap"]=this.lineCap));d&this.oj&&(d=this.Ef(this.font),c["font-weight"]=d.fontWeight,c["font-size"]=parseFloat(d.fontSize),c["font-style"]=d.fontStyle,c["font-family"]=d.fontFamily);this.Kp(new sa(a,c,f))};a.prototype.Kp=function(a){var b=!0,c=null,f={},g,h=this.Qj();0===h.children.length?b=!1:c=h.children[h.children.length-1];!c||a.name===c.name&&a.text===c.text||(b=
!1);if(b&&c)for(g in c.attributes)if(c.attributes.hasOwnProperty(g))if(g in a.attributes){var k=c.attributes[g],l=a.attributes[g];if(k!==l)if(0===g.indexOf("fill")||0===g.indexOf("stroke"))if("none"===k)f[g]=l;else if("none"===l)f[g]=k;else{b=!1;break}else{b=!1;break}}else f[g]=c.attributes[g];if(b&&c)for(g in a.attributes)a.attributes.hasOwnProperty(g)&&(g in c.attributes||(f[g]=a.attributes[g]));b&&c?c.Ho(f):h.Je(a)};a.prototype.zi=function(a){if(a===this.Bf){if(0===this.lineWidth)return!1;a=this.strokeStyle}else a=
this.fillStyle;return a instanceof sd?!0:"string"===typeof a?0<z.Xb(a).values[3]:!1};a.prototype.rm=function(a){for(var b=0;b<this.Yb.length;b++)if(this.Yb[b].Zg===a)return this.Yb[b].kh;return null};a.prototype.gj=function(a){var b=this.rm(a);if(b)return b;b="image"+this.Yb.length;this.Yb.push({Zg:a,kh:b});var c=document.createElement("canvas"),f=c.getContext("2d");c.width=a.width;c.height=a.height;f.drawImage(a,0,0);c=c.toDataURL();a=new sa("image",{id:b,x:0,y:0,width:a.width,height:a.height,"xlink:href":c});
this.Wj.Je(a);return b};a.prototype.hj=function(a){var b=this.rm(a);if(b)return b;var c=this.gj(a.qa);b="pattern"+this.Yb.length;this.Yb.push({Zg:a,kh:b});var f=new sa("pattern",{id:b});"no-repeat"===a.repeat?(f.attributes.width="1",f.attributes.height="1"):"repeat-x"===a.repeat?(f.attributes.patternUnits="userSpaceOnUse",f.attributes.width=a.qa.width,f.attributes.height=1E4):("repeat-y"===a.repeat?(f.attributes.patternUnits="userSpaceOnUse",f.attributes.width=1E4):(f.attributes.patternUnits="userSpaceOnUse",
f.attributes.width=a.qa.width),f.attributes.height=a.qa.height);f.Je(new sa("use",{"xlink:href":"#"+c}));this.Wj.Je(f);return b};a.prototype.toString=function(){return'<?xml version="1.0" encoding="UTF-8"?>\n'+this.root.toString()};a.prototype.toBlob=function(){for(var a=this.toString(),d=new Uint8Array(a.length),c=0;c<a.length;c++)d[c]=a.charCodeAt(c);return new Blob([d],{type:"image/svg+xml"})};a.prototype.beginPath=function(){this.path=new xd};a.prototype.transform=function(a,d,c,f,g,h){a=new M(a,
c,d,f,g,h);this.sa=this.sa.multiply(a)};a.prototype.closePath=function(){this.path.closePath()};a.prototype.fill=function(){this.zi(this.zg)&&this.node("path",this.zg,{d:this.path.Zo(this.sa)})};a.prototype.stroke=function(){this.zi(this.Bf)&&this.node("path",this.Bf,{d:this.path.Zo(this.sa)})};a.prototype.moveTo=function(a,d){this.path.moveTo(this.sa,a,d)};a.prototype.lineTo=function(a,d){this.path.lineTo(this.sa,a,d)};a.prototype.quadraticCurveTo=function(a,d,c,f){this.path.quadraticCurveTo(this.sa,
a,d,c,f)};a.prototype.bezierCurveTo=function(a,d,c,f,g,h){this.path.bezierCurveTo(this.sa,a,d,c,f,g,h)};a.prototype.fillText=function(a,d,c){this.zi(this.zg)&&(this.Ef(this.font),this.node("text",this.zg|this.oj,{x:d,y:c},a))};a.prototype.strokeText=function(a,d,c){this.zi(this.Bf)&&(this.Ef(this.font),this.node("text",this.Bf|this.oj,{x:d,y:c},a))};a.prototype.om=function(a,d,c,f,g,h,k,l,n){var b=document.createElement("canvas"),e=b.getContext("2d");b.width=f;b.height=g;e.drawImage(a,-d,-c);a=b.toDataURL();
this.Qj().Je(new sa("image",{transform:"matrix("+this.sa.m11+" "+this.sa.m21+" "+this.sa.m12+" "+this.sa.m22+" "+this.sa.Ca+" "+this.sa.Da+")",x:h,y:k,width:l,height:n,"xlink:href":a}))};a.prototype.measureText=function(){return{width:1}};a.prototype.rg=function(){};return a}(ud);var Dd=new (function(){function c(){this.log=B.create("serializer")}c.prototype.qj=function(a){if(a instanceof Array)var b=this.Nn(a);else{if("string"!==typeof a)return this.log("Can only open an array or string as a document."),null;if("{"===a.charAt(0))b=this.os(a);else if(0===a.indexOf("zwibbler3."))b=JSON.parse(a.substr(10)),b=this.Nn(b);else if(0===a.indexOf("zwibblerclip."))b=new zd(!1),a=b.Yn(a,[]),b.ta(a),b.oh();else throw Error("Format detection failed.");}for(a=1;a<b.Cc();a++)b.Fl(a,!1);
return b};c.prototype.os=function(a){function b(a){var b=new M;b.m11=a.m11;b.m12=a.m12;b.m21=a.m21;b.m22=a.m22;b.Ca=a.dx;b.Da=a.dy;return b}function d(a,c){switch(a.type){case "Node":for(var e=[],h=a.children,k=h.length-1;0<=k;k--){var l=f.lb;try{d(h[k],c+1)}catch(F){continue}e.push(l)}0<c&&g.push(new Ad(f.Ua(),e));break;case "PathNode":case "ArrowNode":var v=a;h=0;"arrowSize"in v&&(h=v.arrowSize,v=v.path);e=b(v.matrix);h={strokeStyle:v.strokeStyle,fillStyle:v.fillStyle,lineWidth:v.lineWidth,smoothness:v.smoothness,
sloppiness:v.sloppiness,shadow:v.shadow,arrowSize:h,seed:Math.round(65535*Math.random())};"textNode"in v&&(k=v.textNode,h.fontSize=k.fontSize,h.fontName=k.fontName,h.text=k.text,h.textFillStyle="textFillStyle"in k?k.textFillStyle:k.fillStyle);"path"in v&&(v=v.path);var A=v.startX,x=v.startY;k=v.closed;l=new U;v=v.segments;A=e.apply(A,x);l.moveTo(A.x,A.y);for(A=0;A<v.length;A++){var y=v[A];switch(y.type){case 1:x=e.apply(y.x,y.y);l.lineTo(x.x,x.y);break;case 2:x=e.apply(y.x,y.y);l.Lg(x.x,x.y);break;
case 3:x=e.apply(y.x1,y.y1);y=e.apply(y.x,y.y);l.Me(x.x,x.y,y.x,y.y);break;default:throw"Unknown path segment type: "+y.type;}}k&&l.close();h.commands=l.ec();g.push(new V(f.Ua(),"PathNode",h));break;case "TextNode":e=b(a.matrix);e=e.multiply(new L(0,1.3*a.fontSize));e={fillStyle:a.fillStyle,lineWidth:0,text:a.text,fontName:a.fontName,fontSize:a.fontSize,matrix:e};g.push(new V(f.Ua(),"TextNode",e));break;default:throw Error("Unknown node type: "+a.type);}}var c=B.create("IMPORT"),f=new zd,g=[];try{var h=
JSON.parse(a)}catch(k){a=a.replace(/\\\\/g,"\\").replace(/\\"/g,'"');try{h=JSON.parse(a)}catch(l){throw c("Couldn't parse file."),"Couldn't parse file.";}}c("Successfully parsed!");d(h,0);f.ta(g);return f};c.prototype.Nn=function(a){function b(a,d){if(void 0!==a){var e={};for(var g in a)a.hasOwnProperty(g)&&"children"!==g&&"parent"!==g&&"id"!==g&&"type"!==g&&(e[g]="matrix"===g?new M(a[g]):a[g]);g=f;0!==a.id&&c.push(new V(g,a.type,e,d,-1));f+=1;if(void 0!==a.children)for(e=0;e<a.children.length;e++)b(a.children[e],
g)}}var d;a=JSON.parse(JSON.stringify(a));var c=[],f=0,g={},h=!1;for(d=0;d<a.length;d++){var k=a[d];if("document"===k.type)delete k.type,c.push(new Bd(k));else{"PageNode"===k.type&&(h=!0);if("parent"in k){if(!(k.parent in g))throw"Error: child "+k.id+" references parent "+k.parent+" before it was defined.";var l=g[k.parent];void 0!==l.children?l.children.push(k):l.children=[k]}"GroupNode"!==k.type&&"PageNode"!==k.type||void 0!==k.children||(k.children=[]);g[k.id]=k}}h||(f+=1);b(g[0],f);for(d=0;d<
c.length;d++)this.log(c[d].toString());a=new zd(h);a.ta(c);a.oh();return a};c.prototype.hn=function(a){function b(a,c){var e={id:c.id,type:c.type()};d.push(e);a&&(e.parent=a.id);var f=c.tc(),g;for(g in f)f.hasOwnProperty(g)&&("matrix"===g?e[g]=f[g].ec():"inverse"!==g&&(e[g]=f[g]));if(c.Sn()&&c.children)for(e=0;e<c.children.length;e++)b(c,c.children[e])}var d=[],c={type:"document"},f=!1,g;for(g in a.aa)a.aa.hasOwnProperty(g)&&(c[g]=a.aa[g],f=!0);f&&d.push(c);b(null,a.getRootNode());return d};c.prototype.tj=
function(a,b,d){if("list"===b)a=this.hn(a),b="application/json";else if("zwibbler3"===b)a=this.hn(a),a="zwibbler3."+JSON.stringify(a),b="application/octet-stream";else if("svg"===b){b=a.Ue();var c=new yd(b);a.ja(c);a=c;b="image/svg+xml"}else if("pdf"===b){b=a.Ue();c=new wd(b,Cd.fonts);var f=a.Wa;for(b=0;b<a.Cc();b++)0<b&&c.rg(),a.Bb(b),a.ja(c);a.Bb(f);a=c;b="application/pdf"}else throw"Unknown save format: "+b;if("string"===typeof a)if("string"===d)var g=a;else if("data-uri"===d)g="data:"+b+";base64,"+
w.encode("base64",a);else{if("blob"===d)for(d=new Uint8Array(a.length),b=0;b<a.length;b++)d[b]=a.charCodeAt(b)}else if(a.toBlob&&a.toString)"string"===d?g=a.toString():"data-uri"===d?g="data:"+b+";base64,"+w.encode("base64",a.toString()):"blob"===d&&(g=a.toBlob());else if("object"===d)g=a;else throw"Error in ZwibblerDocument.save()";return g};return c}());var Ed=new (function(){function c(){this.ek={}}c.prototype.Th=function(){if("localStorage"in window)try{var a=window.localStorage}catch(b){}return void 0!==a};c.prototype.setItem=function(a,b){this.Th()?window.localStorage.setItem(a,b):this.ek[a]=""+b};c.prototype.getItem=function(a){return this.Th()?window.localStorage.getItem(a):this.ek[a]};c.prototype.removeItem=function(a){this.Th()?window.localStorage.removeItem(a):delete this.ek[a]};return c}());function Fd(c){function a(a){b&&clearTimeout(b);b=setTimeout(function(){b=null;c()},arguments.length?a:1E3)}var b=null;a.cancel=function(){b&&(clearTimeout(b),b=null)};return a};var Id=function(){function c(a,b,d,c,f,g,h){this.view=a;this.node=b;this.handle=d;this.hf=g;this.zh=this.yh=0;this.log=B.create("MoveEditNode");this.qo=b.Ug(d);this.Fa=b.la("snap")||0;this.Sa(c,f,h)}c.prototype.sc=function(){this.log("Entering MoveEditNode")};c.prototype.Hc=function(){this.log("Leaving MoveEditNode")};c.prototype.ub=function(a){if("touchmove"===a.type){var b=a.touches[0];b=this.view.eb(b.pageX,b.pageY);return this.Ta(b.x,b.y,a)}return"touchend"===a.type?(b=a.changedTouches[0],b=this.view.eb(b.pageX,
b.pageY),this.Za(b.x,b.y,a)):!1};c.prototype.Sa=function(a,b){var d=this.view.Fa(new E(a,b),this.Fa);a=d.x;b=d.y;this.log("onMouseDown(%s,%s)",a,b);this.yh=a;this.zh=b;return!0};c.prototype.Ta=function(a,b){var d=this.view.Fa(new E(a,b),this.Fa);a=d.x;b=d.y;this.node.ie(this.handle,a,b);this.node.format(this.view.ka,this.view.request);this.view.ja();return!0};c.prototype.Za=function(a,b){var d=this.view.Fa(new E(a,b),this.Fa);a=d.x;b=d.y;this.log("onMouseUp(%s,%s)",a,b,this.yh,this.zh);a!==this.yh||
b!==this.zh?this.view.ta([new Gd(this.node.id,this.handle,this.qo.x,this.qo.y,a,b)]):this.view.nt(this.node.id,this.handle);this.view.ja();this.view.Pa(this.hf||new Hd(this.view));return!0};return c}();function Jd(){this.y=this.x=0}
var Kd=function(c){function a(a,d,e){var b=c.call(this)||this;b.sa=a;b.Uk=d;b.origin=e;a=b.sa.apply(d.x,d.y);b.x=a.x;b.y=a.y;return b}p(a,c);a.prototype.Wg=function(a){var b=1,c=1,f=this.sa.inverse(),g=f.apply(this.x+a.x,this.y+a.y);a=new E(this.Uk.x-this.origin.x,this.Uk.y-this.origin.y);g=new E(g.x-this.origin.x,g.y-this.origin.y);g=(g.x*a.x+g.y*a.y)/(a.x*a.x+a.y*a.y);0!==a.x&&0!==a.y?c=b=g:0!==a.x?b=g:c=g;return this.sa.multiply(new O(b,c,this.origin.x,this.origin.y)).multiply(f)};return a}(Jd),
Ld=function(c){function a(a,d,e,f){var b=c.call(this)||this;b.sa=a;b.Uk=d;b.Xh=f;b.log=B.create("RotationSelHandle");b.origin=b.sa.apply(e.x,e.y);a=b.sa.apply(d.x,d.y);b.x=a.x;b.y=a.y;b.Xt=Math.atan2(b.y-b.origin.y,b.x-b.origin.x);b.Xh=f;return b}p(a,c);a.prototype.Wg=function(a){a=Math.atan2(this.y+a.y-this.origin.y,this.x+a.x-this.origin.x)-this.Xt;if(this.Xh){var b=Math.PI/16;a=Math.floor(a/b)*b}return new zc(-a,this.origin.x,this.origin.y)};return a}(Jd),Md=function(c){function a(a){var b=c.call(this)||
this;b.sa=a;return b}p(a,c);a.prototype.Wg=function(a){return new L(a.x,a.y)};return a}(Jd),Nd=function(c){function a(){return null!==c&&c.apply(this,arguments)||this}p(a,c);a.prototype.Wg=function(){return new M};return a}(Jd);function Od(c){for(var a=[],b=0;b<c.length;b++)a.push(c[b].id);return a}
var Qd=function(){function c(a,b,d,c,f,g){this.view=a;this.handle=b;this.cu=d;this.ph=new K(0,0,0,0);this.ra=[];this.he=[];this.sd=new E(0,0);this.log=B.create("TransformSelectionBehaviour");this.view.Vo(this.handle instanceof Ld);this.In=!1;this.Fa=0;this.Sa(c,f,g)}c.prototype.ub=function(a){var b;if(this.In||"touchmove"!==a.type&&"touchstart"!==a.type&&"touchend"!==a.type)return!1;for(b=0;b<a.touches.length;){b=a.touches[b];b=this.view.eb(b.pageX,b.pageY);"touchmove"===a.type&&this.Ta(b.x,b.y,a);
break}for(b=0;b<a.changedTouches.length;){b=a.changedTouches[b];b=this.view.eb(b.pageX,b.pageY);"touchend"===a.type&&this.Za(b.x,b.y,a);break}return!0};c.prototype.Ya=function(a){if("gesturestart"!==a.type&&"gesturechange"!==a.type&&"gestureend"!==a.type)return!1;this.log("%s scale=%s rotation=%s",a.type,a.scale,a.rotation);this.In=!0;var b=this.ph.x+this.ph.width/2,d=this.ph.y+this.ph.height/2,c=a.scale;this.view.qh||(c=1);var f=-a.rotation/180*Math.PI;if(0<this.view.da.get("snap")){var g=Math.PI/
16;f=Math.floor(f/g)*g}c=new O(c,c,b,d);b=new zc(f,b,d);b=c.multiply(b);for(d=0;d<this.ra.length;d++)this.ra[d].og(b.multiply(this.he[d])),this.ra[d].format(this.view.ka,this.view.request);this.view.Gl(b);this.view.ja();if("gestureend"===a.type){for(d=0;d<this.ra.length;d++)this.ra[d].og(this.he[d]);this.view.ta([new Pd(Od(this.ra),b)]);this.gn()}return!0};c.prototype.Sa=function(a,b){this.ra=this.view.Uf();this.Oq(this.ra);this.sd=this.view.Fa(new E(a,b),this.Fa);this.log("onMouseDown(%s,%s)",this.sd.x,
this.sd.y);this.ph=new K(this.view.ad.x,this.view.ad.y,this.view.ad.width,this.view.ad.height);return!0};c.prototype.Oq=function(a){this.he=[];for(var b=0;b<a.length;b++)this.he.push(a[b].Ga()),this.Fa=this.Fa||a[b].la("snap")};c.prototype.Ta=function(a,b){var d=this;var c=this.view.Fa(new E(a,b),this.Fa);var f=c.x;var g=c.y;var h=this.handle.Wg(new E(c.x-this.sd.x,c.y-this.sd.y));h=this.to(h,a,b);for(var k=0;k<this.ra.length;k++)c=h.multiply(this.he[k]),this.ra[k].og(c),this.ra[k].format(this.view.ka,
this.view.request);this.view.Gl(h);this.view.ja(function(){if(d.handle instanceof Ld){var a=d.view.ka;a.save();a.beginPath();a.strokeStyle="#0050B7";a.lineWidth=1/d.view.scale;a.moveTo(d.handle.origin.x,d.handle.origin.y);a.lineTo(f,g);a.stroke();a.restore()}});return!0};c.prototype.Za=function(a,b){var d=a,c=b,f=this.view.Fa(new E(a,b),this.Fa);a=f.x;b=f.y;this.log("onMouseUp(%s,%s)",a,b);if(f.$d(this.sd))this.cu?(d=this.view.ha.gb(d,c,this.view.La))&&d.Xf()?(this.log("Didn't move, and has edit mode. Selecting node %s",
d.id),this.view.nb(),this.view.qf(d)):this.log("Didn't move, but node has no edit mode or failed hittest"):this.log("Didn't move, but toggleEditNode=false");else{this.log("Moved by %s,%s",a-this.sd.x,b-this.sd.y);f=this.handle.Wg(new E(f.x-this.sd.x,f.y-this.sd.y));f=this.to(f,d,c);for(d=0;d<this.ra.length;d++)this.ra[d].og(this.he[d]);this.view.ta([new Pd(Od(this.ra),f)])}this.gn();return!0};c.prototype.gn=function(){this.view.Gl(new M);this.view.Vo(!0);this.view.Jf();this.view.update(!0);this.view.Va()};
c.prototype.Ps=function(a){a=a.split(/\s+/);for(var b,d={Ti:"bottom",nh:"inside",Pf:0},c=0;c<a.length;c++)switch(b=a[c],b){case "left":case "top":case "right":case "bottom":case "hcentre":case "vcentre":d.Ti=b;break;case "hcenter":d.Ti="hcentre";break;case "vcenter":d.Ti="vcentre";break;case "inside":case "outside":case "middle":d.nh=b;break;default:if(b=parseFloat(b))d.Pf=b}return d};c.prototype.to=function(a,b,d){if(1<this.ra.length||!a.Tn())return a;var c=this.ra[0].la("wallAffinity");if(!c)return a;
var f=this.view.ha.gb(b,d,this.view.La,"WallNode");if(null===f)return a;var g=f.ld(b,d,this.view.scale);if("middle"!==f.de(g))return a;var h=this.Ps(c);a=f.qr(g);var k=this.he[0].Vg();this.log("Scale=%s",k);var l=this.ra[0].fb.clone();c=new M;c=(new O(k.x,k.y,0,0)).multiply(c);l.width*=k.x;l.height*=k.y;switch(h.Ti){case "left":c=(new zc(-Math.PI/2,0,0)).multiply(c);c=(new L(l.width/2,0)).multiply(c);break;default:case "top":c=(new L(-l.width/2,0)).multiply(c);break;case "right":c=(new zc(Math.PI/
2,0,0)).multiply(c);c=(new L(-l.height/2,l.width)).multiply(c);break;case "bottom":c=(new zc(Math.PI,0,0)).multiply(c);c=(new L(l.width/2,l.height)).multiply(c);break;case "hcentre":c=(new L(-l.width/2,-l.height/2)).multiply(c);break;case "vcentre":c=(new L(-l.width/2,-l.height/2)).multiply(c),c=(new zc(-Math.PI/2,0,0)).multiply(c)}k="outside"===h.nh;"inside"===h.nh||k?(k=f.uk(g,"inside",h.Pf,b,d),f=f.uk(g,"outside",h.Pf,b,d),f.Oa(new E(b,d))<k.Oa(new E(b,d))||"outside"===h.nh?(c=(new zc(Math.PI,
0,0)).multiply(c),b=f):b=k):b=f.uk(g,h.nh,h.Pf,b,d);c=(new zc(-a,0,0)).multiply(c);c=(new L(b.x,b.y)).multiply(c);return c.multiply(this.he[0].inverse())};return c}();var Sd=function(){function c(a,b){this.view=a;this.aa=b;this.li=!1;this.Ba=this.Zd=this.na=null;this.fillStyle="#000000";this.fk=!1;this.Bl="normal";this.log=B.create("Text");this.multiline=a.da.get("multilineText");this.rb=document.createElement("div");a.da.get("iPadNoScrollText")&&null!==navigator.userAgent.match(/iPad|iPhone|Android/i)&&(this.Bl="top")}c.prototype.sc=function(){this.log("Entering text mode");this.view.canvas.style.cursor="text"};c.prototype.Hc=function(){this.li&&this.$h();this.view.canvas.style.cursor=
"default";this.log("Leaving text mode");this.na&&this.na.parentNode&&(this.na.parentNode.removeChild(this.na),this.na=null);this.rb.parentNode&&this.rb.parentNode.removeChild(this.rb)};c.prototype.ub=function(a){if("touchstart"!==a.type&&"touchend"!==a.type&&"touchmove"!==a.type)return!1;for(var b=0;b<a.touches.length;b++){var d=a.touches[b];d=this.view.eb(d.pageX,d.pageY);"touchstart"===a.type&&this.Sa(d.x,d.y,a)}return!1};c.prototype.Sa=function(a,b,d){this.log("onMouseDown(%s)",d.type);this.li?
(this.log("Editing somewhere else on mousedown; submit that first."),this.$h(),this.view.da.get("autoPickToolText")&&this.view.Va()):(d=this.view.ha.gb(a,b,this.view.La),this.yl(d,a,b));this.log("Eating click");this.view.ki=!0;return!1};c.prototype.Nq=function(){if(this.rb&&this.na){this.rb.style.fontSize=this.na.style.fontSize;this.rb.style.fontFamily=this.na.style.fontFamily;this.rb.style.fontWeight=this.na.style.fontWeight;this.rb.style.fontStyle=this.na.style.fontStyle;this.rb.style.whiteSpace=
"pre-line";this.rb.style.position="absolute";this.rb.style.visibility="hidden";this.rb.style.backgroundColor="rgba(0,0,0,0.2)";document.body.appendChild(this.rb);this.rb.style.left="0";for(this.rb.style.top="0";this.rb.firstChild;)this.rb.removeChild(this.rb.firstChild);this.rb.appendChild(document.createTextNode(this.na.value));var a=C(this.rb).width(),b=C(this.na).width();b<a&&(b=a,this.view.da.get("multilineText")&&b>500*this.view.scale&&(b=500*this.view.scale),C(this.na).width(b+2))}};c.prototype.yl=
function(a,b,d){function c(){m.na&&(m.log("Set editBox height to %s",""+m.na.scrollHeight+"px"),m.na.style.height=""+m.na.scrollHeight+"px",m.na.style.width=""+m.na.scrollWidth+"px");q=null}var f=0;this.fk=!1;if(a&&"TextNode"===a.type()||a&&"PathNode"===a.type()&&this.view.da.get("allowTextInShape")){this.Ba=a;"top"!==this.Bl&&"TextNode"===a.type()&&this.Ba.qe(!0);this.view.ja();this.Zd=new E(a.rect.x,a.rect.y);var g=a.la("fontName");var h=a.la("fontSize");var k=a.la("bold");var l=a.la("italic");
var n=a.la("textDecoration");f=a.rect.width*this.view.scale;f=Math.max(f,200);this.fillStyle=a.la("fillStyle")}else this.Ba=null,this.Zd=new E(b,d),g=this.Pb("fontName"),h=this.Pb("fontSize"),k=this.Pb("bold"),l=this.Pb("italic"),n=this.Pb("textDecoration"),this.fillStyle=this.aa.fillStyle||this.Pb("textFillStyle")||this.Pb("fillStyle");var m=this;this.na=document.createElement("textarea");a=C(this.na).height();this.na.style.width=f?""+f+"px":"auto";f=this.view.Yj(this.Zd.x,this.Zd.y);this.na.style.position=
"absolute";this.na.style.fontFamily=g;this.na.style.fontSize=""+h*this.view.scale+"px";this.na.style.overflow="auto";this.na.style.fontWeight=k?"bold":"normal";this.na.style.fontStyle=l?"italic":"normal";this.na.style.padding="0";this.na.style.border="1px solid #888";this.na.style.color=this.fillStyle;this.na.style.backgroundColor=this.Pb("background");this.na.style.textDecoration=n||"none";this.na.style.zIndex=""+(this.view.Wf()+1);this.log("Using z-index %s",this.na.style.zIndex);this.log("FillStyle=%s",
z.Xb(this.fillStyle).toString());"#ffffff"===z.Xb(this.fillStyle).toString()&&(this.na.style.backgroundColor="#808080");g=C(this.view.canvas.parentNode);h=g.offset();l=k=0;"top"===this.Bl?(l=C(this.view.canvas).offset(),k=C(this.view.canvas).width(),f=C(this.na).width(),k=l.left+k/2-f/2,l=l.top):(k=Math.round(f.x)-1,l=Math.round(f.y)-1);this.na.style.WebkitTransitionDuration="0";this.na.style.MozTransitionDuration="0";this.na.style.msTransitionDuration="0";this.na.style.OTransitionDuration="0";this.na.style.transitionDuration=
"0";this.na.style.left=k-h.left+"px";this.na.style.top=l-h.top+"px";g[0].appendChild(this.na);lc(C(this.na));this.li=!0;this.Zd=new E(b,d+a);this.Ba&&(this.na.value=this.Ba.la("text"));var q=null;q=setTimeout(c,0);C(this.na).bind("keydown",function(a){"keydown"===a.type&&(27===a.keyCode&&m.multiline||13===a.keyCode&&(a.shiftKey||!m.multiline)?(m.log("Enter pressed. create text."),m.$h(),m.view.Ea.vb&&m.view.To(a),m.view.Wb.Oe("goto-canvas"),m.view.da.get("autoPickToolText")&&m.view.Va()):27===a.keyCode?
(m.log("ESC pressed; cancel."),m.cancel(),m.view.Va(),m.view.Wb.ua("goto-toolbar")):13===a.keyCode&&(q||(q=setTimeout(c,0))))});C(this.na).bind("input propertychange",function(){null===m.Ba&&m.Nq()});this.view.da.get("leaveTextToolOnBlur")&&(C(this.na).bind("focus",function(){m.log("Text focus received.")}),C(this.na).bind("blur",function(){m.na&&!m.na.$k&&(m.log("Text blur received -- removing=%s",!0===m.na.$k),m.na.$k=!0,m.$h())}));setTimeout(function(){m.na&&m.na.focus()},200);this.na.focus();
this.view.wa.ua("edit-text-shown",m.na)};c.prototype.cancel=function(){this.na&&(this.na.$k=!0,this.na.parentNode&&this.na.parentNode.removeChild(this.na),this.view.wa.ua("edit-text-hidden"));this.na=null;this.li=!1;this.Ba&&(this.Ba.qe(!1),this.view.ja())};c.prototype.Pb=function(a){return a in this.aa?this.aa[a]:"background"===a?this.view.da.get("defaultTextBackground"):this.view.ya[a]};c.prototype.$h=function(){if(this.na){var a=this.na.value;this.cancel();if(this.Ba&&this.Ba.la("text")===a&&!this.fk)this.log("Text was not changed.");
else if(null===this.Ba&&""===a)this.log("No text entered.");else if(this.Ba)this.log("Update text in node %s",this.Ba.id),a=[new Rd([this.Ba.id],"text",a),new Rd([this.Ba.id],"textFillStyle",this.fillStyle)],"bold"in this.aa&&a.push(new Rd([this.Ba.id],"bold",this.aa.bold)),"italic"in this.aa&&a.push(new Rd([this.Ba.id],"italic",this.aa.bold)),this.view.ta(a);else if(this.Zd){this.log("Create new text node.");var b=this.view.ha.lb,d=0,c=this.Pb("fontSize");this.view.da.get("multilineText")||(d=c);
d=new L(this.Zd.x,this.Zd.y+d);this.view.ta([new V(this.view.ha.Ua(),"TextNode",C.extend({text:a,background:this.Pb("background"),fontSize:c,fontName:this.Pb("fontName"),bold:this.Pb("bold"),italic:this.Pb("italic"),textFillStyle:this.Pb("textFillStyle"),strokeStyle:this.Pb("textStrokeStyle"),lineWidth:this.Pb("textLineWidth"),layer:this.aa.layer||this.view.La,wrap:this.view.da.get("multilineText")},this.aa)),new Pd([b],d)])}}};c.prototype.Ta=function(){return!1};c.prototype.Zb=function(a){this.log("keyboard: %s",
a);"cancel"===a&&null===this.na&&(this.view.Va(),this.view.Wb.ua("goto-toolbar"))};c.prototype.md=function(a){this.log("Set text colour to %s",a);this.fk=!0;this.fillStyle=a;this.aa.textFillStyle=a;this.na&&(this.na.style.color=a,"#ffffff"===z.Xb(a).toString()?this.na.style.backgroundColor="#808080":this.na.style.backgroundColor="#ffffff")};c.prototype.nd=function(a,b){this.view.pl(a,b)};c.prototype.le=function(a,b){if("defaultBold"===a)a="bold",this.na&&(this.na.style.fontWeight=b?"bold":"normal");
else if("defaultItalic"===a)a="italic",this.na&&(this.na.style.fontStyle=b?"italic":"normal");else if("defaultTextBackground"===a)a="background",this.na&&(this.na.style.backgroundColor=b);else return;this.log("Update %s=%s",a,b);this.aa[a]=b};c.prototype.Wc=function(){return"text"};c.prototype.ue=function(a,b){this.aa[a]=b};return c}();var Hd=function(){function c(a){this.view=a;this.Do=1;this.log=B.create("DefaultBehaviour");this.view.re("");if(this.vd=this.view.da.vd())this.Do=2;this.ac=new Rc(a)}c.prototype.sc=function(){this.log("Entering pick tool.");this.view.canvas.style.cursor="default"};c.prototype.Hc=function(){this.log("Leaving pick tool.")};c.prototype.ub=function(a){if("touchmove"!==a.type&&"touchstart"!==a.type&&"touchend"!==a.type)return!1;for(var b=0;b<a.touches.length;b++){var d=a.touches[b];d=this.view.eb(d.pageX,
d.pageY);if("touchstart"===a.type)return this.Tr(d.x,d.y,a);if("touchend"===a.type)return this.Za(d.x,d.y,a)}return!1};c.prototype.Ya=function(a){return this.ac.Ya(a)};c.prototype.Tr=function(a,b,d){return this.Sa(a,b,d)};c.prototype.Sa=function(a,b,d){var c,f;this.log("onMouseDown");if(this.view.da.get("readOnly"))return(c=this.view.ha.gb(a,b,this.view.La))?(this.log("layer=%s active=%s",c.Ad(),this.view.La),this.view.wa.ua("node-clicked",c.id,a,b)):this.log("readOnly mode: Ignoring click."),!1;
if(f=this.view.tr(a,b))return this.view.Pa(new Qd(this.view,f,!1,a,b,d)),!0;this.view.selection.length&&this.view.bs(d)&&this.view.di();if(this.view.Ba&&(c=this.view.Ba,f=c.ld(a,b,1/this.view.scale*this.Do),null!==f))return this.view.Pa(new Id(this.view,c,f,a,b,this,d)),!0;if(c=this.view.ha.gb(a,b,this.view.La))this.log("layer=%s active=%s",c.Ad(),this.view.La),this.view.wa.ua("node-clicked",c.id,a,b);if(c&&c.Ad()===this.view.La){var g=c===this.view.Ba,h=this.view.Zr(c);this.log("wasEditNode: %s, wasSelected: %s",
g,h);if("WallNode"===c.type()&&1<c.Hb.length&&(f=c.ld(a,b,1/this.view.scale),null!==f))return this.view.Pa(new Id(this.view,c,f,a,b,this,d)),!0;h||(d.shiftKey||this.view.nb(),this.view.Ee(c),this.view.Nb());this.view.Pa(new Qd(this.view,this.view.mg?new Md(c.Ga()):new Nd,!g&&h,a,b,d))}else if(this.view.Us(a,b))this.view.Pa(new Qd(this.view,this.view.mg?new Md(this.view.selection[0].Ga()):new Nd,!0,a,b,d));else if(this.view.da.br())this.view.qf(null),this.view.Pa(new Oc(this.view,this,a,b));else return this.log("Disabled select box -- mobile touch active."),
this.view.qf(null),this.view.nb(),this.view.Nb(),this.view.ja(),!1;return!0};c.prototype.Za=function(){this.log("onMouseUp");return!1};c.prototype.Zb=function(a,b){this.log("keyboard: %s",a);var d=!0,c=this.view.da.get("nudge");b&&b.ctrlKey&&(c=this.view.da.get("preciseNudge"));switch(a){case "bring-to-front":this.view.Dg();break;case "send-to-back":this.view.rh();break;case "left":this.view.Fi(-1,0,c)||(this.view.wb=Math.min(this.view.wb+16,0),this.view.ic(),this.view.ja());break;case "right":this.view.Fi(1,
0,c)||(c=this.view.jc.width,this.view.wb=Math.max(-(c*this.view.scale-c),this.view.wb-16),this.view.ic(),this.view.ja());break;case "up":this.view.Fi(0,-1,c)||(this.view.ib=Math.min(this.view.ib+16,0),this.view.ic(),this.view.ja());break;case "down":this.view.Fi(0,1,c)||(c=this.view.jc.height,this.view.ib=Math.max(-(c*this.view.scale-c),this.view.ib-16),this.view.ic(),this.view.ja());break;case "select-none":this.view.nb();this.view.Nb();this.view.ja();this.view.Ea.vb&&this.view.Wb.ua("goto-toolbar");
break;case "select-all":var f=[];this.view.ha.Qf(function(a){f.push(a)});this.view.selectNodes(f);this.view.ja();this.view.Ea.vb&&this.view.Wb.ua("goto-toolbar");break;case "duplicate":this.view.duplicate();break;case "move-up":this.view.Ci();break;case "move-down":this.view.Bi();break;case "delete":this.view.di();break;case "curve-tool":this.view.Sj({});break;case "line-tool":this.view.Dk({},!1,!1);break;case "group":this.view.group();break;case "ungroup":this.view.Dh();break;case "undo":this.view.jb();
break;case "redo":this.view.Jd();break;case "cut":this.view.Vj();break;case "copy":this.view.Le();break;case "paste":this.view.mh();break;case "zoom-normal":this.view.da.get("allowZoom")?(c=this.view.ce(),this.view.scale=1,this.view.wb=-c.x,this.view.ib=-c.y,this.view.ic(),this.view.ja()):this.log("Zooming is disabled.");break;case "zoom-in":this.view.da.get("allowZoom")?this.view.jj():this.log("Zooming is disabled.");break;case "zoom-out":this.view.da.get("allowZoom")?this.view.kj():this.log("Zooming is disabled.");
break;default:d=!1}d&&(b.preventDefault(),b.stopPropagation())};c.prototype.md=function(a,b){if(b){this.view.Db=a;this.view.Vb=a;var d="fillStyle"}else this.view.Mb=a,d="strokeStyle";this.view.setProperty(d,a)};c.prototype.nd=function(a,b){b?(this.view.Db=hc(this.view.Db,a),this.view.Vb=hc(this.view.Vb,a)):this.view.Mb=hc(this.view.Mb,a);this.view.pl(a,b)};c.prototype.Gd=function(a,b){this.log("onDoubleClick");var d=this.view.ha.gb(a,b,this.view.La);this.log("hittest: %s, hasText: %s",null!==d,null!==
d&&d.wi());this.view.wa.ua("double-click",a,b,d?d.id:null);if(d&&"PathNode"===d.type()&&!this.view.da.get("allowTextInShape"))this.log("Editing text in shape is disabled.");else if(d&&d.wi())this.log("Text double-clicked."),this.view.$i({}),this.view.oa instanceof Sd&&this.view.oa.yl(d,a,b);else return!1;return!0};c.prototype.Wc=function(){return"pick"};return c}();var Td=function(){function c(a,b,d,c){this.view=a;this.hf=b;this.options=d;this.mode=c;this.Ma=!1;this.Rb=[];this.Ch={};this.from=this.Qe=null;this.log=B.create("Brush");this.ac=new Rc(this.view);this.view.nb(!0)}c.prototype.me=function(){this.Fk(this.options.lineWidth/2)};c.prototype.sc=function(){this.view.canvas.style.cursor="crosshair";this.Fk(this.options.lineWidth/2);C(window).xa("resize",this.me)};c.prototype.Hc=function(){this.view.canvas.style.cursor="default";this.view.ja();C(window).wg("resize",
this.me)};c.prototype.reset=function(){this.Ma=!1;this.Rb=[];this.Ch={}};c.prototype.Ya=function(a){a=this.ac.Ya(a);this.Ma&&this.ac.active&&this.reset();return a};c.prototype.Fk=function(a){var b=document.createElement("canvas");a*=window.devicePixelRatio||1;a*=this.view.scale;a=Math.ceil(a+1);b.width=2*a+2;b.height=2*a+2;var d=b.getContext("2d");d.beginPath();"round"===(this.options.lineCap||"round")?d.arc(a+1,a+1,a,0,2*Math.PI):d.rect(1,1,2*a-2,2*a-2);d.lineWidth=2;d.strokeStyle="#ffffff";d.stroke();
d.lineWidth=1;d.strokeStyle="#000000";d.stroke();b=b.toDataURL();this.view.canvas.style.cursor="url("+b+") "+(a+1)+" "+(a+1)+", auto"};c.prototype.sh=function(a){this.options.strokeStyle=a};c.prototype.kl=function(a){this.options.lineWidth=a;this.Fk(a/2)};c.prototype.ub=function(a){var b;if(this.ac.active)return!0;if("touchstart"===a.type){var d=a.changedTouches;var c=0;for(b=d.length;c<b;c++){var f=d[c];a=this.view.eb(f.pageX,f.pageY,!0);this.Rb.push([a]);f.identifier&&(this.Ch[f.identifier]=this.Rb[this.Rb.length-
1])}this.Ma=!0;1===this.Rb.length&&(this.Qe=this.view.Hk())}else if("touchmove"===a.type){var g=a.changedTouches;b=0;for(d=g.length;b<d;b++)f=g[b],a=this.view.eb(f.pageX,f.pageY,!0),f.identifier?f.identifier in this.Ch?c=this.Ch[f.identifier]:(c=[a],this.Rb.push(c),this.Ch[f.identifier]=c):c=this.Qq(a),c?a.x===c[c.length-1].x&&a.y===c[c.length-1].y||c.push(a):this.log("WARNING: Can't find path for touch!");!1===this.Ma&&(this.Qe=this.view.Hk(),this.Ma=!0);this.Qe?this.Qe.ja(this.lh,this):this.view.ja()}else"touchend"===
a.type&&this.Ma&&0===a.touches.length&&(this.ta(),this.Ma=!1);return!0};c.prototype.Qq=function(a){var b=0,d;var c=null;for(d=0;d<this.Rb.length;d++){var f=this.Rb[d],g=f[f.length-1].Oa(a);if(null===c||g<b)c=f,b=g}c||(c=[a],this.Rb.push(c));return c};c.prototype.Sa=function(a,b){var d=new E(a,b);this.Ma=!0;this.Rb.push([d]);1===this.Rb.length&&(this.Qe=this.view.Hk());return!0};c.prototype.lh=function(a){var b,d,c,f=this.view.Rm();a.lineCap=this.options.lineCap||"round";a.lineJoin="round"===a.lineCap?
"round":"bevel";a.lineWidth=this.options.lineWidth;var g=a.globalAlpha;"opacity"in this.options&&(a.globalAlpha=this.options.opacity);a.beginPath();var h=this.Rb;var k=0;for(d=h.length;k<d;k++){var l=h[k];a.moveTo(l[0].x,l[0].y);var n=b=1;for(c=l.length-1;b<=c;n=b+=1)n=l[n],a.lineTo(n.x,n.y)}nc(a,this.options.strokeStyle);f&&a.restore();a.globalAlpha=g};c.prototype.Ta=function(a,b){var d=new E(a,b);this.Ma&&(this.from=this.Rb[0][this.Rb[0].length-1],d.x!==this.from.x||d.y!==this.from.y)&&(this.Rb[0].push(d),
this.Qe?this.Qe.ja(this.lh,this):this.view.ja());return!0};c.prototype.Za=function(a,b,d){this.Ta(a,b,d);this.Ma=!1;this.ta();return!0};c.prototype.ta=function(){var a,b,d,c;var f=[];var g=this.Rb;var h=this.view.ha.lb;var k=0;for(d=g.length;k<d;k++){var l=g[k];if("brush"===this.mode){var n=[];1===l.length&&l.push(new E(l[0].x+.1,l[0].y+.1));if(1<l.length){var m=a=0;for(b=l.length-1;a<=b;m=a+=1)n.push(l[m].x),n.push(l[m].y);f.push(new V(this.view.ha.Ua(),"BrushNode",C.extend({points:n,layer:this.view.La},
this.options)))}}else{if("shapebrush"===this.mode){l=Ic(l,20);b=l;if(!(2>b.length)){l=b[0];m=b[b.length-1];n=40>l.Oa(m);for(a=0;a<b.length;a++){var q=b[a];for(c=a+1;c<b.length;c++){var u=b[c];20>Math.abs(q.x-u.x)&&(u.x=q.x);20>Math.abs(q.y-u.y)&&(u.y=q.y)}}q=K.ze(b).Kf();for(a=0;a<b.length;a++)c=b[a],20>Math.abs(c.x-q.x)&&(c.x=q.x),20>Math.abs(c.y-q.y)&&(c.y=q.y);n&&(l.x=m.x,l.y=m.y)}l=b}else if("freehand"===this.mode)n=l,n=Ic(n,2),n=Kc(n,4),l=n=Ic(n,.5);else if("quadratic"===this.mode){l=Ic(l,10);
a=Qc(l);n=a.ba[1];m=a.ba[2];c=a.ba[4];b=a.ba[5];l=a.ba[8];a=a.ba[9];c=((3*c-n)/2+(3*c-l)/2)/2;b=((3*b-m)/2+(3*b-a)/2)/2;q=new P;q.moveTo(n,m);q.quadraticCurveTo(c,b,l,a);n=q;n=S.mp(n);f.push(new V(this.view.ha.Ua(),"PathNode",C.extend({commands:n,fillStyle:this.view.Db,sloppiness:0,layer:this.view.La},this.options)));continue}1===l.length&&"freehand"===this.mode&&l.push(new E(l[0].x+.1,l[0].y+.1));if(1<l.length){n=new U;n.moveTo(l[0].x,l[0].y);a=l[0].$d(l[l.length-1]);m=b=1;for(c=l.length-1;b<=c;m=
b+=1)n.lineTo(l[m].x,l[m].y);a&&n.close();f.push(new V(this.view.ha.Ua(),"PathNode",C.extend({commands:n.ec(),fillStyle:this.view.Db,sloppiness:0,layer:this.view.La},this.options)))}}}this.view.ta(f);this.view.nb();k=this.view.ha.za(h,!1);f.length&&"quadratic"===this.mode?(k&&this.view.qf(k),this.view.Va()):this.view.da.get("singleStrokeBrush")?(k&&this.view.Ee(k),this.view.Va()):this.reset();this.view.Nb()};c.prototype.md=function(a,b){this.options.strokeStyle=a;if(b){this.view.Db=a;this.view.Vb=
a;var d="fillStyle"}else this.view.Mb=a,d="strokeStyle";this.view.setProperty(d,a)};c.prototype.nd=function(a){this.view.Vb=hc(this.view.Vb,a);this.options.strokeStyle=hc(this.options.strokeStyle,a);this.view.Db=this.view.Vb};c.prototype.Zb=function(a){this.log("keyboard: %s",a);"cancel"===a&&(this.log("ESC pressed. Abort brush and go back to toolbar."),this.view.Va(),this.view.Wb.ua("goto-toolbar"))};c.prototype.le=function(a,b){"defaultBrushWidth"===a?this.kl(b):"defaultBrushColour"===a&&this.sh(b)};
c.prototype.Wc=function(){return"circle"===this.mode?"ellipse":this.mode};return c}();var Ud=function(){function c(a,b,d,c,f,g){void 0===d&&(d="");void 0===c&&(c={});void 0===f&&(f=!1);void 0===g&&(g=!1);this.view=a;this.type=b;this.url=d;this.aa=c;this.Pt=f;this.Xh=g;this.node=null;this.hk=new E(0,0);this.Ck=new E(0,0);this.index=0;this.state="start";this.log=B.create("DRAWLINES");"wrap"in this.aa||(this.aa.wrap=this.view.da.get("multilineText"));"fontSize"in this.aa||(this.aa.fontSize=this.view.da.get("defaultFontSize"));this.ac=new Rc(this.view);this.view.nb(!0)}c.prototype.sc=
function(){this.log("Entering DrawLinesBehaviour");this.view.canvas.style.cursor="crosshair";this.view.da.vd()||this.view.re("click-to-place-first-point-of-line");this.view.ja()};c.prototype.reset=function(){this.sc()};c.prototype.ub=function(a){if("touchstart"===a.type){var b=a.changedTouches[0];b=this.view.eb(b.pageX,b.pageY);return this.Sa(b.x,b.y,a)}return"touchmove"===a.type?(b=a.changedTouches[0],b=this.view.eb(b.pageX,b.pageY),this.Ta(b.x,b.y,a)):"touchend"===a.type?(b=a.changedTouches[0],
b=this.view.eb(b.pageX,b.pageY),this.Za(b.x,b.y,a)):!1};c.prototype.Ya=function(a){a=this.ac.Ya(a);this.ac.active&&this.node&&this.reset();return a};c.prototype.Zb=function(a){"cancel"===a&&(null!==this.node&&this.view.Yr&&"curve"===this.type&&this.ta(),null!==this.node&&this.view.ha.removeNode(this.node),this.view.Ea.vb?this.view.Wb.ua("goto-toolbar"):this.view.Va())};c.prototype.done=function(){this.view.da.get("autoPickTool")?(this.view.Va(),this.view.xo()):this.state="start"};c.prototype.Fm=function(a,
b){this.node instanceof S&&("curve"===this.type||"arrow"===this.type||"linear-bezier"===this.type?this.node.Lg(a,b):this.node.lineTo(a,b))};c.prototype.Sa=function(a,b){var d=this.view.Fa(new E(a,b));if("start"===this.state)if(this.hk=new E(a,b),"stampline"===this.type)this.node=R.create("StampLineNode",this.view.ha.Ua(),this.view.ha),this.node.setProperty("x1",d.x),this.node.setProperty("y1",d.y),this.node.setProperty("x2",d.x),this.node.setProperty("y2",d.y),this.node.setProperty("url",this.url),
this.view.ha.Gf(this.node),this.view.re("click-to-set-the-end-of-the-line"),this.view.update(),this.index=3;else{this.node=new S(this.view.ha.Ua(),this.view.ha);this.node.setProperty("seed",Math.round(65535*Math.random()));this.node.setProperty("strokeStyle",this.view.Mb);this.node.setProperty("lineWidth",this.view.ya.lineWidth);this.node.setProperty("sloppiness",this.view.ya.sloppiness);this.node.setProperty("smoothness",this.view.ya.smoothness);for(var c in this.aa)this.aa.hasOwnProperty(c)&&this.node.setProperty(c,
this.aa[c]);this.view.ha.Gf(this.node);"arrow"===this.type&&(this.node.setProperty("arrowSize",this.view.da.Ha("defaultArrowSize")),this.node.setProperty("arrowStyle",this.view.da.Ha("defaultArrowStyle")),this.node.setProperty("arrowXOffset",this.view.da.Ha("defaultArrowXOffset")));this.node.moveTo(d.x,d.y);this.Fm(d.x,d.y);this.index=3;this.view.update();this.state="predrag"}else if("placing"===this.state)if("arrow"!==this.type&&8>this.hk.Oa(new E(a,b))&&3<this.index)this.log("Clicked close to start; automatically closing path"),
this.node instanceof S&&this.node.close(),this.ta(),this.done();else if(8>this.Ck.Oa(new E(a,b)))3<this.index?(this.node instanceof S&&this.node.it(this.index),this.ta()):this.cancel(),this.done();else{if(this.Pt)return this.ta(),this.done(),!0;this.node&&(this.Fm(d.x,d.y),this.index+=3,this.view.ha.$f(this.node.id),this.view.update())}else return this.log("Invalid state %s",this.state),!0;this.Ck=new E(d.x,d.y);return!0};c.prototype.Za=function(a,b){var d=new E(a,b);d=this.hk.Oa(d);this.log("onMouseUp (%s,%s) %s",
a,b,this.state);"predrag"===this.state&&(this.log("MovedBy: %s",d),10<d?(this.ta(),this.done()):(this.state="placing",this.view.re("click-to-place-another-point-or-double-click-to-end-the-line")));return!0};c.prototype.Ta=function(a,b,d){b=this.view.Fa(new E(a,b));a=b.x;b=b.y;if(d.ctrlKey||this.Xh){d=this.Ck;var c=Math.atan2(b-d.y,a-d.x),f=Math.PI/8;c>=-f&&c<f?b=d.y:c>=f&&c<3*f?(a=Math.max(b-d.y,a-d.x),b=d.y+a,a=d.x+a):c>=3*f&&c<5*f?a=d.x:c>=5*f&&c<7*f?(a=Math.max(b-d.y,d.x-a),b=d.y+a,a=d.x-a):c>=
7*f||c<=7*-f?b=d.y:c<5*-f?(a=Math.max(d.y-b,d.x-a),b=d.y-a,a=d.x-a):c<3*-f?a=d.x:(a=Math.max(d.y-b,a-d.x),b=d.y-a,a=d.x+a)}this.node&&(this.node.ie(this.index,a,b),this.node.format(this.view.ka,this.view.request),this.view.ja());return!0};c.prototype.nc=function(){this.log("onMouseClick()");return!0};c.prototype.oq=function(a){for(var b=0,d=[],c,f,g,h,k,l;b<a.length;){var n=a[b];switch(n){case S.yf:g=a[b+1];h=a[b+2];d.push(n,g,h);break;case S.Pd:c=a[b+1],f=a[b+2],void 0!==g&&void 0!==h&&void 0!==
k&&void 0!==l&&d.push(S.xg,c,f,(k+g)/2,(l+h)/2,(g+c)/2,(h+f)/2),k=g,l=h,g=c,h=f}b+=S.ab[n]+1}return d};c.prototype.ta=function(){if(this.node){this.node instanceof S&&this.node.Sp();this.view.ha.removeNode(this.node);var a=this.view.da.Ha("defaultArrowSize"),b=this.node.la("commands");"linear-bezier"===this.type&&(b=this.oq(b));a={arrowSize:"arrow"===this.type?a:0,arrowStyle:this.view.da.Ha("defaultArrowStyle"),arrowXOffset:this.view.da.Ha("defaultArrowXOffset"),commands:b,seed:this.node.la("seed"),
fillStyle:this.view.Db,strokeStyle:this.view.Mb,lineWidth:this.view.ya.lineWidth,sloppiness:this.view.ya.sloppiness,smoothness:this.view.ya.smoothness,layer:this.view.La};for(var d in this.aa)this.aa.hasOwnProperty(d)&&(a[d]=this.aa[d]);this.view.ta([new V(this.view.ha.Ua(),"PathNode",a)]);this.node=null}};c.prototype.cancel=function(){this.node&&(this.view.ha.removeNode(this.node),this.node=null)};c.prototype.Hc=function(){this.cancel();this.view.canvas.style.cursor="default";this.view.re("");this.view.ja()};
c.prototype.md=function(a,b){if(b){this.view.Db=a;this.view.Vb=a;var d="fillStyle";this.log("We are drawing lines. Set strokeStyle instead of fillStyle")}else d="strokeStyle";this.view.Mb=a;this.view.setProperty(d,a)};c.prototype.nd=function(a,b){b?(this.view.Db=hc(this.view.Db,a),this.view.Vb=hc(this.view.Vb,a)):this.view.Mb=hc(this.view.Mb,a);this.view.pl(a,b)};c.prototype.Wc=function(){return this.type};c.prototype.ue=function(a,b){this.aa[a]=b};return c}();var Vd=function(){function c(a,b,d,c,f,g,h){var e=this;this.view=a;this.nodeType=b;this.aa=d;this.width=c;this.height=f;this.Eo=g;this.eu=h;this.state="initial";this.start=new E(0,0);this.end=new E(0,0);this.node=null;this.log=B.create("DrawShape");"rectangle-tl"===g&&(this.Zm=function(a){a.lineWidth=1/e.view.scale;a.strokeStyle="#ccc";a.beginPath();a.rect(e.start.x,e.start.y,e.end.x-e.start.x,e.end.y-e.start.y);a.stroke()});this.ac=new Rc(this.view);this.view.nb(!0)}c.prototype.Zm=function(){};c.prototype.sc=
function(){this.log("Entering DrawShapeBehaviour");this.view.canvas.style.cursor="crosshair"};c.prototype.Hc=function(){this.log("Leaving DrawShapeBehaviour");this.cancel()};c.prototype.cancel=function(){this.node&&(this.view.ha.removeNode(this.node),this.view.update(),this.node=null);this.state="initial"};c.prototype.Ya=function(a){a=this.ac.Ya(a);this.node&&this.ac.active&&(this.view.ha.removeNode(this.node),this.node=null,this.state="initial");return a};c.prototype.Zb=function(a){"cancel"===a&&
this.view.Va()};c.prototype.ub=function(a){if("touchstart"===a.type){var b=a.changedTouches[0];b=this.view.eb(b.pageX,b.pageY);return this.Sa(b.x,b.y)}return"touchmove"===a.type?(b=a.changedTouches[0],b=this.view.eb(b.pageX,b.pageY),this.Ta(b.x,b.y,a)):"touchend"===a.type?(b=a.changedTouches[0],b=this.view.eb(b.pageX,b.pageY),this.Za(b.x,b.y,a)):!1};c.prototype.Sa=function(a,b){"initial"===this.state&&(this.start=this.view.Fa(new E(a,b)),this.state="predraw",this.log("initial -> predraw"));return!0};
c.prototype.Ta=function(a,b,d){a=this.view.Fa(new E(a,b));d=d.ctrlKey;"predraw"===this.state&&10<this.start.Oa(a)&&(this.create(),this.state="drawing",this.log("predraw -> drawing"));"drawing"===this.state&&(this.transform(this.start,a,d),this.end=a,this.view.update(!1,this.Zm));return!0};c.prototype.Za=function(a,b,d){"predraw"===this.state?this.view.da.get("clickToDrawShapes")?(this.create(),this.transform(this.start,null,d.ctrlKey),this.ta(),this.view.da.get("autoPickTool")&&this.view.Va(),this.state=
"initial"):this.cancel():"drawing"===this.state&&(this.transform(this.start,this.view.Fa(new E(a,b)),d.ctrlKey),this.ta(),this.view.da.get("autoPickTool")&&this.view.Va(),this.state="initial");return!0};c.prototype.create=function(){if(this.node=R.create(this.nodeType,this.view.ha.Ua(),this.view.ha))this.node.Cb(this.aa),this.view.ha.Gf(this.node)};c.prototype.transform=function(a,b,d){if(b)if("circle"===this.Eo){var c=a;a=a.Oa(b);var f=2*a/this.width;a=2*a/this.height}else{if("rectangle-tl"===this.Eo)a=
a.clone(),b=b.clone(),a.x>b.x&&(f=a.x,a.x=b.x,b.x=f),a.y>b.y&&(f=a.y,a.y=b.y,b.y=f),c=a;else if(f=[a,b],0===f.length)c=new E(0,0);else{c=f[0].x;for(var g=f[0].y,h=1;h<f.length;h++)c+=f[h].x,g+=f[h].y;c=new E(c/f.length,g/f.length)}f=(b.x-a.x)/this.width;a=(b.y-a.y)/this.height}else c=a,a=f=1;d&&(a=f=Math.min(f,a));d=new L(c.x,c.y);d=d.multiply(new O(f,a));this.node&&(this.node.og(d),this.view.ha.$f(this.node.id))};c.prototype.ta=function(){this.node&&(this.aa.matrix=this.node.Ga(),this.view.ha.removeNode(this.node),
this.node=null,this.view.ta([new V(this.view.ha.Ua(),this.nodeType,this.aa)]))};c.prototype.kl=function(a){this.aa.lineWidth=a};c.prototype.md=function(a,b){Hd.prototype.md.call(this,a,b);this.aa[b?"fillStyle":"strokeStyle"]=a};c.prototype.nd=function(a,b){Hd.prototype.nd.call(this,a,b);var d=b?"fillStyle":"strokeStyle",c=hc(this.aa[d],a);this.log("oldColour=%s+opacity %s = %s",this.aa[d],a,c);this.aa[d]=c};c.prototype.Wc=function(){return this.eu};c.prototype.ue=function(a,b){this.aa[a]=b};c.prototype.le=
function(a,b){"defaultLineWidth"===a&&this.kl(b)};return c}();var Wd=function(){function c(a,b){this.view=a;this.aa=b;this.ba=[];this.node=null;this.log=B.create("Wall");this.Fa=b.snap||0}c.prototype.Wc=function(){return"wall"};c.prototype.Zb=function(a){this.log("keyboard: %s",a);"cancel"===a&&(this.log("ESC pressed. Abort wall and go back to toolbar."),this.view.Va(),this.view.Wb.ua("goto-toolbar"))};c.prototype.sc=function(){this.log("Enter DrawWallBehaviour");this.view.canvas.style.cursor="crosshair"};c.prototype.Hc=function(){this.log("Leaving DrawWallBehaviour");
this.reset()};c.prototype.Sa=function(a,b,d){var c=this.view.Fa(new E(a,b),this.Fa);if(this.node){if(this.view.$r(d))return this.ta(!1),!0;d=new E(this.ba[this.ba.length-4],this.ba[this.ba.length-3]);this.log("Last point=%s new point=%s distance=%s",d,new E(a,b),d.Oa(new E(a,b)));if(10<d.Oa(new E(a,b))){if(10>c.Oa(new E(this.ba[1],this.ba[2])))return this.ba.push("Z"),this.log("Closed path!"),this.ta(!0),!0;this.ba.push(a,b);this.node.setProperty("svgpath",this.ba.join(" "));this.view.ha.$f(this.node.id)}}else this.ba=
["M",c.x,c.y,c.x,c.y],this.node=R.create("WallNode",this.view.ha.lb,this.view.ha),this.node.Cb(this.aa),this.node.setProperty("svgpath",this.ba.join(" ")),this.view.ha.Gf(this.node),this.view.tl(!0),this.view.re("click-to-place-another-point-or-double-click-to-end-the-line");this.view.update();return!0};c.prototype.Ta=function(a,b){var d=this.view.Fa(new E(a,b),this.Fa);return this.node?(this.ba[this.ba.length-2]=d.x,this.ba[this.ba.length-1]=d.y,this.node.setProperty("svgpath",this.ba.join(" ")),
this.view.ha.$f(this.node.id),this.view.update(),!0):!1};c.prototype.Za=function(a,b){var d=this.view.Fa(new E(a,b),this.Fa);if(this.node){var c=new E(this.ba[this.ba.length-4],this.ba[this.ba.length-3]);this.log("Last point=%s new point=%s distance=%s",c,new E(a,b),c.Oa(new E(a,b)));10<c.Oa(d)&&(this.ba.push(d.x,d.y),this.ta(!1));return!0}return!1};c.prototype.Gd=function(){this.ta(!1);return!0};c.prototype.ta=function(a){this.node&&(this.log("Commit()"),this.view.ha.removeNode(this.node),this.node=
null,this.ba.length-=2,3<this.ba.length&&(a&&this.ba.push("Z"),this.aa.svgpath=this.ba.join(" "),this.view.ta([new V(this.view.ha.Ua(),"WallNode",this.aa)]),this.view.nb()),this.view.tl(!1),this.view.re(""))};c.prototype.reset=function(){this.node&&(this.view.tl(!1),this.view.ha.removeNode(this.node),this.view.update(),this.view.re(""))};return c}();var $d=function(){function c(a,b,d){this.view=a;this.aa=b;this.vs=d;this.state="none";this.scale=1;this.log=B.create("ImageStamp");this.qa=document.createElement("img");this.url=this.qa.src=b.url;"scale"in this.aa&&(this.scale=this.aa.scale,delete this.aa.scale)}c.prototype.sc=function(){this.log("Entering ImageStampBehaviour");this.view.canvas.style.cursor="move"};c.prototype.Hc=function(){this.log("Leaving ImageStampBehaviour");this.view.ja()};c.prototype.ub=function(a){if("touchstart"===a.type){var b=
a.changedTouches[0];b=this.view.eb(b.pageX,b.pageY);return this.Sa(b.x,b.y,a)}return"touchmove"===a.type?(b=a.changedTouches[0],b=this.view.eb(b.pageX,b.pageY),this.Ta(b.x,b.y,a)):"touchend"===a.type?(b=a.changedTouches[0],b=this.view.eb(b.pageX,b.pageY),this.Za(b.x,b.y,a)):!1};c.prototype.Fa=function(a,b){this.qa.complete&&(a-=this.qa.width/2,b-=this.qa.height/2);return this.view.Fa(new E(a,b))};c.prototype.Sa=function(a,b,d){this.log("onMouseDown type %s",d.type);a=this.Fa(a,b);this.view.ta([new V(this.view.ha.Ua(),
"ImageNode",C.extend({},this.aa,{url:this.url,layer:this.view.La,matrix:(new L(a.x,a.y)).multiply(new O(this.scale,this.scale))}))]);this.vs||(this.log("MultiStamp not set; return to pick mode."),this.view.Va());return!0};c.prototype.Ta=function(a,b){this.qa.complete||this.log("Don't draw; image not loaded.");var d=this.Fa(a,b),c=this;this.view.ja(function(a){var b=a.globalAlpha;a.globalAlpha=.5;a.drawImage(c.qa,d.x,d.y,c.qa.naturalWidth*c.scale,c.qa.naturalHeight*c.scale);a.globalAlpha=b});return!0};
c.prototype.Za=function(){return!0};c.prototype.Zb=function(a){"cancel"===a&&(this.view.Va(),this.view.Wb.ua("goto-toolbar"))};return c}();var ae=function(){function c(){this.Gh=[];this.ij=[];this.log=B.create("SnapRules",!0)}c.prototype.Ej=function(a,b){jc(this.Gh,function(b){return b.id===a});jc(this.ij,function(b){return b.id===a});var d;for(d=0;d<b.length;d++)this.Gh.push({id:a,value:b[d].x}),this.ij.push({id:a,value:b[d].y})};c.prototype.xq=function(){this.Gh.sort(function(a,b){return a.value-b.value});this.ij.sort(function(a,b){return a.value-b.value})};c.prototype.Fa=function(a,b,d){return 0===this.Gh.length?new E(a,b):new E(this.xm(this.Gh,
a,d),this.xm(this.ij,b,d))};c.prototype.xm=function(a,b,d){for(var c=a.length,f=-1,g;1<c-f;)g=(c+f)/2|0,a[g].value<=b?f=g:c=g;-1===f&&(f=0);return Math.abs(a[f].value-b)<d?a[f].value:f+1<a.length&&Math.abs(a[f+1].value-b)<d?a[f+1].value:b};return c}();var be=function(){function c(a){this.view=a;this.log=B.create("Wall")}c.prototype.Wc=function(){return"split-wall"};c.prototype.Zb=function(a){this.log("keyboard: %s",a);"cancel"===a&&(this.log("ESC pressed. Abort wall and go back to toolbar."),this.view.Va(),this.view.Wb.ua("goto-toolbar"))};c.prototype.sc=function(){this.log("Enter SplitWallBehaviour");this.view.canvas.style.cursor="default"};c.prototype.Hc=function(){this.log("Leaving DrawWallBehaviour")};c.prototype.Sa=function(a,b,d){this.Ta(a,
b,d);var c=this.view.ha.gb(a,b,this.view.La),f,g;return c&&"WallNode"===c.type()?((f=c.ld(a,b,this.view.scale))&&"middle"===c.de(f)&&(g=this.Vt(c.Mr(),a,b))&&(g.transform(c.Ga().inverse()),f=new Mc,g.ja(f),this.view.ta([new Rd([c.id],"svgpath",f.toString())]),f=c.ld(a,b,this.view.scale)),f&&this.view.Pa(new Id(this.view,c,f,a,b,this,d)),!0):!1};c.prototype.Ta=function(a,b){this.view.Fa(new E(a,b));var d=this.view.ha.gb(a,b,this.view.La),c;if(d&&"WallNode"===d.type()&&(c=d.ld(a,b,this.view.scale))){var f=
!0;d=d.de(c);this.view.canvas.style.cursor="middle"===d?"copy":"move"}f||(this.view.canvas.style.cursor="default");return!0};c.prototype.Vt=function(a,b,d){var c,f;new E(0,0);var g=0,h=0,k=0,l=0,n=null,m=null,q=new E(b,d);a.ja({moveTo:function(a,b){var d=new E(a,b);d=q.Oa(d);if(null===n||n>d)n=d;c=a;f=b},lineTo:function(a,b){var d=new E(a,b),e=q.Oa(d);if(null===n||n>e)n=e;d=q.ei(new E(c,f),d);if(null===m||m>d)g=c,h=f,k=a,l=b,m=d;c=a;f=b},beginPath:function(){},closePath:function(){}});if(null!==n&&
(null===m||m>n))return null;var u=new P;a.ja({moveTo:function(a,b){u.moveTo(a,b);c=a;f=b},lineTo:function(a,b){c===g&&f===h&&a===k&&b===l&&u.lineTo(q.x,q.y);u.lineTo(a,b);c=a;f=b},beginPath:function(){},closePath:function(){u.closePath()}});return u};c.prototype.ta=function(){};return c}();for(var ce,de=[],ee=0;4>ee;ee++)de.push(String.fromCharCode(">2$-".charCodeAt(ee)^"zwibbler3".charCodeAt(ee%9)));ce=de.join("");for(var fe,ge=[115,116,114,111,107,101,84,101,120,116],he=[],ie=0;ie<ge.length;ie++)he.push(String.fromCharCode(ge[ie]));fe=he.join("");
var ne=function(){function c(a,b,d,e,f,g,h,k){this.ha=b;this.Ub=d;this.Wb=e;this.da=f;this.language=g;this.wa=h;this.xb=k;this.wd="none";this.Bh=this.Ah=0;this.scale=1;this.ib=this.wb=0;this.ad=new K(0,0,0,0);this.fl=new Q;this.mg=this.Oi=this.qh=!0;this.el=new M;this.selection=[];this.oe=[];this.ck=!0;this.La="default";this.we=this.ki=!1;this.dd=this.background=this.Fe=null;this.backgroundRepeat="no-repeat";this.hd=this.Ba=null;this.Be=4;this.pj=2*this.Be;this.ud=this.Ac=null;this.bk=!1;this.gd=
null;this.Df=!1;this.Vb=this.Db=this.Mb="#000000";this.Mf=5;this.Yf="";this.cc=0;this.Lk=new K(0,0,0,0);this.Mk=new K(0,0,0,0);this.Ea={vb:!1,Ma:!1,Kj:!1,x:100,y:100};this.xo=function(){};this.log=B.create("VIEW");this.canvas=a[0];this.ka=this.canvas.getContext("2d");this.we=!0===f.get("pageView");this.wh=new ae;this.gt();this.oa=new Hd(this);this.Sb=null;this.jd=new Tc("horizontal",!0,this.xb);this.jd.Gj(this.canvas.parentNode);this.fc=new Tc("vertical",!1,this.xb);this.fc.Gj(this.canvas.parentNode);
this.Gi=this.Sg();this.jc=new xc(this.canvas.width/this.Gi,this.canvas.height/this.Gi);var l=this;this.request=new kd;this.request.canvas=this.canvas;this.request.xa("reformat",function(a){l.log("Node %s requests reformat",a);l.ha.Pe(a)&&(l.log("   Reformatting... zoom=%s",l.wd),l.ha.$f(a));l.update();a===l.dd&&l.Yh();l.kg();l.wa.ua("resource-loaded")});this.request.xa("convert-dom-request",function(a,b){l.wa.ua("convert-dom-request",b,a)});f.xa("useTouch",function(){f.vd()?(l.ud=document.createElement("img"),
l.ud.setAttribute("src",f.sb("trashcan.png")),l.pj=4*l.Be):(l.ud=null,l.pj=2*l.Be)});this.fc.xa("scroll",function(a){l.ib=-a*l.scale;l.ja()});this.jd.xa("scroll",function(a){l.wb=-a*l.scale;l.ja()});this.Yh();this.ha=this.pf(b);(a=window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame)?(this.log("Using requestAnimationFrame"),this.requestAnimationFrame=a):this.log("Emulating requestAnimationFrame");this.da.xa("update",function(a,b){l.le(a,b)});this.xb.bind(C(document),
"webkitfullscreenchange",function(){0<=navigator.userAgent.search("Safari")&&0>navigator.userAgent.search("Chrome")&&(l.log("SAFARI WORKAROUND: Disabling requestAnimationFrame."),l.requestAnimationFrame=c.prototype.requestAnimationFrame)});this.oa=this.Va()}c.prototype.Fn=function(a){var b,d=-1,c=!1;for(b=0;b<a.jf.length;b++){var f=a.jf[b];this.wh.Ej(f,[]);f===this.dd&&(this.log("Background node has been removed"),d=-1)}for(b=0;b<a.bd.length;b++){f=a.bd[b];var g=this.ha.za(f,!1);this.wh.Ej(f,g.vk());
"background"===g.la("layer")&&(this.log("Background node has been added"),d=f)}for(b=0;b<a.uf.length;b++)f=a.uf[b],g=this.ha.za(f,!1),this.wh.Ej(f,g.vk()),"background"===g.la("layer")?(this.log("Background node has been changed"),d=f,c=!0):f===this.dd&&(this.log("Node removed from background layer"),d=-1);-1===d||!c&&d===this.dd||(this.dd=d,this.Yh(),this.dd&&this.ha.za(this.dd,!1).qe(!0));(a.bd.length||a.uf.length)&&this.wh.xq();a.bd.length&&this.wa.ua("nodes-added",a.bd);a.uf.length&&this.wa.ua("nodes-changed",
a.uf);a.jf.length&&this.wa.ua("nodes-removed",a.jf)};c.prototype.requestAnimationFrame=function(a){a()};c.prototype.Rg=function(){return parseInt(C(this.canvas).ea("border-left-width"),10)||0};c.prototype.Qg=function(){this.log("getActiveLayer() -> %s",this.La);return this.La};c.prototype.Pi=function(a){this.log("setActiveLayer(%s)",a);this.La=a;this.nb();this.Nb();this.ja()};c.prototype.vh=function(a,b){this.ha.vh(a,b);b||a!==this.La||(this.nb(),this.Nb());this.ja()};c.prototype.pf=function(a){this.log("setDocument()");
this.Va();this.ha=a;this.scale=1;this.ib=this.wb=0;this.selection=[];this.hd=this.Ba=null;this.cc=1;this.ad=new K(0,0,0,0);this.fl=new Q(this.ad);this.el=new M;this.ck=!0;this.Yf="";this.La="default";this.Db="#ffffff";this.Vb=this.da.Ha("defaultBrushColour");this.Mb=this.da.Ha("defaultStrokeStyle");this.ya={};this.ya.lineWidth=this.da.Ha("defaultLineWidth");this.ya.sloppiness=.5;this.ya.fontName=this.da.Ha("defaultFont");this.ya.fontSize=this.da.Ha("defaultFontsize");this.ya.bold=this.da.Ha("defaultBold");
this.ya.italic=this.da.Ha("defaultItalic");this.ya.smoothness=.3;this.ya.textFillStyle=this.da.Ha("defaultTextFillStyle");this.ya.textStrokeStyle=this.da.Ha("defaultTextStrokeStyle");this.ya.textLineWidth=this.da.Ha("defaultTextLineWidth");this.Mf=this.da.get("defaultBrushWidth");var b=this.ce();this.wb=-b.x;this.ib=-b.y;this.ic();this.ha.wl=this.da.get("spotHighlightColour");this.ha.Wi=this.da.get("spotHighlightZIndex");this.ha.format(this.ka,this.request);this.Mk=new K(0,0,0,0);this.Lk=new K(0,
0,0,0);"none"!==this.wd?this.Mc(this.wd):(this.Mc(this.da.get("defaultZoom")),this.ja());return a};c.prototype.le=function(a,b){var d=!1;switch(a){case "allowResize":this.Jf();this.ja();break;case "defaultBrushColour":this.Vb=b;break;case "defaultFillStyle":this.Db=this.ya.fillStyle=b;break;case "defaultStrokeStyle":this.Mb=b;this.ya.strokeStyle=b;break;case "defaultLineWidth":this.ya.lineWidth=b;break;case "defaultFont":this.ya.fontName=b;break;case "defaultBold":this.ya.bold=b;break;case "defaultItalic":this.ya.italic=
b;break;case "defaultFontSize":this.ya.fontSize=b;break;case "defaultTextFillStyle":this.ya.textFillStyle=b;break;case "defaultTextStokeStyle":this.ya.textStrokeStyle=b;break;case "defaultTextLineWidth":this.ya.textLineWidth=b;break;case "defaultBrushWidth":this.Mf=b;break;case "defaultZoom":this.Mc(b);break;case "pageView":this.we=b;d=!0;break;case "pagePlacement":this.Mc(this.wd);break;case "snap":case "background":case "gridSpacing":case "gridBlocks":case "gridColour":case "backgroundImage":this.Yh();
d=!0;break;case "pageShadow":case "symmetry":case "outsidePageColour":d=!0;break;case "readOnly":!0===b&&(this.Va(),this.nb(),this.Nb(),d=!0);this.ha.pg(b);break;case "spotHighlightColour":this.ha.wl=b;d=!0;break;case "spotHighlightZIndex":this.ha.Wi=b,d=!0}this.oa.le&&this.oa.le(a,b);d&&this.ja()};c.prototype.pe=function(a,b){this.ya[a]=b;"fillStyle"===a?this.Db=b:"strokeStyle"===a&&(this.Mb=b)};c.prototype.Mc=function(a){a!==this.wd&&this.log("Zooming to: %s",a);var b=this.jc.width-20;var d=this.ha.Ur();
var c=!0;this.wd=a;d||"number"===typeof a||(this.log("WARNING: Cannot zoom to page/width because the document size has not been set."),c="page"===a||"width"===a);if("number"===typeof a)this.scale=a;else if("none"===a||this.ha.empty()||!d)this.scale=1;else{if("page"===a)return d=this.ce(),this.uh(d,"centre"===this.da.get("pagePlacement"),!0),this.wd=a,this.oa.me&&this.oa.me(),c;"width"===a&&(d=this.ce(),this.scale=b/d.width,this.wb=-d.x*this.scale,this.ib=-d.y*this.scale,this.log("RECT=%s scale=%s tx=%s ty=%s",
d,this.scale,this.wb,this.ib),this.wd=a)}this.ic();this.ja();this.oa.me&&this.oa.me();return c};c.prototype.eb=function(a,b,d){void 0===d&&(d=!1);a=this.Dn().apply(a,b);d||(a=this.Fa(a));return a};c.prototype.Yj=function(a,b){return this.Dn().inverse().apply(a,b)};c.prototype.wc=function(a){return this.eb(a.pageX,a.pageY,!0)};c.prototype.Zb=function(a,b){this.oa.Zb&&this.oa.Zb(a,b);if("TEXTAREA"!==b.target.tagName&&"INPUT"!==b.target.tagName&&!this.Rr(a,b)){switch(a){case "next-page":this.Bb(this.ha.Wa+
1);break;case "previous-page":this.Bb(this.ha.Wa-1);break;case "zoom-to-page":this.da.get("allowZoom")&&this.Mc("page");break;case "zoom-to-width":this.da.get("allowZoom")&&this.Mc("width")}b.preventDefault();b.stopPropagation()}};c.prototype.gt=function(){var a=this;this.Rg();C(this.canvas).bind("gesturestart",function(b){a.log("GestureStart");a.oa.Ya&&!1!==a.oa.Ya(b)?(b.stopPropagation(),b.preventDefault()):a.log("Pass to browser")});C(this.canvas).bind("gesturechange",function(b){a.oa.Ya&&!1!==
a.oa.Ya(b)?(b.stopPropagation(),b.preventDefault()):a.log("Pass to browser")});C(this.canvas).bind("gestureend",function(b){a.log("GestureEnd");a.oa.Ya&&!1!==a.oa.Ya(b)?(b.stopPropagation(),b.preventDefault()):a.log("Pass to browser")});"ongesturestart"in this.canvas?this.log("Using native gestures"):(this.log("Using emulated gestures"),ub(this.canvas,function(b){a.oa.Ya&&!1!==a.oa.Ya(b)?(b.stopPropagation(),b.preventDefault()):a.log("Allow %s event to pass through",b.type)}));this.da.get("simulateGestures")&&
mc(this.canvas,function(b){a.log("Simulating %s",b.type);a.oa.Ya&&!1!==a.oa.Ya(b)&&(b.stopPropagation(),b.preventDefault())});var b="ontouchstart"in window,d="onpointerdown"in window,c="ongesturestart"in window,f="onmousedown"in window;this.log("Have TouchEvents: %s",b);this.log("Have PointerEvents: %s",d);this.log("Have GestureEvents: %s",c);this.log("Have MouseEvents: %s",f);d&&!this.da.get("allowPointerEvents")&&(this.log("Configuration does not allow PointerEvents"),d=!1);var g=new E(0,0),h=0,
k=0,l=!1,n=!1,m;this.xo=function(){a.log("Preventing next double click.");l=!0};if(b){this.log("Using touch events for screen movement.");var q=new Date,u=new E(0,0);C(this.canvas).bind("touchstart",function(b){if(a.oa.ub&&"touchstart"===b.type){var d=!0;300<(new Date).getTime()-q.getTime()?d=!1!==a.oa.ub(b):a.oa.Gd&&(m=new E(b.changedTouches[0].pageX,b.changedTouches[0].pageY),a.log("Double-click distance: %s",m.Oa(u)),10>m.Oa(u)?(m=a.wc(b.changedTouches[0]),d=!1!==a.oa.Gd(m.x,m.y,b)):d=!1);d&&(b.stopPropagation(),
b.preventDefault());q=new Date;u=new E(b.changedTouches[0].pageX,b.changedTouches[0].pageY)}});C(this.canvas).bind("touchmove",function(b){a.oa.ub&&!1!==a.oa.ub(b)&&(b.stopPropagation(),b.preventDefault())});C(this.canvas).bind("touchend",function(b){a.oa.ub&&!1!==a.oa.ub(b)&&(b.stopPropagation(),b.preventDefault())})}else if(d){this.log("Using pointer events for movement");C(this.canvas).bind("pointerdown",function(b){"pointerdown"===b.type&&(a.log("PointerDown"),g=new E(b.pageX,b.pageY),h=$b(),
n=!0,a.oa.Sa&&(m=a.wc(b),!1!==a.oa.Sa(m.x,m.y,b)&&(b.stopPropagation(),b.preventDefault())))});C(this.canvas).bind("pointermove",function(b){"pointermove"===b.type&&(n&&0===b.buttons&&(a.log("MISSED POINTERUP! Fixing."),v(b)),a.oa.Ta&&(m=a.wc(b),!1!==a.oa.Ta(m.x,m.y,b)&&(b.stopPropagation(),b.preventDefault())))});var v=function(b){if("pointerup"===b.type){a.log("PointerUp");m=a.wc(b);a.oa.Za&&n&&!1!==a.oa.Za(m.x,m.y,b)&&(b.stopPropagation(),b.preventDefault());n=!1;a.log("TimeDist=%s PixelDist=%s",
$b()-h,g.Oa(new E(b.pageX,b.pageY)));var d=k,c=200>$b()-h&&2>g.Oa(new E(b.pageX,b.pageY));a.log("Didclick: %s dbltime=%s",c,$b()-d);a.oa.nc&&c&&(a.log("Simulate mouseclick from pointerup"),m=a.wc(b),!1!==a.oa.nc(m.x,m.y,b)&&(b.stopPropagation(),b.preventDefault()));a.oa.Gd&&c&&300>$b()-d&&!l&&(a.log("Simulate double-click"),!1!==a.oa.Gd(m.x,m.y,b)&&(b.stopPropagation(),b.preventDefault()));c&&(k=$b(),l=!1)}};this.xb.bind(C(document),"pointerup",v)}!d||b?(this.log("Using mouse events for screen movement."),
hb(C(this.canvas),function(b){"mousemove"===b.type&&(a.oa.Ta&&(m=a.wc(b),a.oa.Ta(m.x,m.y,b)),b.preventDefault())}),ib(C(this.canvas),function(b){"mousedown"===b.type&&(n=!0,a.oa.Sa&&(m=a.wc(b),a.oa.Sa(m.x,m.y,b)),b.preventDefault())}),this.xb.bind(C(document),"mouseup",function(b){"mouseup"===b.type&&(a.oa.Za&&n&&(m=a.wc(b),a.oa.Za(m.x,m.y,b)),n=!1)}),C(this.canvas).click(function(b){"click"===b.type&&(C(a.canvas).offset(),a.oa.nc&&(m=a.wc(b),a.oa.nc(m.x,m.y,b)),b.stopPropagation(),b.preventDefault())}),
gb(C(this.canvas),function(b){if("dblclick"===b.type){C(a.canvas).offset();if(a.oa.Gd||a.oa.nc)m=a.wc(b),dc()&&a.oa.nc&&(a.log("Insert false mouse click for IE"),a.oa.nc(m.x,m.y,b)),a.oa.Gd&&a.oa.Gd(m.x,m.y,b);b.stopPropagation();b.preventDefault()}})):this.log("Not using mouse events.");C(this.canvas).bind("mouseenter",function(a){a.stopPropagation();a.preventDefault()});C(this.canvas).bind("mouseleave",function(a){a.stopPropagation();a.preventDefault()});C(this.canvas).bind("mouseover",function(a){a.stopPropagation();
a.preventDefault()});C(this.canvas).bind("mouseout",function(a){a.stopPropagation();a.preventDefault()});!window.parent&&this.da.get("setFocus")&&C(this.canvas).focus();this.Ub.bind("colour",function(b,d){a.oa.md&&a.oa.md(b,d)});this.Ub.bind("opacity",function(b,d){a.oa.nd&&a.oa.nd(b,d)});this.da.get("simulateGestures")||(b="mousewheel","onwheel"in document.createElement("div")&&(b="wheel"),a.log("Binding to '%s' for mouse wheel",b),C(this.canvas).bind(b,function(b){if("wheel"===b.type||"mousewheel"===
b.type){var d=b.wheelDelta||-40*b.deltaY,c=d/120*32;m=a.wc(b);a.log("mousewheel: delta %s",d);if((!a.oa.Qk||!1===a.oa.Qk(m.x,m.y,c,b))&&a.fc.cs()){var e=a.ce();a.ib=-120>=d?Math.max(a.ib+c,-(e.bottom()*a.scale-a.canvas.clientHeight)):Math.min(a.ib+c,-e.y*a.scale);a.ic();a.ja();b.stopPropagation();b.preventDefault()}}}));C(this.canvas).bind("dragover",function(b){a.log("Dragover");b.preventDefault()});C(this.canvas).bind("drop",function(){a.log("Drop")});C(this.canvas).bind("dragenter",function(){a.log("DragEnter")});
C(this.canvas).bind("dragleave",function(){a.log("DragLeave")})};c.prototype.Rr=function(a,b){if(!this.Ea.vb)return!1;var d=0,c=0,f=this.da.get("nudge");switch(a){case "right":d=f;break;case "left":d=-f;break;case "down":c=f;break;case "up":c=-f;break;case "enter":if(this.oa.nc){this.Ea.Ma=!1;var g="click"}else this.Ea.Ma=!this.Ea.Ma,g=this.Ea.Ma?"mousedown":"mouseup"}if(d||c)g=this.jc,this.Ea.x+=d,this.Ea.x=Math.max(this.Ea.x,0),this.Ea.x=Math.min(g.width,this.Ea.x),this.Ea.y+=c,this.Ea.y=Math.max(this.Ea.y,
0),this.Ea.y=Math.min(g.height,this.Ea.y),this.ja(),g="mousemove";return g?(b.preventDefault(),b.stopPropagation(),this.ja(),c=C(this.canvas).offset(),d=this.Ea.x+c.left-window.pageXOffset,c=this.Ea.y+c.top-window.pageYOffset,this.log("Simulate a %s at (%s,%s)",g,d,c),f=document.createEvent("MouseEvents"),f.initMouseEvent(g,!0,!0,window,0,d,c,d,c,!1,!1,!1,!1,this.Ea.Ma?1:0,null),this.canvas.dispatchEvent(f),!0):!1};c.prototype.pd=function(a){void 0===a&&(a=!1);this.Ea.vb=!0;this.Ea.Ma=!1;this.Ea.Kj=
a;this.log("Showing keyboard cursor, caret=%s",a);this.ja()};c.prototype.To=function(a){this.Ea.vb=!0;this.Ea.Kj=!1;if(0<this.selection.length){this.log("showKeyboardCursorAndStartMoving()");this.Ea.Ma=!0;var b=this.ad.Kf();this.Ea.x=b.x;this.Ea.y=b.y;this.Va();this.Pa(new Qd(this,new Md(this.selection[0].Ga()),!1,b.x-4,b.y-4,a))}this.ja()};c.prototype.Kn=function(){this.Ea.vb&&(this.Ea.vb=!1,this.ja())};c.prototype.Yr=function(){return this.Ea.vb};c.prototype.bs=function(a){var b=this.Rg(),d=C(this.canvas).offset(),
c=this.fc.si();if("changedTouches"in a){var f=a.changedTouches[0].pageX-d.left-b;a=a.changedTouches[0].pageY-d.top-b}else if("pageX"in a)f=a.pageX-d.left-b,a=a.pageY-d.top-b;else return!1;b=this.jc;return this.ud&&f>b.width-this.ud.width-c&&a<this.ud.height};c.prototype.$r=function(a){var b=this.Rg(),d=C(this.canvas).offset(),c=this.fc.si();if("changedTouches"in a){var f=a.changedTouches[0].pageX-d.left-b;a=a.changedTouches[0].pageY-d.top-b}else if("pageX"in a)f=a.pageX-d.left-b,a=a.pageY-d.top-b;
else return!1;b=this.jc;return this.Ac&&f>b.width-this.Ac.width-c&&a<this.Ac.height};c.prototype.Fa=function(a,b){void 0===b&&(b=0);b=b||this.da.get("snap")||0;var d=this.da.get("autoSnap");if(0<b){d=Math.round(a.x/b)*b;var c=Math.round(a.y/b)*b}else{if(0<d)return this.wh.Fa(a.x,a.y,d/this.scale);d=a.x;c=a.y}return new E(d,c)};c.prototype.Ci=function(){var a=this.Dc(!1);a.length&&this.ta([new je(a,je.em)])};c.prototype.Bi=function(){var a=this.Dc(!1);a.length&&this.ta([new je(a,je.dm)])};c.prototype.Dg=
function(){var a=this.Dc(!1);a.length&&this.ta([new je(a,je.Wl)])};c.prototype.rh=function(){var a=this.Dc(!1);a.length&&this.ta([new je(a,je.sj)])};c.prototype.setProperty=function(a,b){var d=this.Dc(!0);this.ya[a]=b;if(d.length){var c=[new Rd(d,a,b)];if("fillStyle"===a)for(var f=0;f<d.length;f++){var g=this.ha.za(d[f],!1);g&&(this.log("nodeType=%s closed=%s",g.type(),g.la("closed")),"PathNode"===g.type()&&!1===g.la("closed")&&c.push(new Rd([d[f]],"strokeStyle",b)))}this.ta(c)}0<this.selection.length&&
"lineWidth"===a&&"BrushNode"===this.selection[0].type()?this.Mf=b:"textFillStyle"===a&&(this.ya.textFillStyle=b)};c.prototype.ue=function(a,b){this.oa.ue&&this.oa.ue(a,b)};c.prototype.oi=function(){return this.ya.fillStyle};c.prototype.ti=function(){return this.ya.strokeStyle};c.prototype.pl=function(a,b){this.log("setSelectionOpacity(%s, fill=%s)",a,b);for(var d=this.Dc(!0),c=[],f=b?"fillStyle":"strokeStyle",g=0;g<d.length;g++){var h=d[g],k=this.ha.za(h);k&&(k=k.la(f))&&(k=hc(k,a),c.push(new Rd([h],
f,k)),this.log("   set %s of %s to %s",f,h,k))}c.length&&this.ta(c);this.log("   Affected %s of %s nodes",c.length,d.length)};c.prototype.group=function(){var a=this.Dc(!1);a.length&&this.ta([new Ad(this.ha.Ua(),a)])};c.prototype.Dh=function(){var a=this.Dc(!1);a.length&&this.ta([new ke(a)])};c.prototype.di=function(){var a=this.Dc(!1);a.length&&this.ta([new le(a)])};c.prototype.nb=function(a){void 0===a&&(a=!1);var b=!1;0<this.selection.length&&(this.cc+=1,this.selection.length=0,this.log("Clear selection. selectGeneration=%s",
this.cc),b=!0);null!==this.hd&&(this.wa.ua("selected-edit-handle",null,null),b=!0);this.Ba&&(this.log("Clear selection."),this.hd=this.Ba=null,b=!0);b&&a&&(this.Nb(),this.ja())};c.prototype.Ee=function(a){this.qf(null);if(a.cc!==this.cc&&a.Ad()===this.La){this.selection.push(a);a.cc=this.cc;if(a.yk()){for(var b=a.parent,d=0;d<b.children.length;d++)this.Ee(b.children[d]);this.Ee(b)}a.children&&0<a.children.length&&this.Ee(a.children[0])}};c.prototype.selectNodes=function(a){this.nb();for(var b=0;b<
a.length;b++)a[b].la("locked")||"PageNode"===a[b].type()||this.Ee(a[b]);this.Nb()};c.prototype.nt=function(a,b){var d=this.ha.za(a,!1);d?d.Qn()?(d!==this.Ba&&this.qf(d),this.log("Select edit handle %s",b),this.hd=b,this.wa.ua("selected-edit-handle",a,b)):this.log("selectEditHandle: That handle is not selectable."):this.log("selectEditHandle: nodeid %s does not exist.",a)};c.prototype.ta=function(a,b){void 0===b&&(b=!1);if(this.da.get("readOnly"))this.log("readOnly mode: Ignoring change.");else if(0!==
a.length){var d=this.ha.ta(a,b),c;this.ha.format(this.ka,this.request);if(d.bd.length&&!b){var f=[];for(c=0;c<d.bd.length;c++)f.push(this.ha.za(d.bd[c],!1));this.da.get("autoPickTool")&&this.selectNodes(f)}else if((this.selection.length||this.Ba)&&0<d.jf.length){f=0;this.cc+=1;for(c=0;c<this.selection.length;c++)c!==f&&(this.selection[f]=this.selection[c]),this.ha.Pe(this.selection[f].id)&&(this.selection[f].cc=this.cc,f++);this.selection.length!==f&&(this.selection.length=f);this.Ba&&!this.ha.Pe(this.Ba.id)&&
(this.log("EditNode %s no longer exists",this.Ba.id),this.Ba=null,null!==this.hd&&this.wa.ua("selected-edit-handle",null,null),this.hd=null);0!==this.selection.length||this.Ba||this.nb();this.Nb();this.log("Done selecting called.")}this.Fn(d);this.kg();this.ja();this.wa.ua("document-changed")}};c.prototype.mt=function(a){a=this.ha.Gr(a);for(var b=0;b<a.length;b++)this.Ee(a[b])};c.prototype.Nb=function(){this.Jf();this.Sb&&this.Sb.ns(this.selection);this.wa.ua("selected-nodes")};c.prototype.Jf=function(){function a(a,
b,d,e){!1!==c.qh&&c.oe.push(new Kd(b,new E(a.x+d*a.width,a.y+e*a.height),new E(a.x+(1-d)*a.width,a.y+(1-e)*a.height)))}var b;this.mg=this.Oi=this.qh=!0;var d=!1;this.oe.length=0;if(0!==this.selection.length){this.ad=this.selection[0].rect.clone();this.selection[0].la("lockSize")&&(this.qh=!1);this.selection[0].la("lockRotation")&&(this.Oi=!1);this.selection[0].la("lockPosition")&&(this.mg=!1);this.selection[0].la("lockAspectRatio")&&(d=!0);for(b=1;b<this.selection.length;b++)this.ad.Eh(this.selection[b].rect),
this.selection[b].la("lockSize")&&(this.qh=!1),this.selection[b].la("lockRotation")&&(this.Oi=!1),this.selection[b].la("lockAspectRatio")&&(d=!0),this.selection[b].la("lockPosition")&&(this.mg=!1);this.fl=1===this.selection.length?this.selection[0].jk():new Q(this.ad);var c=this,f=0<this.da.get("snap");if(1<this.selection.length){var g=new M;b=null;var h=this.ad}else b=this.selection[0],h=b.fb,g=b.Ga();this.da.get("allowResize")&&(d||(a(h,g,.5,0),a(h,g,1,.5),a(h,g,.5,1),a(h,g,0,.5)),a(h,g,0,0),a(h,
g,1,0),a(h,g,1,1),a(h,g,0,1));if(this.Oi)if(b&&b.la("rotationHandles"))for(d=b.la("rotationHandles"),b=0;b<d.length;b+=4){h=new E(d[b],d[b+1]);var k=new E(d[b+2],d[b+3]);c.oe.push(new Ld(g,h,k,f))}else c.oe.push(new Ld(g,new E(h.x+.5*h.width,h.y-10/this.scale),new E(h.x+.5*h.width,h.y+.5*h.height),f))}};c.prototype.aq=function(){for(var a=0,b=0;b<this.selection.length;b++)b!==a&&(this.selection[a]=this.selection[b]),this.ha.Pe(this.selection[a].id)&&(a+=1);this.selection.length!==a&&(this.selection.length=
a);this.Ba&&!this.ha.Pe(this.Ba.id)&&(this.Ba=null,null!==this.hd&&this.wa.ua("selected-edit-handle",null,null),this.hd=null)};c.prototype.Us=function(a,b){return this.selection.length&&this.fl.Uc(a,b)};c.prototype.Vr=function(){return 0===this.selection.length&&null===this.Ba};c.prototype.Uf=function(){var a=this.selection.concat();this.Ba&&a.push(this.Ba);return a};c.prototype.Fr=function(a){if(0===a.length)return new E(0,0);for(var b=a[0].rect.clone(),d=1;d<a.length;d++)b.Eh(a[d].rect);return b.Kf()};
c.prototype.xn=function(a){for(var b=[],d=0;d<a.length;d++)this.log("Selected id=%s",a[d].id),b.push(a[d].id);return b};c.prototype.Dn=function(){var a=C(this.canvas).offset();return(new M).multiply(new O(1/this.scale,1/this.scale)).multiply(new L(-this.wb,-this.ib)).multiply(new L(-a.left,-a.top))};c.prototype.Dc=function(a){var b=this.Uf();a||(b=this.ha.Wh(b));return this.xn(b)};c.prototype.kk=function(a){for(var b=null,d=0;d<a.length;d++){var c=this.ha.za(a[d]);c&&(null===b?b=c.rect.clone():b.Eh(c.rect))}null===
b&&(b=new K(0,0,0,0));return b};c.prototype.update=function(a,b){void 0===a&&(a=!1);if(this.ha.format(this.ka,this.request)||a)this.Jf(),this.ja(b)};c.prototype.Yh=function(){var a=this.da.get("snap"),b=null,d;var c=this.da.get("background");var f=z.ik(c),g=this.da.get("backgroundImage");this.background=this.Fe=null;this.backgroundRepeat="no-repeat";var h=this;this.log("createBackground() background=%s",c);this.log("backgroundNodeId==%s",this.dd);if("grid"===c){this.backgroundRepeat="repeat";a=this.da.get("gridBlocks");
g=this.da.get("gridSpacing");var k=(a||1)*g;b=Zb(document.body);b.width=k;b.height=k;c=b.getContext("2d");c.fillStyle="#ffffff";c.fillRect(0,0,k,k);c.beginPath();for(d=0;d<k;d+=g)if(d%k||1>a)c.moveTo(d+.5,0),c.lineTo(d+.5,k);for(d=0;d<k;d+=g)if(d%k||1>a)c.moveTo(0,d+.5),c.lineTo(k,d+.5);c.strokeStyle=this.da.get("gridColour");c.lineWidth=.5;c.stroke();if(0<a){c.beginPath();for(d=0;d<=k;d+=k)c.moveTo(d,0),c.lineTo(d,k);for(d=0;d<=k;d+=k)c.moveTo(0,d+.5),c.lineTo(k,d+.5);c.lineWidth=2;c.stroke()}}else if(g)this.request.add(0,
"image",g,null,function(a){h.log("Background image finished loading");h.background=a});else if(this.dd){if(this.log("Regenerate background image"),a=this.ha.za(this.dd,!1))c=a.rect.clone(),b=Zb(document.body),b.width=c.x+c.width,b.height=c.y+c.height,c=b.getContext("2d"),a.ja(c)}else f?(this.log("Using background colour %s",f.toString()),this.Fe=function(a,b,d,c,e){a.fillStyle=f.toString();a.fillRect(b,d,c,e)}):0<a&&"clear"!==c&&(this.backgroundRepeat="repeat",b=Zb(document.body),b.width=a,b.height=
a,c=b.getContext("2d"),c.beginPath(),c.moveTo(0,0),c.arc(0,0,3,0,2*Math.PI,!1),c.moveTo(a,0),c.arc(a,0,3,0,2*Math.PI,!1),c.moveTo(a,a),c.arc(a,a,3,0,2*Math.PI,!1),c.moveTo(0,a),c.arc(0,a,3,0,2*Math.PI,!1),c.fillStyle="#c0c0c0",c.fill());b&&document.body.removeChild(b);this.background=b};c.prototype.Ng=function(a,b,d,c,f){a.Cf=null;this.background?(a.Cf=a.createPattern(this.background,this.backgroundRepeat),a.fillStyle=a.Cf,a.fillRect(b,d,c,f)):this.Fe?this.Fe(a,b,d,c,f):"G_vmlCanvasManager"in window&&
(a.fillStyle="rgba(0, 0, 0, 0.0)",a.fillRect(b,d,c,f))};c.prototype.Cq=function(a){var b=this.ha.tk();a.beginPath();a.fillStyle="#FFFFFF";this.da.get("pageShadow")&&(a.shadowOffsetX=3/this.scale,a.shadowOffsetY=3/this.scale,a.shadowBlur=5/this.scale,a.shadowColor="rgba(0,0,0,1.0)");a.rect(0,0,b.width,b.height);a.fill();a.shadowColor="rgba(0,0,0,0.0)";a.shadowBlur=0;a.shadowOffsetX=0;a.shadowOffsetY=0;a.strokeStyle=this.da.get("pageBorderColour");a.stroke();this.Ng(a,0,0,b.width,b.height);this.Fe&&
this.Fe(a,0,0,b.width,b.height)};c.prototype.il=function(a){a?(this.log("Setting a custom background function."),this.Fe=a):this.log("Clearing custom background function.")};c.prototype.Aq=function(a){if(this.Ea.vb){var b=this.Ea.x,d=this.Ea.y,c=this.Sg();a.save();a.setTransform(c,0,0,c,0,0);a.beginPath();this.Ea.Kj?(a.moveTo(b-3,d-10),a.lineTo(b+3,d-10),a.moveTo(b-3,d+10),a.lineTo(b+3,d+10),a.moveTo(b,d-10),a.lineTo(b,d+10)):(a.moveTo(b,d-3),a.lineTo(b,d-15),a.moveTo(b,d+3),a.lineTo(b,d+15),a.moveTo(b-
3,d),a.lineTo(b-15,d),a.moveTo(b+3,d),a.lineTo(b+15,d));this.Ea.Ma&&this.ka.arc(b,d,8,0,2*Math.PI,!1);a.lineWidth=2;a.strokeStyle="#000000";a.stroke();a.restore()}};c.prototype.me=function(){var a=C(this.canvas),b=a.offset(),d=C(this.canvas.parentNode).offset(),c=a.width();a=a.height();var f=b.left-d.left;b=b.top-d.top;d=this.Rg();this.fc.moveTo(f+c-20+d,b+d);this.fc.te(20,a-20);this.jd.moveTo(f+d,b+a-20+d);this.jd.te(c-20,20);this.kg();this.ja()};c.prototype.kg=function(){if(!this.Ak()){var a=this.ce(),
b=this.jc;b=new K(0,0,b.width,b.height);a.$d(this.Mk)&&b.$d(this.Lk)||!this.Mc(this.wd)||(this.Mk=a,this.Lk=b)}};c.prototype.Rm=function(){if(this.we){var a=this.ha.tk();this.ka.save();this.ka.beginPath();this.ka.rect(0,0,a.width,a.height);this.ka.clip()}return this.we};c.prototype.ja=function(a){if(!this.Ak()&&(this.gd=a||null,!this.bk)){this.bk=!0;var b=this;this.requestAnimationFrame.call(window,function(){b.bk=!1;var a=b.Sg();a!==b.Gi&&(b.log("Detected DPR change; resize canvas now"),b.Jo(b.jc.width,
b.jc.height),b.Gi=a);var c=b.Vf(),f=c.x,g=c.y,h=c.width,k=c.height;b.ka.setTransform(1,0,0,1,0,0);b.ka.clearRect(0,0,b.canvas.width,b.canvas.height);b.we&&(b.ka.fillStyle=b.da.get("outsidePageColour"),b.ka.fillRect(0,0,b.canvas.width,b.canvas.height));b.ka.scale(a,a);b.ka.translate(b.wb,b.ib);b.ka.scale(b.scale,b.scale);var l=new L(b.wb,b.ib);l=l.multiply(new O(b.scale,b.scale));b.ka.Hu=l;b.we?b.Cq(b.ka):b.Ng(b.ka,f,g,Math.max(h,h-f),Math.max(k,k-f));b.ha.Mt();f=b.Rm();g=b.da.Ha("symmetry");if(1<
g){h=2*Math.PI/g;k=b.Fa(new E(b.canvas.width/a/2,b.canvas.height/a/2));g&1&&(l=new zc(h,k.x,k.y));for(b.ka.save();h<2*Math.PI-1E-8;)0===(g&1)&&(l=new Ac(h,k.x,k.y)),b.ka.transform(l.m11,l.m21,l.m12,l.m22,l.Ca,l.Da),b.ha.ja(b.ka),h+=2*Math.PI/g;b.ka.setTransform(1,0,0,1,0,0);b.ka.fillStyle="rgba(255,255,255,0.3)";b.ka.fillRect(0,0,b.canvas.width,b.canvas.height);b.ka.restore()}b.ha.ja(b.ka,c);b.wa.gd&&(b.ka.save(),b.wa.gd(b.ka),b.ka.restore());0<b.selection.length&&(b.ka.save(),b.Dq(b.ka),b.ka.restore());
f&&b.ka.restore();b.Ba&&b.Ba.ii(b.ka,1/b.scale,b.hd);""!==b.Yf&&b.da.get("showHints")&&(b.ka.save(),b.ka.font=10/b.scale+"px Arial",b.ka.fillStyle="#000000",b.ka.textBaseline="top",b.ka.fillText(b.Yf,0,0),b.ka.restore());b.Aq(b.ka);b.oa.lh&&b.oa.lh(b.ka);b.gd&&b.gd(b.ka);b.wa.Oe("draw",b.ka);b.ka.setTransform(1,0,0,1,0,0);0<b.selection.length&&b.ud&&b.ud.naturalWidth&&(c=b.ud.width,b.ka.drawImage(b.ud,b.canvas.width-c-b.fc.si(),0));b.Ac&&b.Ac.complete&&b.Ac.naturalWidth&&(c=b.Ac.naturalWidth,b.ka.drawImage(b.Ac,
b.canvas.width-c-b.fc.si(),0));b.ka.setTransform(a,0,0,a,0,0);b.ka.beginPath();b.ka.font="20px Arial";h=b.ka.measureText(ce).width;a=b.canvas.width/a/h;b.ka.scale(a,a);b.ka.textBaseline="top";b.ka.lineWidth=4/a;b.ka.strokeStyle="rgba(128, 128, 128, 0.1)";b.ka[fe](ce,0,0)})}};c.prototype.Dq=function(a){a.lineWidth=1/this.scale;a.strokeStyle="#888888";a.beginPath();for(var b=0;b<this.selection.length;b++){var d=this.selection[b];var c=d.Ga();d=new P(d.fb);d.transform(c);d.hi(a,[3/this.scale,3/this.scale])}a.stroke();
c=this.scale;for(b=0;b<this.oe.length;b++){d=this.oe[b];var f=this.el.apply(d.x,d.y);d instanceof Ld?this.ck&&(a.beginPath(),a.strokeStyle="#008000",a.lineWidth=3/c,a.moveTo(f.x,f.y),a.arc(f.x,f.y,6/c,0,1.5*Math.PI,!1),a.stroke()):(a.beginPath(),a.strokeStyle="#000",a.lineWidth=1/c,a.rect(f.x-this.Be/c,f.y-this.Be/c,this.Be/c*2,this.Be/c*2),a.stroke())}};c.prototype.qf=function(a){this.Ba=a};c.prototype.Gl=function(a){this.el=a};c.prototype.Vo=function(a){this.ck=a};c.prototype.Zr=function(a){return a.cc===
this.cc};c.prototype.tr=function(a,b){if(this.Ba)return null;for(var d=this.pj/this.scale,c=null,f=Number.MAX_VALUE,g=0;g<this.oe.length;g++){var h=this.oe[g],k=G(h.x,h.y,a,b);k<d&&k<f&&(f=k,c=h)}return c};c.prototype.jb=function(){this.bp(!1)};c.prototype.Jd=function(){this.bp(!0)};c.prototype.bp=function(a){if(this.da.get("readOnly"))this.log("readOnly mode: Ignoring undo.");else if(a?this.ha.He():this.ha.Ie())a=a?this.ha.Jd():this.ha.jb(),this.ha.format(this.ka,this.request),this.aq(),this.Jf(),
this.kg(),this.ic(),this.Fn(a),a=this.ha.ag,this.log("Most recent change page=%s",a),a!==this.ha.Wa?(this.log("Undo/redo switched page %s->%s",this.ha.Wa,a),this.Bb(a)):this.ja(),this.wa.ua("document-changed")};c.prototype.Vj=function(){this.Le();this.di()};c.prototype.Le=function(a,b){void 0===a&&(a=!1);var d=b?this.ha.qk(b,!1,!1):this.Uf();var c=this.ha.lt(d);0<d.length&&(!0!==a&&Ed.setItem("clipboard",c),this.log("Reset paste offset to 0"),this.Bh=this.Ah=0);return c};c.prototype.duplicate=function(){var a=
this.Dc(!1),b=this.da.get("pasteOffset"),d=b||this.da.get("pasteOffsetX");b=b||this.da.get("pasteOffsetY");0<a.length&&this.ta([new me(a,d,b)])};c.prototype.mh=function(a){var b=[];if(!a&&(a=Ed.getItem("clipboard"),!a))return;a=this.ha.Yn(a,b);var d=this.da.get("pasteOffset"),c=d||this.da.get("pasteOffsetX");d=d||this.da.get("pasteOffsetY");if(0!==c||0!==d)this.Ah+=c,this.Bh+=d,this.log("Using paste offset %s,%s",this.Ah,this.Bh),c=new L(this.Ah,this.Bh),a.push(new Pd(b,c));this.ta(a);this.update()};
c.prototype.re=function(a){""!==a?(this.Yf=this.language.get(a),this.wa.ua("hint",this.Yf)):(this.Yf="",this.wa.ua("hint",""))};c.prototype.Va=function(){return this.Pa(new Hd(this))};c.prototype.Pa=function(a){this.oa&&this.oa.Hc&&this.oa.Hc();this.oa=a;a.sc&&a.sc();a.Wc&&this.wa.ua("tool-changed",a.Wc());return a};c.prototype.mk=function(){var a=null;this.oa.Wc&&(a=this.oa.Wc());return a};c.prototype.$i=function(a){if(this.da.get("readOnly"))this.log("readOnly mode: Ignoring tool click.");else return a=
new Sd(this,a),this.Pa(a),a};c.prototype.Dk=function(a,b,d){this.da.get("readOnly")?this.log("readOnly mode: Ignoring tool click."):this.Pa(new Ud(this,"line",void 0,a,b,d))};c.prototype.ak=function(a){this.da.get("readOnly")?this.log("readOnly mode: Ignoring tool click."):(a.lineWidth=a.lineWidth||this.Mf,a.strokeStyle=a.strokeStyle||this.Vb,this.Pa(new Td(this,this.oa,a,"brush")))};c.prototype.$m=function(a){this.da.get("readOnly")?this.log("readOnly mode: Ignoring tool click."):(a.lineWidth=a.lineWidth||
this.Mf,a.strokeStyle=a.strokeStyle||this.Vb,this.Pa(new Td(this,this.oa,a,"shapebrush")))};c.prototype.Ym=function(a,b){this.da.get("readOnly")?this.log("readOnly mode: Ignoring tool click."):(a.lineWidth=a.lineWidth||this.Mf,a.strokeStyle=a.strokeStyle||this.Vb,this.Pa(new Td(this,this.oa,a,b)))};c.prototype.Sj=function(a){this.da.get("readOnly")?this.log("readOnly mode: Ignoring tool click."):this.Pa(new Ud(this,"curve",void 0,a))};c.prototype.Wt=function(a){this.da.get("readOnly")?this.log("readOnly mode: Ignoring tool click."):
this.Pa(new Ud(this,"stampline",a))};c.prototype.Jm=function(a,b){this.da.get("readOnly")?this.log("readOnly mode: Ignoring tool click."):this.Pa(new Ud(this,"arrow",void 0,a,b))};c.prototype.ce=function(){if(this.we){var a=this.ha.tk();a=new K(0,0,a.width,a.height);var b=this.da.get("pageInflation");a.Gc(b,b)}else a=this.ha.Ue();return a};c.prototype.ic=function(){if(!this.Ak())if(this.da.get("scrollbars")){var a=this.jc,b=this.ce(),d=this.Vf(),c=!1,f=!1;d.y<=b.y&&d.bottom()>=b.bottom()?this.fc.Xa():
(this.fc.show(),this.fc.Ro(Math.min(d.y,b.y),Math.max(d.bottom(),b.bottom()),d.height,-this.ib/this.scale),c=!0);d.x<=b.x&&d.right()>=b.right()?this.jd.Xa():(this.jd.show(),this.jd.Ro(Math.min(d.x,b.x),Math.max(d.right(),b.right()),d.width,-this.wb/this.scale),f=!0);f&&c?(this.fc.te(20,a.height-20),this.jd.te(a.width-20,20)):c?this.fc.te(20,a.height):f&&this.jd.te(a.width,20)}else this.fc.Xa(),this.jd.Xa()};c.prototype.ng=function(a,b,d){this.log("Set document size %s,%s",a,b);d?d.push(new Bd({width:a,
height:b})):(this.ha.setProperty("width",a),this.ha.setProperty("height",b),this.ic(),this.kg(),this.wa.ua("document-changed"));return!0};c.prototype.Fi=function(a,b,d){if(this.mg)return a*=d/this.scale,b*=d/this.scale,this.log("Nudge selection by %s, %s",a,b),d=this.Dc(!0),d.length&&(a=new L(a,b),this.ta([new Pd(d,a)])),0<d.length;this.log("Can't nudge; selection motion is locked.")};c.prototype.vf=function(a){var b=new U;var d=new E(-50,-50);var c=new E(50,-50);var f=new E(50,50);var g=new E(-50,
50);b.moveTo(d.x,d.y);b.lineTo(c.x,c.y);b.lineTo(f.x,f.y);b.lineTo(g.x,g.y);b.lineTo(d.x,d.y);b.close();a=C.extend({},{commands:b.ec(),fillStyle:this.Db,strokeStyle:this.Mb,seed:Math.round(65535*Math.random()),lineWidth:this.ya.lineWidth,sloppiness:this.ya.sloppiness,layer:this.La,wrap:this.da.get("multilineText"),fontSize:this.da.get("defaultFontSize")},a);this.log("Create an item on layer %s",this.La);this.Pa(new Vd(this,"PathNode",a,100,100,"rectangle","rectangle"))};c.prototype.Kl=function(a,
b,d,c){var e=new U;for(var g=0;g<=a;g++){var h=50*Math.sin(b),k=50*-Math.cos(b);g&1&&(h*=d,k*=d);0===g?e.moveTo(h,k):e.lineTo(h,k);b+=2*Math.PI/a}e.close();c=C.extend({},{commands:e.ec(),fillStyle:this.Db,strokeStyle:this.Mb,seed:Math.round(65535*Math.random()),lineWidth:this.ya.lineWidth,sloppiness:this.ya.sloppiness,layer:this.La,wrap:this.da.get("multilineText"),fontSize:this.da.get("defaultFontSize")},c);this.log("Create an item on layer %s",this.La);this.Pa(new Vd(this,"PathNode",c,100,100,this.da.wn(),
"polygon"))};c.prototype.Ns=function(){this.Pa(new Sc(this))};c.prototype.Fh=function(a){a=C.extend({},{commands:jd(),fillStyle:this.Db,strokeStyle:this.Mb,seed:Math.round(65535*Math.random()),lineWidth:this.ya.lineWidth,sloppiness:this.ya.sloppiness,layer:this.La,wrap:this.da.get("multilineText"),fontSize:this.da.get("defaultFontSize")},a||{});this.Pa(new Vd(this,"PathNode",a,100,100,this.da.wn(),"circle"))};c.prototype.Ll=function(a,b,d,c,f){this.Pa(new Vd(this,a,b,d,c,f,"shape"))};c.prototype.nu=
function(a,b){this.Pa(new $d(this,a,b))};c.prototype.Jl=function(a){var b=this.ha.za(a,!1);if(!b)return this.log("useEditHandleTool: node %s doesn't exist.",a),!1;if(!b.Xf())return this.log("useEditHandleTool: nodetype %s has no edit mode",b.type()),!1;this.Va();this.nb();this.Nb();this.qf(b);this.ja()};c.prototype.Nl=function(a){this.Pa(new Wd(this,a))};c.prototype.Ml=function(){this.Pa(new be(this))};c.prototype.xs=function(){if("interactive"===this.da.get("textMode"))this.$i({});else{var a=this.ha.Ua();
var b=this.Fa(new E(100,100));b=new L(b.x,b.y);this.ta([new V(a,"TextNode",{text:this.da.Ha("defaultText"),fontSize:this.ya.fontSize,fontName:this.ya.fontName,bold:this.ya.bold,italic:this.ya.italic,textFillStyle:this.ya.textFillStyle,strokeStyle:this.ya.textStrokeStyle,lineWidth:this.ya.textLineWidth,layer:this.La}),new Pd([a],b)])}};c.prototype.eo=function(a){var b=this.ha.Ua();var d=this.Fa(new E(100,100));d=new L(d.x,d.y);this.ta([new V(b,"ImageNode",{url:a,layer:this.La}),new Pd([b],d)]);this.Va()};
c.prototype.Wf=function(){return ec()};c.prototype.Es=function(a,b){this.oa.md?(this.log("Simulating click of colour %s",a),this.oa.md(a,b)):this.log("A colour is not needed for this tool.")};c.prototype.Js=function(a,b){this.oa.nd?(this.log("Simulating opacity change %s",a),this.oa.nd(a,b)):this.log("An opacity is not needed for this tool.")};c.prototype.Bb=function(a){this.ha.Bb(a)&&(this.nb(),this.Nb(),this.ja(),this.wa.ua("set-page",a))};c.prototype.nl=function(a){this.we=a;a=this.ce();this.wb=
-a.x;this.ib=-a.y;this.ic();this.ja()};c.prototype.jj=function(){this.Mc(this.da.cl(1.1*this.scale))};c.prototype.kj=function(){this.Mc(this.da.cl(this.scale/1.1))};c.prototype.Pg=function(a,b,d){d=d||this.Fr(a);b=new Ac(b,d.x,d.y);this.ta([new Pd(this.xn(a),b)])};c.prototype.mn=function(a,b){this.Vr()||this.log("flipSelection: selection is empty");this.Pg(this.Uf(),a,b)};c.prototype.Sg=function(){var a=this.ka;return(window.devicePixelRatio||1)/(a.jv||a.Zu||a.$u||a.bv||a.Su||1)};c.prototype.Jo=function(a,
b){var d=this.Sg();this.canvas.width=a*d;this.canvas.height=b*d;this.canvas.style.width=a+"px";this.canvas.style.height=b+"px";this.jc.width=a;this.jc.height=b};c.prototype.Vf=function(){var a=this.jc;return new K((0-this.wb)/this.scale,(0-this.ib)/this.scale,a.width/this.scale,a.height/this.scale)};c.prototype.uh=function(a,b,d){void 0===b&&(b=!1);void 0===d&&(d=!1);this.log("setViewRect(%s)",a);var c=this.jc,f=Math.min(c.width/a.width,c.height/a.height),g=a.x*f,h=a.y*f;this.wb=b?(c.width-a.width*
f)/2-g:-g;this.ib=d?(c.height-a.height*f)/2-h:-h;this.wd=this.scale=f;this.ic();this.ja()};c.prototype.Wq=function(a){this.request.Ge?(this.log("Formatting in progress; will call function soon"),this.request.once("done",a)):(this.log("Format already done; call function in 1 tick"),setTimeout(a,0))};c.prototype.Ai=function(a){!this.Df&&a?(this.log("Locking updates."),this.Df=!0):this.Df&&!a&&(this.log("Resuming updates"),this.Df=!1,this.kg(),this.ic(),this.ja())};c.prototype.Ak=function(){this.Df&&
this.log("Updates are locked. Ignoring draw/format request");return this.Df};c.prototype.tl=function(a){var b=this;a?(b.Ac=document.createElement("img"),b.Ac.setAttribute("src",b.da.sb("wd-done.png")),b.Ac.onload=function(){b.ja()}):b.Ac=null};c.prototype.Hk=function(){var a=this,b=document.createElement("canvas");b.width=this.canvas.width;b.height=this.canvas.height;var d=b.getContext("2d"),c=this,f=!1;c.ja(function(){d.drawImage(a.canvas,0,0);f=!0});return{ja:function(a,d){c.requestAnimationFrame.call(window,
function(){if(f&&(c.ka.setTransform(1,0,0,1,0,0),c.ka.clearRect(0,0,c.canvas.width,c.canvas.height),c.ka.drawImage(b,0,0),a)){var e=c.Sg();c.ka.scale(e,e);c.ka.translate(c.wb,c.ib);c.ka.scale(c.scale,c.scale);a.call(d,c.ka)}})}}};return c}();var oe=function(){function c(a,b,d){var c=this;this.wa=a;this.ia=b;this.xb=new sb;this.qg=!1;this.io=this.lo=-1;this.tm=!1;this.Vn=this.Wn=0;this.wf="";this.vg=null;this.log=B.create("APP");this.ia.empty();"absolute"!==this.ia.ea("position")&&"fixed"!==this.ia.ea("position")&&this.ia.ea("position","relative");this.ia.ea("overlow","none");this.ia.ea("text-align","left");this.Lf=new tb(C("<div>").ea("width","300px"),this.xb);this.log("Zwibbler built on %s",new Date(1524457528730));this.ia.append(this.Lf.ia);
this.da=new qd(d);this.language=new wb("\nen:arrowhead-size:Arrowhead size\nes:arrowhead-size:Flecha tama\u00f1o\n\nen:arrowhead-size-large:Large\nes:arrowhead-size-large:Grande\n\nen:arrowhead-size-medium:Medium\nes:arrowhead-size-medium:Medio\n\nen:arrowhead-size-none:None\nes:arrowhead-size-none:Nada\n\nen:arrowhead-size-small:Small\nes:arrowhead-size-small:Peque\u00f1o\n\nen:arrowhead-size-tiny:Tiny\nes:arrowhead-size-tiny:Diminuto\n\nen:arrowhead-style:Arrowhead style\nes:arrowhead-style:Flecha estilo\n\nen:arrowhead-style-simple:Simple\nes:arrowhead-style-simple:Llanura\n\nen:arrowhead-style-solid:Solid\nes:arrowhead-style-solid:Denso\n\nen:arrow-keys:Arrow Keys\nes:arrow-keys:Teclas de flecha\n\nen:arrow-tool:Arrow tool\nes:arrow-tool:Flecha\nfr:arrow-tool:Fl\u00e8che\nnl:arrow-tool:Pijl\n\nen:break-apart-group:Break apart group\nes:break-apart-group:Dividir el grupo\n\nen:bring-to-front:Bring to front\nes:bring-to-front:Traer al frente\n\nen:brush-tool:Brush tool\nes:brush-tool:Brocha\nfr:brush-tool:Brosse\nnl:brush-tool:Penseel\n\nen:circle-tool:Circle tool\nes:circle-tool:C\u00edrculo\nfr:circle-tool:Cercle\nnl:circle-tool:Cirkel\n\nen:click-to-place-another-point-or-double-click-to-end-the-line:Click to place another point, or double-click to end the line.\nes:click-to-place-another-point-or-double-click-to-end-the-line:Haga clic para colocar otro punto, o doble clic para finalizar la l\u00ednea\nfr:click-to-place-another-point-or-double-click-to-end-the-line:Cliquez pour placer un autre point, ou double-cliquez pour terminer la ligne.\nnl:click-to-place-another-point-or-double-click-to-end-the-line:Klik op een ander punt te plaatsen, of dubbelklik om de lijn te be\u00ebindigen.\n\nen:click-to-place-first-point-of-line:Click to place first point of line\nes:click-to-place-first-point-of-line:Haga clic para colocar el primer punto de la l\u00ednea\nfr:click-to-place-the-first-point-of-line:Cliquez pour placer le premier point de la ligne\nnl:click-to-place-the-first-point-of-line:Klik om het eerste punt van de lijn te plaatsen.\n\nen:click-to-set-the-end-of-the-line:Click to set the end of the line\nes:click-to-set-the-end-of-the-line:Haga clic para colocar el extremo de la l\u00ednea\nfr:click-to-set-the-end-of-the-line:Cliquez pour d\u00e9finir la fin de la ligne\nnl:click-to-set-the-end-of-the-line:Klik hier voor het einde van de lijn in te stellen.\n\nen:copy:Copy\nes:copy:Copiar\nfr:copy:Copie\nnl:copy:Kopi\u00ebren\n\nen:curve-tool:Curve tool\nes:curve-tool:Curva\nfr:curve-tool:Courbes\nnl:curve-tool:Kromme\n\nen:delete-selection:Delete selection\nes:delete-selection:Eliminar la selecci\u00f3n\n\nen:del-key:Del\nes:del-key:Del\n\nen:double-arrows:Double arrows\nes:double-arrows:flechas dobles\n\nen:draw-curves:Draw curves\nes:draw-curves:Dibuje las curvas\n\nen:draw-lines:Draw lines\nes:draw-lines:Dibujar l\u00edneas\n\nen:duplicate-selection:Duplicate selection\nes:duplicate-selection:Duplica la selecci\u00f3n\n\nen:fill-colour:Fill colour\nes:fill-colour:Color de relleno\n\nen:font:Font\nes:font:Font\n\nen:font-size:Font size\nes:font-size:Tama\u00f1o de letra\n\nen:group-selection:Group selection\nes:group-selection:Grupo la selecci\u00f3n\n\nen:image-tool:Image tool\nes:image-tool:Imagen\nfr:image-tool:Image\nnl:image-tool:Afbeelding\n\nen:image-url:Image URL\nes:image-url:URL de la imagen\n\nen:keyboard:Keyboard\nes:keyboard:Teclado\n\nen:line-style:Line style\nes:line-style:Estilo de l\u00ednea\n\nen:line-style-long-dashes:Long dashes\nes:line-style-long-dashes:Gui\u00f3n largo\n\nen:line-style-short-dashes:Short dashes\nes:line-style-short-dashes:Gui\u00f3n corto\n\nen:line-style-solid:Solid\nes:line-style-solid:Denso\n\nen:line-tool:Line tool\nes:line-tool:Raya\nfr:line-tool:Lignes\nnl:line-tool:Lijn\n\nen:move-selection-away:Move selection away\nes:move-selection-away:Mover la selecci\u00f3n de distancia\n\nen:move-selection-closer:Move selection closer\nes:move-selection-closer:Mover la selecci\u00f3n de distancia\n\nen:move-while-zoomed:Move while zoomed\nes:move-while-zoomed:Desplazarse por la pantalla\n\nen:none:None\nes:none:Nada\n\nen:no:No\nes:no:No\n\nen:outline-colour:Outline colour\nes:outline-colour:Color del contorno\n\nen:outline-thickness:Outline thickness\nes:outline-thickness:Grosor del contorno\n\nen:page-down-key:Page Down\nes:page-down-key:Page Down\n\nen:page-up-key:Page Up\nes:page-up-key:Page Up\n\nen:paste:Paste\nes:paste:Pegar\nfr:paste:Coller\nnl:paste:Plak\n\nen:pick-tool:Pick tool\nes:pick-tool:Seleccionar\nfr:pick-tool:S\u00e9lectionner\nnl:pick-tool:Uitkiezen\n\nen:rectangle-tool:Rectangle tool\nes:rectangle-tool:rect\u00e1ngulo\nfr:rectangle-tool:Rectangle\nnl:rectangle-tool:Rechthoek\n\nen:redo:Redo\nes:redo:Rehacer\nfr:redo:Refaire\nnl:redo:Opnieuw maken\n\nen:rounded-rectangle-tool:Rounded rectangle tool\nes:rounded-rectangle-tool:Rect\u00e1ngulo redondeado\n\nen:save:Save\nes:save:Guardar\n\nen:send-to-back:Send to back\nes:send-to-back:Enviar a la parte posterior\n\nen:shadow:Shadow\nes:shadow:Sombra\n\nen:shape-brush-tool:Shape brush tool\nes:shape-brush-tool:Brush que dibuja formas\n\nen:sloppiness-artist:Artist\nes:sloppiness-artist:Artista\n\nen:sloppiness-cartoonist:Cartoonist\nes:sloppiness-cartoonist:Caricaturista\n\nen:sloppiness-child:Child\nes:sloppiness-child:Ni\u00f1o\n\nen:sloppiness-draftsman:Draftsman\nes:sloppiness-draftsman:Dibujante\n\nen:sloppiness-drunk:Drunk\nes:sloppiness-drunk:Borracho\n\nen:sloppiness:Sloppiness\nes:sloppiness:La dejadez\n\nen:smoothness-sharper:Sharper\nes:smoothness-sharper:Muy afilado\n\nen:smoothness-sharpest:Sharpest\nes:smoothness-sharpest:M\u00e1s afilado\n\nen:smoothness-sharp:Sharp\nes:smoothness-sharp:Afilado\n\nen:smoothness-smoothest:Smoothest\nes:smoothness-smoothest:Muy liso\n\nen:smoothness:Smoothness\nes:smoothness:Lisura\n\nen:smoothness-smooth:Smooth\nes:smoothness-smooth:Liso\n\nen:text-colour:Text colour\nes:text-colour:Color del texto\n\nen:text:Text\nes:text:Texto\n\nen:text-tool:Text tool\nes:text-tool:Texto\nfr:text-tool:Texte\nnl:text-tool:Tekst\n\nen:thickness-brush:Brush\nes:thickness-brush:Brocha\n\nen:thickness-marker:Marker\nes:thickness-marker:Rotulador\n\nen:thickness-pencil:Pencil\nes:thickness-pencil:L\u00e1piz\n\nen:thickness-pen:Pen\nes:thickness-pen:Pluma\n\nen:undo:Undo\nes:undo:Deshacer\nfr:undo:D\u00e9faire\nnl:undo:Ongedaan maken\n\nen:yes:Yes\nes:yes:S\u00ed\n\nen:zoom-in:Zoom in\nes:zoom-in:Zoom\n\nen:zoom-out:Zoom out\nes:zoom-out:Disminuir el zoom\n");
this.language.Po(this.da.get("language"));this.cd=null;this.Sd=C("<div>");this.Sd.ea("position","absolute");this.Sd.ea("overflow","hidden");this.ia.append(this.Sd);this.canvas=C(Zb(this.Sd[0]));this.canvas.ea("outline","0");this.canvas.ea("position","absolute");this.canvas.ea("left","0");this.canvas.ea("top","0");this.canvas.Jb("tabindex","0");this.ka=this.canvas[0].getContext("2d");a=this.da.vd();this.Ub=new oc(this.ia,a?40:20,a,!1,this.da.get("colourPalette"));this.da.xa("useTouch",function(a,b,
d){d||(c.da.vd()?(a=40,b=!0):(a=20,b=!1),c.Ub.te(a,b),c.Bg(!0))});this.Wb=new Hb;this.view=new ne(this.canvas,new zd,this.Ub,this.Wb,this.da,this.language,this.wa,this.xb);this.Ko();this.toolbar=this.ai();this.wa.xa("tool-changed",function(a){c.toolbar.Io(a)});this.es=this.It();this.Sb=new rd(this.da,this.language,this.xb);this.ia.append(this.Sb.ia);this.da.Uo()&&(this.view.Sb=this.Sb);this.Sb.view=this.view;this.Sb.xa("click",function(){c.focus("none")});this.xb.bind(C(window),"resize",function(){setTimeout(function(){c.Bg()},
1)});window.$&&(this.log("jQuery detected; register for bootstrap events"),window.$(document).bind("shown.bs.modal",function(){c.log("Bootstrap modal shown; resize now");c.wa.resize()}));this.query=od();this.qg="debug"in this.query||this.da.qg();this.zc=new Ob(this.ia);this.zc.ia.ea("border-right","1px solid black");this.Ec=new Ob(this.ia);this.Ec.ia.ea("border-top","1px solid black");this.Ec.xa("click",function(a){c.view.eo(a)});this.zc.xa("click",function(a){c.Qi(a)});null!==this.da.Ha("backgroundImage")&&
(this.Qi(this.da.Ha("backgroundImage")),this.view.ha.oh());this.Kq();this.da.xa("update",function(a,b){c.le(a,b)});this.$b=new pc(this.wa,C("<div>"),!1,!this.da.get("showPageSelectorControls"));this.$b.ia.ea("position","absolute");this.$b.ia.ea("top","0");this.$b.ia.ea("bottom","0");this.$b.ia.ea("width","160px");this.$b.ia.ea("left","50px");this.$b.ia.ea("background",this.da.get("outsidePageColour"));this.$b.Ri(this.da.get("showPageSelector"));this.ia.append(this.$b.ia);this.Xk=C("<div>").ea("position",
"absolute").ea("top","0").ea("right","0").ea("box-shadow","3px 3px 3px #444").ea("background","#ccc").ea("color","black").ea("border-bottom-left-radius","4px").ea("font-family","arial,sans");this.ia.append(this.Xk);this.Bg();this.Uj=(a=this.da.nk("pageSelectorDiv"))?new pc(this.wa,C(a),!0,!0):null;this.da.get("setFocus")&&this.focus("toolbar");this.fi=[];this.$b.hl(this.wa);this.Uj&&(this.Uj.hl(this.wa),this.Uj.Ri(!0));this.wa.ua("document-changed");this.wa.ua("set-page",this.view.ha.Wa);if(Ed.Th()){if(this.da.get("persistent")&&
(a=Ed.getItem("zwibbler-document")))try{var f=Dd.qj(a);if(f)this.pf(f);else throw Error("Failed to open document.");}catch(g){this.log("Failed to load persistent document: %s",g.message)}this.vg=Fd(function(){c.da.get("persistent")&&(c.log("Saving document"),Ed.setItem("zwibbler-document",c.wa.save()))});this.wa.xa("document-changed",function(){c.vg()});this.xb.add(function(){c.vg.cancel()})}this.xb.add(function(){c.ia.empty();delete c.ia[0].zwibbler})}c.prototype.Nf=function(){this.xb.Nf()};c.prototype.le=
function(a,b){var c=!1;this.log("onConfigChange %s=%s",a,b);switch(a){case "debug":case "showDebug":this.qg=b;c=!0;break;case "showPageSelector":c=!0;this.$b.Ri(b);break;case "backgroundImage":this.Qi(b);break;case "colourPalette":this.Ub.rt(b);break;case "showToolbar":case "showColourPanel":c=!0;break;case "showArrowTool":case "showBrushTool":case "showCircleTool":case "showCopyPaste":case "showCurveTool":case "showLineTool":case "showMoveToFrontBack":case "showPickTool":case "showRoundRectTool":case "showShapeBrushTool":case "showSquareTool":case "showTextTool":case "showUndoRedo":case "toolbarButtonSize":this.ai();
c=!0;break;case "language":this.language.Po(b)}c&&this.Bg(!0)};c.prototype.Kq=function(){var a;var b=this.da.Ha("fonts");var c=[];var e=0;for(a=b.length;e<a;e++){var f=b[e];this.log("Preloading: %s",f);f=C("<div>").ea("font-family",f).text("abcd");f.ea("color","transparent");c.push(this.ia.append(f))}};c.prototype.Ko=function(){this.da.Ha("sloppy")||this.view.pe("sloppiness",0);this.view.pe("smoothness",this.da.lr());this.view.pe("fillStyle",this.da.Ha("defaultFillStyle"));this.view.pe("strokeStyle",
this.da.Ha("defaultStrokeStyle"));this.view.pe("fontName",this.da.Ha("defaultFont"));this.view.pe("fontSize",this.da.Ha("defaultFontSize"));this.view.pe("lineWidth",this.da.Ha("defaultLineWidth"));this.view.pe("textFillStyle",this.da.Ha("defaultTextFillStyle"))};c.prototype.pt=function(a,b){var c;this.zc.clear();b&&this.zc.Si(b,b);var e=[];var f=0;for(c=a.length;f<c;f++){var g=a[f];"string"===typeof g?e.push(this.zc.Rh(g,g)):e.push(this.zc.Rh(g.small,g.large,g.tooltip))}};c.prototype.At=function(a,
b){var c;this.Ec.clear();var e=[];b&&this.Ec.Si(b,b);var f=0;for(c=a.length;f<c;f++){var g=a[f];"string"===typeof g?e.push(this.Ec.Rh(g,g)):e.push(this.Ec.Rh(g.small,g.large,g.tooltip))}};c.prototype.pf=function(a){this.cd=null;this.view.pf(a);this.Ko();this.Pq();this.wa&&(this.wa.ua("document-changed"),this.wa.ua("set-page",a.Wa));for(a=0;a<this.fi.length;a++){var b=this.fi[a];this.log("Removing old DomElement of type %s",b.tagName);C(b).remove()}this.fi=[]};c.prototype.fq=function(){this.view.ha.oh()};
c.prototype.ai=function(){function a(a){return 0===a.type.indexOf("key")}var b,c=this;this.toolbar&&this.toolbar.ia.remove();var e=this.language.fn(),f=new Ib(this.da.get("toolbarButtonSize"));this.toolbar=f;if(this.da.get("showToolbar")){this.da.get("showPickTool")&&f.De("pick",e("pick-tool"),this.da.sb("wd-pick.png"),function(b){c.view.Va();a(b)&&c.pd()});this.da.get("showSquareTool")&&f.hc(this.da.sb("wd-box.png"),e("rectangle-tool"),function(b){c.view.vf({});a(b)&&c.zl(b)});this.da.get("showRoundRectTool")&&
f.hc(this.da.sb("wd-roundrect.png"),e("rounded-rectangle-tool"),function(b){c.view.vf({roundRadius:c.da.get("defaultRoundRectRadius")});a(b)&&c.zl(b)});this.da.get("showCircleTool")&&f.hc(this.da.sb("wd-circle.png"),e("circle-tool"),function(b){c.view.Fh({});a(b)&&c.zl(b)});this.da.get("showShapeBrushTool")&&f.De("shapebrush",e("shape-brush-tool"),this.da.sb("wd-shapebrush.png"),function(b){c.view.$m({});a(b)&&c.pd()});this.da.Kt()&&f.De("brush",e("brush-tool"),this.da.sb("wd-brush.png"),function(b){c.view.ak({});
a(b)&&c.pd()});this.da.get("showLineTool")&&f.De("line",e("line-tool"),this.da.sb("wd-line.png"),function(b){c.view.Dk({angleArcs:c.da.get("angleArcs")},!1,!1);a(b)&&c.pd()});this.da.get("showCurveTool")&&f.De("curve",e("curve-tool"),this.da.sb("wd-curve.png"),function(b){c.view.Sj({});a(b)&&c.pd()});this.da.get("showArrowTool")&&f.De("arrow",e("arrow-tool"),this.da.sb("wd-arrow.png"),function(b){c.view.Jm({},!1);a(b)&&c.pd()});this.da.get("showTextTool")&&f.De("text",e("text-tool"),this.da.sb("wd-text.png"),
function(b){c.view.xs();a(b)&&c.pd(!0)});var g=function(a){c.toolbar.hc(a.image,a.name,function(b){c.Hs(b,a)})};var h=0;for(b=Cd.buttons.length;h<b;h++){var k=Cd.buttons[h];this.log("add custom button %s",name);g(k)}f.Io("pick");this.da.Ha("showImageTool")&&f.hc(this.da.sb("wd-image.png"),e("image-tool"),function(){c.view.eo("logo.png")});this.da.Ha("showMoveToFrontBack")&&(f.hc(this.da.sb("wd-moveup.png"),e("bring-to-front"),function(){c.view.Dg()}),f.hc(this.da.sb("wd-movedown.png"),e("send-to-back"),
function(){c.view.rh()}));this.da.get("showUndoRedo")&&(f.hc(this.da.sb("wd-undo.png"),e("undo"),function(){c.view.jb()}),f.hc(this.da.sb("wd-redo.png"),e("redo"),function(){c.view.Jd()}));this.da.get("showCopyPaste")&&(f.hc(this.da.sb("wd-copy.png"),e("copy"),function(){c.view.Le()}),f.hc(this.da.sb("wd-paste.png"),e("paste"),function(){c.view.mh()}))}f.xa("click",function(){c.focus("toolbar")});f.ia.style.position="absolute";f.ia.style.left="0";f.ia.style.right="0";this.ia.append(C(f.ia));return f};
c.prototype.Hs=function(a,b){this.log("Custom button %s clicked.",b.name);b.onclick.call(a.target,this.wa)};c.prototype.It=function(){var a=this;this.wf="none";var b=new Kb;this.da.Pp(b);b.xa("*",function(b,c){"toolbar"===a.wf?a.toolbar.Zb(b,c):"canvas"===a.wf?a.view.Zb(b,c):a.log("Ignore key action -- don't have focus.")});this.ia.Jb("tabindex","0");b.Qp(this.ia[0]);this.xb.add(function(){a.es.detach(a.ia[0])});this.view.ki=!1;this.canvas.click(function(){dc()||a.view.ki?a.wf="canvas":a.focus("canvas");
a.view.ki=!1});C(this.toolbar.ia).click(function(){a.focus("toolbar")});this.Ub.xa("colour",function(){a.focus("canvas")});this.Wb.xa("goto-toolbar",function(){a.da.get("showToolbar")?a.focus("toolbar"):a.wa.ua("blur")});this.Wb.xa("goto-canvas",function(){a.focus("canvas")});this.xb.bind(this.ia,"blur",function(){a.log("Blur event received -- hide keyboard cursor");a.view.Kn()});return b};c.prototype.focus=function(a){this.log("Set focus to %s",a);if("toolbar"!==a&&"canvas"!==a&&"none"!==a)throw"Focus must be toolbar or canvas or none, not "+
a;this.wf=a;"toolbar"===this.wf?(this.toolbar.focus(),this.view.Kn(),this.ia.focus()):"canvas"===this.wf&&(this.toolbar.blur(),this.ia.focus())};c.prototype.zl=function(a){this.focus("canvas");this.view.To(a)};c.prototype.pd=function(a){void 0===a&&(a=!1);this.focus("canvas");this.view.pd(a)};c.prototype.createNode=function(a,b,c){var d=this.view.ha.Ua();"layer"in c||(c.layer=this.view.La);a.push(new V(d,b,c));return d};c.prototype.transformNode=function(a,b,c){a.push(new Pd(b,c));return!0};c.prototype.ml=
function(a,b,c,e,f,g,h,k){c=new M(c,f,e,g,h,k);a.push(new Rd(b,"matrix",c));return!0};c.prototype.ej=function(a,b,c,e){c=new L(c,e);a.push(new Pd(b,c));return!0};c.prototype.dl=function(a,b,c,e,f,g){c=new O(c,e,f,g);a.push(new Pd(b,c));return!0};c.prototype.rc=function(a,b){a.push(new le(b));return!0};c.prototype.Pq=function(){var a=this;this.cd=null;this.view.ha.yb(!1,function(b){"ImageNode"!==b.type()||"background"!==b.la("layer")&&"background"!==b.la("tag")||(a.log("Found background image at nodeid %s",
b.id),a.cd=b.id,b.qe(!0))})};c.prototype.Qi=function(a){var b=[];null!==this.cd&&this.view.ha.Pe(this.cd)&&b.push(new le([this.cd]));if(a){var c=this.view.ha.Ua();b.push(new V(c,"ImageNode",{url:a,locked:!0,tag:"background",layer:this.view.La}));b.push(new je([c],je.sj))}this.cd=c||null;this.view.ta(b);c&&this.view.ha.za(c,!1).qe(!0);this.view.nb();this.view.Nb()};c.prototype.fr=function(){return null!==this.cd&&this.view.ha.Pe(this.cd)?this.view.ha.za(this.cd).la("url"):null};c.prototype.Gk=function(){this.pf(new zd);
null!==this.da.Ha("backgroundImage")&&(this.Qi(this.da.Ha("backgroundImage")),this.view.ha.oh())};c.prototype.Bg=function(a){void 0===a&&(a=!1);var b,c,e;var f=C(window).width();var g=C(window).height();if(a||f!==this.Wn||g!==this.Vn)if(this.Wn=f,this.Vn=g,f=this.ia.width()-0,g=this.ia.height()-0,!(0>=f||!a&&f===this.lo&&g===this.io)){this.lo=f;this.io=g;if(this.da.Ha("showBackgroundSelector")){var h=100;this.zc.show();this.zc.Si(h-24,0)}else h=0,this.zc.Xa();if(this.da.Ha("showImageSelector")){var k=
100;this.Ec.Si(0,k-24);this.Ec.show()}else k=0,this.Ec.Xa();if(this.da.Ha("showPageSelector")){this.$b.ia.show();var l=this.$b.ia.outerWidth()}else this.$b.ia.Xa(),l=0;if(this.da.Lt()){this.Ub.show();this.Ub.rl(f);var n=this.Ub.height()}else this.Ub.Xa(),n=0;this.log("Colour panel height is %s",n);if(this.da.Ot()){this.toolbar.show(!0);this.toolbar.Yq(g-n);var m=this.toolbar.width()}else this.toolbar.show(!1),m=0;a=this.view.Rg();this.toolbar&&this.toolbar.moveTo(h+l,0);var q=g-n;var u=b=e=0;this.qg&&
(this.Lf.show(),u=this.Lf.width());(c=this.da.Uo()&&700<=f)&&(b=300);e+=b+u;var v=f-2*a-h-e;var A=g-2*a-n-k;this.zc.width(h);this.zc.height(g-2*a-n);this.zc.moveTo(0,0);this.$b.ia.ea("top","0");this.$b.ia.ea("left","0");this.Ec.width(v);this.Ec.height(k);this.Ec.moveTo(h,g-2*a-n-k);k=l+h+m;h=f-2*a-m-e-h-l;this.Sd.ea("left",""+k+"px");this.Sd.ea("top","0");this.Sd.ea("width",""+h+"px");this.Sd.ea("height",""+A+"px");this.view.Jo(h,A);this.Ub&&(this.Ub.moveTo(k,q),this.Ub.rl(f-k),this.Ub.ja());this.Xk.ea("top",
"0").ea("right",""+(b+u)+"px");this.qg?(this.Lf.moveTo(f-u,0),this.Lf.height(g-2*a-n)):this.Lf.Xa();c?(this.Sb.show(),this.Sb.moveTo(f-u-b,0),this.Sb.width(b),this.Sb.height(g-2*a-n)):this.tm||this.Sb.Xa();this.view.me()}};c.prototype.uj=function(a,b,c){void 0===c&&(c=this.view.ha.Wa);var d=this.view.ha.Wa;this.view.ha.Bb(c);a.translate(-b.x,-b.y);this.view.Ng(a,b.x,b.y,b.width,b.height);this.view.ha.ja(a);this.wa.gd&&this.wa.gd(a);this.view.ha.Bb(d)};c.prototype.Bo=function(a,b){if("image/svg+xml"===
a||"application/pdf"===a){var c=!1;if("image/svg+xml"===a)var e=new yd(new K(0,0,b.width,b.height));else e=new wd(new K(0,0,b.width,b.height),Cd.fonts),c=!0;if(c)for(c=0;c<this.view.ha.Cc();c++)0<c&&e.rg(),this.uj(e,b,c);else this.uj(e,b);return"data:"+a+";base64,"+w.encode("base64",e.toString())}c=C("<canvas>");c.Jb("width",""+b.width);c.Jb("height",""+b.height);e=c[0].getContext("2d");if("image/jpeg"===a||"image/bmp"===a)e.fillStyle="#ffffff",e.fillRect(0,0,b.width,b.height);this.uj(e,b);if("image/bmp"===
a)if(e=c[0],c=e.getContext("2d"),null===c)e="error";else{var f=c.getImageData(0,0,e.width,e.height);e=f.width;var g=f.height;c=e*g*3;var h=c+54,k=[66,77,h&255,h>>8&255,h>>16&255,h>>24&255,0,0,0,0,54,0,0,0],l=[40,0,0,0,e&255,e>>8&255,e>>16&255,e>>24&255,g&255,g>>8&255,g>>16&255,g>>24&255,1,0,24,0,0,0,0,0,c&255,c>>8&255,c>>16&255,c>>24&255,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];c=(4-3*e%4)%4;f=f.data;h=e<<2;for(var n=Sb.yg("Base64Encoder"),m=0;m<k.length;m++)n.Qa(k[m]);for(m=0;m<l.length;m++)n.Qa(l[m]);do{k=
h*(g-1);for(l=0;l<e;l++)m=l<<2,n.Qa(f[k+m+2]),n.Qa(f[k+m+1]),n.Qa(f[k+m]);for(k=0;k<c;k++)n.Qa(0)}while(--g);n.flush();e="data:image/bmp;base64,"+n.Sf().toString()}else e=c[0].toDataURL(a);return e};c.prototype.se=function(a,b,c,e){this.log("External app setItemProperty %s: %s=%s",b,c,e);a.push(new Rd(b,c,e));return!0};c.prototype.ll=function(a,b,c){var d;this.log("External app setNodeProperty %s: %s",b,c);for(d in c)c.hasOwnProperty(d)&&a.push(new Rd(b,d,c[d]));return!0};c.prototype.pi=function(a,
b){var c,e;(c=this.view.ha.za(a))&&(e=c.la(b));this.log("GetItemProperty %s: %s=%s",a,b,e);return e};c.prototype.Pj=function(a,b){var c,e;if(6>b.length)this.log("newShape: Cannot create shape with fewer than three points.");else{var f=new U;var g=c=0;for(e=b.length-1;c<=e;g=c+=2){var h=this.view.Fa(new E(b[g],b[g+1]));if(0===g){f.moveTo(h.x,h.y);var k=h}else f.lineTo(h.x,h.y)}k&&(f.lineTo(k.x,k.y),f.close());return this.Zh(a,f.ec())}};c.prototype.Zh=function(a,b){return this.createNode(a,"PathNode",
{commands:b,fillStyle:this.view.Db,strokeStyle:this.view.Mb,seed:Math.round(65535*Math.random()),lineWidth:this.view.ya.lineWidth,sloppiness:this.view.ya.sloppiness,angleArcs:this.da.get("angleArcs")})};c.prototype.Kg=function(a,b){var c=this.view.ha.Ua();a.push(new Ad(c,b));return c};c.prototype.Dh=function(a,b){a.push(new ke(b));return!0};c.prototype.tq=function(a){return new pb(this.Xk,a)};return c}();var pe=function(){function c(a,b){this.view=a;this.methods=b;this.log=B.create("CustomToolBehaviour");this.ac=new Rc(a)}c.prototype.sc=function(){this.log("Entering CustomToolBehaviour");this.methods.enter&&this.methods.enter()};c.prototype.Hc=function(){this.log("Leaving CustomToolBehaviour");this.methods.leave&&this.methods.leave()};c.prototype.nc=function(a,b,c){return this.methods.onMouseClick?this.methods.onMouseClick(a,b,c):!1};c.prototype.Sa=function(a,b,c){return this.methods.onMouseDown?
this.methods.onMouseDown(a,b,c):!1};c.prototype.Ta=function(a,b,c){return this.methods.onMouseMove?this.methods.onMouseMove(a,b,c):!1};c.prototype.Za=function(a,b,c){return this.methods.onMouseUp?this.methods.onMouseUp(a,b,c):!1};c.prototype.Gd=function(a,b,c){return this.methods.onDoubleClick?this.methods.onDoubleClick(a,b,c):!1};c.prototype.md=function(a,b){return this.methods.onColour?this.methods.onColour(a,b):!1};c.prototype.nd=function(a,b){return this.methods.onOpacity?this.methods.onOpacity(a,
b):!1};c.prototype.Zb=function(a){this.log("keyboard: %s",a);"cancel"===a&&(this.log("ESC pressed. Abort brush and go back to toolbar."),this.view.Va(),this.view.Wb.ua("goto-toolbar"))};c.prototype.lh=function(a){if(this.methods.onRedraw)this.methods.onRedraw(a)};c.prototype.ub=function(a){if(this.methods.onTouch)return this.methods.onTouch(a);if("touchstart"===a.type||"touchmove"===a.type||"touchend"===a.type){if(a.touches&&a.touches.length)var b=a.touches[0];else a.changedTouches&&a.changedTouches.length?
b=a.changedTouches[0]:(this.log("No touches!"),b={pageX:0,pageY:0});b=this.view.eb(b.pageX,b.pageY);return"touchstart"===a.type?this.Sa(b.x,b.y,a):"touchend"===a.type?this.Za(b.x,b.y,a):"touchmove"===a.type?this.Ta(b.x,b.y,a):!1}};c.prototype.Ya=function(a){return this.methods.onGesture?this.methods.onGesture(a):this.ac.Ya(a)};c.prototype.Qk=function(a,b,c,e){return this.methods.onMouseWheel?this.methods.onMouseWheel(a,b,c,e):!1};c.prototype.Wc=function(){return this.methods.getToolName?this.methods.getToolName():
"custom"};return c}();var qe=function(c){function a(a,d){var b=c.call(this,a,d)||this;b.element=null;b.ci=void 0;b.ob=new Q;b.wk=new Q;b.Yd=new M;b.readOnly=!1;b.vb=!1;b.Vc=null;b.width=0;b.height=0;b.log=B.create("DomNode",!0);b.aa.data="";b.aa.locked=!1;return b}p(a,c);a.prototype.type=function(){return"DomNode"};a.prototype.setProperty=function(a,d){if("data"===a)this.element&&(C(this.element).remove(),this.ci=this.element=null);else if("border"===a||"lockSize"===a||"lockRotate"===a){this.aa[a]=d;return}c.prototype.setProperty.call(this,
a,d)};a.prototype.xt=function(a){null!==this.Vc&&(this.log("Node %s receives DOM element and requests reformat",this.id),this.element&&(this.log("   Remove existing DOM element"),C(this.element).remove()),this.element=a,this.element.style.position="absolute","IFRAME"!==a.tagName&&(this.element.style.pointerEvents="none"),ob(C(this.element),this.Vc.lk()),this.width=this.element.offsetWidth||parseFloat(this.element.getAttribute("width")||"0"),this.height=this.element.offsetHeight||parseFloat(this.element.getAttribute("height")||
"0"),C(this.element).remove(),this.pg(this.readOnly,!0),this.element.style.top="0px",this.element.style.left="0px",this.Bj("transformOrigin","top left"),this.log("element height: %s, %s",this.element.offsetWidth,this.element.offsetHeight),this.Vc.bl(this.id))};a.prototype.nk=function(){return this.element};a.prototype.Bj=function(a,c){if(null!==this.element){for(var b=a.charAt(0).toUpperCase()+a.substr(1),d=["ms","Webkit","O","Moz"],g=0;g<d.length;g++)this.element.style[d[g]+b]=c;this.element.style[a]=
c}};a.prototype.qe=function(a){R.prototype.qe.call(this,a);this.element&&(this.element.style.visibility=this.Lh?"hidden":"visible")};a.prototype.pg=function(a,c){void 0===c&&(c=!1);if(c||this.readOnly!==a)this.readOnly=a,this.element&&this.Vc&&this.vb&&(ob(C(this.element),this.Vc.lk()),a?C(this.element).ea("pointer-events","auto"):C(this.element).ea("pointer-events","none"))};a.prototype.format=function(a,c){null===this.element&&this.ci!==this.la("data")&&c&&(this.ci=this.la("data"),this.Vc=c,this.log("DomNode %s requests conversion to DOM element",
this.id),this.Vc.nq(this.ci,this.id));if(this.element){var b=this.Yd;b=b.multiply(this.Ga());b.Tn()?(this.Bj("transform",""),this.element.style.left=""+b.Ca+"px",this.element.style.top=""+b.Da+"px"):(this.element.style.left="0px",this.element.style.top="0px",this.Bj("transform","matrix("+b.m11+","+b.m21+","+b.m12+","+b.m22+","+b.Ca+","+b.Da+")"));this.rect.x=0;this.rect.y=0;this.rect.width=this.width;this.rect.height=this.height;this.element.style.visibility=this.Lh?"hidden":"visible"}else this.rect.x=
0,this.rect.y=0,this.rect.width=100,this.rect.height=22;this.ob=new Q(this.rect);this.fb=this.rect.clone();this.rect.transform(this.Ga());this.ob.transform(this.Ga());if(b=this.aa.border)this.rect.Gc(b),this.wk=this.ob.clone(),this.wk.Gc(b/2),this.ob.Gc(b)};a.prototype.Ce=function(a){var b=a.Hu;b&&this.Vc&&(b.m11!==this.Yd.m11||b.m21!==this.Yd.m21||b.m12!==this.Yd.m12||b.m22!==this.Yd.m22||b.Ca!==this.Yd.Ca||b.Da!==this.Yd.Da)&&(this.log("Moving DOM element as result of draw zooming"),this.Yd=b,this.format(a,
this.Vc));if(this.element){if(b=this.aa.border){var c=this.wk;a.setTransform(1,0,0,1,0,0);a.beginPath();a.lineWidth=b;a.strokeStyle="#cccccc";a.moveTo(c.ma[0].x,c.ma[0].y);a.lineTo(c.ma[1].x,c.ma[1].y);a.lineTo(c.ma[2].x,c.ma[2].y);a.lineTo(c.ma[3].x,c.ma[3].y);a.lineTo(c.ma[0].x,c.ma[0].y);a.closePath();a.stroke()}}else a.beginPath(),a.lineWidth=1,a.fillStyle="#888888",a.strokeStyle="#CCCCCC",a.rect(0,0,100,22),a.stroke(),a.font="20px Arial",a.textBaseline="top",a.fillText("DomNode",0,0)};a.prototype.gb=
function(a,c){return!this.aa.locked&&this.rect.Uc(a,c)&&this.ob.Uc(a,c,3)?this:null};a.prototype.Pk=function(){this.element&&this.Vc&&(this.log("Added DOM NODE %s",this.id),ob(C(this.element),this.Vc.lk()),this.readOnly?C(this.element).ea("pointer-events","auto"):C(this.element).ea("pointer-events","none"));this.vb=!0};a.prototype.Rk=function(){this.log("Removed DOM NODE %s",this.id);this.element&&C(this.element).remove();this.vb=!1};return a}(R);R.Sc("DomNode",qe);var X,re=X||(X={});re[re.IDLE=0]="IDLE";re[re.CONNECTING=1]="CONNECTING";re[re.CONNECTED=2]="CONNECTED";re[re.WAIT_FOR_ACK=3]="WAIT_FOR_ACK";re[re.ERROR_WAIT=4]="ERROR_WAIT";re[re.STOPPING=5]="STOPPING";
var ve=function(c){function a(a,d,e){var b=c.call(this)||this;b.name=a;b.log=B.create("Sharing");b.state=X.IDLE;b.paused=!1;b.k=0;b.timeout=null;b.Tk="";b.As=1;a=new se;var g=new te(d,a);b.sl=new Gb(g);a=new ue(b.sl,a);d.ha.Et(a,e);b.k=0;b.connect();return b}p(a,c);a.prototype.rf=function(a){this.log(X[this.state]+" -> "+X[a]);this.state=a};a.prototype.connect=function(){var a=this;this.log("connect(): "+X[this.state]);this.state!==X.IDLE?this.log("Bad state"):(this.rf(X.CONNECTING),this.xh=new WebSocket("ws://zwibbler.com:3000/socket/"+
this.name),this.xh.addEventListener("open",function(){a.Gs()}),this.xh.addEventListener("close",function(){a.Ds()}),this.xh.addEventListener("message",function(b){a.Is(b)}))};a.prototype.Gs=function(){this.log("onConnected(): "+X[this.state]);this.state!==X.CONNECTING?this.log("Bad state"):(this.rf(X.kp),this.gl())};a.prototype.Ds=function(){this.log("onClose(): "+X[this.state]);this.state!==X.Ih&&(this.state===X.CONNECTING?(this.rf(X.Ih),this.et()):(this.rf(X.IDLE),this.paused||(this.k=0,this.connect())))};
a.prototype.et=function(){var a=this;this.state===X.Ih&&(this.timeout&&(clearTimeout(this.timeout),this.timeout=null),this.timeout=setTimeout(function(){a.state===X.Ih&&(a.log("onTimeout(): "+X[a.state]),a.timeout=null,a.rf(X.IDLE),a.connect())},1E3*Math.pow(2,this.k)),5>this.k&&(this.k+=1))};a.prototype.gl=function(){if(this.state===X.kp){if(this.paused)this.log("Currently paused; ignoring changes.");else if(""!==this.Tk){this.log("Have outstanding changes... not sending more.");return}var a=this.sl.gr();
a.length&&(this.Tk=a,this.xh.send(JSON.stringify({type:"Data",MID:""+this.As++,oldCID:"0",newCID:"0",data:a})))}};a.prototype.Is=function(a){a=JSON.parse(a.data);"Data"===a.type?this.sl.Hp(a.data):"Ack"===a.type&&(this.Tk="",this.gl())};a.prototype.pause=function(a){this.log("SharedSession.pause(): "+X[this.state]);(this.paused=a)?stop():this.state===X.IDLE&&(this.rf(X.CONNECTING),this.connect())};a.prototype.stop=function(){this.log("SharedSession.stop(): "+X[this.state]);this.paused=!0;this.state<
X.Ih?this.xh.close():this.rf(X.IDLE)};return a}(Hb),se=function(){function c(){this.local={};this.remote={};this.add("0",0)}c.prototype.add=function(a,b){this.local[a]=b;this.remote[b]=a};c.prototype.remove=function(a,b){delete this.local[a];delete this.remote[b]};c.prototype.tg=function(a){return this.local[a]};c.prototype.tf=function(a){a in this.remote||console.log("LocalId "+a+" has no remote");return this.remote[a]};return c}();
function we(c){var a={},b;for(b in c)a[b]="matrix"===b?c[b].ec():c[b];return a}function xe(c){var a={},b;for(b in c)a[b]="matrix"===b&&c[b]instanceof Array?new M(c[b]):c[b];return a}
var te=function(){function c(a,b){this.view=a;this.map=b;this.Ud={};this.actions=[];this.log=B.create("Remote")}c.prototype.createNode=function(a,b,c,e){if(!e.type)throw console.log(e),Error("Tried to create node with bad type");var d=xe(e),g=d.type;delete d.type;var h=this.view.ha.Ua();this.log("Create node "+g+" "+a+"/"+h+" at "+b+":"+c);this.map.add(a,h);b=new V(h,g,d,this.map.tg(b),c);this.actions.push(b);this.Ud[a]=e};c.prototype.rc=function(a,b,c){var d=this.map.tg(a);this.log("Delete node "+
a+"/"+d+" from "+b+":"+c);b=new le([d]);this.actions.push(b);this.map.remove(a,d)};c.prototype.je=function(a,b,c){this.log("Move node "+a+" to "+b+":"+c);this.actions.push(new ye(this.map.tg(a),this.map.tg(b),c))};c.prototype.Cb=function(a,b){b=xe(b);var c=this.map.tg(a);this.log("Set properties for node "+a+"/"+c+" to "+JSON.stringify(b));for(var e in b)this.actions.push(new Rd([c],e,b[e]));if(a in this.Ud)for(var f in b)this.Ud[a][f]=b[f]};c.prototype.tc=function(a){var b={};if(a in this.Ud)b=this.Ud[a];
else if(a=this.view.ha.za(this.map.tg(a)))b=we(a.tc()),b.type=a.type();return b};c.prototype.ta=function(){this.Ud={};this.view.ta(this.actions,!0);this.view.Jf();this.view.ja();this.actions=[]};return c}(),ue=function(){function c(a,b){this.Ld=a;this.map=b;this.log=B.create("LOCAL")}c.prototype.createNode=function(a,b,c,e){if(!this.Ld.mc){console.log("Create node "+e.type+" "+a+" at "+b+":"+c);if(!e.type)throw Error("Error: Local tried to create node with bad type.");e=we(e);var d=this.Ld.ss(a);
this.map.add(d,a);a=this.map.tf(b);this.Ld.createNode(d,a,c,e)}};c.prototype.rc=function(a,b,c){this.Ld.mc||(console.log("Delete node "+a+" from "+b+":"+c),b=this.map.tf(b),a=this.map.tf(a),this.Ld.rc(a,b,c))};c.prototype.je=function(a,b,c,e,f){this.Ld.mc||(console.log("Move node "+a+" from "+e+":"+f+" to "+b+":"+c),this.Ld.je(this.map.tf(a),this.map.tf(b),c,this.map.tf(e),f))};c.prototype.Cb=function(a,b){this.Ld.mc||(console.log("Set properties for node "+a+" to "+JSON.stringify(b)),b=we(b),this.Ld.Cb(this.map.tf(a),
b))};return c}();function ze(c){return c instanceof Array?c:[c]}
var Y=function(){function c(a,b){var c=this;this.Ra={};this.zb=0;this.actions=[];this.bi=new t;this.Xj=new t;this.Hi=0;this.Rj=-1;this.Ek=null;this.Ff={};this.ve=this.gd=null;this.log=B.create("CONTEXT");this.ga=new oe(this,a,b);this.no();var e=this;Cd.xk.push(this);this.ga.xb.add(function(){c.Zi();delete a[0].zwibbler;delete e.Ra;delete e.actions;delete e.ga;delete e.gd;for(var b=Cd.xk,d=0;d<b.length;d++)if(b[d]===e){b.splice(d,1);break}});this.xa("document-changed",function(){c.ve&&c.ve.gl()})}
c.prototype.Gp=function(){1<this.zb&&this.Ia("abortTransaction is not implemented for nested calls. Please contact support.");this.zb=0;this.actions=[]};c.prototype.Fj=function(a){this.ga.language.Fj(a)};c.prototype.Lp=function(){return this.ah(this.Cc())};c.prototype.Lm=function(){this.zb+=1;1===this.zb?(this.actions=[],this.Xj.clear(),this.bi.clear(),this.Hi=0,this.Rj=this.ga.view.ha.Wa,this.log("beginTransaction() -- beginning new")):this.log("beginTransaction() -- already in one, bump counter")};
c.prototype.Dg=function(){this.ga.view.Dg()};c.prototype.He=function(){return this.ga.view.ha.He()};c.prototype.Ie=function(){return this.ga.view.ha.Ie()};c.prototype.nb=function(){this.ga.view.nb();this.ga.view.Nb();this.ga.view.ja()};c.prototype.eq=function(){this.ga.fq()};c.prototype.gq=function(a,b){this.sh(a,!b)};c.prototype.kq=function(){this.zb=Math.max(0,this.zb-1);0===this.zb?(this.ga.view.ta(this.actions,!0),this.actions=[],this.log("committing irreversible transaction.")):this.log("delaying transaction commit -- nested call (count=%s)",
this.zb)};c.prototype.Oj=function(){this.zb=Math.max(0,this.zb-1);0===this.zb?(this.ga.view.ta(this.actions),this.actions=[],this.log("committing transaction.")):this.log("delaying transaction commit -- nested call (count=%s)",this.zb)};c.prototype.Le=function(a,b){void 0===a&&(a=!1);return this.ga.view.Le(a,b)};c.prototype.Kg=function(a){if(0<a.length)return this.Ib(this.ga.Kg(this.actions,a))};c.prototype.Kb=function(a){void 0===a&&(a={});var b={},c;for(c in a)if(a.hasOwnProperty(c)){var e=a[c];
"matrix"===c&&("[object Array]"===Object.prototype.toString.apply(e)&&"Matrix"===e[0]&&e.splice(0,1),e=new M(e));b[c]=e}return b};c.prototype.createNode=function(a,b){this.log("createNode(%s)",a);var c=this.Kb(b);return this.Ib(this.ga.createNode(this.actions,a,c))};c.prototype.Zh=function(a){return this.Ib(this.ga.Zh(this.actions,a))};c.prototype.ai=function(a,b){function c(a,b){b.click(function(b){a.onclick.call(this,f,b)})}var e=Yb(a);pa(b)||this.Ia("createToolbar: second parameter must be array");
for(var f=this,g=0;g<b.length;g++){var h=b[g],k=C("<a>").Jb("href","javascript:void(0)");k.ea("background-repeat","no-repeat");k.ea("background-position","center");k.ea("display","inline-block");lb(k,"zwibbler-button");h.toolName&&lb(k,h.toolName);h.onclick&&c(h,k);h.title&&k.Jb("title",h.title);h.background?k.ea("background",h.background):h.image&&k.ea("background-image","url("+h.image+")");h.html&&(k[0].innerHTML=h.html,k.ea("overflow","hidden"));e.append(k)}var l;this.xa("tool-changed",function(a){f.log("Tool-changed: %s",
a);if(l)for(var b=l,c="zwibbler-selected".split(Pa),d=0,g=b.length;d<g;d++){var h=b[d];if(1===h.nodeType&&h.className){for(var k=(" "+h.className+" ").replace(Sa," "),n=0,F=c.length;n<F;n++)k=k.replace(" "+c[n]+" "," ");h.className=Oa.trim(k)}}l=e.find("."+a);lb(l,"zwibbler-selected")})};c.prototype.wq=function(a,b){var c="string"===typeof b?C("#"+b):C(b);if("PageSelector"===a)this.log("Creating page selector"),c=new pc(this,c,!1,!1),c.Ri(!0),c.hl(this),c.Zk();else return this.Ia("Cannot create UI Elemment %s",
a),!1;return!0};c.prototype.Pj=function(a){if(a=this.ga.Pj(this.actions,a))return this.Ib(a);this.Ia("createShape needs an array of at least 6 numbers");return null};c.prototype.Vj=function(){var a=this.ga.view.Le(!1);this.Xm();return a};c.prototype.Nf=function(){this.ga.Nf();for(var a in this)this.hasOwnProperty(a)&&delete this[a]};c.prototype.Ib=function(a){this.zb?"number"===typeof a&&this.bi.add(a):(this.log("Not in a transaction. committing immediately. id=%s",a),this.Oj());return a};c.prototype.rc=
function(a){this.Vm(a)};c.prototype.xp=function(a){for(var b=0;b<a.length;b++){var c=a[b],e=this.ga.view.ha.za(c,!1);e&&!this.Xj.contains(c)||!e&&this.bi.contains(c)||(a.splice(b,1),--b)}return 0<a.length};c.prototype.Vm=function(a){this.log("deleteNodes()");a=ze(a);this.xp(a)&&(this.Ib(this.ga.rc(this.actions,a)),this.Xj.add(a))};c.prototype.Wm=function(){1<this.zb&&this.Ia("deletePage is not implemented inside transactions. Please contact support.");1===this.Cc()?this.log("Cannot remove all the pages."):
(this.actions.push(new le([this.ga.view.ha.sk().id])),this.Ib())};c.prototype.Xm=function(){this.ga.view.di()};c.prototype.Vd=function(){1===arguments.length&&!1===arguments[0]&&this.ga.view.ha.$n();return this.ga.view.ha.Vd()};c.prototype.download=function(a,b,c){"jpeg"===a&&(a="jpg");var d;if("pdf"===a||"svg"===a||"png"===a||"jpg"===a||"bmp"===a||"zwibbler3"===a){var f="zwibbler3"===a?Dd.tj(this.ga.view.ha,a,"data-uri"):this.save(a,c);"Blob"in window&&(d=ic(f));if(d){if(window.navigator.msSaveOrOpenBlob){this.log("Using msSaveOrOpenBlob()");
window.navigator.msSaveOrOpenBlob(d,b);return}f=window.URL.createObjectURL(d);this.log("Using blob object url %s",f);this.ga.xb.add(function(){window.URL.revokeObjectURL(f)})}var g=document.createElement("a");g.innerHTML="download";g.setAttribute("href",f);g.setAttribute("download",b);g.style.display="none";document.body.appendChild(g);g.click();setTimeout(function(){document.body.removeChild(g)},1E3)}else this.log("unsupported format for download: %s",a)};c.prototype.ja=function(a,b){void 0===b&&
(b={});var c=b.page||0,e=this.ga.view.ha.Wa,f=this.ga.view.ha.Ue();this.ga.view.ha.Bb(c);this.ga.view.Ng(a,0,0,f.width,f.height);this.ga.view.ha.ja(a);this.ga.view.ha.Bb(e)};c.prototype.Gq=function(a){var b=this.ga.view.ha.za(a,!1);b?b.wi()?(a=this.ga.view.$i({}))&&a.yl(b,b.rect.x,b.rect.y):this.log("editNodeText: node %s (%s) cannot contain text.",a,b.type()):this.log("editNodeText: nodeid %s does not exist.",a)};c.prototype.duplicate=function(){this.ga.view.duplicate()};c.prototype.ua=function(a){for(var b=
1;b<arguments.length;b++);var c=this;this.Ra||(this.Ra={});if(!this.um(a)){var e=Array.prototype.slice.call(arguments,1);setTimeout(function(){var b;if(a in c.Ra){var d=c.Ra[a];var h=0;for(b=d.length;h<b;h++){var k=d[h];k.apply(null,e)}}},0);return this}};c.prototype.Oe=function(a){for(var b=1;b<arguments.length;b++);this.Ra||(this.Ra={});if(!this.um(a)){b=Array.prototype.slice.call(arguments,1);var c;if(a in this.Ra){var e=this.Ra[a];var f=0;for(c=e.length;f<c;f++){var g=e[f];g.apply(null,b)}}}};
c.prototype.Qt=function(a){this.Ff[a]=a in this.Ff?this.Ff[a]+1:1};c.prototype.um=function(a){return a in this.Ff&&0<this.Ff[a]?(this.log("Skipped %s event",a),--this.Ff[a],!0):!1};c.prototype.focus=function(a){void 0===a&&(a=!1);a?this.ga.pd():this.ga.focus("canvas")};c.prototype.Rq=function(a){a=this.kn(a);return a.length?a[0]:null};c.prototype.kn=function(a){a=this.ga.view.ha.Sq(a);for(var b=[],c=0;c<a.length;c++)b.push(a[c].id);return b};c.prototype.Tq=function(a,b,c){if(3===arguments.length)if("number"!==
typeof b||"number"!==typeof c)this.Ia("flip: 2nd and 3rd args must be numbers.");else{var d=new E(b,c);this.ga.view.mn(a/180*Math.PI,d)}else this.ga.view.mn(a/180*Math.PI)};c.prototype.Pg=function(a,b,c,e){a=this.Am(a);"number"===typeof c&&"number"===typeof e?(c=new E(c,e),this.ga.view.Pg(a,b/180*Math.PI,c)):this.ga.view.Pg(a,b/180*Math.PI)};c.prototype.Zq=function(a,b,c){function d(a){a.xa("click contextmenu",function(b){if("click"===b.type||"contextmenu"===b.type)n.call(h,a.ea("background-color"),
0===b.button),b.preventDefault()})}function f(){var a=C("<div>").ea("width",b+"px").ea("height",b+"px").ea("display","inline-block");k.append(a);return a}function g(a,b){var c=document.createElement("canvas");c.width=a;c.height=a;b(c.getContext("2d"),0,0,a);return f().append(c)}void 0===c&&(c={});var h=this,k=Yb(a),l,n=c.onColour||c.onColor||h.sh;a=g(b,oc.bm);a.xa("click contextmenu",function(a){n.call(h,"transparent",0===a.button);a.preventDefault()});a=g(b,oc.am);a.xa("click contextmenu",function(a){if(c.onOpacity)c.onOpacity(.5,
0===a.button);else h.Qo(.5,0===a.button);a.preventDefault()});for(l=0;1>=l;l+=1/13){var m=(new z(z.yc,[0,0,l,1])).toString();d(f().ea("background-color",m))}for(l=.3;1>=l;l+=.7/14)for(a=0;360>a;a+=22.5)m=(new z(z.yc,[a,.7,l,1])).toString(),d(f().ea("background-color",m));for(a=0;360>a;a+=22.5)m=(new z(z.yc,[a,1,1,1])).toString(),d(f().ea("background-color",m))};c.prototype.Qg=function(){return this.ga.view.Qg()};c.prototype.ar=function(){var a=[];this.ga.view.ha.Qf(function(b){a.push(b.id)},this.be());
return a};c.prototype.zp=function(){var a=[];this.ga.view.ha.yb(!1,function(b){a.push(b.id)});return a};c.prototype.er=function(){return this.ga.fr()};c.prototype.kk=function(a){return this.Ag(this.ga.view.kk(a))};c.prototype.ir=function(a){qa(a)||this.Ia("getConfig: Expected string");return this.ga.da.get(a)};c.prototype.be=function(){return this.zb?this.Rj:this.ga.view.ha.Wa};c.prototype.jr=function(){return this.ga.view.oi()};c.prototype.kr=function(){return this.ga.view.ti()};c.prototype.mk=function(){return this.ga.view.mk()};
c.prototype.mr=function(a,b){var c=this.ga.view.eb(a,b);return{x:c.x,y:c.y}};c.prototype.Tg=function(){var a=this.ga.view.ha.Ue();return{x:a.x,y:a.y,width:a.width,height:a.height}};c.prototype.oi=function(){return this.ga.view.oi()};c.prototype.yr=function(a){return this.ga.language.get(a)};c.prototype.Ag=function(a){return{x:a.x,y:a.y,width:a.width,height:a.height}};c.prototype.Mh=function(a){"object"!==typeof a&&this.Ia("Error: Rectangle object expected.");a=new K(a.x||0,a.y||0,a.width||0,a.height||
0);a.zo();return a};c.prototype.pr=function(){return this.Ag(this.ga.view.ha.tn())};c.prototype.wr=function(a,b){return this.pi(a,b)};c.prototype.Ar=function(){var a=[],b={};this.ga.view.ha.yb(!1,function(d){!(c=d.Ad())||c in b||(b[c]=1,a.push(c))});var c=this.Qg();c in b||a.push(c);return a};c.prototype.zr=function(a){var b=[];this.ga.view.ha.yb(!1,function(c){c.Ad()===a&&b.push(c.id)});return b};c.prototype.ee=function(a){return this.ga.view.ha.ee(a)};c.prototype.pi=function(a,b){return this.ga.pi(a,
b)};c.prototype.Br=function(a){a=ze(a);for(var b=null,c=0;c<a.length;c++){var e=a[c],f=this.ga.view.ha.za(e);null===f?this.Ia("Error: node %s does not exist",e):b?b.Eh(f.rect):b=f.rect.clone()}b||(b=new K(0,0,0,0));return this.Ag(b)};c.prototype.Cr=function(a){var b=this.ga.view.ha.za(a);if(null===b)return this.Ia("Error: node %s does not exist",a),null;a=b.Ga().Vg();return{x:a.x,y:a.y}};c.prototype.Dr=function(a){return(a=this.ga.view.ha.za(a))?a.type():""};c.prototype.Er=function(a,b){var c=this.ga.view.ha.gb(a,
b,this.ga.view.La);return c?c.id:null};c.prototype.Cc=function(){var a=this.ga.view.ha.Cc();this.zb&&(a+=this.Hi);return a};c.prototype.yn=function(a){return(a=this.ga.view.ha.sk(a))?a.id:null};c.prototype.ri=function(a){var b=this.ga.view.ha.za(a,!1);if(!b||"PathNode"!==b.type())return null;a=b.ri().clone().Md();var c=[];b.Ga();for(b=0;b<a.length;b++){var e=a[b];c.push(e.x);c.push(e.y)}return c};c.prototype.Hr=function(a){a=this.ga.view.ha.za(a,!1);if(!a||"PathNode"!==a.type())return null;a=a.ri();
for(var b=[],c=[],e=0;e<a.ba.length;){switch(a.ba[e]){case P.pc:c=[{x:a.ba[e+1],y:a.ba[e+2]}];b.push(c);break;case P.oc:c.push({x:a.ba[e+1],y:a.ba[e+2]})}e+=P.gc[a.ba[e]]}return b};c.prototype.Ap=function(){this.ga.view.Sb=this.ga.Sb;this.ga.tm=!0;return this.ga.Sb.ia[0]};c.prototype.un=function(){return this.ga.view.scale};c.prototype.Kr=function(a,b,c,e){var d=this.ga.view.Yj(a,b);if(void 0===c||void 0===e)return{x:d.x,y:d.y};a=this.ga.view.Yj(a+c,b+e);return this.Ag(new K(d.x,d.y,a.x-d.x,a.y-d.y))};
c.prototype.Lr=function(){return this.ga.view.hd};c.prototype.ti=function(){return this.ga.view.ti()};c.prototype.de=function(a,b){var c=this.ga.view.ha.za(a,!1);return c?c.de(b):null};c.prototype.wt=function(a,b,c){var d=this.ga.view.ha.za(a,!1);if(!d)return this.log("setEditHandle: node %s doesn't exist.",a),!1;if("PathNode"!==d.type())return this.log("setEditHandle: node %s is not a PathNode.",a),!1;d=d.la("commands");d=S.sp(d,b,c);if(!d)return this.log("setEditHandle: failed"),!1;this.se(a,"commands",
d);return!0};c.prototype.Uf=function(a){void 0===a&&(a=!1);return this.ga.view.Dc(a)};c.prototype.Jr=function(a){for(var b={properties:{},types:{},nodes:a},c=this.ga.da.get("allowTextInShape"),e=0;e<a.length;e++){var f=this.ga.view.ha.za(a[e],!1);if(f){var g=f.type();b.types[g]=!0;b.types.AnyNode=!0;"PathNode"===g&&(g=f.la("closed")?"PathNode-closed":"PathNode-open",b.types[g]=!0);f=f.tc();for(var h in f)if(f.hasOwnProperty(h)&&"matrix"!==h&&("BrushNode"!==g||"fillStyle"!==h)){var k=b.properties[h],
l=f[h];("PathNode-open"!==g||"fontSize"!==h&&"fontName"!==h&&"fillStyle"!==h)&&("PathNode-closed"!==g||c||"fontSize"!==h&&"fontName"!==h)&&void 0!==l&&(b.properties[h]=k!==l&&void 0!==k?null:l)}}}return b};c.prototype.Pr=function(){return this.Ag(this.ga.view.Vf())};c.prototype.Ia=function(a){for(var b=1;b<arguments.length;b++);b=arguments[0].split("%s");for(var c=[],e=0;e<b.length;e++)c.push(b[e]),e<b.length-1&&c.push(JSON.stringify(arguments[e+1]));var f=c.join("");this.log(f);throw{message:f,toString:function(){return f}};
};c.prototype.ah=function(a){var b=this.ga.view.ha.Ua();this.actions.push(new V(b,"PageNode",{},this.ga.view.ha.root.id,a));this.Ib(b);this.zb&&(this.Hi+=1);return a};c.prototype.zk=function(a){return this.ga.view.ha.zk(a)};c.prototype.load=function(a,b){void 0===b&&(b=a);var c=Dd.qj(b);return c?(this.Zi(),this.ga.pf(c),!0):!1};c.prototype.Ai=function(a){var b=this;r(a)?(this.Ek&&clearTimeout(this.Ek),this.Ek=setTimeout(function(){b.ga.view.Ai(!1)},a),b.ga.view.Ai(!0)):this.Ia("lockUpdates: Expected a number")};
c.prototype.Bi=function(){this.ga.view.Bi()};c.prototype.us=function(a,b){if(r(a)&&r(b)){var c=this.Cc();0>a||a>=c?this.Ia("From page must be > 0 and less than getPageCount()"):0>b||b>=c?this.Ia("From page must be > 0 and less than getPageCount()"):(c=this.yn(a),null!==c&&(this.actions.push(new je([c],je.hm,b)),this.Ib()))}else this.Ia("movePage: needs two valid page numbers.")};c.prototype.Ci=function(){this.ga.view.Ci()};c.prototype.Gk=function(){this.Zi();this.ga.Gk();this.no()};c.prototype.nextPage=
function(){this.nf(Math.min(this.be()+1,this.Cc()-1))};c.prototype.xa=function(a,b){"draw"===a?this.gd=b:a in this.Ra?this.Ra[a].push(b):this.Ra[a]=[b];return this};c.prototype.Fs=function(a){"function"===typeof a||this.Ia("Error: onComplete needs a function argument.");this.ga.view.Wq(a)};c.prototype.no=function(){var a=this.ga.da.get("defaultPaperSize");this.log("onNewDocument()");"none"!==a&&this.ol(a)};c.prototype.mh=function(a){this.ga.view.mh(a)};c.prototype.Vs=function(){this.nf(Math.max(this.be()-
1,0))};c.prototype.print=function(a,b){var c=[],e;if("number"===typeof a)c.push(a);else if(a instanceof Array)for(e=0;e<a.length;e++)if(r(a[e]))c.push(a[e]);else{this.Ia("print(): pageSpec must be array of numbers");return}else if(!a)for(e=0;e<this.Cc();e++)c.push(e);var f=b?this.Mh(b):this.Mh(this.Tg());var g=this.be(),h=document.createElement("canvas");h.width=f.width;h.height=f.height;var k=h.getContext("2d");k.translate(-f.x,-f.y);e=window.location.hostname;var l=window.open("about:blank","_blank");
l.document.write("<!DOCTYPE html><html><head><title>"+e+"</title></head><body>");for(e=0;e<c.length;e++)this.nf(c[e]),this.ga.view.Ng(k,f.x,f.y,f.width,f.height),this.ga.view.ha.ja(k),0<e?l.document.write("<div style='page-break-before:always'>"):l.document.write("<div>"),l.document.write("<img style='width:100%' src='"),l.document.write(h.toDataURL()),l.document.write("'></div>"),k.clearRect(f.x,f.y,f.width,f.height);l.document.write("</body></html>");l.document.close();setTimeout(function(){l.focus();
l.print();setTimeout(function(){l.close()},1E3)},1E3);this.nf(g)};c.prototype.Jd=function(){this.ga.view.Jd()};c.prototype.ne=function(a){this.ga.view.ja(a)};c.prototype.resize=function(){var a=this;setTimeout(function(){a.ga.Bg(!0)},1)};c.prototype.save=function(a,b){void 0===a&&(a="zwibbler3");var c={jpeg:"image/jpeg",jpg:"image/jpeg",png:"image/png",bmp:"image/bmp",svg:"image/svg+xml",pdf:"application/pdf"},e=this.Mh(b||this.Tg());switch(a){case "list":return Dd.tj(this.ga.view.ha,"list","object");
case "png":case "jpeg":case "jpg":case "bmp":case "svg":case "pdf":return this.ga.Bo(c[a],e);case "zwibbler3":return Dd.tj(this.ga.view.ha,"zwibbler3","string");case "image/png":case "image/jpeg":case "image/bmp":return c=this.ga.Bo(a,e),c=c.substr(c.indexOf(",")+1),w.decode("base64",c);default:return"Unsupported format: "+a}};c.prototype.ut=function(a){C(this.ga.view.canvas).ea("cursor",a)};c.prototype.ue=function(a,b){this.ga.view.ue(a,b)};c.prototype.Am=function(a){for(var b=[],c=0;c<a.length;c++){var e=
this.ga.view.ha.za(a[c],!1);e&&b.push(e)}return b};c.prototype.selectNodes=function(a){a=this.Am(ze(a));this.ga.view.selectNodes(a);this.ga.view.Nb();this.ga.view.ja()};c.prototype.rh=function(){this.ga.view.rh()};c.prototype.Pi=function(a){this.ga.view.Pi(a)};c.prototype.ot=function(a,b){this.ga.pt(a,b)};c.prototype.st=function(a,b){"defaultPaperSize"===a&&this.ol(b);return this.ga.da.set(a,b)};c.prototype.sh=function(a,b){this.ga.view.Es(a,b)};c.prototype.nf=function(a){this.zb?(this.log("Set page to %s inside transaction",
a),this.actions.push(new Ae(a)),this.Rj=a):this.ga.view.Bb(a)};c.prototype.il=function(a){this.ga.view.il(a)};c.prototype.ng=function(a,b){!r(a)&&null!==a||!r(b)&&null!==b?alert("setDocumentSize: width/height must be numbers"):this.ga.view.ng(a,b)};c.prototype.Lo=function(a,b){!r(a)&&null!==a||!r(b)&&null!==b?alert("setDocumentSize: width/height must be numbers"):this.Ib(this.ga.view.ng(a,b,this.actions))};c.prototype.vt=function(a,b){var c=this.ga.view.ha.za(a);c?("DomNode"!==c.type()&&this.Ia("setDomElement: Node %s is not a DomNode. It is %s",
a,c.type()),c.xt(b),this.ga.fi.push(b)):this.Ia("setDomElement: Node %s does not exist",a)};c.prototype.nr=function(a){var b=this.ga.view.ha.za(a);if(!b)return this.Ia("getDomElement: Node %s does not exist",a),null;b instanceof qe||this.Ia("getDomElement: Node %s is not a DomNode. It is %s",a,b.type());return b.nk()};c.prototype.Ct=function(a,b){qa(a)&&qa(b)?(this.Qg()===a&&this.Pi(b),this.ga.view.ha.yb(!1,function(c){c.Ad()===a&&c.setProperty("layer",b)})):this.Ia("setLayerName() needs string arguments.")};
c.prototype.ol=function(a,b){var c=null,e=null,f=!0,g=!1;if(2===arguments.length)if(r(arguments[0])&&r(arguments[1])){var h=arguments[0];c=arguments[1]}else qa(arguments[0])&&"boolean"===typeof arguments[1]?(e=arguments[0],g=arguments[1]):f=!1;else if(1===arguments.length&&qa(arguments[0]))for(var k=arguments[0].split(" "),l=0;l<k.length;l++)"landscape"===k[l]?g=!0:"portrait"===k[l]?g=!1:e=k[l];if(!1===f)return this.log("Bad arguments to setPaperSize()."),!1;if(null===e)return this.ng(h,c),!0;switch(e.toLowerCase()){case "letter":h=
816;c=1056;break;case "legal":h=816;c=1344;break;case "11x17":h=1056;c=1632;break;case "tabloid":h=1056;c=1632;break;case "a0":h=841/25.4*96;c=1189/25.4*96;break;case "a1":h=594/25.4*96;c=841/25.4*96;break;case "a2":h=420/25.4*96;c=594/25.4*96;break;case "a3":h=297/25.4*96;c=420/25.4*96;break;case "a4":h=210/25.4*96;c=297/25.4*96;break;case "none":c=h=null;break;default:return this.log("Invalid paper size: %s",e),!1}g&&(e=h,h=c,c=e);this.ng(h,c);return!0};c.prototype.zt=function(a,b){this.ga.At(a,
b)};c.prototype.Bt=function(a,b,c){this.se(a,b,c)};c.prototype.ll=function(a,b){if(2!==arguments.length)throw"Error: setNodeProperties takes 2 arguments.";return this.Ib(this.ga.ll(this.actions,ze(a),this.Kb(b)))};c.prototype.se=function(a,b,c){3!==arguments.length&&this.Ia("Error: setNodeProperty takes 3 arguments.");return this.Ib(this.ga.se(this.actions,ze(a),b,c))};c.prototype.Dt=function(a,b){for(var c=ze(a),e=0;e<c.length;e++){var f=this.ga.view.ha.za(c[e],!0);f&&f.qe(!b)}this.ga.view.ja()};
c.prototype.Qo=function(a,b){this.ga.view.Js(a,b)};c.prototype.nl=function(a){this.ga.view.nl(a)};c.prototype.Ht=function(a){ra(a)&&r(a.x)&&r(a.y)&&r(a.width)&&r(a.height)||this.Ia("setViewRect: arg must be an object with numeric x, y, width, height properties");0!==a.width&&0!==a.height||this.Ia("setViewRect: width and height must be non-zero.");this.ga.view.uh(this.Mh(a))};c.prototype.Mc=function(a,b,c){if(r(a)||"page"===a||"width"===a)if(1===arguments.length)this.ga.view.Mc(a);else if(3===arguments.length&&
"number"===typeof a&&r(b)&&r(c)){var d=this.un()/a,f=this.ga.view.Vf();f.transform(new O(d,d,b,c));this.ga.view.uh(f)}else this.Ia("setZoom: invalid arguments.");else this.log("setZoom: invalid parameter.")};c.prototype.vh=function(a,b){void 0===b&&(b=!0);this.ga.view.vh(a,b)};c.prototype.ej=function(a,b,c){this.log("Translate node %s by %s,%s actions=%s",a,b,c,this.actions.length);return this.Ib(this.ga.ej(this.actions,ze(a),b,c))};c.prototype.kt=function(a){var b=Math.round(a/(Math.PI/2));a=b*Math.PI/
2;b=0===b%2;var c=this.zp(),e=this.Tg(),f=e.width/2,g=e.height/2;this.Lm();for(var h=0;h<c.length;h++)this.Ao(c[h],a,f,g),b||this.ej(c[h],g-f,f-g);b||this.Lo(e.height,e.width);this.Oj()};c.prototype.Ao=function(a,b,c,e){this.log("Rotate nodes by %s around (%s,%s) actions=%s",b/Math.PI*180,c,e,this.actions.length);for(var d=4===arguments.length,g=ze(a),h=new E(0,0),k=0;k<g.length;k++){var l=g[k],n=this.ga.view.ha.za(l);!n&&!this.bi.contains(l)||!n&&!d?this.log("rotateNode: Node %s does not exist",
l):!d&&n&&(l=n.rect.Kf(),h.x+=l.x,h.y+=l.y)}d?(h.x=c,h.y=e):(h.x/=g.length,h.y/=g.length);d=new zc(b,h.x,h.y);return this.Ib(this.ga.transformNode(this.actions,g,d))};c.prototype.dl=function(a,b,c,e,f){void 0===e&&(e=0);void 0===f&&(f=0);this.log("Scale node %s by %s,%s actions=%s",a,b,c,this.actions.length);return this.Ib(this.ga.dl(this.actions,ze(a),b,c,e,f))};c.prototype.ml=function(a,b,c,e,f,g,h){7!==arguments.length&&this.Ia("setNodeTransform: requires 7 arguments");this.log("setNodeTransform(id=%s %s %s %s %s %s %s %s)",
a,b,c,e,f,g,h);return this.Ib(this.ga.ml(this.actions,ze(a),b,c,e,f,g,h))};c.prototype.vq=function(){var a=[];for(var b=0;32>b;b++)a.push("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz01234567890"[Math.floor(63*Math.random())]);a=a.join("");this.log("Creating shared session "+a);return this.vm(a,!0)};c.prototype.vm=function(a,b){this.log("Attach to shared session "+a);this.ve&&this.ve.stop();this.ve=new ve(a,this.ga.view,b);return a};c.prototype.ds=function(a){var b=new zd(!0);this.ga.pf(b);
this.vm(a,!1)};c.prototype.Zi=function(){this.ve&&(this.ve.stop(),this.ve=null)};c.prototype.jb=function(){this.ga.view.jb()};c.prototype.Dh=function(a){this.Ib(this.ga.Dh(this.actions,ze(a)))};c.prototype.upload=function(a,b){function c(){}function e(){}var f=this.ga.tq(b||"Working"),g=new XMLHttpRequest,h=new FormData(a);g.upload.addEventListener("progress",function(a){f.update(a.loaded/a.total)},!1);g.addEventListener("load",function(){200===g.status?(f.done(),e(g.response,g)):(f.error("Error"),
c(g))},!1);g.addEventListener("error",function(){f.error("Error");c(g)},!1);g.addEventListener("abort",function(){f.error("Aborted");c(g)},!1);g.open(a.method,a.action);g.send(h);var k={success:function(a){e=a;return k},error:function(a){c=a;return k}};return k};c.prototype.gu=function(a,b){void 0===b&&(b=!1);this.ga.view.Jm(this.Kb(a),b)};c.prototype.hu=function(a,b){2===arguments.length?this.ga.view.ak({lineWidth:b,strokeStyle:a}):this.ga.view.ak(this.Kb(arguments[0]))};c.prototype.iu=function(a){this.ga.view.Fh(this.Kb(a))};
c.prototype.ju=function(a){this.ga.view.Sj(this.Kb(a))};c.prototype.ku=function(a){ra(a)?(a=new pe(this.ga.view,a),this.ga.view.Pa(a)):this.Ia("useCustomTool(): requires an object as argument.")};c.prototype.Jl=function(a){this.ga.view.Jl(a)};c.prototype.Fh=function(a){void 0===a&&(a={});this.ga.view.Fh(this.Kb(a))};c.prototype.mu=function(a,b,c){void 0===c&&(c="freehand");ra(a)?(a=this.Kb(a),c=b):a={strokeStyle:a,lineWidth:b};this.ga.view.Ym(a,c)};c.prototype.wu=function(a,b){void 0===b&&(b=!0);
var c=a;qa(a)?c={url:a}:"url"in c||this.Ia("useStampTool: missing url in properties");this.ga.view.nu(c,1===arguments.length||!0===b)};c.prototype.ou=function(a,b){if(ra(b)){var c=b.singleLine;var e=b.orthogonal}else c=b;this.ga.view.Dk(this.Kb(a),c,e)};c.prototype.pu=function(){this.ga.view.Ns()};c.prototype.qu=function(){this.ga.view.Va()};c.prototype.Kl=function(a,b,c,e){r(a)||this.Ia("usePolygonTool: parameter 1 must be a number.");r(b)||this.Ia("usePolygonTool: parameter 2 must be a number.");
c&&!r(c)&&this.Ia("usePolygonTool: parameter 3 must be a number.");e&&!ra(e)&&this.Ia("usePolygonTool: parameter 4 must be a object properties.");this.ga.view.Kl(a,b,c||1,e||{})};c.prototype.ru=function(a){void 0===a&&(a={});this.ga.view.Ym(this.Kb(a),"quadratic")};c.prototype.vf=function(a){void 0===a&&(a={});this.ga.view.vf(this.Kb(a))};c.prototype.su=function(a){void 0===a&&(a={});this.ga.view.vf(C.extend({},{roundRadius:this.ga.da.get("defaultRoundRectRadius")},a))};c.prototype.tu=function(a,
b){var c={};ra(a)?c=this.Kb(a):qa(a)&&(c.stokeStyle=a);r(b)&&(c.lineWidth=b);this.ga.view.$m(c)};c.prototype.Ll=function(a,b,c,e,f){this.ga.view.Ll(a,this.Kb(b),c,e,f)};c.prototype.Ml=function(){this.ga.view.Ml()};c.prototype.vu=function(a){this.ga.view.Wt(a)};c.prototype.uu=function(a){this.ga.view.vf(this.Kb(a))};c.prototype.xu=function(a){this.ga.view.$i(this.Kb(a))};c.prototype.Nl=function(a){this.ga.view.Nl(this.Kb(a))};c.prototype.jj=function(){this.ga.view.jj()};c.prototype.kj=function(){this.ga.view.kj()};
return c}();Y.prototype.log=Y.prototype.log;Y.prototype.abortTransaction=Y.prototype.Gp;Y.prototype.addToLanguage=Y.prototype.Fj;Y.prototype.addPage=Y.prototype.Lp;Y.prototype.beginTransaction=Y.prototype.Lm;Y.prototype.bringToFront=Y.prototype.Dg;Y.prototype.canRedo=Y.prototype.He;Y.prototype.canUndo=Y.prototype.Ie;Y.prototype.clearSelection=Y.prototype.nb;Y.prototype.clearUndo=Y.prototype.eq;Y.prototype.clickColour=Y.prototype.gq;Y.prototype.commitIrreversibleTransaction=Y.prototype.kq;
Y.prototype.commitTransaction=Y.prototype.Oj;Y.prototype.copy=Y.prototype.Le;Y.prototype.createGroup=Y.prototype.Kg;Y.prototype.createNode=Y.prototype.createNode;Y.prototype.createPath=Y.prototype.Zh;Y.prototype.createToolbar=Y.prototype.ai;Y.prototype.createUiElement=Y.prototype.wq;Y.prototype.createShape=Y.prototype.Pj;Y.prototype.cut=Y.prototype.Vj;Y.prototype.destroy=Y.prototype.Nf;Y.prototype.deleteNode=Y.prototype.rc;Y.prototype.deleteNodes=Y.prototype.Vm;Y.prototype.deletePage=Y.prototype.Wm;
Y.prototype.deleteSelection=Y.prototype.Xm;Y.prototype.dirty=Y.prototype.Vd;Y.prototype.download=Y.prototype.download;Y.prototype.draw=Y.prototype.ja;Y.prototype.editNodeText=Y.prototype.Gq;Y.prototype.duplicate=Y.prototype.duplicate;Y.prototype.emit=Y.prototype.ua;Y.prototype.skipEvent=Y.prototype.Qt;Y.prototype.focus=Y.prototype.focus;Y.prototype.findNode=Y.prototype.Rq;Y.prototype.findNodes=Y.prototype.kn;Y.prototype.flip=Y.prototype.Tq;Y.prototype.flipNodes=Y.prototype.Pg;
Y.prototype.generatePalette=Y.prototype.Zq;Y.prototype.getActiveLayer=Y.prototype.Qg;Y.prototype.getAllNodes=Y.prototype.ar;Y.prototype.getBackgroundImage=Y.prototype.er;Y.prototype.getBoundingRectangle=Y.prototype.kk;Y.prototype.getConfig=Y.prototype.ir;Y.prototype.getCurrentPage=Y.prototype.be;Y.prototype.getCurrentFillColour=Y.prototype.jr;Y.prototype.getCurrentOutlineColour=Y.prototype.kr;Y.prototype.getCurrentTool=Y.prototype.mk;Y.prototype.getDocumentCoordinates=Y.prototype.mr;
Y.prototype.getDocumentSize=Y.prototype.Tg;Y.prototype.getFillColour=Y.prototype.oi;Y.prototype.getLanguageString=Y.prototype.yr;Y.prototype.getDrawingRectangle=Y.prototype.pr;Y.prototype.getItemProperty=Y.prototype.wr;Y.prototype.getLayers=Y.prototype.Ar;Y.prototype.getLayerNodes=Y.prototype.zr;Y.prototype.getNodePageNumber=Y.prototype.ee;Y.prototype.getNodeProperty=Y.prototype.pi;Y.prototype.getNodeRectangle=Y.prototype.Br;Y.prototype.getNodeScale=Y.prototype.Cr;Y.prototype.getNodeType=Y.prototype.Dr;
Y.prototype.getNodeUnderPoint=Y.prototype.Er;Y.prototype.getPageCount=Y.prototype.Cc;Y.prototype.getPageNode=Y.prototype.yn;Y.prototype.getPathData=Y.prototype.ri;Y.prototype.getPathAsPoints=Y.prototype.Hr;Y.prototype._getPropertyPanelElement=Y.prototype.Ap;Y.prototype.getCanvasScale=Y.prototype.un;Y.prototype.getScreenCoordinates=Y.prototype.Kr;Y.prototype.getSelectedEditHandle=Y.prototype.Lr;Y.prototype.getStrokeColour=Y.prototype.ti;Y.prototype.getEditHandleType=Y.prototype.de;
Y.prototype.setEditHandle=Y.prototype.wt;Y.prototype.getSelectedNodes=Y.prototype.Uf;Y.prototype.getPropertySummary=Y.prototype.Jr;Y.prototype.getViewRectangle=Y.prototype.Pr;Y.prototype.insertPage=Y.prototype.ah;Y.prototype.isLayerVisible=Y.prototype.zk;Y.prototype.load=Y.prototype.load;Y.prototype.lockUpdates=Y.prototype.Ai;Y.prototype.moveDown=Y.prototype.Bi;Y.prototype.movePage=Y.prototype.us;Y.prototype.moveUp=Y.prototype.Ci;Y.prototype.newDocument=Y.prototype.Gk;Y.prototype.nextPage=Y.prototype.nextPage;
Y.prototype.on=Y.prototype.xa;Y.prototype.onComplete=Y.prototype.Fs;Y.prototype.paste=Y.prototype.mh;Y.prototype.previousPage=Y.prototype.Vs;Y.prototype.print=Y.prototype.print;Y.prototype.redo=Y.prototype.Jd;Y.prototype.redraw=Y.prototype.ne;Y.prototype.resize=Y.prototype.resize;Y.prototype.save=Y.prototype.save;Y.prototype.setCursor=Y.prototype.ut;Y.prototype.setToolProperty=Y.prototype.ue;Y.prototype.selectNodes=Y.prototype.selectNodes;Y.prototype.sendToBack=Y.prototype.rh;
Y.prototype.setActiveLayer=Y.prototype.Pi;Y.prototype.setBackgroundBrowserImages=Y.prototype.ot;Y.prototype.setConfig=Y.prototype.st;Y.prototype.setColour=Y.prototype.sh;Y.prototype.setCurrentPage=Y.prototype.nf;Y.prototype.setCustomBackgroundFn=Y.prototype.il;Y.prototype.setDocumentSize=Y.prototype.ng;Y.prototype.setDocumentSizeInTransaction=Y.prototype.Lo;Y.prototype.setDomElement=Y.prototype.vt;Y.prototype.getDomElement=Y.prototype.nr;Y.prototype.setLayerName=Y.prototype.Ct;
Y.prototype.setPaperSize=Y.prototype.ol;Y.prototype.setIconBrowserImages=Y.prototype.zt;Y.prototype.setItemProperty=Y.prototype.Bt;Y.prototype.setNodeProperties=Y.prototype.ll;Y.prototype.setNodeProperty=Y.prototype.se;Y.prototype.setNodeVisibility=Y.prototype.Dt;Y.prototype.setOpacity=Y.prototype.Qo;Y.prototype.setPageView=Y.prototype.nl;Y.prototype.setViewRectangle=Y.prototype.Ht;Y.prototype.setZoom=Y.prototype.Mc;Y.prototype.showLayer=Y.prototype.vh;Y.prototype.translateNode=Y.prototype.ej;
Y.prototype.rotateDocument=Y.prototype.kt;Y.prototype.rotateNode=Y.prototype.Ao;Y.prototype.scaleNode=Y.prototype.dl;Y.prototype.setNodeTransform=Y.prototype.ml;Y.prototype.createSharedSession=Y.prototype.vq;Y.prototype.joinSharedSession=Y.prototype.ds;Y.prototype.stopSharing=Y.prototype.Zi;Y.prototype.undo=Y.prototype.jb;Y.prototype.ungroup=Y.prototype.Dh;Y.prototype.upload=Y.prototype.upload;Y.prototype.useArrowTool=Y.prototype.gu;Y.prototype.useBrushTool=Y.prototype.hu;
Y.prototype.useCircleTool=Y.prototype.iu;Y.prototype.useCurveTool=Y.prototype.ju;Y.prototype.useCustomTool=Y.prototype.ku;Y.prototype.useEditHandleTool=Y.prototype.Jl;Y.prototype.useEllipseTool=Y.prototype.Fh;Y.prototype.useFreehandTool=Y.prototype.mu;Y.prototype.useStampTool=Y.prototype.wu;Y.prototype.useLineTool=Y.prototype.ou;Y.prototype.usePanTool=Y.prototype.pu;Y.prototype.usePickTool=Y.prototype.qu;Y.prototype.usePolygonTool=Y.prototype.Kl;Y.prototype.useQuadraticBezierTool=Y.prototype.ru;
Y.prototype.useRectangleTool=Y.prototype.vf;Y.prototype.useRoundRectTool=Y.prototype.su;Y.prototype.useShapeBrushTool=Y.prototype.tu;Y.prototype.useShapeTool=Y.prototype.Ll;Y.prototype.useSplitWallTool=Y.prototype.Ml;Y.prototype.useStampLineTool=Y.prototype.vu;Y.prototype.useSquareTool=Y.prototype.uu;Y.prototype.useTextTool=Y.prototype.xu;Y.prototype.useWallTool=Y.prototype.Nl;Y.prototype.zoomIn=Y.prototype.jj;Y.prototype.zoomOut=Y.prototype.kj;"undefined"!==typeof jQuery&&(jQuery.fn.zwibbler=function(c){void 0===c&&(c={});var a=null;this.each(function(b,d){d.zwibbler&&jQuery(d).empty();a=new Y(C(d),c);d.zwibbler=a});return a},jQuery.fn.zwibblerContext=function(){return this[0].zwibbler});
var Z=function(){function c(){this.xk=[];this.buttons=[];this.Tj={};this.fonts=new wc;this.log=B.create("ZWIBBLER")}c.prototype.create=function(a,b){"string"===typeof a&&0<a.length&&"."!==a.charAt(0)&&"#"!==a.charAt(0)&&(a="#"+a);var c=Yb(a);return null===c?(alert("Zwibbler.create: Cannot find an element with id "+a),null):new Y(c,b)};c.prototype.hc=function(a){for(var b=["name","image","onclick"],c=0;c<b.length;c++)if(!(b[c]in a))return alert("Zwibbler.addButton: missing "+b[c]),!1;this.buttons.push(a);
return!0};c.prototype.Ip=function(a,b){this.Tj[a]=b};c.prototype.qp=function(a,b){void 0===b&&(b={});return this.$l(a,b)};c.prototype.$l=function(a,b){function c(){var a=e.outerWidth(),b=e.outerHeight(),c=kc();e.offset({left:c.x+c.width/2-a/2,top:c.y+c.height/2-b/2})}void 0===b&&(b={});var e=Yb(a);null===e[0].parentNode&&C(document.body).append(e);"static"===e.ea("position")&&e.ea("position","absolute");e.ea("display","none");var f=new qb("transparent");f.insertBefore=e;var g=b.showNear,h=b.showHow,
k=!1,l={hide:function(){f.Xa();e.Xa();if(l.onhide)l.onhide();C(window).wg("resize",c)},show:function(a,b,d){void 0===d&&(d=!1);var n=0,m=0,q="",x="";if("number"===typeof a&&"number"===typeof b){n=a;m=b;var y=!0}else q=a||g,x=b||h,y=!1;a=ec()+1;e.ea("z-index",a);f.zIndex=a;e.show();a=e.outerWidth();b=e.outerHeight();y?(x=kc(),n={left:n,top:m},n.left=Math.min(n.left,x.x+x.width-a-2),n.top=Math.min(n.top,x.y+x.height-b-3),e.offset(n)):q&&x?(m=Yb(q),n=e,q=x,x=m.offset(),q=q.toLowerCase().split(" "),2!==
q.length&&(q=["tl","tl"]),0<=q[0].indexOf("b")&&(x.top+=m.outerHeight()),0<=q[0].indexOf("r")&&(x.left+=m.outerWidth()),0<=q[1].indexOf("b")&&(x.top-=n.outerHeight()),0<=q[1].indexOf("r")&&(x.left-=n.outerWidth()),n.ea("position","absolute"),m=kc(),q=n.width(),a=n.height(),x.left=Math.min(x.left,m.x+m.width-q),x.top=Math.min(x.top,m.y+m.height-a),n.offset(x)):(C(window).xa("resize",c),c());f.show(l.hide);if(l.onshow)l.onshow();k=d},onshow:b.onshow,onhide:b.onhide};e.xa("click",function(){k&&l.hide()});
return l};c.prototype.lp=function(a,b){var c=Yb(a),e=new vb(c,b),f=new Hb;e.Sk=function(a){f.ua("change",a)};return{on:function(a,b){f.xa(a,b)},colour:function(){if(arguments.length)e.Mo(arguments[0]);else return e.kb.toString()}}};c.prototype.tp=function(a,b){void 0===b&&(b={});var c=b.autohide,e=new Jb(Yb(a));b.onshow&&e.xa("show",b.onshow);b.onhide&&e.xa("hide",b.onhide);return{show:function(a){e.show("left"===a?"left":"right",c)},hide:function(){e.Xa()}}};c.prototype.sq=function(a,b){return this.kf(a,
b)};c.prototype.kf=function(a,b){function c(){var a=u.Ue(),b=1,c=0,d=0;h&&(a.y=h);n&&(a.height=n-a.y);k&&(a.x=k);l&&(a.width=l-a.x);f&&g?b=Math.min(f/a.width,g/a.height):f?(b=f/a.width,g=a.height*b):g?(b=g/a.height,f=a.width*b):(f=a.width,g=a.height);a.width*b<f&&(c=f/2-a.width*b/2);a.height*b<g&&(d=g/2-a.height*b/2);c-=a.x*b;d-=a.y*b;m.width=Math.ceil(f);m.height=Math.ceil(g);q.translate(c,d);q.scale(b,b);u.ja(q);e.log("Drawn.")}var e=this;void 0===b&&(b={});var f=b.width||0,g=b.height||0,h=b.top||
0,k=b.left||0,l=b.right||0,n=b.bottom||0,m=Zb(null),q=m.getContext("2d"),u=Dd.qj(a);if(!u)throw Error("Zwibbler.render: Could not open document");var v=new kd;u.format(q,v);v.xa("reformat",function(a){u.$f(a.id)});v.Ge?v.xa("done",function(){u.format(q,v);c()}):c();return m};c.prototype.Ss=function(a){a=z.Xb(a);return{r:a.values[0],g:a.values[1],b:a.values[2],a:a.values[3]}};c.prototype.rs=function(a){return(new z(z.RGBA,[a.r,a.g,a.b,a.a])).toString()};c.prototype.$q=function(a){var b=document.createElement("a");
b.href=a;return b.href};c.prototype.Up=function(a){return w.encode("base64",a)};c.prototype.Jp=function(a,b){this.fonts.add(a,b)};c.prototype.np=function(a){var b=new U;Lc(b,a);return b.ec()};c.prototype.vr=function(a,b){var c=document.createElement("img");c.src=a;c.onload=function(){b(c.naturalWidth,c.naturalHeight,c)}};c.prototype.qt=function(a,b){return hc(a,b)};c.prototype.du=function(a){var b=Yb(a)[0];if(!b)throw Error("Zwibbler.toggleFullScreen: "+a+" not found");a=document;this.Rn()?document.exitFullscreen?
document.exitFullscreen():a.msExitFullscreen?a.msExitFullscreen():a.mozCancelFullScreen?a.mozCancelFullScreen():document.webkitExitFullscreen&&document.webkitExitFullscreen():b.requestFullscreen?b.requestFullscreen():b.msRequestFullscreen?b.msRequestFullscreen():b.mozRequestFullScreen?b.mozRequestFullScreen():b.webkitRequestFullscreen&&b.webkitRequestFullscreen(Element.ALLOW_KEYBOARD_INPUT)};c.prototype.Rn=function(){var a=document;return document.fullscreenElement||a.mozFullScreenElement||a.webkitFullscreenElement||
a.msFullscreenElement?!0:!1};c.prototype.Jq=function(){B.Iq()};return c}(),Cd=new Z;Cd.instances=Cd.xk;Z.prototype.addButton=Z.prototype.hc;Z.prototype.addCustomNode=Z.prototype.Ip;Z.prototype.Popup=Z.prototype.qp;Z.prototype.Dialog=Z.prototype.$l;Z.prototype.ColourWheel=Z.prototype.lp;Z.prototype.SlidingPanel=Z.prototype.tp;Z.prototype.createPreview=Z.prototype.sq;Z.prototype.render=Z.prototype.kf;Z.prototype.parseColour=Z.prototype.Ss;Z.prototype.makeColour=Z.prototype.rs;
Z.prototype.getAbsoluteUrl=Z.prototype.$q;Z.prototype.base64Encode=Z.prototype.Up;Z.prototype.addFont=Z.prototype.Jp;Z.prototype.pathCommands=Z.prototype.fv;Z.prototype.CommandsFromSvgPath=Z.prototype.np;Z.prototype.getImageSize=Z.prototype.vr;Z.prototype.setColourOpacity=Z.prototype.qt;Z.prototype.toggleFullScreen=Z.prototype.du;Z.prototype.isFullScreen=Z.prototype.Rn;Z.prototype.enableConsoleLogging=Z.prototype.Jq;window.Zwibbler=Cd;var Be=function(c){function a(a,d){var b=c.call(this,a,d)||this;b.Fc=null;b.log=B.create("CUSTOM");return b}p(a,c);a.prototype.type=function(){return"CustomNode"};a.prototype.setProperty=function(a,d){if(null===this.Fc&&"type"===a){var b=Cd.Tj[d];this.Fc=new b}this.Fc&&this.Fc.setProperty?this.Fc.setProperty(a,d):c.prototype.setProperty.call(this,a,d)};a.prototype.la=function(a){return this.Fc&&this.Fc.setProperty?this.Fc.getProperty(a):c.prototype.la.call(this,a)};a.prototype.format=function(a){"format"in
this.Fc?this.Fc.format(a):alert("Error: custom item must have a format(ctx) function");a=this.Fc.rect;this.rect=new K(a.x,a.y,a.width,a.height)};a.prototype.ja=function(a){this.Fc.draw(a)};return a}(R);R.Sc("CustomNode",Be);var Ce=function(c){function a(a,d){var b=c.call(this,a,d)||this;b.qa=null;b.width=100;b.height=20;b.ob=new Q;b.Ne=[];b.Ed=new K(0,0,b.width,b.height);b.kc=new K(0,0,b.width,b.height);b.log=B.create("IMAGE",!0);delete b.aa.fillStyle;delete b.aa.strokeStyle;delete b.aa.lineWidth;b.aa.url="";return b}p(a,c);a.prototype.type=function(){return"ImageNode"};a.prototype.setProperty=function(a,d){c.prototype.setProperty.call(this,a,d);if("url"===a)this.qa=null;else if("allowCrop"===a||"crop"===a||"blendMode"===
a||"opacity"===a||"width"===a||"height"===a)this.aa[a]=d};a.prototype.tt=function(a){a.x=Math.max(a.x,0);a.y=Math.max(a.y,0);a.width=Math.min(a.width,this.Ed.width);a.height=Math.min(a.height,this.Ed.height);a.width=Math.max(1,a.width);a.height=Math.max(1,a.height);this.aa.crop=[a.x,a.y,a.width,a.height].join()};a.prototype.vn=function(){var a=this.aa.crop,c=new K(0,0,this.Ed.width,this.Ed.height);a&&(a=a.split(","),c.x=parseFloat(a[0])|0,c.y=parseFloat(a[1])|0,c.width=parseFloat(a[2])|0,c.height=
parseFloat(a[3])|0);return c};a.prototype.format=function(a,c){function b(a,b,c){l.Ne.push({x:l.kc.x+a*l.kc.width,y:l.kc.y+b*l.kc.height,Cd:c})}var d=this;null===this.qa&&"ImageSurface"in window?(this.qa=new window.ImageSurface(this.aa.url),this.Ed=new K(0,0,this.qa.width,this.qa.height)):null===this.qa?(this.Ed=new K(0,0,this.width,this.height),c.add(this.id,"image",this.aa.url,null,function(a){d.log("Got image response.");d.qa=a;a=d.la("width");var b=d.la("height");d.log("Override width/height as %s/%s",
a,b);a&&(d.qa.style.width=a+"px");b&&(d.qa.style.height=b+"px");return c.bl(d.id)})):this.Ed=new K(0,0,this.qa.width,this.qa.height);this.kc=this.vn();this.rect=this.kc.clone();var g=this.la("boundingPolygon");if(g){for(var h=[],k=0;k<g.length;k+=2)h.push(new E(g[k],g[k+1]));this.ob=new Q(h)}else this.ob=new Q(this.rect);this.fb=this.rect.clone();this.ob.transform(this.aa.matrix);this.rect.transform(this.aa.matrix);this.Ne.length=0;var l=this;b(.5,0,!0);b(1,.5,!1);b(.5,1,!0);b(0,.5,!1)};a.prototype.jk=
function(){return this.ob};a.prototype.gb=function(a,c){return!this.aa.locked&&this.ob.Uc(a,c,3)?this:null};a.prototype.Ce=function(b){var c,e,f=!1;if(this.qa)try{var g=b.globalCompositeOperation,h=b.globalAlpha,k=this.la("blendMode"),l=this.la("opacity");k&&(b.globalCompositeOperation=""+k,this.log("Using globalCompsiteOperation=%s (requested %s)",b.globalCompositeOperation,k));void 0!==l&&(b.globalAlpha=l);b.drawImage(this.qa,this.kc.x,this.kc.y,this.kc.width,this.kc.height,this.kc.x,this.kc.y,
this.kc.width,this.kc.height);b.globalAlpha=h;b.globalCompositeOperation=g;if(a.Yl){var n=this.ob.ma;b.save();b.setTransform(1,0,0,1,0,0);b.beginPath();b.lineWidth=2;b.strokeStyle="#000000";b.moveTo(n[0].x,n[0].y);var m=c=1;for(e=n.length-1;c<=e;m=c+=1)b.lineTo(n[m].x,n[m].y);b.closePath();b.stroke();b.restore()}}catch(q){this.log("Error drawing image: %s",q.message),f=q}if(null===this.qa||f)b.save(),b.lineWidth=1,b.strokeStyle="#cccccc",b.strokeRect(0,0,this.width,this.height),b.restore()};a.prototype.Xf=
function(){return!0===this.la("allowCrop")&&!0!==this.la("lockEditMode")};a.prototype.ii=function(a,c){a.save();a.beginPath();a.lineWidth=1*c;a.strokeStyle="#0050B7";for(var b=this.Ga(),d=0;d<this.Ne.length;d++){var g=this.Ne[d],h=b.apply(g.x,g.y),k;if(g.Cd){var l=20;var n=k=0;var m=3;g=h.x-10;h=h.y-6}else l=0,k=20,n=3,m=0,g=h.x-6,h=h.y-10;for(var q=0;5>q;q++)a.moveTo(g,h),a.lineTo(g+l*c,h+k*c),g+=n*c,h+=m*c}a.stroke();a.restore()};a.prototype.ld=function(a,c,e){var b=this.Ga();e*=10;for(var d=0;d<
this.Ne.length;d++){var h=this.Ne[d];h=b.apply(h.x,h.y);if(h.x-e<=a&&a<h.x+e&&h.y-e<=c&&c<h.y+e)return d}return null};a.prototype.Ug=function(a){a=this.Ne[a];return this.Ga().apply(a.x,a.y)};a.prototype.ie=function(a,c,e){var b=this.vn();c=this.Te().apply(c,e);0===a&&0<=c.y?(b.height-=c.y-b.y,b.y=c.y):1===a&&c.x<this.Ed.width?b.width=c.x-b.x:2===a&&c.y<this.Ed.height?b.height=c.y-b.y:3===a&&0<=c.x&&(b.width-=c.x-b.x,b.x=c.x);this.tt(b)};a.Yl=!1;return a}(R);R.Sc("ImageNode",Ce);var De=function(c){function a(a,d){var b=c.call(this,a,d)||this;b.qa=null;b.$g=20;b.Xc=20;b.ob=new Q;b.Pc=0;b.Qc=0;b.Nd=0;b.Od=0;b.log=B.create("STAMPLINE",!0);b.log("New StampLineNode created.");b.aa.x1=10;b.aa.y1=10;b.aa.x2=100;b.aa.y2=100;b.aa.url="http://zwibbler.com/wd-box.png";return b}p(a,c);a.prototype.type=function(){return"StampLineNode"};a.prototype.format=function(a,c){var b=this;null===this.qa?(c.add(this.id,"image",this.aa.url,null,function(a){b.log("Got image response.");b.qa=a;c.bl(b.id)}),
this.Xc=this.$g=20):(this.$g=this.qa.width,this.Xc=this.qa.height);this.Pc=this.aa.x1;this.Qc=this.aa.y1;this.Nd=this.aa.x2;this.Od=this.aa.y2;var d=G(this.Pc,this.Qc,this.Nd,this.Od);var g=-Math.atan2(this.Od-this.Qc,this.Nd-this.Pc);this.ob=new Q;this.ob.add(0,-this.Xc/2);this.ob.add(d,-this.Xc/2);this.ob.add(d,this.Xc/2);this.ob.add(0,this.Xc/2);d=new M;d=d.multiply(this.Ga());d=d.multiply(new L(this.Pc,this.Qc));d=d.multiply(new zc(g,0,0));this.ob.transform(d);this.rect=this.ob.Nm()};a.prototype.gb=
function(a,c){return!this.aa.locked&&this.ob.Uc(a,c,3)?this:null};a.prototype.Xf=function(){return!0};a.prototype.ld=function(a,c,e){var b=this.Ga();var d=b.apply(this.Pc,this.Qc);b=b.apply(this.Nd,this.Od);e*=8;return a>=d.x-e&&a<d.x+e&&c>=d.y-e&&c<d.y+e?0:a>=b.x-e&&a<b.x+e&&c>=b.y-e&&c<b.y+e?1:null};a.prototype.Ug=function(a){return 0===a?this.Ga().apply(this.aa.x1,this.aa.y1):this.Ga().apply(this.aa.x2,this.aa.y2)};a.prototype.ie=function(a,c,e){c=this.Te().apply(c,e);0===a?(this.aa.x1=c.x,this.aa.y1=
c.y):1===a&&(this.aa.x2=c.x,this.aa.y2=c.y)};a.prototype.ii=function(a,c){a.save();a.lineWidth=1*c;a.strokeStyle="#0050B7";var b=this.Ga();var d=b.apply(this.Pc,this.Qc);b=b.apply(this.Nd,this.Od);var g=4*c;a.beginPath();a.moveTo(d.x,d.y);a.lineTo(b.x,b.y);a.rect(d.x-g,d.y-g,2*g,2*g);a.rect(b.x-g,b.y-g,2*g,2*g);a.stroke();a.restore()};a.prototype.Ce=function(a){var b,c;var f=new E(this.Pc,this.Qc);var g=new E(this.Nd,this.Od);g=f.Oa(g);f=new zc(-Math.atan2(this.Od-this.Qc,this.Nd-this.Pc),this.Pc,
this.Qc);f=f.multiply(new L(this.Pc,this.Qc));a.transform(f.m11,f.m21,f.m12,f.m22,f.Ca,f.Da);a.beginPath();f=b=0;for(c=this.$g;0<c?b<=g:b>=g;f=b+=c)this.qa?this.$g<g-f?a.drawImage(this.qa,f,-this.Xc/2|0):1<g-f&&a.drawImage(this.qa,0,0,g-f|0,this.Xc,f,-this.Xc/2|0,g-f|0,this.Xc):a.rect(f,0,this.$g,this.Xc);null===this.qa&&(a.lineWidth=2,a.strokeStyle="red",a.stroke())};return a}(R);R.Sc("StampLineNode",De);var Ee=function(c){function a(a,d){var b=c.call(this,a,d)||this;b.Qh="UnknownNode";b.width=100;b.height=20;b.pb=new Wc;b.log=B.create("UNKNOWN",!0);b.pb.Go("centre","middle");return b}p(a,c);a.prototype.Gt=function(a){this.Qh=a;this.pb.So(a);this.log("Creating placeholder for node type %s",a)};a.prototype.type=function(){return this.Qh};a.prototype.setProperty=function(a,c){this.aa[a]=c};a.prototype.format=function(a){this.log("Formatting placeholder for %s",this.Qh);this.rect=new K(0,0,this.width,
this.height);this.rect.transform(this.aa.matrix);this.pb.format(a,this.width,this.height)};a.prototype.Ce=function(a){this.log("Drawing placeholder for for %s",this.Qh);a.save();a.lineWidth=1;a.fillStyle="#888888";a.fillRect(0,0,this.width,this.height);a.fillStyle="#000000";this.pb.ja(a,0,0);a.restore()};a.Yl=!1;return a}(R);R.Sc("UnknownNode",Ee);var Fe=function(){function c(a,b){this.next=this.$c=null;this.Al=this.aj=this.length=0;this.ap=!1;this.text="";this.Di=!0;this.log=B.create("WallSegment",!0);a instanceof c?(this.$c=a,this.$c.next=this,this.from=this.$c.fa):this.from=a;this.fa=b}c.prototype.qn=function(a,b,c){this.text=a;this.aj=b;this.Al=c;this.ap=!1};c.prototype.Bq=function(a){if(""!==this.text){var b=G(this.from.x,this.from.y,this.fa.x,this.fa.y);if(!(b<this.aj)){a.save();var c=2*this.Al,e=J(this.from.x,this.from.y,this.fa.x,this.fa.y),
f=new E(e.y,-e.x),g=Math.atan2(this.fa.y-this.from.y,this.fa.x-this.from.x);0>g&&(g+=2*Math.PI);this.ap&&(c*=-1);var h=(b-this.aj)/2,k=new E(this.from.x+f.x*c,this.from.y+f.y*c),l=new E(this.fa.x+f.x*c,this.fa.y+f.y*c);a.beginPath();a.moveTo(k.x-f.x*c/4+e.x*c/4,k.y-f.y*c/4+e.y*c/4);a.lineTo(k.x,k.y);a.lineTo(k.x+f.x*c/4+e.x*c/4,k.y+f.y*c/4+e.y*c/4);a.moveTo(l.x-f.x*c/4-e.x*c/4,l.y-f.y*c/4-e.y*c/4);a.lineTo(l.x,l.y);a.lineTo(l.x+f.x*c/4-e.x*c/4,l.y+f.y*c/4-e.y*c/4);a.moveTo(k.x,k.y);a.lineTo(k.x+e.x*
h,k.y+e.y*h);a.moveTo(l.x,l.y);a.lineTo(l.x-e.x*h,l.y-e.y*h);a.stroke();g>Math.PI/2&&g<3*Math.PI/2&&(g+=Math.PI);a.translate(k.x+e.x*b/2,k.y+e.y*b/2);a.rotate(g);a.translate(-this.aj/2,this.Al/2*.8);a.fillText(this.text,0,0);a.restore()}}};c.prototype.yq=function(a,b){var c=J(this.from.x,this.from.y,this.fa.x,this.fa.y),e=new E(c.y,-c.x),f=e.x*(a-this.from.x)+e.y*(b-this.from.y);c=new E(this.from.x+f*e.x,this.from.y+f*e.y);e=new E(this.fa.x+f*e.x,this.fa.y+f*e.y);this.$c&&(f=Jc(this.$c.from.x,this.$c.from.y,
this.$c.fa.x,this.$c.fa.y,c.x,c.y,e.x,e.y))&&(c=f);this.next&&(f=Jc(this.next.from.x,this.next.from.y,this.next.fa.x,this.next.fa.y,c.x,c.y,e.x,e.y))&&(e=f);this.from.x=c.x;this.from.y=c.y;this.fa.x=e.x;this.fa.y=e.y};return c}(),Ge=function(){function c(a,b){this.Ka=a;this.type=b;this.log=B.create("WallEditHandle",!0);this.Ka=a;this.type=b}c.prototype.gb=function(a,b,c,e,f){switch(this.type){case "from":a=G(a,b,this.Ka.from.x,this.Ka.from.y);break;case "to":a=G(a,b,this.Ka.fa.x,this.Ka.fa.y);break;
default:var d=0,h=0;"middle"===e?(d=-f/2,h=f/2):"outside"===e?d=-f:h=f;e=J(this.Ka.from.x,this.Ka.from.y,this.Ka.fa.x,this.Ka.fa.y);e=new E(e.y,-e.x);d=(new E(a,b)).ei(new E(this.Ka.from.x+d*e.x,this.Ka.from.y+d*e.y),new E(this.Ka.fa.x+d*e.x,this.Ka.fa.y+d*e.y));a=(new E(a,b)).ei(new E(this.Ka.from.x+h*e.x,this.Ka.from.y+h*e.y),new E(this.Ka.fa.x+h*e.x,this.Ka.fa.y+h*e.y));a=Math.min(d,a)}return a<c};c.prototype.moveTo=function(a,b){switch(this.type){case "from":var c=this.Ka.$c;this.Ka.from.x=a;
this.Ka.from.y=b;break;case "to":var e=this.Ka.next;this.Ka.fa.x=a;this.Ka.fa.y=b;break;default:c=this.Ka.$c,e=this.Ka.next,this.Ka.yq(a,b)}c&&(c.Di=!0);e&&(e.Di=!0)};c.prototype.Ir=function(){switch(this.type){case "from":return this.Ka.from;case "to":return this.Ka.fa;default:return this.Ka.from}};c.prototype.cr=function(){return Math.atan2(this.Ka.fa.y-this.Ka.from.y,this.Ka.fa.x-this.Ka.from.x)};return c}();var He=function(c){function a(a,d){var b=c.call(this,a,d)||this;b.precision=1;b.font="";b.rect=new K(0,0,0,0);b.fb=new K(0,0,0,0);b.path=null;b.Fg=[];b.Hb=[];b.Gb=[];b.ka=null;b.lineWidth=0;b.sg=0;b.log=B.create("WallNode",!0);b.log("New WallNode created.");b.aa.svgpath="";b.aa.strokeStyle="#000000";b.aa.lineWidth=1;b.aa.pixelsPerUnit=1;b.aa.units="px";b.aa.fontSize=15;b.aa.fontName="Arial";b.aa.textFillStyle="#000000";b.aa.insideFillStyle="rgba(0,0,0,0.0)";b.aa.fillStyle="rgba(0,0,0,0.0)";b.aa.thickness=
10;b.aa.placement="middle";b.aa.lockCorners=!1;return b}p(a,c);a.prototype.type=function(){return"WallNode"};a.prototype.resolve=function(a){var b=a.jk().clone();this.log("Resolve with: %s %s",a.type(),b.ma);b.transform(this.Te());this.Fg.push(b);return a.rect.Ls(this.rect)};a.prototype.format=function(a,c){this.ka=a;var b=new E(0,0),d=[],g=null,h=this.Ga(),k=[],l=[],n,m=this,q={beginPath:function(){},moveTo:function(a,c){b=h.apply(a,c);k.push(new E(a,c));l.push(b);g=null;q.moveTo=q.lineTo},lineTo:function(a,
c){var e=h.apply(a,c);g?g=new Fe(g,e):n=g=new Fe(b,e);k.push(new E(a,c));l.push(e);b=e;d.push(g)},bezierCurveTo:function(){},quadraticCurveTo:function(){},closePath:function(){m.log("close");n&&g!==n&&null!==g&&(m.log("close up!"),n.$c=g,g.next=n,g.fa=n.from)}};this.Hb=d;this.path=new P;this.log("Formatting svgpath=%s",this.la("svgpath"));Lc(this.path,this.la("svgpath"));var u;for(u=0;u<this.Fg.length;u++)this.log("path: %s",this.path.Md()),this.log("poly: %s",this.Fg[u].Md()),this.path=this.path.iq(this.Fg[u]);
this.path.ja(q);this.fb=K.ze(k);this.rect=K.ze(l);this.path.transform(this.Ga());this.lineWidth=u=this.la("lineWidth");this.rect.Gc(u/2,u/2);this.sg=this.la("thickness");this.rect.Gc(2*this.sg);this.rect.Gc(3*this.aa.fontSize);this.font=""+this.aa.fontSize+'px "'+this.aa.fontName+'"';for(u=0;u<this.Hb.length;u++)this.rn(a,this.Hb[u]);this.Gb.length=0;for(u=0;u<d.length;u++){var v=d[u];A!==v.from&&this.Gb.push(new Ge(v,"from"));this.Gb.push(new Ge(v,"to"));var A=v.fa}for(u=0;u<d.length;u++)v=d[u],
this.Gb.push(new Ge(v,"middle"));A=this.la("insideFillStyle");this.Xq(a,c,A);this.Fg.length=0};a.prototype.rn=function(a,c){c.Di=!1;if(0>=this.aa.pixelsPerUnit)c.qn("",0,0);else{var b=G(c.from.x,c.from.y,c.fa.x,c.fa.y)/this.aa.pixelsPerUnit;if("ft-in"===this.aa.units){var d=Math.floor(b);b=Math.round(12*(b-d));12===b&&(b=0,d+=1);b=b?" "+d+"'"+b+'" ':" "+d+"' "}else d=Math.pow(10,this.precision),b=Math.round(b*d)/d,b=" "+b+this.aa.units+" ";a.font=this.font;c.qn(b,a.measureText(b).width,this.aa.fontSize)}};
a.prototype.ft=function(){this.log("Reconstruct path!");var a=new Mc,c=this.Ga().inverse();a.transform(c.m11,c.m21,c.m12,c.m22,c.Ca,c.Da);this.bn(a);this.setProperty("svgpath",a.toString())};a.prototype.Tf=function(){return"svgpath"};a.prototype.Mr=function(){return this.path||new P};a.prototype.bn=function(a){var b=null,c;for(c=0;c<this.Hb.length;c++){var f=this.Hb[c];if(b!==f.from){a.moveTo(f.from.x,f.from.y);var g=f.from}a.lineTo(f.fa.x,f.fa.y);f.fa===g&&a.closePath();b=f.fa}};a.prototype.ja=function(a){var b;
a.save();this.ig(a);a.lineJoin="square";a.lineCap="square";a.strokeStyle=this.la("strokeStyle");a.lineWidth=this.la("lineWidth");a.beginPath();this.bn(a);a.fillStyle=this.rr();a.fill();a.beginPath();var c=[];for(b=0;b<this.Hb.length;b++){var f=this.Hb[b];g!==f.from&&(Nc(a,c,this.la("thickness"),this.la("placement")),c.length=0,c.push(f.from));c.push(f.fa);var g=f.fa}Nc(a,c,this.la("thickness"),this.la("placement"));a.fillStyle=this.la("fillStyle");a.strokeStyle=this.la("strokeStyle");a.fill();a.stroke();
a.fillStyle=a.strokeStyle;if(0<this.la("pixelsPerUnit"))for(a.textBaseline="alphabetic",a.fillStyle=this.la("textFillStyle"),a.strokeStyle=this.la("textFillStyle"),a.font=this.font,b=0;b<this.Hb.length;b++)f=this.Hb[b],f.Bq(a);this.gg(a);a.restore()};a.prototype.gb=function(a,c){if(null===this.path)return null;var b=6+2*this.la("thickness");return"rgba(0,0,0,0.0)"===this.la("fillStyle")?!this.hidden()&&!this.la("locked")&&this.rect.Uc(a,c,b)&&this.path.Vk(a,c,b)?this:null:!this.hidden()&&!this.la("locked")&&
this.rect.Uc(a,c,b)&&this.path.vo(a,c,b)?this:null};a.prototype.ld=function(a,c,e){var b=this.la("thickness"),d=this.la("wallPlacement");e=6/e+b;for(var h=this.aa.lockCorners,k=0;k<this.Gb.length;k++)if(this.Gb[k].gb(a,c,e,d,b)&&(!h||"middle"===this.Gb[k].type))return k;return null};a.prototype.Xf=function(){return!1};a.prototype.Ug=function(a){return a>=this.Gb.length?(this.log("Bad edit handle %s",a),null):this.Gb[a].Ir()};a.prototype.de=function(a){return null!==a&&a<this.Gb.length?this.Gb[a].type:
null};a.prototype.qr=function(a){return null!==a&&a<this.Gb.length?this.Gb[a].cr():0};a.prototype.uk=function(a,c,e,f,g){if(null===a||a>=this.Gb.length)return new E(0,0);a=this.Gb[a].Ka;var b=this.la("placement");"middle"===b?e-=this.sg/2:"outside"===b&&(e-=this.sg);"middle"===c?e+=this.sg/2:"outside"===c&&(e+=this.sg);c=J(a.from.x,a.from.y,a.fa.x,a.fa.y);var d=new E(c.y,-c.x);c=a.from.x+e*d.x;b=a.from.y+e*d.y;var l=a.fa.x+e*d.x-c;e=a.fa.y+e*d.y-b;f=((f-c)*l+(g-b)*e)/(l*l+e*e);1<f?f=1:0>f&&(f=0);
return new E(c+f*l,b+f*e)};a.prototype.ie=function(a,c,e){if(a>=this.Gb.length)this.log("Bad edit handle %s",a);else{this.Gb[a].moveTo(c,e);for(a=0;a<this.Hb.length;a++)c=this.Hb[a],c.Di&&this.ka&&this.rn(this.ka,c);this.ft()}};return a}(R);R.Sc("WallNode",He);var Ie=function(c){function a(){var a=null!==c&&c.apply(this,arguments)||this;a.Tb="Action";a.log=B.create("ACTION");return a}p(a,c);a.prototype.Ob=function(){};a.prototype.toString=function(){return""+this.Tb+"()"};return a}(Pb),V=function(c){function a(a,d,e,f,g){void 0===f&&(f=null);void 0===g&&(g=-1);var b=c.call(this)||this;b.id=a;b.type=d;b.aa=e;b.Ii=f;b.index=g;b.node=null;b.Tb="CreateAction";return b}p(a,c);a.prototype.Ob=function(a){var b=R.create(this.type,this.id,a);b||(this.type in Cd.Tj?
(b=new Be(this.id,a),b.setProperty("type",this.type)):(this.log("Bad node type: %s",this.type),b=R.create("UnknownNode",this.id,a),b.Gt(this.type)));b.Cb(this.aa);null===this.Ii&&(this.Ii=a.sk().id,this.index=-1);var c=a.za(this.Ii,!1);c instanceof ld&&(a.qb(c,b,this.index),this.log("Add %s id %s to parent %s index %s",b.type(),this.id,c.type(),this.index),this.node=b)};a.prototype.toString=function(){return""+this.Tb+"("+this.type+NaN+this.id+", "+JSON.stringify(this.aa)+", parent="+this.Ii+", index="+
this.index+")"};a.prototype.jb=function(a){this.node&&a.removeNode(this.node)};return a}(Ie),le=function(c){function a(a){var b=c.call(this)||this;b.Na=a;b.ke=[];b.Tb="DeleteAction";return b}p(a,c);a.prototype.Ob=function(a){var b;this.ke.length=0;var c=this.Na;var f=0;for(b=c.length;f<b;f++){var g=c[f];(g=a.za(g,!1))&&this.ke.push({node:g,parent:g.parent,index:a.removeNode(g)})}};a.prototype.jb=function(a){for(var b,c=this.ke.length-1;0<=c;--c)b=this.ke[c],b.node&&b.parent&&a.qb(b.parent,b.node,
b.index)};return a}(Ie),Rd=function(c){function a(a,d,e){var b=c.call(this)||this;b.Na=a;b.name=d;b.value=e;b.Fd=[];b.Tb="SetAction";return b}p(a,c);a.prototype.Ob=function(a){var b;this.Fd.length=0;var c=this.Na;var f=0;for(b=c.length;f<b;f++){var g=c[f];if(g=a.za(g,!0))this.Fd.push(g.la(this.name)),a.se(g,this.name,this.value)}};a.prototype.jb=function(a){var b,c,f;if(0!==this.Na.length){var g=c=0;for(f=this.Na.length-1;0<=f?c<=f:c>=f;g=0<=f?++c:--c)(b=a.za(this.Na[g],!0))&&a.se(b,this.name,this.Fd[g])}};
a.prototype.co=function(b){if(!(b instanceof a)||this.name!==b.name)return!1;this.Na.sort();b.Na.sort();if(this.Na.length!==b.Na.length)return!1;for(var c=0;c<this.Na.length;c++)if(this.Na[c]!==b.Na[c])return!1;this.log("Merging property change %s",this.name);this.value=b.value;return!0};return a}(Ie),Pd=function(c){function a(a,d){var b=c.call(this)||this;b.Na=a;b.sa=d;b.Tb="TransformAction";b.inverse=d.inverse();return b}p(a,c);a.prototype.Ob=function(a){for(var b=a.qk(this.Na,!0,!0),c=0;c<b.length;c++){var f=
b[c];f.transform(this.sa);a.Zc.Cb(f.id,{matrix:f.Ga()})}};a.prototype.jb=function(a){for(var b=a.qk(this.Na,!0,!0),c=0;c<b.length;c++){var f=b[c];f.transform(this.inverse);a.Zc.Cb(f.id,{matrix:f.Ga()})}};return a}(Ie),Gd=function(c){function a(a,d,e,f,g,h){var b=c.call(this)||this;b.id=a;b.handle=d;b.Bs=e;b.Cs=f;b.x=g;b.y=h;b.Tb="MoveEditHandleAction";return b}p(a,c);a.prototype.Ob=function(a){var b;if(b=a.za(this.id,!0)){b.ie(this.handle,this.x,this.y);var c={};c[b.Tf()]=b.la(b.Tf());a.Zc.Cb(b.id,
c)}};a.prototype.jb=function(a){var b;if(b=a.za(this.id,!0)){b.ie(this.handle,this.Bs,this.Cs);var c={};c[b.Tf()]=b.la(b.Tf());a.Zc.Cb(b.id,c)}};return a}(Ie),Ad=function(c){function a(a,d){var b=c.call(this)||this;b.id=a;b.Na=d;b.ke=[];b.node=null;b.Tb="GroupAction";return b}p(a,c);a.prototype.Ob=function(a){var b;this.ke.length=0;var c=this.Na;var f=0;for(b=c.length;f<b;f++){var g=c[f];(g=a.za(g))&&this.ke.push({node:g,parent:g.parent,index:g.parent.gk(g)})}this.node=a.Kg(this.id,this.Na)};a.prototype.jb=
function(a){var b,c;if(0!==this.Na.length&&this.node){for(b=c=this.Na.length-1;0<=c&&!(0>b);b=c+=-1)b=this.ke[b],b.parent&&b.node&&a.qb(b.parent,b.node,b.index);a.removeNode(this.node)}};a.prototype.toString=function(){return"GroupAction("+JSON.stringify(this.Na)+")"};return a}(Ie),ke=function(c){function a(a){var b=c.call(this)||this;b.Na=a;b.Bd=[];b.Tb="UngroupAction";return b}p(a,c);a.prototype.Ob=function(a){var b,c,f={};var g=this.Na;var h=0;for(b=g.length;h<b;h++){var k=g[h];k=a.za(k);if(k instanceof
ld){var l=k;if(!(l.id in f)){f[l.id]=!0;var n={node:l,parent:l.parent,children:l.children.concat(),index:0};var m=n.children;var q=0;for(c=m.length;q<c;q++)k=m[q],a.qb(l.parent,k,-1);n.index=a.removeNode(l);this.Bd.push(n)}}}};a.prototype.jb=function(a){var b,c,f,g;if(0!==this.Bd.length){for(b=f=this.Bd.length-1;0<=f&&!(0>b);b=f+=-1)if(b=this.Bd[b],0!==b.children.length)for(a.qb(b.parent,b.node,b.index),c=g=b.children.length-1;0<=g&&!(0>c);c=g+=-1)a.qb(b.node,b.children[c],-1);a.mi=!0}};return a}(Ie);
function Je(c,a){var b;if(c.Sn()){var d=c.children;var e=0;for(b=d.length;e<b;e++){var f=d[e];Je(f,a)}}else c.transform(a)}
var me=function(c){function a(a,d,e){var b=c.call(this)||this;b.Na=a;b.offsetX=d;b.offsetY=e;b.ra=[];b.Tb="DuplicateAction";return b}p(a,c);a.prototype.Ob=function(a){var b;var c=new L(this.offsetX,this.offsetY);this.ra.length=0;var f=function(){return a.Ua()};var g=this.Na;var h=0;for(b=g.length;h<b;h++){var k=g[h];if(k=a.za(k))k=k.clone(f),Je(k,c),a.Gf(k),this.ra.push(k)}};a.prototype.jb=function(a){var b,c;if(0!==this.ra.length)for(b=c=this.ra.length-1;0<=c&&!(0>b);b=c+=-1)a.removeNode(this.ra[b])};
return a}(Ie),je=function(c){function a(a,d,e){var b=c.call(this)||this;b.Na=a;b.type=d;b.fo=e;b.ra=[];b.Nk=[];b.Tb="ChangeOrderAction";return b}p(a,c);a.prototype.Ob=function(b){var c,e;this.Nk.length=0;this.ra.length=0;var f=this.Na;var g=0;for(e=f.length;g<e;g++){var h=f[g];if(h=b.za(h))if(c=h.parent){var k=h.Se();this.Nk.push(k);this.ra.push(h);switch(this.type){case a.Wl:b.qb(c,h,-1);break;case a.sj:b.qb(c,h,0);break;case a.dm:0<k?b.qb(c,h,k-1):b.qb(c,h,k);break;case a.em:k<c.children.length?
b.qb(c,h,k+1):b.qb(c,h,k);break;case a.hm:void 0===this.fo?b.qb(c,h,-1):b.qb(c,h,this.fo)}}}};a.prototype.jb=function(a){var b,c,f;if(0!==this.Na.length)for(b=f=this.Na.length-1;0<=f&&!(0>b);b=f+=-1){var g=this.ra[b];(c=g.parent)&&g&&a.qb(c,g,this.Nk[b])}};a.Wl=0;a.sj=1;a.em=2;a.dm=3;a.hm=4;return a}(Ie),ye=function(c){function a(a,d,e){var b=c.call(this)||this;b.id=a;b.bu=d;b.au=e;b.Tb="MoveNodeAction";b.ko=0;b.We=0;return b}p(a,c);a.prototype.Ob=function(a){var b=a.za(this.id),c=a.za(this.bu);if(c&&
!(c instanceof ld)&&b)throw console.log("FATAL: Parent node: "+c.id+":"+c.type()+" child "+b.id+":"+b.type()),Error("Tried to move to a non-group node!");b&&b.parent&&c&&(this.ko=b.parent.id,this.We=b.Se(),a.qb(c,b,this.au))};a.prototype.jb=function(a){var b=a.za(this.id),c=a.za(this.ko);b&&b.parent&&c&&a.qb(c,b,this.We)};return a}(Ie),Bd=function(c){function a(a){var b=c.call(this)||this;b.aa=a;b.Fd={};b.Tb="SetDocumentPropertiesAction";return b}p(a,c);a.prototype.Ob=function(a){var b;this.Fd={};
for(b in this.aa)this.aa.hasOwnProperty(b)&&(this.Fd[b]=a.la(b),a.setProperty(b,this.aa[b]))};a.prototype.jb=function(a){for(var b in this.Fd)this.Fd.hasOwnProperty(b)&&a.setProperty(b,this.Fd[b])};return a}(Ie),Ae=function(c){function a(a){var b=c.call(this)||this;b.Ms=a;b.jo=0;b.Tb="SetPageAction";return b}p(a,c);a.prototype.Ob=function(a){this.jo=a.Wa;a.Bb(this.Ms)};a.prototype.jb=function(a){a.Bb(this.jo)};return a}(Ie);var Ke=function(c){function a(b,d){var e=c.call(this,b,d,a)||this;e.log=B.create("PAGE",!0);e.children=[];return e}p(a,c);a.prototype.type=function(){return"PageNode"};a.prototype.format=function(){};a.prototype.gb=function(){return null};a.prototype.ja=function(){};return a}(ld);R.Sc("PageNode",Ke);var Le=function(){function c(){this.log=B.create("NullObserver")}c.prototype.createNode=function(a,b,c,e){this.log("Create node "+e.type+" "+a+" at "+b+":"+c)};c.prototype.rc=function(a,b,c){this.log("Delete node "+a+" from "+b+":"+c)};c.prototype.je=function(a,b,c,e,f){this.log("Move node "+a+" from "+e+":"+f+" to "+b+":"+c)};c.prototype.Cb=function(a,b){this.log("Set properties for node "+a+" to "+JSON.stringify(b))};return c}(),zd=function(c){function a(a){void 0===a&&(a=!1);var b=c.call(this)||
this;b.Tu=a;b.Zc=new Le;b.ye=new Qb;b.ra={};b.ne=new t;b.pn=!0;b.mi=!0;b.lb=0;b.Yc=new t;b.removedNodes=new t;b.Td=new t;b.root=new ld(b.Ua(),b);b.Wi=0;b.wl="magenta";b.readOnly=!1;b.Hb=new t;b.$j=new t;b.aa={};b.xi=new t;b.Vl=new t;b.rd=[];b.$a=[];b.Wa=0;b.gi=0;b.ag=0;b.Co=0;b.log=B.create("DOC");b.ra[b.root.id]=b.root;b.$n();a||(b.xj(b.root,0),b.Bb(b.ah(0)));return b}p(a,c);a.prototype.empty=function(){return 0===this.root.children.length};a.prototype.$n=function(){this.Co=this.ye.next};a.prototype.Vd=
function(){return this.Co!==this.ye.next};a.prototype.Ua=function(){for(;;){var a=this.lb++;if(!(a in this.ra))return a}};a.prototype.Pe=function(a){return a in this.ra};a.prototype.xj=function(a,c,e,f,g){void 0===e&&(e=!0);void 0===f&&(f=null);void 0===g&&(g=0);var b,d=!1;if(a.id in this.ra)null!==f&&a.parent&&(this.Zc.je(a.id,a.parent.id,a.Se(),f,g),this.log("Node %s inserted at %s:%s; was at %s",a.id,a.parent.id,a.Se(),g));else if(d=!0,this.ra[a.id]=a,a.parent&&(f=a.tc(),f.type=a.type(),this.Zc.createNode(a.id,
a.parent.id,a.Se(),f)),a instanceof ld){var l=a.children;g=0;for(b=l.length;g<b;g++)f=l[g],this.xj(f,c,e)}"PageNode"!==a.type()&&d&&(this.Yc.add(a.id),this.removedNodes.remove(a.id));a.pg(this.readOnly);e&&this.ne.add(a.id);this.Vl.add(a.Wf());a.la("spotHighlight")&&"PathNode"===a.type()&&this.rd.push(a);this.ag=void 0===c||null===c?this.ee(a.id)||0:c;a.la("wallAffinity")&&this.$j.add(a.id);"WallNode"===a.type()&&this.Hb.add(a.id);d&&a.Pk()};a.prototype.$f=function(a){this.Td.add(a);this.ag=this.ee(a)||
0;this.ne.add(a)};a.prototype.Gf=function(a){this.$a[this.Wa]||console.log("FATAL: Asked to add a node but bad page.",this.Wa,this.$a);this.qb(this.$a[this.Wa],a,-1)};a.prototype.za=function(a,c){void 0===c&&(c=!1);if(a in this.ra){var b=this.ra[a];c&&(this.ne.add(a),this.Td.add(a),this.ag=this.ee(a)||0);return b}return null};a.prototype.ee=function(a){for(a=this.za(a,!1);;)if(a)if("PageNode"===a.type())break;else{if(null===a.parent)return null;a=a.parent}else return null;for(var b=0;b<this.$a.length;b++)if(this.$a[b]===
a)return b;return null};a.prototype.qk=function(a,c,e){for(var b=[],d=0;d<a.length;d++){var h=this.za(a[d],e);h&&b.push(h)}return b=c?this.Mq(b):this.Wh(b)};a.prototype.Sq=function(a){var b=[],c;for(c in this.ra)if(this.ra.hasOwnProperty(c)){var f=this.ra[c];f.la("tag")===a&&b.push(f)}return b};a.prototype.ta=function(a,c){void 0===c&&(c=!1);this.Yc=new t;this.removedNodes=new t;this.Td=new t;if(c){this.log("Performing actions without adding to undo stack");for(var b=0;b<a.length;b++)a[b].Ob(this)}else this.ye.ta(a,
!1,this);return{bd:this.Yc.td(),jf:this.removedNodes.td(),uf:this.Td.Of(this.Yc).Of(this.removedNodes).td()}};a.prototype.jb=function(){this.Yc=new t;this.removedNodes=new t;this.Td=new t;this.ye.jb(this);return{bd:this.Yc.td(),jf:this.removedNodes.td(),uf:this.Td.Of(this.Yc).Of(this.removedNodes).td()}};a.prototype.Jd=function(){this.Yc=new t;this.removedNodes=new t;this.Td=new t;this.ye.Jd(this);return{bd:this.Yc.td(),jf:this.removedNodes.td(),uf:this.Td.Of(this.Yc).Of(this.removedNodes).td()}};
a.prototype.Ie=function(){return this.ye.Ie()};a.prototype.He=function(){return this.ye.He()};a.prototype.oh=function(){this.ye=new Qb};a.prototype.format=function(a,c){var b=this,d;var g=[];if(this.pn)for(m in this.ra)g.push(this.ra[m]);else this.ne.yb(function(a){g.push(b.ra[parseInt(a,10)]);return!1});var h=this.Wh(g);var k=[],l=[];var n=0;for(d=h.length;n<d;n++){var m=h[n];"WallNode"!==m.type()?(m.format(a,c),m.la("wallAffinity")&&k.push(m)):l.push(m)}if(!this.Hb.empty()){var q=new t,u,v,A=this,
x;A.Hb.yb(function(a){a=parseInt(a,10);for(x=0;x<k.length;x++)u=k[x],A.ra[a].resolve(u)&&h.push(A.ra[a]),q.add(a+"_"+u.id);return!1});A.$j.yb(function(a){a=parseInt(a,10);for(x=0;x<l.length;x++)v=l[x],q.contains(v.id+"_"+a)||v.resolve(A.ra[a])&&h.push(v);return!1});n=0;for(d=h.length;n<d;n++)m=h[n],"WallNode"!==m.type()||q.contains(m.id)||(q.add(m.id),m.format(a,c))}this.ne.clear();this.pn=!1;return g.length};a.prototype.Eq=function(a,c,e){if(0!==this.rd.length&&c===this.Wi){a.save();a.beginPath();
c=e||this.Ue();a.moveTo(c.x,c.y);a.lineTo(c.x,c.bottom());a.lineTo(c.right(),c.bottom());a.lineTo(c.right(),c.y);a.closePath();e=!1;for(var b=0;b<this.rd.length;b++)this.rd[b].page===this.$a[this.Wa]&&(this.rd[b].clip(a),e=!0);e&&(a.clip(),a.fillStyle=this.wl,a.fillRect(c.x,c.y,c.width,c.height));a.restore()}};a.prototype.ja=function(a,c){function b(b){g.Qf(function(c){g.xi.contains(c.Ad())||c.Wf()===b&&(c.hidden()||c.ja(a))});g.Eq(a,b,c)}var d,g=this;this.Vl.add(this.Wi);var h=this.Vl.td();h.sort(function(a,
b){return a-b});var k=0;for(d=h.length;k<d;k++)b(h[k])};a.prototype.gb=function(a,c,e,f){var b=null;this.Qf(function(d){d.Ad()===e&&d.gb(a,c)&&(!(null===b||b.Wf()<=d.Wf())||f&&f!==d.type()||(b=d))});return b};a.prototype.Gr=function(a){var b=[];this.Qf(function(c){a.contains(c.rect)&&b.push(c)});return b};a.prototype.Wh=function(a){var b,c;var f=[];var g={};var h=0;for(c=a.length;h<c;h++){for(b=a[h];b.yk()&&b.parent;)this.log("Node type %s:%s is a group member",b.id,b.type()),b=b.parent;b.id in g||
(g[b.id]=b,f.push(b))}this.St(f);return f};a.prototype.Mq=function(a){function b(a){if(!(a.id in f)&&(f[a.id]=a,c.push(a),a.children))for(var d=0;d<a.children.length;d++)b(a.children[d])}for(var c=[],f={},g=0;g<a.length;g++)b(a[g]);return c};a.prototype.yb=function(a,c){function b(d){var e;if(d.children){a&&c(d);var f=d.children;var k=0;for(e=f.length;k<e;k++)d=f[k],b(d)}else c(d)}b(this.root)};a.prototype.Qf=function(a,c){function b(c){if(c.children)for(var d=0;d<c.children.length;d++)b(c.children[d]);
else"PageNode"!==c.type()&&a(c)}void 0===c&&(c=this.Wa);c<this.$a.length&&b(this.$a[c||0])};a.prototype.filter=function(a){var b=[];this.yb(!1,function(c){if(a(c))return b.push(c)});return b};a.prototype.St=function(a){var b=0;this.mi&&(this.mi=!1,this.yb(!0,function(a){a.order=b++}));a.sort(function(a,b){return a.order-b.order})};a.prototype.Kg=function(a,c){var b;var d=new ld(a,this);this.Gf(d);var g=0;for(b=c.length;g<b;g++){var h=c[g];this.qb(d,this.ra[h],-1)}return d};a.prototype.lt=function(a){var b,
c=[];var f=0;var g=this.Wh(a);var h=0;for(b=g.length;h<b;h++)a=g[h],f=this.wm(a,c,f);return"zwibblerclip."+JSON.stringify(c)};a.prototype.wm=function(a,c,e){var b;if(a.children){var d=[];var h=a.children;var k=0;for(b=h.length;k<b;k++)a=h[k],e=this.wm(a,c,e),d.push(e-1);c.push({type:"GroupAction",members:d})}else{k=a.tc();h={};for(d in k)k.hasOwnProperty(d)&&(b=k[d],b instanceof M&&(b=["Matrix",b.m11,b.m12,b.m21,b.m22,b.Ca,b.Da]),h[d]=b);c.push({type:"CreateAction",node:a.type(),properties:h})}return e+
1};a.prototype.Yn=function(a,c){var b,d;0===a.indexOf("zwibblerclip.")&&(a=a.substr(13));var g=JSON.parse(a);var h=[];var k={},l=0;var n=0;for(d=g.length;n<d;n++){var m=g[n];if("GroupAction"===m.type){var q=this.Ua();k[l++]=q;var u=[];var v=0;for(m=m.members;v<m.length;v++)u.push(k[m[v]]);h.push(new Ad(q,u));c.push(q)}else if("CreateAction"===m.type){v=m.properties;u={};for(b in v)v.hasOwnProperty(b)&&(q=v[b],"[object Array]"===Object.prototype.toString.apply(q)&&"Matrix"===q[0]&&(q.splice(0,1),q=
new M(q)),u[b]=q);q=this.Ua();k[l++]=q;h.push(new V(q,m.node,u));c.push(q)}}return h};a.prototype.qb=function(a,c,e){var b=null,d=0;c.parent&&(b=c.parent.id,d=c.Se(),this.removeNode(c,!1));-1===e?a.children.push(c):a.children.splice(e,0,c);c instanceof Ke&&(-1===e?this.$a.push(c):this.$a.splice(e,0,c));c.parent=a;this.xj(c,this.ee(a.id),!0,b,d);this.mi=!0};a.prototype.ht=function(a,c){var b="function"!==typeof c?function(a){return a===c}:c;for(var d=0,g=0;g<a.length;g++)b(a[g])?d+=1:d&&(a[g-d]=a[g]);
a.length-=d};a.prototype.removeNode=function(a,c){void 0===c&&(c=!0);var b=this,d=this.ee(a.id);if(!a.parent||null===d)return this.log("Error: removeNode -- should not happen!"),-1;var g=a.parent.gk(a);if(0<=g&&(c&&this.Zc.rc(a.id,a.parent.id,g),a.parent.children.splice(g,1),a.parent=null,c)){var h=function(a){var c;delete b.ra[a.id];b.Yc.remove(a.id);b.removedNodes.add(a.id);a.Rk();b.ne.remove(a.id);if(a.children){var d=a.children;var e=0;for(c=d.length;e<c;e++){var f=d[e];h(f)}}a.la("spotHighlight")&&
b.ht(b.rd,a);b.Hb.remove(a.id);b.$j.remove(a.id)};h(a)}"PageNode"===a.type()?(this.$a.splice(g,1),g===this.Wa&&(this.log("Removed current page."),this.Bb(Math.min(g,this.$a.length-1)),this.ag=this.Wa)):this.ag=d;return g};a.prototype.tn=function(){var a=0,c=0,e=0,f=0,g=!1;this.yb(!1,function(b){if(!g||b.rect.x<a)a=b.rect.x;if(!g||b.rect.right()>c)c=b.rect.right();if(!g||b.rect.y<e)e=b.rect.y;if(!g||b.rect.bottom()>f)f=b.rect.bottom();g=!0});return g?new K(a,e,c-a,f-e):new K(0,0,10,10)};a.prototype.Ue=
function(){return this.aa.width?new K(0,0,this.aa.width,this.aa.height):this.tn()};a.prototype.la=function(a){return this.aa[a]};a.prototype.Ur=function(){return"width"in this.aa};a.prototype.setProperty=function(a,c){null===c?a in this.aa&&delete this.aa[a]:this.aa[a]=c;var b={};b[a]=c;this.Zc.Cb(this.root.id,b)};a.prototype.se=function(a,c,e){a===this.root&&this.setProperty(c,e);a.setProperty(c,e);var b={};b[c]=e;this.Zc.Cb(a.id,b);if("spotHighlight"===c&&"PathNode"===a.type()){for(c=0;c<this.rd.length;c++)if(this.rd[c]===
a){this.rd.splice(c,1);break}e?(this.log("Added node %s to spotHighlightNodes",a.id),this.rd.push(a)):this.log("Removed node %s from spotHighlightNodes",a.id)}};a.prototype.vh=function(a,c){this.log("showLayer(%s, %s)",a,c);c?this.xi.remove(a):this.xi.add(a)};a.prototype.zk=function(a){return!this.xi.contains(a)};a.prototype.ah=function(a){this.log("Adding page to document with index %s",a);if(a>this.$a.length)return this.log("Error: Can insert page with index %s",a),-1;var b=R.create("PageNode",
this.Ua(),this);this.qb(this.root,b,a);return a};a.prototype.Cc=function(){return this.$a.length};a.prototype.Bb=function(a){if(a!==this.Wa){if(0<=a&&a<this.$a.length)return this.log("Set current page to %s/%s",a,this.$a.length),this.Wa=a,!0;this.log("Tried to set page to non-existing %s",a);return!1}};a.prototype.Mt=function(){this.gi!==this.Wa&&(this.gi<this.$a.length&&this.Fl(this.gi,!1),this.Fl(this.Wa,!0),this.gi=this.Wa)};a.prototype.Fl=function(a,c){this.Qf(function(a){"DomNode"===a.type()&&
(c?a.Pk():a.Rk())},a)};a.prototype.sk=function(a){return 0===this.$a.length?this.root:void 0===a?this.$a[this.Wa]:this.$a[a]};a.prototype.tk=function(){var a=816,c=1056;"width"in this.aa&&(a=this.aa.width);"height"in this.aa&&(c=this.aa.height);return new xc(a,c)};a.prototype.pg=function(a){this.yb(!1,function(b){b.pg(a)})};a.prototype.getRootNode=function(){return this.root};a.prototype.Et=function(a,c){void 0===c&&(c=!0);this.Zc=a;c&&(this.Zc.Cb(this.root.id,this.aa),this.yb(!0,function(b){if(b.parent){var c=
b.tc();c.type=b.type();a.createNode(b.id,b.parent.id,b.Se(),c)}}))};return a}(Hb);}).call(window);
